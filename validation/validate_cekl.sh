nohup: ignoring input
2023-12-04 00:49:16.152342: I tensorflow/core/util/port.cc:110] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2023-12-04 00:49:16.201268: I tensorflow/core/platform/cpu_feature_guard.cc:182] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-12-04 00:49:16.951902: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Could not find TensorRT
Found cached dataset truthful_qa (/home/elicer/.cache/huggingface/datasets/truthful_qa/multiple_choice/1.1.0/63502f6bc6ee493830ce0843991b028d0ab568d221896b2ee3b8a5dfdaa9d7f4)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 365.61it/s]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:00<00:00,  5.29it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  6.28it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  6.10it/s]
head_wise_activation_length:(11012, 32, 4096)
labels_shape:(11012,)
seperated_head_activation shape:11013
Running fold 0
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:28,  1.10it/s]  6%|▋         | 2/32 [00:01<00:27,  1.07it/s]  9%|▉         | 3/32 [00:02<00:26,  1.10it/s] 12%|█▎        | 4/32 [00:03<00:24,  1.12it/s] 16%|█▌        | 5/32 [00:04<00:24,  1.12it/s] 19%|█▉        | 6/32 [00:05<00:23,  1.09it/s] 22%|██▏       | 7/32 [00:06<00:22,  1.09it/s] 25%|██▌       | 8/32 [00:07<00:22,  1.06it/s] 28%|██▊       | 9/32 [00:08<00:22,  1.03it/s] 31%|███▏      | 10/32 [00:09<00:21,  1.00it/s] 34%|███▍      | 11/32 [00:10<00:21,  1.02s/it] 38%|███▊      | 12/32 [00:11<00:20,  1.02s/it] 41%|████      | 13/32 [00:12<00:19,  1.03s/it] 44%|████▍     | 14/32 [00:13<00:18,  1.05s/it] 47%|████▋     | 15/32 [00:14<00:17,  1.04s/it] 50%|█████     | 16/32 [00:15<00:16,  1.04s/it] 53%|█████▎    | 17/32 [00:16<00:15,  1.05s/it] 56%|█████▋    | 18/32 [00:17<00:14,  1.06s/it] 59%|█████▉    | 19/32 [00:19<00:14,  1.09s/it] 62%|██████▎   | 20/32 [00:20<00:13,  1.11s/it] 66%|██████▌   | 21/32 [00:21<00:12,  1.12s/it] 69%|██████▉   | 22/32 [00:22<00:11,  1.10s/it] 72%|███████▏  | 23/32 [00:23<00:10,  1.13s/it] 75%|███████▌  | 24/32 [00:24<00:09,  1.18s/it] 78%|███████▊  | 25/32 [00:26<00:08,  1.16s/it] 81%|████████▏ | 26/32 [00:27<00:06,  1.15s/it] 84%|████████▍ | 27/32 [00:28<00:05,  1.18s/it] 88%|████████▊ | 28/32 [00:29<00:04,  1.13s/it] 91%|█████████ | 29/32 [00:30<00:03,  1.14s/it] 94%|█████████▍| 30/32 [00:31<00:02,  1.12s/it] 97%|█████████▋| 31/32 [00:32<00:01,  1.13s/it]100%|██████████| 32/32 [00:34<00:00,  1.22s/it]100%|██████████| 32/32 [00:34<00:00,  1.07s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
/home/elicer/honest_llama/validation/../TruthfulQA/truthfulqa/metrics.py:284: FutureWarning: load_metric is deprecated and will be removed in the next major version of datasets. Use 'evaluate.load' instead, from the new library 🤗 Evaluate: https://huggingface.co/docs/evaluate
  bleurt = load_metric("bleurt", cache_dir=cache_dir)
[[0.651 0.665 0.645 ... 0.646 0.647 0.652]
 [0.659 0.644 0.645 ... 0.648 0.658 0.656]
 [0.651 0.657 0.685 ... 0.637 0.648 0.667]
 ...
 [0.765 0.762 0.657 ... 0.73  0.704 0.674]
 [0.748 0.678 0.696 ... 0.663 0.769 0.786]
 [0.775 0.815 0.74  ... 0.697 0.809 0.79 ]]
Heads intervened:  [(8, 16), (12, 4), (13, 8), (13, 16), (16, 30), (17, 29), (18, 29), (19, 17), (20, 30), (22, 16), (23, 3), (31, 6)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
2023-12-04 00:50:08.154563: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1635] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 24961 MB memory:  -> device: 0, name: NVIDIA A100 80GB PCIe MIG 3g.40gb, pci bus id: 0000:65:00.0, compute capability: 8.0
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 266.61it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-ec0cf83741fdb3e8.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-d31e6c0c76fafb4d.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:01<01:42,  1.04s/it]  3%|▎         | 3/100 [00:01<00:29,  3.24it/s]  5%|▌         | 5/100 [00:01<00:16,  5.63it/s]  7%|▋         | 7/100 [00:01<00:11,  7.99it/s]  9%|▉         | 9/100 [00:01<00:08, 10.19it/s] 11%|█         | 11/100 [00:01<00:07, 12.11it/s] 13%|█▎        | 13/100 [00:01<00:06, 13.72it/s] 15%|█▌        | 15/100 [00:01<00:05, 14.99it/s] 17%|█▋        | 17/100 [00:01<00:05, 15.98it/s] 19%|█▉        | 19/100 [00:02<00:04, 16.69it/s] 21%|██        | 21/100 [00:02<00:04, 17.25it/s] 23%|██▎       | 23/100 [00:02<00:04, 17.65it/s] 25%|██▌       | 25/100 [00:02<00:04, 17.93it/s] 27%|██▋       | 27/100 [00:02<00:04, 18.14it/s] 29%|██▉       | 29/100 [00:02<00:03, 18.30it/s] 31%|███       | 31/100 [00:02<00:03, 18.39it/s] 33%|███▎      | 33/100 [00:02<00:03, 18.47it/s] 35%|███▌      | 35/100 [00:02<00:03, 18.53it/s] 37%|███▋      | 37/100 [00:02<00:03, 18.49it/s] 39%|███▉      | 39/100 [00:03<00:03, 18.26it/s] 41%|████      | 41/100 [00:03<00:03, 18.35it/s] 43%|████▎     | 43/100 [00:03<00:03, 18.45it/s] 45%|████▌     | 45/100 [00:03<00:02, 18.52it/s] 47%|████▋     | 47/100 [00:03<00:02, 18.57it/s] 49%|████▉     | 49/100 [00:03<00:02, 18.61it/s] 51%|█████     | 51/100 [00:03<00:02, 18.63it/s] 53%|█████▎    | 53/100 [00:03<00:02, 18.65it/s] 55%|█████▌    | 55/100 [00:03<00:02, 18.66it/s] 57%|█████▋    | 57/100 [00:04<00:02, 18.67it/s] 59%|█████▉    | 59/100 [00:04<00:02, 18.67it/s] 61%|██████    | 61/100 [00:04<00:02, 18.68it/s] 63%|██████▎   | 63/100 [00:04<00:01, 18.68it/s] 65%|██████▌   | 65/100 [00:04<00:01, 18.67it/s] 67%|██████▋   | 67/100 [00:04<00:01, 18.68it/s] 69%|██████▉   | 69/100 [00:04<00:01, 18.68it/s] 71%|███████   | 71/100 [00:04<00:01, 18.69it/s] 73%|███████▎  | 73/100 [00:04<00:01, 18.69it/s] 75%|███████▌  | 75/100 [00:05<00:01, 18.69it/s] 77%|███████▋  | 77/100 [00:05<00:01, 18.68it/s] 79%|███████▉  | 79/100 [00:05<00:01, 18.68it/s] 81%|████████  | 81/100 [00:05<00:01, 18.68it/s] 83%|████████▎ | 83/100 [00:05<00:00, 18.69it/s] 85%|████████▌ | 85/100 [00:05<00:00, 18.70it/s] 87%|████████▋ | 87/100 [00:05<00:00, 18.67it/s] 89%|████████▉ | 89/100 [00:05<00:00, 18.68it/s] 91%|█████████ | 91/100 [00:05<00:00, 18.68it/s] 93%|█████████▎| 93/100 [00:05<00:00, 18.62it/s] 95%|█████████▌| 95/100 [00:06<00:00, 18.63it/s] 97%|█████████▋| 97/100 [00:06<00:00, 18.65it/s] 99%|█████████▉| 99/100 [00:06<00:00, 18.66it/s]100%|██████████| 100/100 [00:06<00:00, 15.75it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 351.69it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-1939fcc1eeebdaa7.arrow
Map:   0%|          | 0/100 [00:00<?, ? examples/s]/home/elicer/honest_llama/validation/../utils.py:600: UserWarning: To copy construct from a tensor, it is recommended to use sourceTensor.clone().detach() or sourceTensor.clone().detach().requires_grad_(True), rather than torch.tensor(sourceTensor).
  owt = dataset.map(lambda x: {'input_ids': torch.tensor(tokenizer(x['text'], return_tensors='pt')['input_ids'][:,:128])})
Token indices sequence length is longer than the specified maximum sequence length for this model (2286 > 2048). Running this sequence through the model will result in indexing errors
Map:  19%|█▉        | 19/100 [00:00<00:00, 170.65 examples/s]Map:  45%|████▌     | 45/100 [00:00<00:00, 210.25 examples/s]Map:  68%|██████▊   | 68/100 [00:00<00:00, 215.99 examples/s]Map:  96%|█████████▌| 96/100 [00:00<00:00, 189.37 examples/s]                                                               0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:15,  6.27it/s]  2%|▏         | 2/100 [00:00<00:13,  7.09it/s]  3%|▎         | 3/100 [00:00<00:13,  7.40it/s]  4%|▍         | 4/100 [00:00<00:12,  7.57it/s]  5%|▌         | 5/100 [00:00<00:12,  7.65it/s]  6%|▌         | 6/100 [00:00<00:12,  7.70it/s]  7%|▋         | 7/100 [00:00<00:12,  7.75it/s]  8%|▊         | 8/100 [00:01<00:11,  7.77it/s]  9%|▉         | 9/100 [00:01<00:11,  7.79it/s] 10%|█         | 10/100 [00:01<00:11,  7.79it/s] 11%|█         | 11/100 [00:01<00:11,  7.80it/s] 12%|█▏        | 12/100 [00:01<00:11,  7.82it/s] 13%|█▎        | 13/100 [00:01<00:11,  7.81it/s] 14%|█▍        | 14/100 [00:01<00:11,  7.77it/s] 15%|█▌        | 15/100 [00:01<00:10,  7.78it/s] 16%|█▌        | 16/100 [00:02<00:10,  7.79it/s] 17%|█▋        | 17/100 [00:02<00:10,  7.81it/s] 18%|█▊        | 18/100 [00:02<00:10,  7.82it/s] 19%|█▉        | 19/100 [00:02<00:10,  7.81it/s] 20%|██        | 20/100 [00:02<00:10,  7.68it/s] 21%|██        | 21/100 [00:02<00:10,  7.71it/s] 22%|██▏       | 22/100 [00:02<00:10,  7.75it/s] 23%|██▎       | 23/100 [00:02<00:09,  7.77it/s] 24%|██▍       | 24/100 [00:03<00:09,  7.79it/s] 25%|██▌       | 25/100 [00:03<00:09,  7.75it/s] 26%|██▌       | 26/100 [00:03<00:09,  7.77it/s] 27%|██▋       | 27/100 [00:03<00:09,  7.79it/s] 28%|██▊       | 28/100 [00:03<00:09,  7.79it/s] 29%|██▉       | 29/100 [00:03<00:09,  7.81it/s] 30%|███       | 30/100 [00:03<00:08,  7.80it/s] 31%|███       | 31/100 [00:04<00:08,  7.80it/s] 32%|███▏      | 32/100 [00:04<00:08,  7.82it/s] 33%|███▎      | 33/100 [00:04<00:08,  7.82it/s] 34%|███▍      | 34/100 [00:04<00:08,  7.83it/s] 35%|███▌      | 35/100 [00:04<00:08,  7.81it/s] 36%|███▌      | 36/100 [00:04<00:08,  7.75it/s] 37%|███▋      | 37/100 [00:04<00:08,  7.78it/s] 38%|███▊      | 38/100 [00:04<00:07,  7.79it/s] 39%|███▉      | 39/100 [00:05<00:07,  7.80it/s] 40%|████      | 40/100 [00:05<00:07,  7.80it/s] 41%|████      | 41/100 [00:05<00:07,  7.80it/s] 42%|████▏     | 42/100 [00:05<00:07,  7.81it/s] 43%|████▎     | 43/100 [00:05<00:07,  7.81it/s] 44%|████▍     | 44/100 [00:05<00:07,  7.82it/s] 45%|████▌     | 45/100 [00:05<00:07,  7.82it/s] 46%|████▌     | 46/100 [00:05<00:06,  7.81it/s] 47%|████▋     | 47/100 [00:06<00:06,  7.82it/s] 48%|████▊     | 48/100 [00:06<00:06,  7.44it/s] 49%|████▉     | 49/100 [00:06<00:06,  7.56it/s] 50%|█████     | 50/100 [00:06<00:06,  7.63it/s] 51%|█████     | 51/100 [00:06<00:06,  7.67it/s] 52%|█████▏    | 52/100 [00:06<00:06,  7.69it/s] 53%|█████▎    | 53/100 [00:06<00:06,  7.73it/s] 54%|█████▍    | 54/100 [00:06<00:05,  7.77it/s] 55%|█████▌    | 55/100 [00:07<00:05,  7.78it/s] 56%|█████▌    | 56/100 [00:07<00:05,  7.78it/s] 57%|█████▋    | 57/100 [00:07<00:05,  7.81it/s] 58%|█████▊    | 58/100 [00:07<00:05,  7.81it/s] 59%|█████▉    | 59/100 [00:07<00:05,  7.81it/s] 60%|██████    | 60/100 [00:07<00:05,  7.81it/s] 61%|██████    | 61/100 [00:07<00:04,  7.80it/s] 62%|██████▏   | 62/100 [00:08<00:04,  7.81it/s] 63%|██████▎   | 63/100 [00:08<00:04,  7.81it/s] 64%|██████▍   | 64/100 [00:08<00:04,  7.83it/s] 65%|██████▌   | 65/100 [00:08<00:04,  7.81it/s] 66%|██████▌   | 66/100 [00:08<00:04,  7.80it/s] 67%|██████▋   | 67/100 [00:08<00:04,  7.82it/s] 68%|██████▊   | 68/100 [00:08<00:04,  7.79it/s] 69%|██████▉   | 69/100 [00:08<00:03,  7.80it/s] 70%|███████   | 70/100 [00:09<00:03,  7.80it/s] 71%|███████   | 71/100 [00:09<00:03,  7.80it/s] 72%|███████▏  | 72/100 [00:09<00:03,  7.81it/s] 73%|███████▎  | 73/100 [00:09<00:03,  7.81it/s] 74%|███████▍  | 74/100 [00:09<00:03,  7.82it/s] 75%|███████▌  | 75/100 [00:09<00:03,  7.81it/s] 76%|███████▌  | 76/100 [00:09<00:03,  7.81it/s] 77%|███████▋  | 77/100 [00:09<00:02,  7.82it/s] 78%|███████▊  | 78/100 [00:10<00:02,  7.82it/s] 79%|███████▉  | 79/100 [00:10<00:02,  7.82it/s] 80%|████████  | 80/100 [00:10<00:02,  7.82it/s] 81%|████████  | 81/100 [00:10<00:02,  7.81it/s] 82%|████████▏ | 82/100 [00:10<00:02,  7.83it/s] 83%|████████▎ | 83/100 [00:10<00:02,  7.83it/s] 84%|████████▍ | 84/100 [00:10<00:02,  7.73it/s] 85%|████████▌ | 85/100 [00:10<00:01,  7.75it/s] 86%|████████▌ | 86/100 [00:11<00:01,  7.76it/s] 87%|████████▋ | 87/100 [00:11<00:01,  7.79it/s] 88%|████████▊ | 88/100 [00:11<00:01,  7.80it/s] 89%|████████▉ | 89/100 [00:11<00:01,  7.81it/s] 90%|█████████ | 90/100 [00:11<00:01,  7.80it/s] 91%|█████████ | 91/100 [00:11<00:01,  7.80it/s] 92%|█████████▏| 92/100 [00:11<00:01,  7.80it/s] 93%|█████████▎| 93/100 [00:11<00:00,  7.81it/s] 94%|█████████▍| 94/100 [00:12<00:00,  7.82it/s] 95%|█████████▌| 95/100 [00:12<00:00,  7.81it/s] 96%|█████████▌| 96/100 [00:12<00:00,  7.81it/s] 97%|█████████▋| 97/100 [00:12<00:00,  7.82it/s] 98%|█████████▊| 98/100 [00:12<00:00,  7.82it/s] 99%|█████████▉| 99/100 [00:12<00:00,  7.83it/s]100%|██████████| 100/100 [00:12<00:00,  7.75it/s]100%|██████████| 100/100 [00:12<00:00,  7.77it/s]
FOLD 0
Metric     CE Loss  KL wrt Orig
Model                          
llama_7B  2.333701      0.15516
Running fold 1
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:30,  1.01it/s]  6%|▋         | 2/32 [00:02<00:33,  1.12s/it]  9%|▉         | 3/32 [00:03<00:34,  1.20s/it] 12%|█▎        | 4/32 [00:04<00:33,  1.21s/it] 16%|█▌        | 5/32 [00:06<00:33,  1.25s/it] 19%|█▉        | 6/32 [00:07<00:33,  1.28s/it] 22%|██▏       | 7/32 [00:08<00:32,  1.29s/it] 25%|██▌       | 8/32 [00:09<00:30,  1.28s/it] 28%|██▊       | 9/32 [00:11<00:29,  1.28s/it] 31%|███▏      | 10/32 [00:12<00:28,  1.28s/it] 34%|███▍      | 11/32 [00:13<00:26,  1.26s/it] 38%|███▊      | 12/32 [00:14<00:24,  1.24s/it] 41%|████      | 13/32 [00:16<00:23,  1.23s/it] 44%|████▍     | 14/32 [00:17<00:21,  1.22s/it] 47%|████▋     | 15/32 [00:18<00:20,  1.21s/it] 50%|█████     | 16/32 [00:19<00:19,  1.22s/it] 53%|█████▎    | 17/32 [00:20<00:18,  1.21s/it] 56%|█████▋    | 18/32 [00:22<00:16,  1.21s/it] 59%|█████▉    | 19/32 [00:23<00:16,  1.24s/it] 62%|██████▎   | 20/32 [00:24<00:15,  1.28s/it] 66%|██████▌   | 21/32 [00:26<00:14,  1.28s/it] 69%|██████▉   | 22/32 [00:27<00:12,  1.29s/it] 72%|███████▏  | 23/32 [00:28<00:11,  1.30s/it] 75%|███████▌  | 24/32 [00:30<00:10,  1.32s/it] 78%|███████▊  | 25/32 [00:31<00:09,  1.32s/it] 81%|████████▏ | 26/32 [00:32<00:07,  1.32s/it] 84%|████████▍ | 27/32 [00:34<00:06,  1.33s/it] 88%|████████▊ | 28/32 [00:35<00:05,  1.32s/it] 91%|█████████ | 29/32 [00:36<00:03,  1.32s/it] 94%|█████████▍| 30/32 [00:37<00:02,  1.31s/it] 97%|█████████▋| 31/32 [00:39<00:01,  1.30s/it]100%|██████████| 32/32 [00:40<00:00,  1.36s/it]100%|██████████| 32/32 [00:40<00:00,  1.27s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
[[0.666 0.672 0.662 ... 0.668 0.662 0.67 ]
 [0.662 0.662 0.659 ... 0.677 0.666 0.663]
 [0.668 0.67  0.68  ... 0.661 0.665 0.671]
 ...
 [0.758 0.75  0.674 ... 0.716 0.694 0.677]
 [0.749 0.671 0.686 ... 0.674 0.762 0.76 ]
 [0.765 0.805 0.748 ... 0.743 0.787 0.775]]
Heads intervened:  [(8, 16), (11, 17), (12, 4), (13, 8), (13, 16), (16, 17), (17, 13), (17, 29), (18, 29), (19, 17), (20, 30), (23, 3)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 253.89it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-30ec7b2da7888791.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-4e53eea82b0ecfef.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  2%|▏         | 2/100 [00:00<00:05, 17.12it/s]  4%|▍         | 4/100 [00:00<00:05, 18.03it/s]  6%|▌         | 6/100 [00:00<00:05, 18.29it/s]  8%|▊         | 8/100 [00:00<00:04, 18.47it/s] 10%|█         | 10/100 [00:00<00:04, 18.57it/s] 12%|█▏        | 12/100 [00:00<00:04, 18.65it/s] 14%|█▍        | 14/100 [00:00<00:04, 18.68it/s] 16%|█▌        | 16/100 [00:00<00:04, 18.60it/s] 18%|█▊        | 18/100 [00:00<00:04, 18.64it/s] 20%|██        | 20/100 [00:01<00:04, 18.71it/s] 22%|██▏       | 22/100 [00:01<00:04, 18.73it/s] 24%|██▍       | 24/100 [00:01<00:04, 18.77it/s] 26%|██▌       | 26/100 [00:01<00:03, 18.80it/s] 28%|██▊       | 28/100 [00:01<00:03, 18.82it/s] 30%|███       | 30/100 [00:01<00:03, 18.84it/s] 32%|███▏      | 32/100 [00:01<00:03, 18.87it/s] 34%|███▍      | 34/100 [00:01<00:03, 18.77it/s] 36%|███▌      | 36/100 [00:01<00:03, 18.73it/s] 38%|███▊      | 38/100 [00:02<00:03, 18.74it/s] 40%|████      | 40/100 [00:02<00:03, 18.66it/s] 42%|████▏     | 42/100 [00:02<00:03, 18.62it/s] 44%|████▍     | 44/100 [00:02<00:03, 18.64it/s] 46%|████▌     | 46/100 [00:02<00:02, 18.68it/s] 48%|████▊     | 48/100 [00:02<00:02, 18.69it/s] 50%|█████     | 50/100 [00:02<00:02, 18.71it/s] 52%|█████▏    | 52/100 [00:02<00:02, 18.73it/s] 54%|█████▍    | 54/100 [00:02<00:02, 18.75it/s] 56%|█████▌    | 56/100 [00:02<00:02, 18.80it/s] 58%|█████▊    | 58/100 [00:03<00:02, 18.83it/s] 60%|██████    | 60/100 [00:03<00:02, 18.84it/s] 62%|██████▏   | 62/100 [00:03<00:02, 18.81it/s] 64%|██████▍   | 64/100 [00:03<00:01, 18.80it/s] 66%|██████▌   | 66/100 [00:03<00:01, 18.81it/s] 68%|██████▊   | 68/100 [00:03<00:01, 18.71it/s] 70%|███████   | 70/100 [00:03<00:01, 17.99it/s] 72%|███████▏  | 72/100 [00:03<00:01, 18.12it/s] 74%|███████▍  | 74/100 [00:03<00:01, 18.21it/s] 76%|███████▌  | 76/100 [00:04<00:01, 18.31it/s] 78%|███████▊  | 78/100 [00:04<00:01, 18.39it/s] 80%|████████  | 80/100 [00:04<00:01, 18.46it/s] 82%|████████▏ | 82/100 [00:04<00:00, 18.49it/s] 84%|████████▍ | 84/100 [00:04<00:00, 18.54it/s] 86%|████████▌ | 86/100 [00:04<00:00, 18.57it/s] 88%|████████▊ | 88/100 [00:04<00:00, 18.53it/s] 90%|█████████ | 90/100 [00:04<00:00, 18.50it/s] 92%|█████████▏| 92/100 [00:04<00:00, 18.50it/s] 94%|█████████▍| 94/100 [00:05<00:00, 18.51it/s] 96%|█████████▌| 96/100 [00:05<00:00, 18.50it/s] 98%|█████████▊| 98/100 [00:05<00:00, 18.51it/s]100%|██████████| 100/100 [00:05<00:00, 18.53it/s]100%|██████████| 100/100 [00:05<00:00, 18.59it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 341.11it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-14295f39edd20556.arrow
Map:   0%|          | 0/100 [00:00<?, ? examples/s]/home/elicer/honest_llama/validation/../utils.py:600: UserWarning: To copy construct from a tensor, it is recommended to use sourceTensor.clone().detach() or sourceTensor.clone().detach().requires_grad_(True), rather than torch.tensor(sourceTensor).
  owt = dataset.map(lambda x: {'input_ids': torch.tensor(tokenizer(x['text'], return_tensors='pt')['input_ids'][:,:128])})
Map:  20%|██        | 20/100 [00:00<00:00, 186.60 examples/s]Map:  44%|████▍     | 44/100 [00:00<00:00, 210.85 examples/s]Token indices sequence length is longer than the specified maximum sequence length for this model (2171 > 2048). Running this sequence through the model will result in indexing errors
Map:  67%|██████▋   | 67/100 [00:00<00:00, 197.31 examples/s]Map:  92%|█████████▏| 92/100 [00:00<00:00, 212.40 examples/s]                                                               0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:16,  5.94it/s]  2%|▏         | 2/100 [00:00<00:14,  6.84it/s]  3%|▎         | 3/100 [00:00<00:14,  6.79it/s]  4%|▍         | 4/100 [00:00<00:13,  6.94it/s]  5%|▌         | 5/100 [00:00<00:14,  6.70it/s]  6%|▌         | 6/100 [00:00<00:13,  6.72it/s]  7%|▋         | 7/100 [00:01<00:13,  6.79it/s]  8%|▊         | 8/100 [00:01<00:13,  7.02it/s]  9%|▉         | 9/100 [00:01<00:12,  7.13it/s] 10%|█         | 10/100 [00:01<00:12,  7.33it/s] 11%|█         | 11/100 [00:01<00:11,  7.46it/s] 12%|█▏        | 12/100 [00:01<00:11,  7.54it/s] 13%|█▎        | 13/100 [00:01<00:11,  7.54it/s] 14%|█▍        | 14/100 [00:01<00:11,  7.37it/s] 15%|█▌        | 15/100 [00:02<00:11,  7.47it/s] 16%|█▌        | 16/100 [00:02<00:11,  7.51it/s] 17%|█▋        | 17/100 [00:02<00:11,  7.36it/s] 18%|█▊        | 18/100 [00:02<00:11,  7.31it/s] 19%|█▉        | 19/100 [00:02<00:11,  7.08it/s] 20%|██        | 20/100 [00:02<00:11,  7.02it/s] 21%|██        | 21/100 [00:02<00:11,  7.16it/s] 22%|██▏       | 22/100 [00:03<00:10,  7.23it/s] 23%|██▎       | 23/100 [00:03<00:10,  7.31it/s] 24%|██▍       | 24/100 [00:03<00:10,  7.30it/s] 25%|██▌       | 25/100 [00:03<00:10,  7.44it/s] 26%|██▌       | 26/100 [00:03<00:10,  7.34it/s] 27%|██▋       | 27/100 [00:03<00:09,  7.48it/s] 28%|██▊       | 28/100 [00:03<00:09,  7.58it/s] 29%|██▉       | 29/100 [00:03<00:09,  7.66it/s] 30%|███       | 30/100 [00:04<00:09,  7.59it/s] 31%|███       | 31/100 [00:04<00:09,  7.65it/s] 32%|███▏      | 32/100 [00:04<00:09,  7.33it/s] 33%|███▎      | 33/100 [00:04<00:09,  7.36it/s] 34%|███▍      | 34/100 [00:04<00:08,  7.48it/s] 35%|███▌      | 35/100 [00:04<00:08,  7.48it/s] 36%|███▌      | 36/100 [00:04<00:08,  7.59it/s] 37%|███▋      | 37/100 [00:05<00:08,  7.44it/s] 38%|███▊      | 38/100 [00:05<00:08,  7.23it/s] 39%|███▉      | 39/100 [00:05<00:08,  7.20it/s] 40%|████      | 40/100 [00:05<00:08,  7.27it/s] 41%|████      | 41/100 [00:05<00:08,  7.29it/s] 42%|████▏     | 42/100 [00:05<00:07,  7.46it/s] 43%|████▎     | 43/100 [00:05<00:07,  7.57it/s] 44%|████▍     | 44/100 [00:06<00:07,  7.53it/s] 45%|████▌     | 45/100 [00:06<00:07,  7.58it/s] 46%|████▌     | 46/100 [00:06<00:07,  7.53it/s] 47%|████▋     | 47/100 [00:06<00:07,  7.18it/s] 48%|████▊     | 48/100 [00:06<00:07,  7.35it/s] 49%|████▉     | 49/100 [00:06<00:06,  7.44it/s] 50%|█████     | 50/100 [00:06<00:06,  7.52it/s] 51%|█████     | 51/100 [00:06<00:06,  7.54it/s] 52%|█████▏    | 52/100 [00:07<00:06,  7.55it/s] 53%|█████▎    | 53/100 [00:07<00:06,  7.50it/s] 54%|█████▍    | 54/100 [00:07<00:06,  7.59it/s] 55%|█████▌    | 55/100 [00:07<00:06,  7.49it/s] 56%|█████▌    | 56/100 [00:07<00:05,  7.37it/s] 57%|█████▋    | 57/100 [00:07<00:05,  7.24it/s] 58%|█████▊    | 58/100 [00:07<00:05,  7.38it/s] 59%|█████▉    | 59/100 [00:08<00:05,  7.15it/s] 60%|██████    | 60/100 [00:08<00:05,  7.13it/s] 61%|██████    | 61/100 [00:08<00:05,  7.34it/s] 62%|██████▏   | 62/100 [00:08<00:05,  7.23it/s] 63%|██████▎   | 63/100 [00:08<00:05,  7.13it/s] 64%|██████▍   | 64/100 [00:08<00:04,  7.31it/s] 65%|██████▌   | 65/100 [00:08<00:04,  7.19it/s] 66%|██████▌   | 66/100 [00:09<00:04,  7.04it/s] 67%|██████▋   | 67/100 [00:09<00:04,  7.25it/s] 68%|██████▊   | 68/100 [00:09<00:04,  7.20it/s] 69%|██████▉   | 69/100 [00:09<00:04,  7.40it/s] 70%|███████   | 70/100 [00:09<00:03,  7.53it/s] 71%|███████   | 71/100 [00:09<00:03,  7.35it/s] 72%|███████▏  | 72/100 [00:09<00:03,  7.49it/s] 73%|███████▎  | 73/100 [00:09<00:03,  7.59it/s] 74%|███████▍  | 74/100 [00:10<00:03,  7.54it/s] 75%|███████▌  | 75/100 [00:10<00:03,  7.61it/s] 76%|███████▌  | 76/100 [00:10<00:03,  7.47it/s] 77%|███████▋  | 77/100 [00:10<00:03,  7.23it/s] 78%|███████▊  | 78/100 [00:10<00:03,  7.22it/s] 79%|███████▉  | 79/100 [00:10<00:02,  7.38it/s] 80%|████████  | 80/100 [00:10<00:02,  7.22it/s] 81%|████████  | 81/100 [00:11<00:02,  7.28it/s] 82%|████████▏ | 82/100 [00:11<00:02,  7.22it/s] 83%|████████▎ | 83/100 [00:11<00:02,  7.40it/s] 84%|████████▍ | 84/100 [00:11<00:02,  7.53it/s] 85%|████████▌ | 85/100 [00:11<00:01,  7.62it/s] 86%|████████▌ | 86/100 [00:11<00:01,  7.52it/s] 87%|████████▋ | 87/100 [00:11<00:01,  7.52it/s] 88%|████████▊ | 88/100 [00:11<00:01,  7.61it/s] 89%|████████▉ | 89/100 [00:12<00:01,  7.44it/s] 90%|█████████ | 90/100 [00:12<00:01,  7.38it/s] 91%|█████████ | 91/100 [00:12<00:01,  7.32it/s] 92%|█████████▏| 92/100 [00:12<00:01,  7.47it/s] 93%|█████████▎| 93/100 [00:12<00:00,  7.19it/s] 94%|█████████▍| 94/100 [00:12<00:00,  7.31it/s] 95%|█████████▌| 95/100 [00:12<00:00,  7.36it/s] 96%|█████████▌| 96/100 [00:13<00:00,  7.31it/s] 97%|█████████▋| 97/100 [00:13<00:00,  7.25it/s] 98%|█████████▊| 98/100 [00:13<00:00,  7.24it/s] 99%|█████████▉| 99/100 [00:13<00:00,  7.15it/s]100%|██████████| 100/100 [00:13<00:00,  7.35it/s]100%|██████████| 100/100 [00:13<00:00,  7.34it/s]
FOLD 1
Metric     CE Loss  KL wrt Orig
Model                          
llama_7B  2.200703     0.153382
[2.26720215 0.15427055]
2023-12-04 00:51:47.461879: I tensorflow/core/util/port.cc:110] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2023-12-04 00:51:47.511382: I tensorflow/core/platform/cpu_feature_guard.cc:182] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-12-04 00:51:48.259632: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Could not find TensorRT
Found cached dataset truthful_qa (/home/elicer/.cache/huggingface/datasets/truthful_qa/multiple_choice/1.1.0/63502f6bc6ee493830ce0843991b028d0ab568d221896b2ee3b8a5dfdaa9d7f4)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 370.03it/s]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:00<00:00,  4.89it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  5.87it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  5.70it/s]
head_wise_activation_length:(11012, 32, 4096)
labels_shape:(11012,)
seperated_head_activation shape:11013
Running fold 0
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:28,  1.11it/s]  6%|▋         | 2/32 [00:01<00:28,  1.07it/s]  9%|▉         | 3/32 [00:02<00:26,  1.11it/s] 12%|█▎        | 4/32 [00:03<00:24,  1.13it/s] 16%|█▌        | 5/32 [00:04<00:23,  1.13it/s] 19%|█▉        | 6/32 [00:05<00:23,  1.11it/s] 22%|██▏       | 7/32 [00:06<00:22,  1.10it/s] 25%|██▌       | 8/32 [00:07<00:22,  1.07it/s] 28%|██▊       | 9/32 [00:08<00:22,  1.04it/s] 31%|███▏      | 10/32 [00:09<00:21,  1.01it/s] 34%|███▍      | 11/32 [00:10<00:21,  1.01s/it] 38%|███▊      | 12/32 [00:11<00:20,  1.01s/it] 41%|████      | 13/32 [00:12<00:19,  1.03s/it] 44%|████▍     | 14/32 [00:13<00:19,  1.06s/it] 47%|████▋     | 15/32 [00:14<00:17,  1.05s/it] 50%|█████     | 16/32 [00:15<00:16,  1.05s/it] 53%|█████▎    | 17/32 [00:16<00:15,  1.06s/it] 56%|█████▋    | 18/32 [00:17<00:15,  1.08s/it] 59%|█████▉    | 19/32 [00:19<00:14,  1.11s/it] 62%|██████▎   | 20/32 [00:20<00:13,  1.12s/it] 66%|██████▌   | 21/32 [00:21<00:12,  1.13s/it] 69%|██████▉   | 22/32 [00:22<00:11,  1.11s/it] 72%|███████▏  | 23/32 [00:23<00:10,  1.13s/it] 75%|███████▌  | 24/32 [00:24<00:09,  1.18s/it] 78%|███████▊  | 25/32 [00:26<00:08,  1.16s/it] 81%|████████▏ | 26/32 [00:27<00:06,  1.15s/it] 84%|████████▍ | 27/32 [00:28<00:05,  1.18s/it] 88%|████████▊ | 28/32 [00:29<00:04,  1.13s/it] 91%|█████████ | 29/32 [00:30<00:03,  1.14s/it] 94%|█████████▍| 30/32 [00:31<00:02,  1.12s/it] 97%|█████████▋| 31/32 [00:32<00:01,  1.13s/it]100%|██████████| 32/32 [00:34<00:00,  1.23s/it]100%|██████████| 32/32 [00:34<00:00,  1.07s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
/home/elicer/honest_llama/validation/../TruthfulQA/truthfulqa/metrics.py:284: FutureWarning: load_metric is deprecated and will be removed in the next major version of datasets. Use 'evaluate.load' instead, from the new library 🤗 Evaluate: https://huggingface.co/docs/evaluate
  bleurt = load_metric("bleurt", cache_dir=cache_dir)
[[0.651 0.665 0.645 ... 0.646 0.647 0.652]
 [0.659 0.644 0.645 ... 0.648 0.658 0.656]
 [0.651 0.657 0.685 ... 0.637 0.648 0.667]
 ...
 [0.765 0.762 0.657 ... 0.73  0.704 0.674]
 [0.748 0.678 0.696 ... 0.663 0.769 0.786]
 [0.775 0.815 0.74  ... 0.697 0.809 0.79 ]]
Heads intervened:  [(8, 16), (12, 4), (12, 15), (13, 8), (13, 16), (15, 28), (16, 30), (17, 13), (17, 17), (17, 29), (18, 29), (19, 13), (19, 17), (20, 22), (20, 30), (22, 16), (22, 30), (23, 3), (23, 7), (23, 13), (25, 15), (31, 1), (31, 6), (31, 30)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
2023-12-04 00:52:38.812468: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1635] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 24961 MB memory:  -> device: 0, name: NVIDIA A100 80GB PCIe MIG 3g.40gb, pci bus id: 0000:65:00.0, compute capability: 8.0
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 276.09it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-ec0cf83741fdb3e8.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-d31e6c0c76fafb4d.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:01<01:44,  1.05s/it]  3%|▎         | 3/100 [00:01<00:30,  3.17it/s]  5%|▌         | 5/100 [00:01<00:17,  5.50it/s]  7%|▋         | 7/100 [00:01<00:11,  7.78it/s]  9%|▉         | 9/100 [00:01<00:09,  9.88it/s] 11%|█         | 11/100 [00:01<00:07, 11.71it/s] 13%|█▎        | 13/100 [00:01<00:06, 13.24it/s] 15%|█▌        | 15/100 [00:01<00:05, 14.46it/s] 17%|█▋        | 17/100 [00:01<00:05, 15.38it/s] 19%|█▉        | 19/100 [00:02<00:05, 16.08it/s] 21%|██        | 21/100 [00:02<00:04, 16.59it/s] 23%|██▎       | 23/100 [00:02<00:04, 16.97it/s] 25%|██▌       | 25/100 [00:02<00:04, 17.24it/s] 27%|██▋       | 27/100 [00:02<00:04, 17.43it/s] 29%|██▉       | 29/100 [00:02<00:04, 17.57it/s] 31%|███       | 31/100 [00:02<00:03, 17.67it/s] 33%|███▎      | 33/100 [00:02<00:03, 17.74it/s] 35%|███▌      | 35/100 [00:02<00:03, 17.79it/s] 37%|███▋      | 37/100 [00:03<00:03, 17.81it/s] 39%|███▉      | 39/100 [00:03<00:03, 17.84it/s] 41%|████      | 41/100 [00:03<00:03, 17.87it/s] 43%|████▎     | 43/100 [00:03<00:03, 17.90it/s] 45%|████▌     | 45/100 [00:03<00:03, 17.92it/s] 47%|████▋     | 47/100 [00:03<00:02, 17.93it/s] 49%|████▉     | 49/100 [00:03<00:02, 17.94it/s] 51%|█████     | 51/100 [00:03<00:02, 17.94it/s] 53%|█████▎    | 53/100 [00:03<00:02, 17.88it/s] 55%|█████▌    | 55/100 [00:04<00:02, 17.49it/s] 57%|█████▋    | 57/100 [00:04<00:02, 17.60it/s] 59%|█████▉    | 59/100 [00:04<00:02, 17.70it/s] 61%|██████    | 61/100 [00:04<00:02, 17.78it/s] 63%|██████▎   | 63/100 [00:04<00:02, 17.82it/s] 65%|██████▌   | 65/100 [00:04<00:01, 17.86it/s] 67%|██████▋   | 67/100 [00:04<00:01, 17.89it/s] 69%|██████▉   | 69/100 [00:04<00:01, 17.91it/s] 71%|███████   | 71/100 [00:04<00:01, 17.92it/s] 73%|███████▎  | 73/100 [00:05<00:01, 17.94it/s] 75%|███████▌  | 75/100 [00:05<00:01, 17.94it/s] 77%|███████▋  | 77/100 [00:05<00:01, 17.94it/s] 79%|███████▉  | 79/100 [00:05<00:01, 17.94it/s] 81%|████████  | 81/100 [00:05<00:01, 17.93it/s] 83%|████████▎ | 83/100 [00:05<00:00, 17.93it/s] 85%|████████▌ | 85/100 [00:05<00:00, 17.94it/s] 87%|████████▋ | 87/100 [00:05<00:00, 17.95it/s] 89%|████████▉ | 89/100 [00:05<00:00, 17.88it/s] 91%|█████████ | 91/100 [00:06<00:00, 17.80it/s] 93%|█████████▎| 93/100 [00:06<00:00, 17.83it/s] 95%|█████████▌| 95/100 [00:06<00:00, 17.87it/s] 97%|█████████▋| 97/100 [00:06<00:00, 17.90it/s] 99%|█████████▉| 99/100 [00:06<00:00, 17.92it/s]100%|██████████| 100/100 [00:06<00:00, 15.17it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 351.40it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-1939fcc1eeebdaa7.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-785bb4b6f2089589.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:17,  5.78it/s]  2%|▏         | 2/100 [00:00<00:15,  6.48it/s]  3%|▎         | 3/100 [00:00<00:14,  6.88it/s]  4%|▍         | 4/100 [00:00<00:14,  6.82it/s]  5%|▌         | 5/100 [00:00<00:13,  7.11it/s]  6%|▌         | 6/100 [00:00<00:13,  6.92it/s]  7%|▋         | 7/100 [00:01<00:13,  6.97it/s]  8%|▊         | 8/100 [00:01<00:13,  7.06it/s]  9%|▉         | 9/100 [00:01<00:12,  7.25it/s] 10%|█         | 10/100 [00:01<00:12,  7.30it/s] 11%|█         | 11/100 [00:01<00:12,  7.21it/s] 12%|█▏        | 12/100 [00:01<00:12,  7.29it/s] 13%|█▎        | 13/100 [00:01<00:12,  6.92it/s] 14%|█▍        | 14/100 [00:02<00:12,  6.94it/s] 15%|█▌        | 15/100 [00:02<00:12,  6.96it/s] 16%|█▌        | 16/100 [00:02<00:12,  6.93it/s] 17%|█▋        | 17/100 [00:02<00:11,  6.95it/s] 18%|█▊        | 18/100 [00:02<00:11,  7.09it/s] 19%|█▉        | 19/100 [00:02<00:11,  7.07it/s] 20%|██        | 20/100 [00:02<00:11,  7.08it/s] 21%|██        | 21/100 [00:02<00:11,  7.15it/s] 22%|██▏       | 22/100 [00:03<00:11,  6.96it/s] 23%|██▎       | 23/100 [00:03<00:11,  6.92it/s] 24%|██▍       | 24/100 [00:03<00:11,  6.90it/s] 25%|██▌       | 25/100 [00:03<00:10,  7.09it/s] 26%|██▌       | 26/100 [00:03<00:10,  7.12it/s] 27%|██▋       | 27/100 [00:03<00:10,  7.15it/s] 28%|██▊       | 28/100 [00:03<00:10,  7.09it/s] 29%|██▉       | 29/100 [00:04<00:10,  7.08it/s] 30%|███       | 30/100 [00:04<00:09,  7.14it/s] 31%|███       | 31/100 [00:04<00:09,  6.99it/s] 32%|███▏      | 32/100 [00:04<00:09,  7.18it/s] 33%|███▎      | 33/100 [00:04<00:09,  7.14it/s] 34%|███▍      | 34/100 [00:04<00:09,  6.97it/s] 35%|███▌      | 35/100 [00:04<00:09,  6.79it/s] 36%|███▌      | 36/100 [00:05<00:09,  6.68it/s] 37%|███▋      | 37/100 [00:05<00:09,  6.75it/s] 38%|███▊      | 38/100 [00:05<00:09,  6.71it/s] 39%|███▉      | 39/100 [00:05<00:08,  6.85it/s] 40%|████      | 40/100 [00:05<00:08,  7.07it/s] 41%|████      | 41/100 [00:05<00:08,  7.11it/s] 42%|████▏     | 42/100 [00:06<00:08,  6.99it/s] 43%|████▎     | 43/100 [00:06<00:08,  6.90it/s] 44%|████▍     | 44/100 [00:06<00:08,  6.77it/s] 45%|████▌     | 45/100 [00:06<00:07,  7.02it/s] 46%|████▌     | 46/100 [00:06<00:07,  6.94it/s] 47%|████▋     | 47/100 [00:06<00:07,  6.90it/s] 48%|████▊     | 48/100 [00:06<00:07,  7.14it/s] 49%|████▉     | 49/100 [00:06<00:06,  7.30it/s] 50%|█████     | 50/100 [00:07<00:06,  7.42it/s] 51%|█████     | 51/100 [00:07<00:06,  7.31it/s] 52%|█████▏    | 52/100 [00:07<00:06,  7.22it/s] 53%|█████▎    | 53/100 [00:07<00:06,  7.30it/s] 54%|█████▍    | 54/100 [00:07<00:06,  7.33it/s] 55%|█████▌    | 55/100 [00:07<00:06,  7.31it/s] 56%|█████▌    | 56/100 [00:07<00:06,  7.20it/s] 57%|█████▋    | 57/100 [00:08<00:06,  7.15it/s] 58%|█████▊    | 58/100 [00:08<00:06,  6.85it/s] 59%|█████▉    | 59/100 [00:08<00:06,  6.80it/s] 60%|██████    | 60/100 [00:08<00:05,  6.95it/s] 61%|██████    | 61/100 [00:08<00:05,  7.15it/s] 62%|██████▏   | 62/100 [00:08<00:05,  7.06it/s] 63%|██████▎   | 63/100 [00:08<00:05,  7.14it/s] 64%|██████▍   | 64/100 [00:09<00:04,  7.30it/s] 65%|██████▌   | 65/100 [00:09<00:04,  7.35it/s] 66%|██████▌   | 66/100 [00:09<00:04,  7.12it/s] 67%|██████▋   | 67/100 [00:09<00:04,  7.23it/s] 68%|██████▊   | 68/100 [00:09<00:04,  7.15it/s] 69%|██████▉   | 69/100 [00:09<00:04,  7.09it/s] 70%|███████   | 70/100 [00:09<00:04,  7.26it/s] 71%|███████   | 71/100 [00:10<00:04,  7.13it/s] 72%|███████▏  | 72/100 [00:10<00:03,  7.12it/s] 73%|███████▎  | 73/100 [00:10<00:03,  7.28it/s] 74%|███████▍  | 74/100 [00:10<00:03,  7.40it/s] 75%|███████▌  | 75/100 [00:10<00:03,  7.17it/s] 76%|███████▌  | 76/100 [00:10<00:03,  7.13it/s] 77%|███████▋  | 77/100 [00:10<00:03,  6.98it/s] 78%|███████▊  | 78/100 [00:11<00:03,  6.93it/s] 79%|███████▉  | 79/100 [00:11<00:03,  6.97it/s] 80%|████████  | 80/100 [00:11<00:02,  6.99it/s] 81%|████████  | 81/100 [00:11<00:02,  6.91it/s] 82%|████████▏ | 82/100 [00:11<00:02,  7.03it/s] 83%|████████▎ | 83/100 [00:11<00:02,  6.94it/s] 84%|████████▍ | 84/100 [00:11<00:02,  6.96it/s] 85%|████████▌ | 85/100 [00:12<00:02,  6.89it/s] 86%|████████▌ | 86/100 [00:12<00:01,  7.10it/s] 87%|████████▋ | 87/100 [00:12<00:01,  7.15it/s] 88%|████████▊ | 88/100 [00:12<00:01,  7.22it/s] 89%|████████▉ | 89/100 [00:12<00:01,  7.10it/s] 90%|█████████ | 90/100 [00:12<00:01,  6.95it/s] 91%|█████████ | 91/100 [00:12<00:01,  6.87it/s] 92%|█████████▏| 92/100 [00:13<00:01,  6.94it/s] 93%|█████████▎| 93/100 [00:13<00:01,  6.90it/s] 94%|█████████▍| 94/100 [00:13<00:00,  6.88it/s] 95%|█████████▌| 95/100 [00:13<00:00,  7.03it/s] 96%|█████████▌| 96/100 [00:13<00:00,  7.04it/s] 97%|█████████▋| 97/100 [00:13<00:00,  6.93it/s] 98%|█████████▊| 98/100 [00:13<00:00,  6.98it/s] 99%|█████████▉| 99/100 [00:14<00:00,  6.89it/s]100%|██████████| 100/100 [00:14<00:00,  6.95it/s]100%|██████████| 100/100 [00:14<00:00,  7.04it/s]
FOLD 0
Metric     CE Loss  KL wrt Orig
Model                          
llama_7B  2.347363     0.162746
Running fold 1
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:29,  1.04it/s]  6%|▋         | 2/32 [00:02<00:33,  1.10s/it]  9%|▉         | 3/32 [00:03<00:34,  1.19s/it] 12%|█▎        | 4/32 [00:04<00:33,  1.20s/it] 16%|█▌        | 5/32 [00:05<00:33,  1.24s/it] 19%|█▉        | 6/32 [00:07<00:32,  1.27s/it] 22%|██▏       | 7/32 [00:08<00:31,  1.28s/it] 25%|██▌       | 8/32 [00:09<00:30,  1.27s/it] 28%|██▊       | 9/32 [00:11<00:29,  1.27s/it] 31%|███▏      | 10/32 [00:12<00:28,  1.27s/it] 34%|███▍      | 11/32 [00:13<00:26,  1.26s/it] 38%|███▊      | 12/32 [00:14<00:24,  1.23s/it] 41%|████      | 13/32 [00:16<00:23,  1.23s/it] 44%|████▍     | 14/32 [00:17<00:22,  1.22s/it] 47%|████▋     | 15/32 [00:18<00:20,  1.22s/it] 50%|█████     | 16/32 [00:19<00:19,  1.22s/it] 53%|█████▎    | 17/32 [00:20<00:18,  1.22s/it] 56%|█████▋    | 18/32 [00:22<00:17,  1.22s/it] 59%|█████▉    | 19/32 [00:23<00:16,  1.25s/it] 62%|██████▎   | 20/32 [00:24<00:15,  1.29s/it] 66%|██████▌   | 21/32 [00:26<00:14,  1.29s/it] 69%|██████▉   | 22/32 [00:27<00:12,  1.29s/it] 72%|███████▏  | 23/32 [00:28<00:11,  1.29s/it] 75%|███████▌  | 24/32 [00:30<00:10,  1.31s/it] 78%|███████▊  | 25/32 [00:31<00:09,  1.31s/it] 81%|████████▏ | 26/32 [00:32<00:07,  1.30s/it] 84%|████████▍ | 27/32 [00:33<00:06,  1.31s/it] 88%|████████▊ | 28/32 [00:35<00:05,  1.31s/it] 91%|█████████ | 29/32 [00:36<00:03,  1.32s/it] 94%|█████████▍| 30/32 [00:37<00:02,  1.31s/it] 97%|█████████▋| 31/32 [00:39<00:01,  1.31s/it]100%|██████████| 32/32 [00:40<00:00,  1.36s/it]100%|██████████| 32/32 [00:40<00:00,  1.27s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
[[0.666 0.672 0.662 ... 0.668 0.662 0.67 ]
 [0.662 0.662 0.659 ... 0.677 0.666 0.663]
 [0.668 0.67  0.68  ... 0.661 0.665 0.671]
 ...
 [0.758 0.75  0.674 ... 0.716 0.694 0.677]
 [0.749 0.671 0.686 ... 0.674 0.762 0.76 ]
 [0.765 0.805 0.748 ... 0.743 0.787 0.775]]
Heads intervened:  [(8, 16), (11, 16), (11, 17), (12, 4), (13, 8), (13, 10), (13, 16), (13, 21), (16, 17), (16, 26), (16, 30), (17, 13), (17, 19), (17, 29), (18, 29), (19, 13), (19, 17), (19, 31), (20, 22), (20, 30), (22, 16), (23, 3), (23, 12), (31, 6)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 257.16it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-30ec7b2da7888791.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-4e53eea82b0ecfef.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  2%|▏         | 2/100 [00:00<00:06, 16.25it/s]  4%|▍         | 4/100 [00:00<00:05, 17.26it/s]  6%|▌         | 6/100 [00:00<00:05, 17.65it/s]  8%|▊         | 8/100 [00:00<00:05, 17.84it/s] 10%|█         | 10/100 [00:00<00:05, 17.94it/s] 12%|█▏        | 12/100 [00:00<00:04, 18.00it/s] 14%|█▍        | 14/100 [00:00<00:04, 18.05it/s] 16%|█▌        | 16/100 [00:00<00:04, 18.09it/s] 18%|█▊        | 18/100 [00:01<00:04, 18.10it/s] 20%|██        | 20/100 [00:01<00:04, 18.13it/s] 22%|██▏       | 22/100 [00:01<00:04, 18.14it/s] 24%|██▍       | 24/100 [00:01<00:04, 18.13it/s] 26%|██▌       | 26/100 [00:01<00:04, 18.12it/s] 28%|██▊       | 28/100 [00:01<00:03, 18.11it/s] 30%|███       | 30/100 [00:01<00:03, 18.12it/s] 32%|███▏      | 32/100 [00:01<00:03, 18.13it/s] 34%|███▍      | 34/100 [00:01<00:03, 17.93it/s] 36%|███▌      | 36/100 [00:02<00:03, 17.97it/s] 38%|███▊      | 38/100 [00:02<00:03, 18.01it/s] 40%|████      | 40/100 [00:02<00:03, 18.04it/s] 42%|████▏     | 42/100 [00:02<00:03, 18.06it/s] 44%|████▍     | 44/100 [00:02<00:03, 18.09it/s] 46%|████▌     | 46/100 [00:02<00:02, 18.10it/s] 48%|████▊     | 48/100 [00:02<00:02, 18.11it/s] 50%|█████     | 50/100 [00:02<00:02, 18.12it/s] 52%|█████▏    | 52/100 [00:02<00:02, 18.11it/s] 54%|█████▍    | 54/100 [00:02<00:02, 18.12it/s] 56%|█████▌    | 56/100 [00:03<00:02, 18.12it/s] 58%|█████▊    | 58/100 [00:03<00:02, 18.12it/s] 60%|██████    | 60/100 [00:03<00:02, 18.13it/s] 62%|██████▏   | 62/100 [00:03<00:02, 18.13it/s] 64%|██████▍   | 64/100 [00:03<00:01, 18.13it/s] 66%|██████▌   | 66/100 [00:03<00:01, 18.13it/s] 68%|██████▊   | 68/100 [00:03<00:01, 18.14it/s] 70%|███████   | 70/100 [00:03<00:01, 18.13it/s] 72%|███████▏  | 72/100 [00:03<00:01, 17.66it/s] 74%|███████▍  | 74/100 [00:04<00:01, 17.75it/s] 76%|███████▌  | 76/100 [00:04<00:01, 17.86it/s] 78%|███████▊  | 78/100 [00:04<00:01, 17.94it/s] 80%|████████  | 80/100 [00:04<00:01, 17.99it/s] 82%|████████▏ | 82/100 [00:04<00:00, 18.03it/s] 84%|████████▍ | 84/100 [00:04<00:00, 18.06it/s] 86%|████████▌ | 86/100 [00:04<00:00, 18.08it/s] 88%|████████▊ | 88/100 [00:04<00:00, 18.09it/s] 90%|█████████ | 90/100 [00:04<00:00, 18.10it/s] 92%|█████████▏| 92/100 [00:05<00:00, 18.11it/s] 94%|█████████▍| 94/100 [00:05<00:00, 18.12it/s] 96%|█████████▌| 96/100 [00:05<00:00, 18.14it/s] 98%|█████████▊| 98/100 [00:05<00:00, 18.14it/s]100%|██████████| 100/100 [00:05<00:00, 18.14it/s]100%|██████████| 100/100 [00:05<00:00, 18.04it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 351.43it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-14295f39edd20556.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-10ca04ba0c7bb427.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:16,  6.09it/s]  2%|▏         | 2/100 [00:00<00:14,  6.69it/s]  3%|▎         | 3/100 [00:00<00:13,  7.10it/s]  4%|▍         | 4/100 [00:00<00:13,  7.03it/s]  5%|▌         | 5/100 [00:00<00:13,  6.85it/s]  6%|▌         | 6/100 [00:00<00:13,  7.04it/s]  7%|▋         | 7/100 [00:00<00:12,  7.17it/s]  8%|▊         | 8/100 [00:01<00:12,  7.32it/s]  9%|▉         | 9/100 [00:01<00:12,  7.24it/s] 10%|█         | 10/100 [00:01<00:12,  7.38it/s] 11%|█         | 11/100 [00:01<00:12,  7.27it/s] 12%|█▏        | 12/100 [00:01<00:12,  7.15it/s] 13%|█▎        | 13/100 [00:01<00:11,  7.31it/s] 14%|█▍        | 14/100 [00:01<00:12,  7.16it/s] 15%|█▌        | 15/100 [00:02<00:11,  7.32it/s] 16%|█▌        | 16/100 [00:02<00:11,  7.28it/s] 17%|█▋        | 17/100 [00:02<00:11,  7.29it/s] 18%|█▊        | 18/100 [00:02<00:11,  7.41it/s] 19%|█▉        | 19/100 [00:02<00:10,  7.42it/s] 20%|██        | 20/100 [00:02<00:11,  7.21it/s] 21%|██        | 21/100 [00:02<00:10,  7.27it/s] 22%|██▏       | 22/100 [00:03<00:10,  7.15it/s] 23%|██▎       | 23/100 [00:03<00:10,  7.31it/s] 24%|██▍       | 24/100 [00:03<00:10,  7.16it/s] 25%|██▌       | 25/100 [00:03<00:10,  7.31it/s] 26%|██▌       | 26/100 [00:03<00:10,  7.27it/s] 27%|██▋       | 27/100 [00:03<00:10,  7.27it/s] 28%|██▊       | 28/100 [00:03<00:10,  7.13it/s] 29%|██▉       | 29/100 [00:04<00:09,  7.21it/s] 30%|███       | 30/100 [00:04<00:09,  7.16it/s] 31%|███       | 31/100 [00:04<00:09,  7.17it/s] 32%|███▏      | 32/100 [00:04<00:09,  7.31it/s] 33%|███▎      | 33/100 [00:04<00:09,  7.19it/s] 34%|███▍      | 34/100 [00:04<00:09,  7.26it/s] 35%|███▌      | 35/100 [00:04<00:08,  7.31it/s] 36%|███▌      | 36/100 [00:05<00:09,  7.09it/s] 37%|███▋      | 37/100 [00:05<00:08,  7.26it/s] 38%|███▊      | 38/100 [00:05<00:08,  7.15it/s] 39%|███▉      | 39/100 [00:05<00:08,  7.16it/s] 40%|████      | 40/100 [00:05<00:08,  7.32it/s] 41%|████      | 41/100 [00:05<00:08,  7.21it/s] 42%|████▏     | 42/100 [00:05<00:08,  7.10it/s] 43%|████▎     | 43/100 [00:05<00:07,  7.27it/s] 44%|████▍     | 44/100 [00:06<00:07,  7.32it/s] 45%|████▌     | 45/100 [00:06<00:07,  7.42it/s] 46%|████▌     | 46/100 [00:06<00:07,  7.17it/s] 47%|████▋     | 47/100 [00:06<00:07,  7.21it/s] 48%|████▊     | 48/100 [00:06<00:07,  7.35it/s] 49%|████▉     | 49/100 [00:06<00:07,  7.19it/s] 50%|█████     | 50/100 [00:06<00:07,  7.05it/s] 51%|█████     | 51/100 [00:07<00:06,  7.02it/s] 52%|█████▏    | 52/100 [00:07<00:06,  7.20it/s] 53%|█████▎    | 53/100 [00:07<00:06,  7.15it/s] 54%|█████▍    | 54/100 [00:07<00:06,  7.31it/s] 55%|█████▌    | 55/100 [00:07<00:06,  7.20it/s] 56%|█████▌    | 56/100 [00:07<00:06,  7.14it/s] 57%|█████▋    | 57/100 [00:07<00:05,  7.29it/s] 58%|█████▊    | 58/100 [00:08<00:05,  7.21it/s] 59%|█████▉    | 59/100 [00:08<00:05,  7.16it/s] 60%|██████    | 60/100 [00:08<00:05,  7.10it/s] 61%|██████    | 61/100 [00:08<00:05,  7.19it/s] 62%|██████▏   | 62/100 [00:08<00:05,  7.34it/s] 63%|██████▎   | 63/100 [00:08<00:04,  7.45it/s] 64%|██████▍   | 64/100 [00:08<00:04,  7.37it/s] 65%|██████▌   | 65/100 [00:09<00:04,  7.38it/s] 66%|██████▌   | 66/100 [00:09<00:04,  7.11it/s] 67%|██████▋   | 67/100 [00:09<00:04,  7.28it/s] 68%|██████▊   | 68/100 [00:09<00:04,  7.28it/s] 69%|██████▉   | 69/100 [00:09<00:04,  7.40it/s] 70%|███████   | 70/100 [00:09<00:04,  7.36it/s] 71%|███████   | 71/100 [00:09<00:03,  7.38it/s] 72%|███████▏  | 72/100 [00:09<00:03,  7.22it/s] 73%|███████▎  | 73/100 [00:10<00:03,  7.34it/s] 74%|███████▍  | 74/100 [00:10<00:03,  7.15it/s] 75%|███████▌  | 75/100 [00:10<00:03,  7.30it/s] 76%|███████▌  | 76/100 [00:10<00:03,  7.20it/s] 77%|███████▋  | 77/100 [00:10<00:03,  7.35it/s] 78%|███████▊  | 78/100 [00:10<00:02,  7.46it/s] 79%|███████▉  | 79/100 [00:10<00:02,  7.38it/s] 80%|████████  | 80/100 [00:11<00:02,  7.31it/s] 81%|████████  | 81/100 [00:11<00:02,  7.03it/s] 82%|████████▏ | 82/100 [00:11<00:02,  7.21it/s] 83%|████████▎ | 83/100 [00:11<00:02,  7.14it/s] 84%|████████▍ | 84/100 [00:11<00:02,  7.31it/s] 85%|████████▌ | 85/100 [00:11<00:02,  7.43it/s] 86%|████████▌ | 86/100 [00:11<00:01,  7.36it/s] 87%|████████▋ | 87/100 [00:12<00:01,  7.15it/s] 88%|████████▊ | 88/100 [00:12<00:01,  7.25it/s] 89%|████████▉ | 89/100 [00:12<00:01,  7.31it/s] 90%|█████████ | 90/100 [00:12<00:01,  7.23it/s] 91%|█████████ | 91/100 [00:12<00:01,  7.15it/s] 92%|█████████▏| 92/100 [00:12<00:01,  7.19it/s] 93%|█████████▎| 93/100 [00:12<00:00,  7.33it/s] 94%|█████████▍| 94/100 [00:12<00:00,  7.25it/s] 95%|█████████▌| 95/100 [00:13<00:00,  7.12it/s] 96%|█████████▌| 96/100 [00:13<00:00,  7.06it/s] 97%|█████████▋| 97/100 [00:13<00:00,  7.13it/s] 98%|█████████▊| 98/100 [00:13<00:00,  7.03it/s] 99%|█████████▉| 99/100 [00:13<00:00,  7.14it/s]100%|██████████| 100/100 [00:13<00:00,  7.29it/s]100%|██████████| 100/100 [00:13<00:00,  7.23it/s]
FOLD 1
Metric     CE Loss  KL wrt Orig
Model                          
llama_7B  2.261768     0.207135
[2.30456543 0.18494052]
2023-12-04 00:54:18.617626: I tensorflow/core/util/port.cc:110] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2023-12-04 00:54:18.668054: I tensorflow/core/platform/cpu_feature_guard.cc:182] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-12-04 00:54:19.425488: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Could not find TensorRT
Found cached dataset truthful_qa (/home/elicer/.cache/huggingface/datasets/truthful_qa/multiple_choice/1.1.0/63502f6bc6ee493830ce0843991b028d0ab568d221896b2ee3b8a5dfdaa9d7f4)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 367.66it/s]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:00<00:00,  5.17it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  6.21it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  6.03it/s]
head_wise_activation_length:(11012, 32, 4096)
labels_shape:(11012,)
seperated_head_activation shape:11013
Running fold 0
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:29,  1.06it/s]  6%|▋         | 2/32 [00:01<00:28,  1.04it/s]  9%|▉         | 3/32 [00:02<00:27,  1.07it/s] 12%|█▎        | 4/32 [00:03<00:25,  1.09it/s] 16%|█▌        | 5/32 [00:04<00:25,  1.08it/s] 19%|█▉        | 6/32 [00:05<00:24,  1.06it/s] 22%|██▏       | 7/32 [00:06<00:23,  1.05it/s] 25%|██▌       | 8/32 [00:07<00:23,  1.03it/s] 28%|██▊       | 9/32 [00:08<00:22,  1.00it/s] 31%|███▏      | 10/32 [00:09<00:22,  1.02s/it] 34%|███▍      | 11/32 [00:10<00:22,  1.05s/it] 38%|███▊      | 12/32 [00:11<00:20,  1.05s/it] 41%|████      | 13/32 [00:12<00:20,  1.06s/it] 44%|████▍     | 14/32 [00:14<00:19,  1.08s/it] 47%|████▋     | 15/32 [00:15<00:18,  1.07s/it] 50%|█████     | 16/32 [00:16<00:17,  1.07s/it] 53%|█████▎    | 17/32 [00:17<00:16,  1.08s/it] 56%|█████▋    | 18/32 [00:18<00:15,  1.09s/it] 59%|█████▉    | 19/32 [00:19<00:14,  1.12s/it] 62%|██████▎   | 20/32 [00:20<00:13,  1.13s/it] 66%|██████▌   | 21/32 [00:21<00:12,  1.15s/it] 69%|██████▉   | 22/32 [00:23<00:11,  1.13s/it] 72%|███████▏  | 23/32 [00:24<00:10,  1.16s/it] 75%|███████▌  | 24/32 [00:25<00:09,  1.21s/it] 78%|███████▊  | 25/32 [00:26<00:08,  1.20s/it] 81%|████████▏ | 26/32 [00:27<00:07,  1.18s/it] 84%|████████▍ | 27/32 [00:29<00:06,  1.21s/it] 88%|████████▊ | 28/32 [00:30<00:04,  1.16s/it] 91%|█████████ | 29/32 [00:31<00:03,  1.17s/it] 94%|█████████▍| 30/32 [00:32<00:02,  1.17s/it] 97%|█████████▋| 31/32 [00:33<00:01,  1.17s/it]100%|██████████| 32/32 [00:35<00:00,  1.27s/it]100%|██████████| 32/32 [00:35<00:00,  1.10s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
/home/elicer/honest_llama/validation/../TruthfulQA/truthfulqa/metrics.py:284: FutureWarning: load_metric is deprecated and will be removed in the next major version of datasets. Use 'evaluate.load' instead, from the new library 🤗 Evaluate: https://huggingface.co/docs/evaluate
  bleurt = load_metric("bleurt", cache_dir=cache_dir)
[[0.651 0.665 0.645 ... 0.646 0.647 0.652]
 [0.659 0.644 0.645 ... 0.648 0.658 0.656]
 [0.651 0.657 0.685 ... 0.637 0.648 0.667]
 ...
 [0.765 0.762 0.657 ... 0.73  0.704 0.674]
 [0.748 0.678 0.696 ... 0.663 0.769 0.786]
 [0.775 0.815 0.74  ... 0.697 0.809 0.79 ]]
Heads intervened:  [(8, 16), (12, 4), (12, 15), (13, 8), (13, 16), (14, 2), (14, 20), (15, 28), (16, 17), (16, 26), (16, 30), (17, 4), (17, 9), (17, 13), (17, 17), (17, 29), (18, 29), (19, 13), (19, 17), (19, 31), (20, 22), (20, 30), (21, 18), (22, 16), (22, 23), (22, 30), (23, 3), (23, 4), (23, 7), (23, 13), (25, 15), (31, 1), (31, 3), (31, 6), (31, 25), (31, 30)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
2023-12-04 00:55:11.821595: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1635] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 24961 MB memory:  -> device: 0, name: NVIDIA A100 80GB PCIe MIG 3g.40gb, pci bus id: 0000:65:00.0, compute capability: 8.0
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 259.92it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-ec0cf83741fdb3e8.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-d31e6c0c76fafb4d.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:01<01:43,  1.05s/it]  3%|▎         | 3/100 [00:01<00:30,  3.18it/s]  5%|▌         | 5/100 [00:01<00:17,  5.47it/s]  7%|▋         | 7/100 [00:01<00:12,  7.66it/s]  9%|▉         | 9/100 [00:01<00:09,  9.64it/s] 11%|█         | 11/100 [00:01<00:07, 11.34it/s] 13%|█▎        | 13/100 [00:01<00:06, 12.75it/s] 15%|█▌        | 15/100 [00:01<00:06, 13.76it/s] 17%|█▋        | 17/100 [00:01<00:05, 14.60it/s] 19%|█▉        | 19/100 [00:02<00:05, 15.22it/s] 21%|██        | 21/100 [00:02<00:05, 15.68it/s] 23%|██▎       | 23/100 [00:02<00:04, 16.01it/s] 25%|██▌       | 25/100 [00:02<00:04, 16.32it/s] 27%|██▋       | 27/100 [00:02<00:04, 16.10it/s] 29%|██▉       | 29/100 [00:02<00:04, 16.23it/s] 31%|███       | 31/100 [00:02<00:04, 16.47it/s] 33%|███▎      | 33/100 [00:02<00:04, 16.39it/s] 35%|███▌      | 35/100 [00:03<00:03, 16.57it/s] 37%|███▋      | 37/100 [00:03<00:03, 16.72it/s] 39%|███▉      | 39/100 [00:03<00:03, 16.80it/s] 41%|████      | 41/100 [00:03<00:03, 16.90it/s] 43%|████▎     | 43/100 [00:03<00:03, 16.96it/s] 45%|████▌     | 45/100 [00:03<00:03, 16.97it/s] 47%|████▋     | 47/100 [00:03<00:03, 17.00it/s] 49%|████▉     | 49/100 [00:03<00:02, 17.04it/s] 51%|█████     | 51/100 [00:04<00:02, 17.06it/s] 53%|█████▎    | 53/100 [00:04<00:02, 17.08it/s] 55%|█████▌    | 55/100 [00:04<00:02, 17.04it/s] 57%|█████▋    | 57/100 [00:04<00:02, 17.07it/s] 59%|█████▉    | 59/100 [00:04<00:02, 17.07it/s] 61%|██████    | 61/100 [00:04<00:02, 16.97it/s] 63%|██████▎   | 63/100 [00:04<00:02, 16.85it/s] 65%|██████▌   | 65/100 [00:04<00:02, 16.91it/s] 67%|██████▋   | 67/100 [00:04<00:01, 16.90it/s] 69%|██████▉   | 69/100 [00:05<00:01, 16.94it/s] 71%|███████   | 71/100 [00:05<00:01, 16.99it/s] 73%|███████▎  | 73/100 [00:05<00:01, 16.99it/s] 75%|███████▌  | 75/100 [00:05<00:01, 17.04it/s] 77%|███████▋  | 77/100 [00:05<00:01, 17.08it/s] 79%|███████▉  | 79/100 [00:05<00:01, 17.11it/s] 81%|████████  | 81/100 [00:05<00:01, 17.13it/s] 83%|████████▎ | 83/100 [00:05<00:00, 17.14it/s] 85%|████████▌ | 85/100 [00:06<00:00, 17.03it/s] 87%|████████▋ | 87/100 [00:06<00:00, 17.07it/s] 89%|████████▉ | 89/100 [00:06<00:00, 17.09it/s] 91%|█████████ | 91/100 [00:06<00:00, 17.09it/s] 93%|█████████▎| 93/100 [00:06<00:00, 16.99it/s] 95%|█████████▌| 95/100 [00:06<00:00, 16.91it/s] 97%|█████████▋| 97/100 [00:06<00:00, 16.35it/s] 99%|█████████▉| 99/100 [00:06<00:00, 16.58it/s]100%|██████████| 100/100 [00:06<00:00, 14.48it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 789.14it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-1939fcc1eeebdaa7.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-785bb4b6f2089589.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:17,  5.58it/s]  2%|▏         | 2/100 [00:00<00:15,  6.30it/s]  3%|▎         | 3/100 [00:00<00:14,  6.80it/s]  4%|▍         | 4/100 [00:00<00:13,  6.88it/s]  5%|▌         | 5/100 [00:00<00:13,  7.01it/s]  6%|▌         | 6/100 [00:00<00:13,  6.94it/s]  7%|▋         | 7/100 [00:01<00:13,  6.97it/s]  8%|▊         | 8/100 [00:01<00:13,  7.00it/s]  9%|▉         | 9/100 [00:01<00:12,  7.16it/s] 10%|█         | 10/100 [00:01<00:12,  7.19it/s] 11%|█         | 11/100 [00:01<00:12,  7.16it/s] 12%|█▏        | 12/100 [00:01<00:12,  7.07it/s] 13%|█▎        | 13/100 [00:01<00:12,  7.11it/s] 14%|█▍        | 14/100 [00:02<00:12,  7.08it/s] 15%|█▌        | 15/100 [00:02<00:11,  7.20it/s] 16%|█▌        | 16/100 [00:02<00:11,  7.18it/s] 17%|█▋        | 17/100 [00:02<00:11,  7.03it/s] 18%|█▊        | 18/100 [00:02<00:11,  7.00it/s] 19%|█▉        | 19/100 [00:02<00:11,  7.14it/s] 20%|██        | 20/100 [00:02<00:11,  7.10it/s] 21%|██        | 21/100 [00:02<00:11,  7.09it/s] 22%|██▏       | 22/100 [00:03<00:11,  7.00it/s] 23%|██▎       | 23/100 [00:03<00:10,  7.06it/s] 24%|██▍       | 24/100 [00:03<00:10,  7.07it/s] 25%|██▌       | 25/100 [00:03<00:10,  6.90it/s] 26%|██▌       | 26/100 [00:03<00:11,  6.63it/s] 27%|██▋       | 27/100 [00:03<00:10,  6.70it/s] 28%|██▊       | 28/100 [00:04<00:10,  6.75it/s] 29%|██▉       | 29/100 [00:04<00:10,  6.79it/s] 30%|███       | 30/100 [00:04<00:10,  6.86it/s] 31%|███       | 31/100 [00:04<00:10,  6.88it/s] 32%|███▏      | 32/100 [00:04<00:10,  6.70it/s] 33%|███▎      | 33/100 [00:04<00:09,  6.84it/s] 34%|███▍      | 34/100 [00:04<00:09,  7.00it/s] 35%|███▌      | 35/100 [00:05<00:09,  6.91it/s] 36%|███▌      | 36/100 [00:05<00:09,  6.89it/s] 37%|███▋      | 37/100 [00:05<00:08,  7.02it/s] 38%|███▊      | 38/100 [00:05<00:08,  7.00it/s] 39%|███▉      | 39/100 [00:05<00:08,  6.89it/s] 40%|████      | 40/100 [00:05<00:08,  6.96it/s] 41%|████      | 41/100 [00:05<00:08,  7.03it/s] 42%|████▏     | 42/100 [00:06<00:08,  6.92it/s] 43%|████▎     | 43/100 [00:06<00:08,  6.86it/s] 44%|████▍     | 44/100 [00:06<00:07,  7.05it/s] 45%|████▌     | 45/100 [00:06<00:07,  7.18it/s] 46%|████▌     | 46/100 [00:06<00:07,  6.91it/s] 47%|████▋     | 47/100 [00:06<00:07,  7.05it/s] 48%|████▊     | 48/100 [00:06<00:07,  7.06it/s] 49%|████▉     | 49/100 [00:07<00:07,  7.12it/s] 50%|█████     | 50/100 [00:07<00:06,  7.24it/s] 51%|█████     | 51/100 [00:07<00:06,  7.26it/s] 52%|█████▏    | 52/100 [00:07<00:06,  6.95it/s] 53%|█████▎    | 53/100 [00:07<00:06,  6.91it/s] 54%|█████▍    | 54/100 [00:07<00:06,  7.01it/s] 55%|█████▌    | 55/100 [00:07<00:06,  7.05it/s] 56%|█████▌    | 56/100 [00:08<00:06,  6.90it/s] 57%|█████▋    | 57/100 [00:08<00:06,  6.83it/s] 58%|█████▊    | 58/100 [00:08<00:06,  6.85it/s] 59%|█████▉    | 59/100 [00:08<00:06,  6.80it/s] 60%|██████    | 60/100 [00:08<00:05,  6.76it/s] 61%|██████    | 61/100 [00:08<00:05,  6.91it/s] 62%|██████▏   | 62/100 [00:08<00:05,  6.92it/s] 63%|██████▎   | 63/100 [00:09<00:05,  6.99it/s] 64%|██████▍   | 64/100 [00:09<00:05,  7.08it/s] 65%|██████▌   | 65/100 [00:09<00:05,  6.97it/s] 66%|██████▌   | 66/100 [00:09<00:04,  6.96it/s] 67%|██████▋   | 67/100 [00:09<00:04,  6.98it/s] 68%|██████▊   | 68/100 [00:09<00:04,  6.96it/s] 69%|██████▉   | 69/100 [00:09<00:04,  6.94it/s] 70%|███████   | 70/100 [00:10<00:04,  7.12it/s] 71%|███████   | 71/100 [00:10<00:04,  7.25it/s] 72%|███████▏  | 72/100 [00:10<00:03,  7.09it/s] 73%|███████▎  | 73/100 [00:10<00:03,  7.01it/s] 74%|███████▍  | 74/100 [00:10<00:03,  6.96it/s] 75%|███████▌  | 75/100 [00:10<00:03,  6.96it/s] 76%|███████▌  | 76/100 [00:10<00:03,  7.11it/s] 77%|███████▋  | 77/100 [00:11<00:03,  7.03it/s] 78%|███████▊  | 78/100 [00:11<00:03,  6.99it/s] 79%|███████▉  | 79/100 [00:11<00:03,  6.87it/s] 80%|████████  | 80/100 [00:11<00:02,  6.96it/s] 81%|████████  | 81/100 [00:11<00:02,  7.11it/s] 82%|████████▏ | 82/100 [00:11<00:02,  6.91it/s] 83%|████████▎ | 83/100 [00:11<00:02,  6.92it/s] 84%|████████▍ | 84/100 [00:12<00:02,  6.91it/s] 85%|████████▌ | 85/100 [00:12<00:02,  7.09it/s] 86%|████████▌ | 86/100 [00:12<00:02,  6.96it/s] 87%|████████▋ | 87/100 [00:12<00:01,  7.00it/s] 88%|████████▊ | 88/100 [00:12<00:01,  7.08it/s] 89%|████████▉ | 89/100 [00:12<00:01,  7.08it/s] 90%|█████████ | 90/100 [00:12<00:01,  7.01it/s] 91%|█████████ | 91/100 [00:13<00:01,  6.98it/s] 92%|█████████▏| 92/100 [00:13<00:01,  7.14it/s] 93%|█████████▎| 93/100 [00:13<00:00,  7.10it/s] 94%|█████████▍| 94/100 [00:13<00:00,  6.97it/s] 95%|█████████▌| 95/100 [00:13<00:00,  7.00it/s] 96%|█████████▌| 96/100 [00:13<00:00,  6.95it/s] 97%|█████████▋| 97/100 [00:13<00:00,  6.97it/s] 98%|█████████▊| 98/100 [00:14<00:00,  7.13it/s] 99%|█████████▉| 99/100 [00:14<00:00,  7.19it/s]100%|██████████| 100/100 [00:14<00:00,  7.19it/s]100%|██████████| 100/100 [00:14<00:00,  6.99it/s]
FOLD 0
Metric     CE Loss  KL wrt Orig
Model                          
llama_7B  2.384463      0.19677
Running fold 1
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:29,  1.05it/s]  6%|▋         | 2/32 [00:02<00:32,  1.09s/it]  9%|▉         | 3/32 [00:03<00:34,  1.18s/it] 12%|█▎        | 4/32 [00:04<00:33,  1.20s/it] 16%|█▌        | 5/32 [00:05<00:32,  1.22s/it] 19%|█▉        | 6/32 [00:07<00:32,  1.24s/it] 22%|██▏       | 7/32 [00:08<00:30,  1.24s/it] 25%|██▌       | 8/32 [00:09<00:29,  1.23s/it] 28%|██▊       | 9/32 [00:10<00:28,  1.23s/it] 31%|███▏      | 10/32 [00:12<00:26,  1.23s/it] 34%|███▍      | 11/32 [00:13<00:25,  1.21s/it] 38%|███▊      | 12/32 [00:14<00:23,  1.20s/it] 41%|████      | 13/32 [00:15<00:22,  1.19s/it] 44%|████▍     | 14/32 [00:16<00:21,  1.19s/it] 47%|████▋     | 15/32 [00:17<00:20,  1.18s/it] 50%|█████     | 16/32 [00:19<00:19,  1.20s/it] 53%|█████▎    | 17/32 [00:20<00:17,  1.20s/it] 56%|█████▋    | 18/32 [00:21<00:16,  1.19s/it] 59%|█████▉    | 19/32 [00:22<00:15,  1.22s/it] 62%|██████▎   | 20/32 [00:24<00:15,  1.25s/it] 66%|██████▌   | 21/32 [00:25<00:13,  1.25s/it] 69%|██████▉   | 22/32 [00:26<00:12,  1.25s/it] 72%|███████▏  | 23/32 [00:27<00:11,  1.26s/it] 75%|███████▌  | 24/32 [00:29<00:10,  1.28s/it] 78%|███████▊  | 25/32 [00:30<00:08,  1.28s/it] 81%|████████▏ | 26/32 [00:31<00:07,  1.27s/it] 84%|████████▍ | 27/32 [00:33<00:06,  1.28s/it] 88%|████████▊ | 28/32 [00:34<00:05,  1.27s/it] 91%|█████████ | 29/32 [00:35<00:03,  1.28s/it] 94%|█████████▍| 30/32 [00:36<00:02,  1.27s/it] 97%|█████████▋| 31/32 [00:38<00:01,  1.26s/it]100%|██████████| 32/32 [00:39<00:00,  1.31s/it]100%|██████████| 32/32 [00:39<00:00,  1.24s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
[[0.666 0.672 0.662 ... 0.668 0.662 0.67 ]
 [0.662 0.662 0.659 ... 0.677 0.666 0.663]
 [0.668 0.67  0.68  ... 0.661 0.665 0.671]
 ...
 [0.758 0.75  0.674 ... 0.716 0.694 0.677]
 [0.749 0.671 0.686 ... 0.674 0.762 0.76 ]
 [0.765 0.805 0.748 ... 0.743 0.787 0.775]]
Heads intervened:  [(8, 16), (11, 16), (11, 17), (12, 4), (12, 22), (13, 8), (13, 10), (13, 16), (13, 21), (14, 2), (15, 28), (16, 4), (16, 17), (16, 26), (16, 30), (17, 4), (17, 13), (17, 19), (17, 29), (18, 29), (19, 13), (19, 17), (19, 31), (20, 22), (20, 30), (22, 16), (23, 3), (23, 12), (23, 25), (26, 13), (27, 3), (27, 7), (30, 4), (30, 18), (31, 1), (31, 6)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 252.21it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-30ec7b2da7888791.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-4e53eea82b0ecfef.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  2%|▏         | 2/100 [00:00<00:06, 15.17it/s]  4%|▍         | 4/100 [00:00<00:06, 15.75it/s]  6%|▌         | 6/100 [00:00<00:05, 16.00it/s]  8%|▊         | 8/100 [00:00<00:05, 16.30it/s] 10%|█         | 10/100 [00:00<00:05, 16.34it/s] 12%|█▏        | 12/100 [00:00<00:05, 16.45it/s] 14%|█▍        | 14/100 [00:00<00:05, 16.57it/s] 16%|█▌        | 16/100 [00:00<00:05, 16.66it/s] 18%|█▊        | 18/100 [00:01<00:04, 16.72it/s] 20%|██        | 20/100 [00:01<00:04, 16.74it/s] 22%|██▏       | 22/100 [00:01<00:04, 16.77it/s] 24%|██▍       | 24/100 [00:01<00:04, 16.77it/s] 26%|██▌       | 26/100 [00:01<00:04, 16.78it/s] 28%|██▊       | 28/100 [00:01<00:04, 16.72it/s] 30%|███       | 30/100 [00:01<00:04, 16.67it/s] 32%|███▏      | 32/100 [00:01<00:04, 16.65it/s] 34%|███▍      | 34/100 [00:02<00:03, 16.65it/s] 36%|███▌      | 36/100 [00:02<00:03, 16.72it/s] 38%|███▊      | 38/100 [00:02<00:03, 16.76it/s] 40%|████      | 40/100 [00:02<00:03, 16.79it/s] 42%|████▏     | 42/100 [00:02<00:03, 16.81it/s] 44%|████▍     | 44/100 [00:02<00:03, 16.83it/s] 46%|████▌     | 46/100 [00:02<00:03, 16.34it/s] 48%|████▊     | 48/100 [00:02<00:03, 16.10it/s] 50%|█████     | 50/100 [00:03<00:03, 16.30it/s] 52%|█████▏    | 52/100 [00:03<00:02, 16.44it/s] 54%|█████▍    | 54/100 [00:03<00:02, 16.58it/s] 56%|█████▌    | 56/100 [00:03<00:02, 16.68it/s] 58%|█████▊    | 58/100 [00:03<00:02, 16.75it/s] 60%|██████    | 60/100 [00:03<00:02, 16.76it/s] 62%|██████▏   | 62/100 [00:03<00:02, 16.78it/s] 64%|██████▍   | 64/100 [00:03<00:02, 16.82it/s] 66%|██████▌   | 66/100 [00:03<00:02, 16.85it/s] 68%|██████▊   | 68/100 [00:04<00:01, 16.87it/s] 70%|███████   | 70/100 [00:04<00:01, 16.88it/s] 72%|███████▏  | 72/100 [00:04<00:01, 16.85it/s] 74%|███████▍  | 74/100 [00:04<00:01, 16.76it/s] 76%|███████▌  | 76/100 [00:04<00:01, 16.72it/s] 78%|███████▊  | 78/100 [00:04<00:01, 16.66it/s] 80%|████████  | 80/100 [00:04<00:01, 16.63it/s] 82%|████████▏ | 82/100 [00:04<00:01, 16.50it/s] 84%|████████▍ | 84/100 [00:05<00:00, 16.39it/s] 86%|████████▌ | 86/100 [00:05<00:00, 16.44it/s] 88%|████████▊ | 88/100 [00:05<00:00, 16.52it/s] 90%|█████████ | 90/100 [00:05<00:00, 16.59it/s] 92%|█████████▏| 92/100 [00:05<00:00, 16.62it/s] 94%|█████████▍| 94/100 [00:05<00:00, 16.69it/s] 96%|█████████▌| 96/100 [00:05<00:00, 16.76it/s] 98%|█████████▊| 98/100 [00:05<00:00, 16.79it/s]100%|██████████| 100/100 [00:06<00:00, 16.83it/s]100%|██████████| 100/100 [00:06<00:00, 16.63it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 351.16it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-14295f39edd20556.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-10ca04ba0c7bb427.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:17,  5.77it/s]  2%|▏         | 2/100 [00:00<00:16,  6.08it/s]  3%|▎         | 3/100 [00:00<00:15,  6.27it/s]  4%|▍         | 4/100 [00:00<00:14,  6.63it/s]  5%|▌         | 5/100 [00:00<00:13,  6.83it/s]  6%|▌         | 6/100 [00:00<00:13,  6.85it/s]  7%|▋         | 7/100 [00:01<00:13,  6.88it/s]  8%|▊         | 8/100 [00:01<00:13,  6.95it/s]  9%|▉         | 9/100 [00:01<00:13,  6.88it/s] 10%|█         | 10/100 [00:01<00:13,  6.75it/s] 11%|█         | 11/100 [00:01<00:13,  6.78it/s] 12%|█▏        | 12/100 [00:01<00:12,  6.78it/s] 13%|█▎        | 13/100 [00:01<00:12,  6.87it/s] 14%|█▍        | 14/100 [00:02<00:12,  6.81it/s] 15%|█▌        | 15/100 [00:02<00:12,  7.00it/s] 16%|█▌        | 16/100 [00:02<00:11,  7.06it/s] 17%|█▋        | 17/100 [00:02<00:11,  7.10it/s] 18%|█▊        | 18/100 [00:02<00:11,  7.09it/s] 19%|█▉        | 19/100 [00:02<00:11,  7.04it/s] 20%|██        | 20/100 [00:02<00:11,  7.02it/s] 21%|██        | 21/100 [00:03<00:11,  6.93it/s] 22%|██▏       | 22/100 [00:03<00:11,  6.83it/s] 23%|██▎       | 23/100 [00:03<00:11,  6.74it/s] 24%|██▍       | 24/100 [00:03<00:11,  6.74it/s] 25%|██▌       | 25/100 [00:03<00:11,  6.64it/s] 26%|██▌       | 26/100 [00:03<00:11,  6.69it/s] 27%|██▋       | 27/100 [00:03<00:10,  6.66it/s] 28%|██▊       | 28/100 [00:04<00:10,  6.82it/s] 29%|██▉       | 29/100 [00:04<00:10,  6.92it/s] 30%|███       | 30/100 [00:04<00:09,  7.01it/s] 31%|███       | 31/100 [00:04<00:09,  7.02it/s] 32%|███▏      | 32/100 [00:04<00:09,  6.83it/s] 33%|███▎      | 33/100 [00:04<00:09,  6.82it/s] 34%|███▍      | 34/100 [00:04<00:09,  6.82it/s] 35%|███▌      | 35/100 [00:05<00:09,  6.87it/s] 36%|███▌      | 36/100 [00:05<00:09,  6.96it/s] 37%|███▋      | 37/100 [00:05<00:09,  6.66it/s] 38%|███▊      | 38/100 [00:05<00:09,  6.66it/s] 39%|███▉      | 39/100 [00:05<00:09,  6.75it/s] 40%|████      | 40/100 [00:05<00:08,  6.84it/s] 41%|████      | 41/100 [00:06<00:08,  6.82it/s] 42%|████▏     | 42/100 [00:06<00:08,  6.81it/s] 43%|████▎     | 43/100 [00:06<00:08,  6.89it/s] 44%|████▍     | 44/100 [00:06<00:07,  7.06it/s] 45%|████▌     | 45/100 [00:06<00:07,  6.94it/s] 46%|████▌     | 46/100 [00:06<00:07,  6.91it/s] 47%|████▋     | 47/100 [00:06<00:07,  6.81it/s] 48%|████▊     | 48/100 [00:07<00:07,  6.85it/s] 49%|████▉     | 49/100 [00:07<00:07,  6.79it/s] 50%|█████     | 50/100 [00:07<00:07,  6.70it/s] 51%|█████     | 51/100 [00:07<00:07,  6.70it/s] 52%|█████▏    | 52/100 [00:07<00:07,  6.66it/s] 53%|█████▎    | 53/100 [00:07<00:07,  6.53it/s] 54%|█████▍    | 54/100 [00:07<00:07,  6.56it/s] 55%|█████▌    | 55/100 [00:08<00:06,  6.70it/s] 56%|█████▌    | 56/100 [00:08<00:06,  6.77it/s] 57%|█████▋    | 57/100 [00:08<00:06,  6.74it/s] 58%|█████▊    | 58/100 [00:08<00:06,  6.69it/s] 59%|█████▉    | 59/100 [00:08<00:06,  6.81it/s] 60%|██████    | 60/100 [00:08<00:05,  6.87it/s] 61%|██████    | 61/100 [00:08<00:05,  6.73it/s] 62%|██████▏   | 62/100 [00:09<00:05,  6.83it/s] 63%|██████▎   | 63/100 [00:09<00:05,  6.80it/s] 64%|██████▍   | 64/100 [00:09<00:05,  6.99it/s] 65%|██████▌   | 65/100 [00:09<00:04,  7.05it/s] 66%|██████▌   | 66/100 [00:09<00:04,  7.01it/s] 67%|██████▋   | 67/100 [00:09<00:04,  6.90it/s] 68%|██████▊   | 68/100 [00:09<00:04,  6.91it/s] 69%|██████▉   | 69/100 [00:10<00:04,  6.74it/s] 70%|███████   | 70/100 [00:10<00:04,  6.68it/s] 71%|███████   | 71/100 [00:10<00:04,  6.66it/s] 72%|███████▏  | 72/100 [00:10<00:04,  6.73it/s] 73%|███████▎  | 73/100 [00:10<00:03,  6.81it/s] 74%|███████▍  | 74/100 [00:10<00:03,  6.79it/s] 75%|███████▌  | 75/100 [00:11<00:03,  6.75it/s] 76%|███████▌  | 76/100 [00:11<00:03,  6.87it/s] 77%|███████▋  | 77/100 [00:11<00:03,  6.93it/s] 78%|███████▊  | 78/100 [00:11<00:03,  7.07it/s] 79%|███████▉  | 79/100 [00:11<00:02,  7.10it/s] 80%|████████  | 80/100 [00:11<00:02,  7.03it/s] 81%|████████  | 81/100 [00:11<00:02,  6.80it/s] 82%|████████▏ | 82/100 [00:12<00:02,  6.79it/s] 83%|████████▎ | 83/100 [00:12<00:02,  6.82it/s] 84%|████████▍ | 84/100 [00:12<00:02,  6.70it/s] 85%|████████▌ | 85/100 [00:12<00:02,  6.64it/s] 86%|████████▌ | 86/100 [00:12<00:02,  6.70it/s] 87%|████████▋ | 87/100 [00:12<00:01,  6.62it/s] 88%|████████▊ | 88/100 [00:12<00:01,  6.69it/s] 89%|████████▉ | 89/100 [00:13<00:01,  6.50it/s] 90%|█████████ | 90/100 [00:13<00:01,  6.59it/s] 91%|█████████ | 91/100 [00:13<00:01,  6.57it/s] 92%|█████████▏| 92/100 [00:13<00:01,  6.72it/s] 93%|█████████▎| 93/100 [00:13<00:01,  6.84it/s] 94%|█████████▍| 94/100 [00:13<00:00,  6.98it/s] 95%|█████████▌| 95/100 [00:13<00:00,  6.85it/s] 96%|█████████▌| 96/100 [00:14<00:00,  6.85it/s] 97%|█████████▋| 97/100 [00:14<00:00,  6.71it/s] 98%|█████████▊| 98/100 [00:14<00:00,  6.62it/s] 99%|█████████▉| 99/100 [00:14<00:00,  6.68it/s]100%|██████████| 100/100 [00:14<00:00,  6.70it/s]100%|██████████| 100/100 [00:14<00:00,  6.80it/s]
FOLD 1
Metric     CE Loss  KL wrt Orig
Model                          
llama_7B  2.266729     0.205517
[2.3255957  0.20114365]
2023-12-04 00:56:52.920015: I tensorflow/core/util/port.cc:110] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2023-12-04 00:56:52.970189: I tensorflow/core/platform/cpu_feature_guard.cc:182] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-12-04 00:56:53.723558: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Could not find TensorRT
Found cached dataset truthful_qa (/home/elicer/.cache/huggingface/datasets/truthful_qa/multiple_choice/1.1.0/63502f6bc6ee493830ce0843991b028d0ab568d221896b2ee3b8a5dfdaa9d7f4)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 366.86it/s]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:00<00:00,  5.16it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  6.18it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  5.99it/s]
head_wise_activation_length:(11012, 32, 4096)
labels_shape:(11012,)
seperated_head_activation shape:11013
Running fold 0
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:29,  1.06it/s]  6%|▋         | 2/32 [00:01<00:28,  1.05it/s]  9%|▉         | 3/32 [00:02<00:27,  1.07it/s] 12%|█▎        | 4/32 [00:03<00:25,  1.10it/s] 16%|█▌        | 5/32 [00:04<00:24,  1.09it/s] 19%|█▉        | 6/32 [00:05<00:24,  1.08it/s] 22%|██▏       | 7/32 [00:06<00:23,  1.07it/s] 25%|██▌       | 8/32 [00:07<00:23,  1.04it/s] 28%|██▊       | 9/32 [00:08<00:22,  1.01it/s] 31%|███▏      | 10/32 [00:09<00:22,  1.01s/it] 34%|███▍      | 11/32 [00:10<00:21,  1.03s/it] 38%|███▊      | 12/32 [00:11<00:20,  1.02s/it] 41%|████      | 13/32 [00:12<00:19,  1.03s/it] 44%|████▍     | 14/32 [00:13<00:18,  1.05s/it] 47%|████▋     | 15/32 [00:14<00:17,  1.04s/it] 50%|█████     | 16/32 [00:15<00:16,  1.04s/it] 53%|█████▎    | 17/32 [00:17<00:15,  1.05s/it] 56%|█████▋    | 18/32 [00:18<00:14,  1.06s/it] 59%|█████▉    | 19/32 [00:19<00:14,  1.09s/it] 62%|██████▎   | 20/32 [00:20<00:13,  1.10s/it] 66%|██████▌   | 21/32 [00:21<00:12,  1.12s/it] 69%|██████▉   | 22/32 [00:22<00:11,  1.11s/it] 72%|███████▏  | 23/32 [00:23<00:10,  1.14s/it] 75%|███████▌  | 24/32 [00:25<00:09,  1.19s/it] 78%|███████▊  | 25/32 [00:26<00:08,  1.18s/it] 81%|████████▏ | 26/32 [00:27<00:06,  1.17s/it] 84%|████████▍ | 27/32 [00:28<00:05,  1.19s/it] 88%|████████▊ | 28/32 [00:29<00:04,  1.15s/it] 91%|█████████ | 29/32 [00:30<00:03,  1.15s/it] 94%|█████████▍| 30/32 [00:32<00:02,  1.14s/it] 97%|█████████▋| 31/32 [00:33<00:01,  1.16s/it]100%|██████████| 32/32 [00:34<00:00,  1.25s/it]100%|██████████| 32/32 [00:34<00:00,  1.08s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
/home/elicer/honest_llama/validation/../TruthfulQA/truthfulqa/metrics.py:284: FutureWarning: load_metric is deprecated and will be removed in the next major version of datasets. Use 'evaluate.load' instead, from the new library 🤗 Evaluate: https://huggingface.co/docs/evaluate
  bleurt = load_metric("bleurt", cache_dir=cache_dir)
[[0.651 0.665 0.645 ... 0.646 0.647 0.652]
 [0.659 0.644 0.645 ... 0.648 0.658 0.656]
 [0.651 0.657 0.685 ... 0.637 0.648 0.667]
 ...
 [0.765 0.762 0.657 ... 0.73  0.704 0.674]
 [0.748 0.678 0.696 ... 0.663 0.769 0.786]
 [0.775 0.815 0.74  ... 0.697 0.809 0.79 ]]
Heads intervened:  [(8, 16), (8, 19), (10, 18), (11, 16), (12, 4), (12, 15), (12, 22), (13, 8), (13, 16), (14, 2), (14, 20), (15, 28), (16, 17), (16, 26), (16, 30), (17, 4), (17, 9), (17, 13), (17, 17), (17, 29), (18, 29), (19, 13), (19, 17), (19, 31), (20, 22), (20, 30), (21, 18), (22, 2), (22, 8), (22, 16), (22, 23), (22, 30), (23, 3), (23, 4), (23, 7), (23, 13), (23, 25), (25, 15), (30, 14), (30, 23), (31, 1), (31, 3), (31, 6), (31, 11), (31, 25), (31, 30)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
2023-12-04 00:57:45.063492: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1635] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 24961 MB memory:  -> device: 0, name: NVIDIA A100 80GB PCIe MIG 3g.40gb, pci bus id: 0000:65:00.0, compute capability: 8.0
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 273.28it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-ec0cf83741fdb3e8.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-d31e6c0c76fafb4d.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:01<01:42,  1.04s/it]  3%|▎         | 3/100 [00:01<00:30,  3.18it/s]  5%|▌         | 5/100 [00:01<00:17,  5.36it/s]  7%|▋         | 7/100 [00:01<00:12,  7.51it/s]  9%|▉         | 9/100 [00:01<00:09,  9.44it/s] 11%|█         | 11/100 [00:01<00:08, 11.11it/s] 13%|█▎        | 13/100 [00:01<00:06, 12.48it/s] 15%|█▌        | 15/100 [00:01<00:06, 13.55it/s] 17%|█▋        | 17/100 [00:02<00:05, 14.38it/s] 19%|█▉        | 19/100 [00:02<00:05, 14.99it/s] 21%|██        | 21/100 [00:02<00:05, 15.43it/s] 23%|██▎       | 23/100 [00:02<00:04, 15.75it/s] 25%|██▌       | 25/100 [00:02<00:04, 15.98it/s] 27%|██▋       | 27/100 [00:02<00:04, 16.15it/s] 29%|██▉       | 29/100 [00:02<00:04, 16.28it/s] 31%|███       | 31/100 [00:02<00:04, 16.37it/s] 33%|███▎      | 33/100 [00:02<00:04, 16.43it/s] 35%|███▌      | 35/100 [00:03<00:03, 16.47it/s] 37%|███▋      | 37/100 [00:03<00:03, 16.51it/s] 39%|███▉      | 39/100 [00:03<00:03, 16.52it/s] 41%|████      | 41/100 [00:03<00:03, 16.53it/s] 43%|████▎     | 43/100 [00:03<00:03, 16.55it/s] 45%|████▌     | 45/100 [00:03<00:03, 16.55it/s] 47%|████▋     | 47/100 [00:03<00:03, 16.56it/s] 49%|████▉     | 49/100 [00:03<00:03, 16.56it/s] 51%|█████     | 51/100 [00:04<00:02, 16.57it/s] 53%|█████▎    | 53/100 [00:04<00:02, 16.50it/s] 55%|█████▌    | 55/100 [00:04<00:02, 16.48it/s] 57%|█████▋    | 57/100 [00:04<00:02, 16.50it/s] 59%|█████▉    | 59/100 [00:04<00:02, 16.51it/s] 61%|██████    | 61/100 [00:04<00:02, 16.54it/s] 63%|██████▎   | 63/100 [00:04<00:02, 16.53it/s] 65%|██████▌   | 65/100 [00:04<00:02, 16.54it/s] 67%|██████▋   | 67/100 [00:05<00:01, 16.56it/s] 69%|██████▉   | 69/100 [00:05<00:01, 16.55it/s] 71%|███████   | 71/100 [00:05<00:01, 16.56it/s] 73%|███████▎  | 73/100 [00:05<00:01, 16.57it/s] 75%|███████▌  | 75/100 [00:05<00:01, 16.57it/s] 77%|███████▋  | 77/100 [00:05<00:01, 16.53it/s] 79%|███████▉  | 79/100 [00:05<00:01, 16.54it/s] 81%|████████  | 81/100 [00:05<00:01, 16.54it/s] 83%|████████▎ | 83/100 [00:06<00:01, 16.56it/s] 85%|████████▌ | 85/100 [00:06<00:00, 16.56it/s] 87%|████████▋ | 87/100 [00:06<00:00, 16.56it/s] 89%|████████▉ | 89/100 [00:06<00:00, 16.54it/s] 91%|█████████ | 91/100 [00:06<00:00, 16.55it/s] 93%|█████████▎| 93/100 [00:06<00:00, 16.56it/s] 95%|█████████▌| 95/100 [00:06<00:00, 16.57it/s] 97%|█████████▋| 97/100 [00:06<00:00, 16.57it/s] 99%|█████████▉| 99/100 [00:06<00:00, 16.57it/s]100%|██████████| 100/100 [00:07<00:00, 14.21it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 784.13it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-1939fcc1eeebdaa7.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-785bb4b6f2089589.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:17,  5.78it/s]  2%|▏         | 2/100 [00:00<00:15,  6.41it/s]  3%|▎         | 3/100 [00:00<00:14,  6.67it/s]  4%|▍         | 4/100 [00:00<00:14,  6.72it/s]  5%|▌         | 5/100 [00:00<00:14,  6.76it/s]  6%|▌         | 6/100 [00:00<00:13,  6.99it/s]  7%|▋         | 7/100 [00:01<00:13,  7.13it/s]  8%|▊         | 8/100 [00:01<00:12,  7.22it/s]  9%|▉         | 9/100 [00:01<00:12,  7.07it/s] 10%|█         | 10/100 [00:01<00:12,  7.00it/s] 11%|█         | 11/100 [00:01<00:12,  6.86it/s] 12%|█▏        | 12/100 [00:01<00:12,  6.96it/s] 13%|█▎        | 13/100 [00:01<00:12,  6.93it/s] 14%|█▍        | 14/100 [00:02<00:12,  6.94it/s] 15%|█▌        | 15/100 [00:02<00:12,  7.02it/s] 16%|█▌        | 16/100 [00:02<00:12,  6.77it/s] 17%|█▋        | 17/100 [00:02<00:12,  6.69it/s] 18%|█▊        | 18/100 [00:02<00:11,  6.85it/s] 19%|█▉        | 19/100 [00:02<00:11,  6.91it/s] 20%|██        | 20/100 [00:02<00:11,  7.07it/s] 21%|██        | 21/100 [00:03<00:11,  6.99it/s] 22%|██▏       | 22/100 [00:03<00:11,  6.82it/s] 23%|██▎       | 23/100 [00:03<00:11,  6.66it/s] 24%|██▍       | 24/100 [00:03<00:11,  6.79it/s] 25%|██▌       | 25/100 [00:03<00:11,  6.61it/s] 26%|██▌       | 26/100 [00:03<00:11,  6.62it/s] 27%|██▋       | 27/100 [00:03<00:11,  6.54it/s] 28%|██▊       | 28/100 [00:04<00:11,  6.45it/s] 29%|██▉       | 29/100 [00:04<00:11,  6.32it/s] 30%|███       | 30/100 [00:04<00:10,  6.38it/s] 31%|███       | 31/100 [00:04<00:10,  6.54it/s] 32%|███▏      | 32/100 [00:04<00:10,  6.51it/s] 33%|███▎      | 33/100 [00:04<00:10,  6.50it/s] 34%|███▍      | 34/100 [00:05<00:10,  6.60it/s] 35%|███▌      | 35/100 [00:05<00:09,  6.83it/s] 36%|███▌      | 36/100 [00:05<00:09,  6.91it/s] 37%|███▋      | 37/100 [00:05<00:09,  6.98it/s] 38%|███▊      | 38/100 [00:05<00:08,  7.03it/s] 39%|███▉      | 39/100 [00:05<00:08,  6.95it/s] 40%|████      | 40/100 [00:05<00:08,  6.78it/s] 41%|████      | 41/100 [00:06<00:08,  6.79it/s] 42%|████▏     | 42/100 [00:06<00:08,  6.68it/s] 43%|████▎     | 43/100 [00:06<00:08,  6.89it/s] 44%|████▍     | 44/100 [00:06<00:08,  6.85it/s] 45%|████▌     | 45/100 [00:06<00:08,  6.81it/s] 46%|████▌     | 46/100 [00:06<00:07,  6.82it/s] 47%|████▋     | 47/100 [00:06<00:07,  6.82it/s] 48%|████▊     | 48/100 [00:07<00:07,  6.84it/s] 49%|████▉     | 49/100 [00:07<00:07,  6.93it/s] 50%|█████     | 50/100 [00:07<00:07,  6.96it/s] 51%|█████     | 51/100 [00:07<00:07,  6.74it/s] 52%|█████▏    | 52/100 [00:07<00:07,  6.70it/s] 53%|█████▎    | 53/100 [00:07<00:07,  6.69it/s] 54%|█████▍    | 54/100 [00:07<00:06,  6.72it/s] 55%|█████▌    | 55/100 [00:08<00:06,  6.58it/s] 56%|█████▌    | 56/100 [00:08<00:06,  6.56it/s] 57%|█████▋    | 57/100 [00:08<00:06,  6.69it/s] 58%|█████▊    | 58/100 [00:08<00:06,  6.72it/s] 59%|█████▉    | 59/100 [00:08<00:06,  6.80it/s] 60%|██████    | 60/100 [00:08<00:05,  6.68it/s] 61%|██████    | 61/100 [00:09<00:05,  6.67it/s] 62%|██████▏   | 62/100 [00:09<00:05,  6.89it/s] 63%|██████▎   | 63/100 [00:09<00:05,  6.91it/s] 64%|██████▍   | 64/100 [00:09<00:05,  7.00it/s] 65%|██████▌   | 65/100 [00:09<00:05,  6.75it/s] 66%|██████▌   | 66/100 [00:09<00:05,  6.79it/s] 67%|██████▋   | 67/100 [00:09<00:04,  6.90it/s] 68%|██████▊   | 68/100 [00:10<00:04,  6.88it/s] 69%|██████▉   | 69/100 [00:10<00:04,  7.03it/s] 70%|███████   | 70/100 [00:10<00:04,  6.90it/s] 71%|███████   | 71/100 [00:10<00:04,  7.00it/s] 72%|███████▏  | 72/100 [00:10<00:04,  6.89it/s] 73%|███████▎  | 73/100 [00:10<00:03,  6.76it/s] 74%|███████▍  | 74/100 [00:10<00:03,  6.79it/s] 75%|███████▌  | 75/100 [00:11<00:03,  6.72it/s] 76%|███████▌  | 76/100 [00:11<00:03,  6.74it/s] 77%|███████▋  | 77/100 [00:11<00:03,  6.77it/s] 78%|███████▊  | 78/100 [00:11<00:03,  6.96it/s] 79%|███████▉  | 79/100 [00:11<00:03,  6.85it/s] 80%|████████  | 80/100 [00:11<00:02,  6.82it/s] 81%|████████  | 81/100 [00:11<00:02,  6.71it/s] 82%|████████▏ | 82/100 [00:12<00:02,  6.65it/s] 83%|████████▎ | 83/100 [00:12<00:02,  6.83it/s] 84%|████████▍ | 84/100 [00:12<00:02,  7.01it/s] 85%|████████▌ | 85/100 [00:12<00:02,  6.84it/s] 86%|████████▌ | 86/100 [00:12<00:02,  6.85it/s] 87%|████████▋ | 87/100 [00:12<00:01,  6.84it/s] 88%|████████▊ | 88/100 [00:12<00:01,  6.77it/s] 89%|████████▉ | 89/100 [00:13<00:01,  6.89it/s] 90%|█████████ | 90/100 [00:13<00:01,  7.05it/s] 91%|█████████ | 91/100 [00:13<00:01,  6.97it/s] 92%|█████████▏| 92/100 [00:13<00:01,  6.91it/s] 93%|█████████▎| 93/100 [00:13<00:01,  6.76it/s] 94%|█████████▍| 94/100 [00:13<00:00,  6.79it/s] 95%|█████████▌| 95/100 [00:13<00:00,  6.97it/s] 96%|█████████▌| 96/100 [00:14<00:00,  6.87it/s] 97%|█████████▋| 97/100 [00:14<00:00,  6.86it/s] 98%|█████████▊| 98/100 [00:14<00:00,  6.86it/s] 99%|█████████▉| 99/100 [00:14<00:00,  7.02it/s]100%|██████████| 100/100 [00:14<00:00,  7.16it/s]100%|██████████| 100/100 [00:14<00:00,  6.82it/s]
FOLD 0
Metric     CE Loss  KL wrt Orig
Model                          
llama_7B  2.424707     0.230272
Running fold 1
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:28,  1.08it/s]  6%|▋         | 2/32 [00:02<00:31,  1.07s/it]  9%|▉         | 3/32 [00:03<00:33,  1.14s/it] 12%|█▎        | 4/32 [00:04<00:32,  1.15s/it] 16%|█▌        | 5/32 [00:05<00:31,  1.18s/it] 19%|█▉        | 6/32 [00:06<00:31,  1.21s/it] 22%|██▏       | 7/32 [00:08<00:30,  1.22s/it] 25%|██▌       | 8/32 [00:09<00:29,  1.21s/it] 28%|██▊       | 9/32 [00:10<00:27,  1.21s/it] 31%|███▏      | 10/32 [00:11<00:26,  1.21s/it] 34%|███▍      | 11/32 [00:13<00:25,  1.20s/it] 38%|███▊      | 12/32 [00:14<00:23,  1.18s/it] 41%|████      | 13/32 [00:15<00:22,  1.17s/it] 44%|████▍     | 14/32 [00:16<00:20,  1.16s/it] 47%|████▋     | 15/32 [00:17<00:19,  1.16s/it] 50%|█████     | 16/32 [00:18<00:18,  1.17s/it] 53%|█████▎    | 17/32 [00:19<00:17,  1.16s/it] 56%|█████▋    | 18/32 [00:21<00:16,  1.16s/it] 59%|█████▉    | 19/32 [00:22<00:15,  1.19s/it] 62%|██████▎   | 20/32 [00:23<00:14,  1.23s/it] 66%|██████▌   | 21/32 [00:24<00:13,  1.24s/it] 69%|██████▉   | 22/32 [00:26<00:12,  1.24s/it] 72%|███████▏  | 23/32 [00:27<00:11,  1.25s/it] 75%|███████▌  | 24/32 [00:28<00:10,  1.27s/it] 78%|███████▊  | 25/32 [00:30<00:08,  1.28s/it] 81%|████████▏ | 26/32 [00:31<00:07,  1.27s/it] 84%|████████▍ | 27/32 [00:32<00:06,  1.28s/it] 88%|████████▊ | 28/32 [00:33<00:05,  1.27s/it] 91%|█████████ | 29/32 [00:35<00:03,  1.28s/it] 94%|█████████▍| 30/32 [00:36<00:02,  1.27s/it] 97%|█████████▋| 31/32 [00:37<00:01,  1.27s/it]100%|██████████| 32/32 [00:39<00:00,  1.32s/it]100%|██████████| 32/32 [00:39<00:00,  1.22s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
[[0.666 0.672 0.662 ... 0.668 0.662 0.67 ]
 [0.662 0.662 0.659 ... 0.677 0.666 0.663]
 [0.668 0.67  0.68  ... 0.661 0.665 0.671]
 ...
 [0.758 0.75  0.674 ... 0.716 0.694 0.677]
 [0.749 0.671 0.686 ... 0.674 0.762 0.76 ]
 [0.765 0.805 0.748 ... 0.743 0.787 0.775]]
Heads intervened:  [(5, 10), (8, 16), (11, 16), (11, 17), (12, 4), (12, 22), (13, 8), (13, 10), (13, 16), (13, 21), (14, 2), (15, 1), (15, 10), (15, 28), (16, 4), (16, 17), (16, 26), (16, 30), (17, 4), (17, 13), (17, 17), (17, 19), (17, 29), (18, 29), (19, 13), (19, 17), (19, 28), (19, 31), (20, 22), (20, 30), (21, 23), (22, 16), (23, 3), (23, 12), (23, 13), (23, 25), (26, 13), (27, 3), (27, 7), (30, 4), (30, 18), (30, 23), (31, 1), (31, 6), (31, 10), (31, 18)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 261.33it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-30ec7b2da7888791.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-4e53eea82b0ecfef.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  2%|▏         | 2/100 [00:00<00:06, 14.66it/s]  4%|▍         | 4/100 [00:00<00:06, 15.52it/s]  6%|▌         | 6/100 [00:00<00:05, 15.92it/s]  8%|▊         | 8/100 [00:00<00:05, 16.12it/s] 10%|█         | 10/100 [00:00<00:05, 16.24it/s] 12%|█▏        | 12/100 [00:00<00:05, 16.31it/s] 14%|█▍        | 14/100 [00:00<00:05, 16.37it/s] 16%|█▌        | 16/100 [00:00<00:05, 16.41it/s] 18%|█▊        | 18/100 [00:01<00:04, 16.42it/s] 20%|██        | 20/100 [00:01<00:04, 16.45it/s] 22%|██▏       | 22/100 [00:01<00:04, 16.47it/s] 24%|██▍       | 24/100 [00:01<00:04, 16.48it/s] 26%|██▌       | 26/100 [00:01<00:04, 16.48it/s] 28%|██▊       | 28/100 [00:01<00:04, 16.48it/s] 30%|███       | 30/100 [00:01<00:04, 16.48it/s] 32%|███▏      | 32/100 [00:01<00:04, 16.49it/s] 34%|███▍      | 34/100 [00:02<00:04, 16.49it/s] 36%|███▌      | 36/100 [00:02<00:03, 16.49it/s] 38%|███▊      | 38/100 [00:02<00:03, 16.09it/s] 40%|████      | 40/100 [00:02<00:03, 16.17it/s] 42%|████▏     | 42/100 [00:02<00:03, 16.25it/s] 44%|████▍     | 44/100 [00:02<00:03, 16.31it/s] 46%|████▌     | 46/100 [00:02<00:03, 16.36it/s] 48%|████▊     | 48/100 [00:02<00:03, 16.38it/s] 50%|█████     | 50/100 [00:03<00:03, 16.41it/s] 52%|█████▏    | 52/100 [00:03<00:02, 16.45it/s] 54%|█████▍    | 54/100 [00:03<00:02, 16.46it/s] 56%|█████▌    | 56/100 [00:03<00:02, 16.47it/s] 58%|█████▊    | 58/100 [00:03<00:02, 16.47it/s] 60%|██████    | 60/100 [00:03<00:02, 16.47it/s] 62%|██████▏   | 62/100 [00:03<00:02, 16.46it/s] 64%|██████▍   | 64/100 [00:03<00:02, 16.47it/s] 66%|██████▌   | 66/100 [00:04<00:02, 16.48it/s] 68%|██████▊   | 68/100 [00:04<00:01, 16.48it/s] 70%|███████   | 70/100 [00:04<00:01, 16.49it/s] 72%|███████▏  | 72/100 [00:04<00:01, 16.47it/s] 74%|███████▍  | 74/100 [00:04<00:01, 16.45it/s] 76%|███████▌  | 76/100 [00:04<00:01, 16.47it/s] 78%|███████▊  | 78/100 [00:04<00:01, 16.48it/s] 80%|████████  | 80/100 [00:04<00:01, 16.50it/s] 82%|████████▏ | 82/100 [00:05<00:01, 16.50it/s] 84%|████████▍ | 84/100 [00:05<00:00, 16.49it/s] 86%|████████▌ | 86/100 [00:05<00:00, 16.50it/s] 88%|████████▊ | 88/100 [00:05<00:00, 16.51it/s] 90%|█████████ | 90/100 [00:05<00:00, 16.51it/s] 92%|█████████▏| 92/100 [00:05<00:00, 16.50it/s] 94%|█████████▍| 94/100 [00:05<00:00, 16.49it/s] 96%|█████████▌| 96/100 [00:05<00:00, 16.49it/s] 98%|█████████▊| 98/100 [00:05<00:00, 16.49it/s]100%|██████████| 100/100 [00:06<00:00, 16.47it/s]100%|██████████| 100/100 [00:06<00:00, 16.40it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 357.39it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-14295f39edd20556.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-10ca04ba0c7bb427.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:17,  5.69it/s]  2%|▏         | 2/100 [00:00<00:16,  6.02it/s]  3%|▎         | 3/100 [00:00<00:15,  6.21it/s]  4%|▍         | 4/100 [00:00<00:14,  6.43it/s]  5%|▌         | 5/100 [00:00<00:14,  6.74it/s]  6%|▌         | 6/100 [00:00<00:13,  6.95it/s]  7%|▋         | 7/100 [00:01<00:13,  7.10it/s]  8%|▊         | 8/100 [00:01<00:12,  7.10it/s]  9%|▉         | 9/100 [00:01<00:12,  7.10it/s] 10%|█         | 10/100 [00:01<00:12,  7.07it/s] 11%|█         | 11/100 [00:01<00:13,  6.84it/s] 12%|█▏        | 12/100 [00:01<00:12,  6.83it/s] 13%|█▎        | 13/100 [00:01<00:12,  6.75it/s] 14%|█▍        | 14/100 [00:02<00:12,  6.74it/s] 15%|█▌        | 15/100 [00:02<00:12,  6.77it/s] 16%|█▌        | 16/100 [00:02<00:12,  6.73it/s] 17%|█▋        | 17/100 [00:02<00:12,  6.71it/s] 18%|█▊        | 18/100 [00:02<00:12,  6.67it/s] 19%|█▉        | 19/100 [00:02<00:12,  6.72it/s] 20%|██        | 20/100 [00:02<00:11,  6.84it/s] 21%|██        | 21/100 [00:03<00:11,  7.01it/s] 22%|██▏       | 22/100 [00:03<00:11,  6.90it/s] 23%|██▎       | 23/100 [00:03<00:11,  6.89it/s] 24%|██▍       | 24/100 [00:03<00:10,  6.97it/s] 25%|██▌       | 25/100 [00:03<00:10,  7.02it/s] 26%|██▌       | 26/100 [00:03<00:10,  7.01it/s] 27%|██▋       | 27/100 [00:03<00:10,  7.12it/s] 28%|██▊       | 28/100 [00:04<00:10,  6.99it/s] 29%|██▉       | 29/100 [00:04<00:10,  6.94it/s] 30%|███       | 30/100 [00:04<00:10,  6.89it/s] 31%|███       | 31/100 [00:04<00:10,  6.87it/s] 32%|███▏      | 32/100 [00:04<00:09,  6.97it/s] 33%|███▎      | 33/100 [00:04<00:09,  6.79it/s] 34%|███▍      | 34/100 [00:04<00:09,  6.87it/s] 35%|███▌      | 35/100 [00:05<00:09,  7.03it/s] 36%|███▌      | 36/100 [00:05<00:09,  6.93it/s] 37%|███▋      | 37/100 [00:05<00:09,  6.84it/s] 38%|███▊      | 38/100 [00:05<00:08,  6.93it/s] 39%|███▉      | 39/100 [00:05<00:08,  6.87it/s] 40%|████      | 40/100 [00:05<00:08,  6.98it/s] 41%|████      | 41/100 [00:05<00:08,  6.98it/s] 42%|████▏     | 42/100 [00:06<00:08,  6.85it/s] 43%|████▎     | 43/100 [00:06<00:08,  6.95it/s] 44%|████▍     | 44/100 [00:06<00:07,  7.01it/s] 45%|████▌     | 45/100 [00:06<00:07,  6.91it/s] 46%|████▌     | 46/100 [00:06<00:07,  6.78it/s] 47%|████▋     | 47/100 [00:06<00:07,  6.83it/s] 48%|████▊     | 48/100 [00:07<00:07,  6.71it/s] 49%|████▉     | 49/100 [00:07<00:07,  6.80it/s] 50%|█████     | 50/100 [00:07<00:07,  6.96it/s] 51%|█████     | 51/100 [00:07<00:06,  7.09it/s] 52%|█████▏    | 52/100 [00:07<00:06,  6.93it/s] 53%|█████▎    | 53/100 [00:07<00:06,  6.83it/s] 54%|█████▍    | 54/100 [00:07<00:06,  6.81it/s] 55%|█████▌    | 55/100 [00:08<00:06,  6.70it/s] 56%|█████▌    | 56/100 [00:08<00:06,  6.66it/s] 57%|█████▋    | 57/100 [00:08<00:06,  6.69it/s] 58%|█████▊    | 58/100 [00:08<00:06,  6.69it/s] 59%|█████▉    | 59/100 [00:08<00:05,  6.83it/s] 60%|██████    | 60/100 [00:08<00:05,  6.87it/s] 61%|██████    | 61/100 [00:08<00:05,  6.88it/s] 62%|██████▏   | 62/100 [00:09<00:05,  6.79it/s] 63%|██████▎   | 63/100 [00:09<00:05,  6.72it/s] 64%|██████▍   | 64/100 [00:09<00:05,  6.67it/s] 65%|██████▌   | 65/100 [00:09<00:05,  6.62it/s] 66%|██████▌   | 66/100 [00:09<00:05,  6.78it/s] 67%|██████▋   | 67/100 [00:09<00:04,  6.74it/s] 68%|██████▊   | 68/100 [00:09<00:04,  6.74it/s] 69%|██████▉   | 69/100 [00:10<00:04,  6.80it/s] 70%|███████   | 70/100 [00:10<00:04,  6.90it/s] 71%|███████   | 71/100 [00:10<00:04,  6.64it/s] 72%|███████▏  | 72/100 [00:10<00:04,  6.67it/s] 73%|███████▎  | 73/100 [00:10<00:03,  6.86it/s] 74%|███████▍  | 74/100 [00:10<00:03,  6.87it/s] 75%|███████▌  | 75/100 [00:10<00:03,  6.64it/s] 76%|███████▌  | 76/100 [00:11<00:03,  6.67it/s] 77%|███████▋  | 77/100 [00:11<00:03,  6.87it/s] 78%|███████▊  | 78/100 [00:11<00:03,  7.02it/s] 79%|███████▉  | 79/100 [00:11<00:03,  6.94it/s] 80%|████████  | 80/100 [00:11<00:02,  7.06it/s] 81%|████████  | 81/100 [00:11<00:02,  6.97it/s] 82%|████████▏ | 82/100 [00:11<00:02,  7.09it/s] 83%|████████▎ | 83/100 [00:12<00:02,  6.96it/s] 84%|████████▍ | 84/100 [00:12<00:02,  6.88it/s] 85%|████████▌ | 85/100 [00:12<00:02,  6.84it/s] 86%|████████▌ | 86/100 [00:12<00:02,  6.89it/s] 87%|████████▋ | 87/100 [00:12<00:01,  6.77it/s] 88%|████████▊ | 88/100 [00:12<00:01,  6.87it/s] 89%|████████▉ | 89/100 [00:13<00:01,  6.81it/s] 90%|█████████ | 90/100 [00:13<00:01,  6.61it/s] 91%|█████████ | 91/100 [00:13<00:01,  6.59it/s] 92%|█████████▏| 92/100 [00:13<00:01,  6.74it/s] 93%|█████████▎| 93/100 [00:13<00:01,  6.61it/s] 94%|█████████▍| 94/100 [00:13<00:00,  6.64it/s] 95%|█████████▌| 95/100 [00:13<00:00,  6.61it/s] 96%|█████████▌| 96/100 [00:14<00:00,  6.75it/s] 97%|█████████▋| 97/100 [00:14<00:00,  6.69it/s] 98%|█████████▊| 98/100 [00:14<00:00,  6.68it/s] 99%|█████████▉| 99/100 [00:14<00:00,  6.64it/s]100%|██████████| 100/100 [00:14<00:00,  6.68it/s]100%|██████████| 100/100 [00:14<00:00,  6.82it/s]
FOLD 1
Metric     CE Loss  KL wrt Orig
Model                          
llama_7B  2.358447     0.290263
[2.39157715 0.26026755]
2023-12-04 00:59:25.992950: I tensorflow/core/util/port.cc:110] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2023-12-04 00:59:26.042683: I tensorflow/core/platform/cpu_feature_guard.cc:182] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-12-04 00:59:26.796823: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Could not find TensorRT
Found cached dataset truthful_qa (/home/elicer/.cache/huggingface/datasets/truthful_qa/multiple_choice/1.1.0/63502f6bc6ee493830ce0843991b028d0ab568d221896b2ee3b8a5dfdaa9d7f4)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 375.53it/s]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:00<00:00,  5.19it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  6.21it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  6.02it/s]
head_wise_activation_length:(11012, 32, 4096)
labels_shape:(11012,)
seperated_head_activation shape:11013
Running fold 0
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:28,  1.09it/s]  6%|▋         | 2/32 [00:01<00:28,  1.06it/s]  9%|▉         | 3/32 [00:02<00:26,  1.09it/s] 12%|█▎        | 4/32 [00:03<00:25,  1.12it/s] 16%|█▌        | 5/32 [00:04<00:24,  1.11it/s] 19%|█▉        | 6/32 [00:05<00:23,  1.09it/s] 22%|██▏       | 7/32 [00:06<00:23,  1.08it/s] 25%|██▌       | 8/32 [00:07<00:22,  1.05it/s] 28%|██▊       | 9/32 [00:08<00:22,  1.02it/s] 31%|███▏      | 10/32 [00:09<00:22,  1.01s/it] 34%|███▍      | 11/32 [00:10<00:21,  1.03s/it] 38%|███▊      | 12/32 [00:11<00:20,  1.03s/it] 41%|████      | 13/32 [00:12<00:19,  1.04s/it] 44%|████▍     | 14/32 [00:13<00:19,  1.06s/it] 47%|████▋     | 15/32 [00:14<00:17,  1.05s/it] 50%|█████     | 16/32 [00:15<00:16,  1.05s/it] 53%|█████▎    | 17/32 [00:16<00:15,  1.06s/it] 56%|█████▋    | 18/32 [00:18<00:15,  1.07s/it] 59%|█████▉    | 19/32 [00:19<00:14,  1.10s/it] 62%|██████▎   | 20/32 [00:20<00:13,  1.11s/it] 66%|██████▌   | 21/32 [00:21<00:12,  1.12s/it] 69%|██████▉   | 22/32 [00:22<00:10,  1.10s/it] 72%|███████▏  | 23/32 [00:23<00:10,  1.12s/it] 75%|███████▌  | 24/32 [00:25<00:09,  1.17s/it] 78%|███████▊  | 25/32 [00:26<00:08,  1.16s/it] 81%|████████▏ | 26/32 [00:27<00:06,  1.14s/it] 84%|████████▍ | 27/32 [00:28<00:05,  1.17s/it] 88%|████████▊ | 28/32 [00:29<00:04,  1.13s/it] 91%|█████████ | 29/32 [00:30<00:03,  1.14s/it] 94%|█████████▍| 30/32 [00:31<00:02,  1.13s/it] 97%|█████████▋| 31/32 [00:32<00:01,  1.14s/it]100%|██████████| 32/32 [00:34<00:00,  1.24s/it]100%|██████████| 32/32 [00:34<00:00,  1.08s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
/home/elicer/honest_llama/validation/../TruthfulQA/truthfulqa/metrics.py:284: FutureWarning: load_metric is deprecated and will be removed in the next major version of datasets. Use 'evaluate.load' instead, from the new library 🤗 Evaluate: https://huggingface.co/docs/evaluate
  bleurt = load_metric("bleurt", cache_dir=cache_dir)
[[0.651 0.665 0.645 ... 0.646 0.647 0.652]
 [0.659 0.644 0.645 ... 0.648 0.658 0.656]
 [0.651 0.657 0.685 ... 0.637 0.648 0.667]
 ...
 [0.765 0.762 0.657 ... 0.73  0.704 0.674]
 [0.748 0.678 0.696 ... 0.663 0.769 0.786]
 [0.775 0.815 0.74  ... 0.697 0.809 0.79 ]]
Heads intervened:  [(8, 16), (12, 4), (13, 8), (13, 16), (16, 30), (17, 29), (18, 29), (19, 17), (20, 30), (22, 16), (23, 3), (31, 6)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
2023-12-04 01:00:17.644445: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1635] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 24961 MB memory:  -> device: 0, name: NVIDIA A100 80GB PCIe MIG 3g.40gb, pci bus id: 0000:65:00.0, compute capability: 8.0
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 279.14it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-ec0cf83741fdb3e8.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-d31e6c0c76fafb4d.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:01<01:41,  1.03s/it]  3%|▎         | 3/100 [00:01<00:29,  3.27it/s]  5%|▌         | 5/100 [00:01<00:16,  5.67it/s]  7%|▋         | 7/100 [00:01<00:11,  8.04it/s]  9%|▉         | 9/100 [00:01<00:08, 10.23it/s] 11%|█         | 11/100 [00:01<00:07, 12.14it/s] 13%|█▎        | 13/100 [00:01<00:06, 13.74it/s] 15%|█▌        | 15/100 [00:01<00:05, 15.02it/s] 17%|█▋        | 17/100 [00:01<00:05, 16.00it/s] 19%|█▉        | 19/100 [00:01<00:04, 16.74it/s] 21%|██        | 21/100 [00:02<00:04, 17.27it/s] 23%|██▎       | 23/100 [00:02<00:04, 17.67it/s] 25%|██▌       | 25/100 [00:02<00:04, 17.95it/s] 27%|██▋       | 27/100 [00:02<00:04, 18.15it/s] 29%|██▉       | 29/100 [00:02<00:03, 18.28it/s] 31%|███       | 31/100 [00:02<00:03, 18.38it/s] 33%|███▎      | 33/100 [00:02<00:03, 18.47it/s] 35%|███▌      | 35/100 [00:02<00:03, 18.51it/s] 37%|███▋      | 37/100 [00:02<00:03, 18.55it/s] 39%|███▉      | 39/100 [00:03<00:03, 18.58it/s] 41%|████      | 41/100 [00:03<00:03, 18.35it/s] 43%|████▎     | 43/100 [00:03<00:03, 18.42it/s] 45%|████▌     | 45/100 [00:03<00:02, 18.48it/s] 47%|████▋     | 47/100 [00:03<00:02, 18.52it/s] 49%|████▉     | 49/100 [00:03<00:02, 18.55it/s] 51%|█████     | 51/100 [00:03<00:02, 18.07it/s] 53%|█████▎    | 53/100 [00:03<00:02, 18.22it/s] 55%|█████▌    | 55/100 [00:03<00:02, 18.33it/s] 57%|█████▋    | 57/100 [00:04<00:02, 18.42it/s] 59%|█████▉    | 59/100 [00:04<00:02, 18.49it/s] 61%|██████    | 61/100 [00:04<00:02, 18.54it/s] 63%|██████▎   | 63/100 [00:04<00:01, 18.58it/s] 65%|██████▌   | 65/100 [00:04<00:01, 18.61it/s] 67%|██████▋   | 67/100 [00:04<00:01, 18.62it/s] 69%|██████▉   | 69/100 [00:04<00:01, 18.65it/s] 71%|███████   | 71/100 [00:04<00:01, 18.67it/s] 73%|███████▎  | 73/100 [00:04<00:01, 18.68it/s] 75%|███████▌  | 75/100 [00:05<00:01, 18.67it/s] 77%|███████▋  | 77/100 [00:05<00:01, 18.68it/s] 79%|███████▉  | 79/100 [00:05<00:01, 18.45it/s] 81%|████████  | 81/100 [00:05<00:01, 18.46it/s] 83%|████████▎ | 83/100 [00:05<00:00, 18.53it/s] 85%|████████▌ | 85/100 [00:05<00:00, 18.57it/s] 87%|████████▋ | 87/100 [00:05<00:00, 18.56it/s] 89%|████████▉ | 89/100 [00:05<00:00, 18.58it/s] 91%|█████████ | 91/100 [00:05<00:00, 18.60it/s] 93%|█████████▎| 93/100 [00:05<00:00, 18.57it/s] 95%|█████████▌| 95/100 [00:06<00:00, 18.58it/s] 97%|█████████▋| 97/100 [00:06<00:00, 18.60it/s] 99%|█████████▉| 99/100 [00:06<00:00, 18.61it/s]100%|██████████| 100/100 [00:06<00:00, 15.72it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 349.21it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-1939fcc1eeebdaa7.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-785bb4b6f2089589.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:16,  5.83it/s]  2%|▏         | 2/100 [00:00<00:14,  6.55it/s]  3%|▎         | 3/100 [00:00<00:13,  7.07it/s]  4%|▍         | 4/100 [00:00<00:13,  7.07it/s]  5%|▌         | 5/100 [00:00<00:13,  7.23it/s]  6%|▌         | 6/100 [00:00<00:12,  7.33it/s]  7%|▋         | 7/100 [00:00<00:13,  7.15it/s]  8%|▊         | 8/100 [00:01<00:12,  7.11it/s]  9%|▉         | 9/100 [00:01<00:13,  6.89it/s] 10%|█         | 10/100 [00:01<00:12,  6.96it/s] 11%|█         | 11/100 [00:01<00:12,  7.21it/s] 12%|█▏        | 12/100 [00:01<00:11,  7.39it/s] 13%|█▎        | 13/100 [00:01<00:11,  7.33it/s] 14%|█▍        | 14/100 [00:01<00:11,  7.35it/s] 15%|█▌        | 15/100 [00:02<00:11,  7.40it/s] 16%|█▌        | 16/100 [00:02<00:11,  7.53it/s] 17%|█▋        | 17/100 [00:02<00:10,  7.56it/s] 18%|█▊        | 18/100 [00:02<00:10,  7.65it/s] 19%|█▉        | 19/100 [00:02<00:10,  7.54it/s] 20%|██        | 20/100 [00:02<00:10,  7.48it/s] 21%|██        | 21/100 [00:02<00:10,  7.59it/s] 22%|██▏       | 22/100 [00:03<00:10,  7.66it/s] 23%|██▎       | 23/100 [00:03<00:09,  7.72it/s] 24%|██▍       | 24/100 [00:03<00:09,  7.68it/s] 25%|██▌       | 25/100 [00:03<00:09,  7.72it/s] 26%|██▌       | 26/100 [00:03<00:09,  7.77it/s] 27%|██▋       | 27/100 [00:03<00:09,  7.79it/s] 28%|██▊       | 28/100 [00:03<00:09,  7.77it/s] 29%|██▉       | 29/100 [00:03<00:09,  7.79it/s] 30%|███       | 30/100 [00:04<00:08,  7.80it/s] 31%|███       | 31/100 [00:04<00:08,  7.82it/s] 32%|███▏      | 32/100 [00:04<00:08,  7.69it/s] 33%|███▎      | 33/100 [00:04<00:08,  7.74it/s] 34%|███▍      | 34/100 [00:04<00:08,  7.77it/s] 35%|███▌      | 35/100 [00:04<00:08,  7.79it/s] 36%|███▌      | 36/100 [00:04<00:08,  7.82it/s] 37%|███▋      | 37/100 [00:04<00:08,  7.82it/s] 38%|███▊      | 38/100 [00:05<00:07,  7.83it/s] 39%|███▉      | 39/100 [00:05<00:07,  7.83it/s] 40%|████      | 40/100 [00:05<00:08,  7.41it/s] 41%|████      | 41/100 [00:05<00:07,  7.54it/s] 42%|████▏     | 42/100 [00:05<00:07,  7.63it/s] 43%|████▎     | 43/100 [00:05<00:07,  7.69it/s] 44%|████▍     | 44/100 [00:05<00:07,  7.73it/s] 45%|████▌     | 45/100 [00:05<00:07,  7.76it/s] 46%|████▌     | 46/100 [00:06<00:06,  7.79it/s] 47%|████▋     | 47/100 [00:06<00:06,  7.80it/s] 48%|████▊     | 48/100 [00:06<00:06,  7.82it/s] 49%|████▉     | 49/100 [00:06<00:06,  7.82it/s] 50%|█████     | 50/100 [00:06<00:06,  7.82it/s] 51%|█████     | 51/100 [00:06<00:06,  7.81it/s] 52%|█████▏    | 52/100 [00:06<00:06,  7.79it/s] 53%|█████▎    | 53/100 [00:06<00:06,  7.81it/s] 54%|█████▍    | 54/100 [00:07<00:05,  7.80it/s] 55%|█████▌    | 55/100 [00:07<00:05,  7.81it/s] 56%|█████▌    | 56/100 [00:07<00:05,  7.80it/s] 57%|█████▋    | 57/100 [00:07<00:05,  7.81it/s] 58%|█████▊    | 58/100 [00:07<00:05,  7.82it/s] 59%|█████▉    | 59/100 [00:07<00:05,  7.82it/s] 60%|██████    | 60/100 [00:07<00:05,  7.81it/s] 61%|██████    | 61/100 [00:08<00:04,  7.83it/s] 62%|██████▏   | 62/100 [00:08<00:04,  7.83it/s] 63%|██████▎   | 63/100 [00:08<00:04,  7.83it/s] 64%|██████▍   | 64/100 [00:08<00:04,  7.82it/s] 65%|██████▌   | 65/100 [00:08<00:04,  7.82it/s] 66%|██████▌   | 66/100 [00:08<00:04,  7.82it/s] 67%|██████▋   | 67/100 [00:08<00:04,  7.83it/s] 68%|██████▊   | 68/100 [00:08<00:04,  7.84it/s] 69%|██████▉   | 69/100 [00:09<00:03,  7.84it/s] 70%|███████   | 70/100 [00:09<00:03,  7.83it/s] 71%|███████   | 71/100 [00:09<00:03,  7.84it/s] 72%|███████▏  | 72/100 [00:09<00:03,  7.81it/s] 73%|███████▎  | 73/100 [00:09<00:03,  7.82it/s] 74%|███████▍  | 74/100 [00:09<00:03,  7.82it/s] 75%|███████▌  | 75/100 [00:09<00:03,  7.82it/s] 76%|███████▌  | 76/100 [00:09<00:03,  7.83it/s] 77%|███████▋  | 77/100 [00:10<00:02,  7.83it/s] 78%|███████▊  | 78/100 [00:10<00:02,  7.84it/s] 79%|███████▉  | 79/100 [00:10<00:02,  7.83it/s] 80%|████████  | 80/100 [00:10<00:02,  7.82it/s] 81%|████████  | 81/100 [00:10<00:02,  7.84it/s] 82%|████████▏ | 82/100 [00:10<00:02,  7.84it/s] 83%|████████▎ | 83/100 [00:10<00:02,  7.85it/s] 84%|████████▍ | 84/100 [00:10<00:02,  7.84it/s] 85%|████████▌ | 85/100 [00:11<00:01,  7.83it/s] 86%|████████▌ | 86/100 [00:11<00:01,  7.85it/s] 87%|████████▋ | 87/100 [00:11<00:01,  7.84it/s] 88%|████████▊ | 88/100 [00:11<00:01,  7.84it/s] 89%|████████▉ | 89/100 [00:11<00:01,  7.71it/s] 90%|█████████ | 90/100 [00:11<00:01,  7.74it/s] 91%|█████████ | 91/100 [00:11<00:01,  7.77it/s] 92%|█████████▏| 92/100 [00:11<00:01,  7.79it/s] 93%|█████████▎| 93/100 [00:12<00:00,  7.81it/s] 94%|█████████▍| 94/100 [00:12<00:00,  7.82it/s] 95%|█████████▌| 95/100 [00:12<00:00,  7.82it/s] 96%|█████████▌| 96/100 [00:12<00:00,  7.83it/s] 97%|█████████▋| 97/100 [00:12<00:00,  7.84it/s] 98%|█████████▊| 98/100 [00:12<00:00,  7.85it/s] 99%|█████████▉| 99/100 [00:12<00:00,  7.84it/s]100%|██████████| 100/100 [00:13<00:00,  7.84it/s]100%|██████████| 100/100 [00:13<00:00,  7.69it/s]
FOLD 0
Metric     CE Loss  KL wrt Orig
Model                          
llama_7B  2.759707     0.552877
Running fold 1
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:28,  1.07it/s]  6%|▋         | 2/32 [00:02<00:32,  1.08s/it]  9%|▉         | 3/32 [00:03<00:33,  1.16s/it] 12%|█▎        | 4/32 [00:04<00:32,  1.17s/it] 16%|█▌        | 5/32 [00:05<00:32,  1.21s/it] 19%|█▉        | 6/32 [00:07<00:32,  1.25s/it] 22%|██▏       | 7/32 [00:08<00:31,  1.25s/it] 25%|██▌       | 8/32 [00:09<00:29,  1.24s/it] 28%|██▊       | 9/32 [00:10<00:28,  1.23s/it] 31%|███▏      | 10/32 [00:12<00:27,  1.23s/it] 34%|███▍      | 11/32 [00:13<00:25,  1.21s/it] 38%|███▊      | 12/32 [00:14<00:23,  1.20s/it] 41%|████      | 13/32 [00:15<00:22,  1.19s/it] 44%|████▍     | 14/32 [00:16<00:21,  1.18s/it] 47%|████▋     | 15/32 [00:17<00:20,  1.18s/it] 50%|█████     | 16/32 [00:19<00:19,  1.19s/it] 53%|█████▎    | 17/32 [00:20<00:17,  1.19s/it] 56%|█████▋    | 18/32 [00:21<00:16,  1.19s/it] 59%|█████▉    | 19/32 [00:22<00:15,  1.22s/it] 62%|██████▎   | 20/32 [00:24<00:15,  1.25s/it] 66%|██████▌   | 21/32 [00:25<00:13,  1.26s/it] 69%|██████▉   | 22/32 [00:26<00:12,  1.26s/it] 72%|███████▏  | 23/32 [00:27<00:11,  1.26s/it] 75%|███████▌  | 24/32 [00:29<00:10,  1.28s/it] 78%|███████▊  | 25/32 [00:30<00:08,  1.28s/it] 81%|████████▏ | 26/32 [00:31<00:07,  1.27s/it] 84%|████████▍ | 27/32 [00:33<00:06,  1.28s/it] 88%|████████▊ | 28/32 [00:34<00:05,  1.27s/it] 91%|█████████ | 29/32 [00:35<00:03,  1.28s/it] 94%|█████████▍| 30/32 [00:36<00:02,  1.27s/it] 97%|█████████▋| 31/32 [00:38<00:01,  1.27s/it]100%|██████████| 32/32 [00:39<00:00,  1.32s/it]100%|██████████| 32/32 [00:39<00:00,  1.24s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
[[0.666 0.672 0.662 ... 0.668 0.662 0.67 ]
 [0.662 0.662 0.659 ... 0.677 0.666 0.663]
 [0.668 0.67  0.68  ... 0.661 0.665 0.671]
 ...
 [0.758 0.75  0.674 ... 0.716 0.694 0.677]
 [0.749 0.671 0.686 ... 0.674 0.762 0.76 ]
 [0.765 0.805 0.748 ... 0.743 0.787 0.775]]
Heads intervened:  [(8, 16), (11, 17), (12, 4), (13, 8), (13, 16), (16, 17), (17, 13), (17, 29), (18, 29), (19, 17), (20, 30), (23, 3)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 259.45it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-30ec7b2da7888791.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-4e53eea82b0ecfef.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  2%|▏         | 2/100 [00:00<00:05, 16.92it/s]  4%|▍         | 4/100 [00:00<00:05, 17.98it/s]  6%|▌         | 6/100 [00:00<00:05, 18.37it/s]  8%|▊         | 8/100 [00:00<00:04, 18.55it/s] 10%|█         | 10/100 [00:00<00:04, 18.66it/s] 12%|█▏        | 12/100 [00:00<00:04, 18.66it/s] 14%|█▍        | 14/100 [00:00<00:04, 18.74it/s] 16%|█▌        | 16/100 [00:00<00:04, 18.79it/s] 18%|█▊        | 18/100 [00:00<00:04, 18.81it/s] 20%|██        | 20/100 [00:01<00:04, 18.84it/s] 22%|██▏       | 22/100 [00:01<00:04, 18.87it/s] 24%|██▍       | 24/100 [00:01<00:04, 18.89it/s] 26%|██▌       | 26/100 [00:01<00:03, 18.90it/s] 28%|██▊       | 28/100 [00:01<00:03, 18.90it/s] 30%|███       | 30/100 [00:01<00:03, 18.91it/s] 32%|███▏      | 32/100 [00:01<00:03, 18.91it/s] 34%|███▍      | 34/100 [00:01<00:03, 18.87it/s] 36%|███▌      | 36/100 [00:01<00:03, 18.85it/s] 38%|███▊      | 38/100 [00:02<00:03, 18.88it/s] 40%|████      | 40/100 [00:02<00:03, 18.89it/s] 42%|████▏     | 42/100 [00:02<00:03, 18.90it/s] 44%|████▍     | 44/100 [00:02<00:02, 18.91it/s] 46%|████▌     | 46/100 [00:02<00:02, 18.91it/s] 48%|████▊     | 48/100 [00:02<00:02, 18.93it/s] 50%|█████     | 50/100 [00:02<00:02, 18.93it/s] 52%|█████▏    | 52/100 [00:02<00:02, 18.93it/s] 54%|█████▍    | 54/100 [00:02<00:02, 18.93it/s] 56%|█████▌    | 56/100 [00:02<00:02, 18.93it/s] 58%|█████▊    | 58/100 [00:03<00:02, 18.93it/s] 60%|██████    | 60/100 [00:03<00:02, 18.93it/s] 62%|██████▏   | 62/100 [00:03<00:02, 18.93it/s] 64%|██████▍   | 64/100 [00:03<00:01, 18.93it/s] 66%|██████▌   | 66/100 [00:03<00:01, 18.93it/s] 68%|██████▊   | 68/100 [00:03<00:01, 18.93it/s] 70%|███████   | 70/100 [00:03<00:01, 18.93it/s] 72%|███████▏  | 72/100 [00:03<00:01, 18.93it/s] 74%|███████▍  | 74/100 [00:03<00:01, 18.92it/s] 76%|███████▌  | 76/100 [00:04<00:01, 18.92it/s] 78%|███████▊  | 78/100 [00:04<00:01, 18.92it/s] 80%|████████  | 80/100 [00:04<00:01, 18.93it/s] 82%|████████▏ | 82/100 [00:04<00:00, 18.93it/s] 84%|████████▍ | 84/100 [00:04<00:00, 18.92it/s] 86%|████████▌ | 86/100 [00:04<00:00, 18.92it/s] 88%|████████▊ | 88/100 [00:04<00:00, 18.92it/s] 90%|█████████ | 90/100 [00:04<00:00, 18.92it/s] 92%|█████████▏| 92/100 [00:04<00:00, 18.92it/s] 94%|█████████▍| 94/100 [00:04<00:00, 18.92it/s] 96%|█████████▌| 96/100 [00:05<00:00, 18.92it/s] 98%|█████████▊| 98/100 [00:05<00:00, 18.93it/s]100%|██████████| 100/100 [00:05<00:00, 18.93it/s]100%|██████████| 100/100 [00:05<00:00, 18.86it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 346.06it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-14295f39edd20556.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-10ca04ba0c7bb427.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:16,  6.16it/s]  2%|▏         | 2/100 [00:00<00:14,  6.54it/s]  3%|▎         | 3/100 [00:00<00:13,  6.97it/s]  4%|▍         | 4/100 [00:00<00:13,  6.97it/s]  5%|▌         | 5/100 [00:00<00:14,  6.74it/s]  6%|▌         | 6/100 [00:00<00:13,  6.97it/s]  7%|▋         | 7/100 [00:01<00:12,  7.17it/s]  8%|▊         | 8/100 [00:01<00:12,  7.17it/s]  9%|▉         | 9/100 [00:01<00:12,  7.10it/s] 10%|█         | 10/100 [00:01<00:12,  7.34it/s] 11%|█         | 11/100 [00:01<00:11,  7.50it/s] 12%|█▏        | 12/100 [00:01<00:11,  7.48it/s] 13%|█▎        | 13/100 [00:01<00:11,  7.42it/s] 14%|█▍        | 14/100 [00:01<00:11,  7.55it/s] 15%|█▌        | 15/100 [00:02<00:11,  7.33it/s] 16%|█▌        | 16/100 [00:02<00:11,  7.23it/s] 17%|█▋        | 17/100 [00:02<00:11,  7.02it/s] 18%|█▊        | 18/100 [00:02<00:11,  7.07it/s] 19%|█▉        | 19/100 [00:02<00:11,  6.97it/s] 20%|██        | 20/100 [00:02<00:11,  7.04it/s] 21%|██        | 21/100 [00:02<00:11,  7.08it/s] 22%|██▏       | 22/100 [00:03<00:10,  7.10it/s] 23%|██▎       | 23/100 [00:03<00:10,  7.31it/s] 24%|██▍       | 24/100 [00:03<00:10,  7.31it/s] 25%|██▌       | 25/100 [00:03<00:10,  7.39it/s] 26%|██▌       | 26/100 [00:03<00:10,  7.26it/s] 27%|██▋       | 27/100 [00:03<00:10,  7.06it/s] 28%|██▊       | 28/100 [00:03<00:10,  7.09it/s] 29%|██▉       | 29/100 [00:04<00:10,  7.05it/s] 30%|███       | 30/100 [00:04<00:09,  7.07it/s] 31%|███       | 31/100 [00:04<00:09,  7.21it/s] 32%|███▏      | 32/100 [00:04<00:09,  7.12it/s] 33%|███▎      | 33/100 [00:04<00:09,  7.04it/s] 34%|███▍      | 34/100 [00:04<00:09,  7.19it/s] 35%|███▌      | 35/100 [00:04<00:09,  7.11it/s] 36%|███▌      | 36/100 [00:05<00:09,  7.02it/s] 37%|███▋      | 37/100 [00:05<00:08,  7.17it/s] 38%|███▊      | 38/100 [00:05<00:08,  7.09it/s] 39%|███▉      | 39/100 [00:05<00:08,  7.01it/s] 40%|████      | 40/100 [00:05<00:08,  7.17it/s] 41%|████      | 41/100 [00:05<00:08,  7.09it/s] 42%|████▏     | 42/100 [00:05<00:08,  7.02it/s] 43%|████▎     | 43/100 [00:06<00:07,  7.17it/s] 44%|████▍     | 44/100 [00:06<00:07,  7.09it/s] 45%|████▌     | 45/100 [00:06<00:07,  6.90it/s] 46%|████▌     | 46/100 [00:06<00:07,  6.99it/s] 47%|████▋     | 47/100 [00:06<00:07,  6.99it/s] 48%|████▊     | 48/100 [00:06<00:07,  6.91it/s] 49%|████▉     | 49/100 [00:06<00:07,  6.94it/s] 50%|█████     | 50/100 [00:07<00:06,  7.18it/s] 51%|█████     | 51/100 [00:07<00:06,  7.37it/s] 52%|█████▏    | 52/100 [00:07<00:06,  7.38it/s] 53%|█████▎    | 53/100 [00:07<00:06,  7.27it/s] 54%|█████▍    | 54/100 [00:07<00:06,  7.13it/s] 55%|█████▌    | 55/100 [00:07<00:06,  6.94it/s] 56%|█████▌    | 56/100 [00:07<00:06,  7.09it/s] 57%|█████▋    | 57/100 [00:08<00:06,  7.03it/s] 58%|█████▊    | 58/100 [00:08<00:05,  7.14it/s] 59%|█████▉    | 59/100 [00:08<00:05,  7.03it/s] 60%|██████    | 60/100 [00:08<00:05,  7.06it/s] 61%|██████    | 61/100 [00:08<00:05,  7.07it/s] 62%|██████▏   | 62/100 [00:08<00:05,  7.19it/s] 63%|██████▎   | 63/100 [00:08<00:05,  7.28it/s] 64%|██████▍   | 64/100 [00:08<00:04,  7.33it/s] 65%|██████▌   | 65/100 [00:09<00:04,  7.05it/s] 66%|██████▌   | 66/100 [00:09<00:04,  7.08it/s] 67%|██████▋   | 67/100 [00:09<00:04,  6.81it/s] 68%|██████▊   | 68/100 [00:09<00:04,  6.87it/s] 69%|██████▉   | 69/100 [00:09<00:04,  7.14it/s] 70%|███████   | 70/100 [00:09<00:04,  7.33it/s] 71%|███████   | 71/100 [00:09<00:03,  7.48it/s] 72%|███████▏  | 72/100 [00:10<00:03,  7.53it/s] 73%|███████▎  | 73/100 [00:10<00:03,  7.61it/s] 74%|███████▍  | 74/100 [00:10<00:03,  7.54it/s] 75%|███████▌  | 75/100 [00:10<00:03,  7.32it/s] 76%|███████▌  | 76/100 [00:10<00:03,  7.13it/s] 77%|███████▋  | 77/100 [00:10<00:03,  7.23it/s] 78%|███████▊  | 78/100 [00:10<00:03,  7.22it/s] 79%|███████▉  | 79/100 [00:11<00:02,  7.19it/s] 80%|████████  | 80/100 [00:11<00:02,  7.25it/s] 81%|████████  | 81/100 [00:11<00:02,  7.07it/s] 82%|████████▏ | 82/100 [00:11<00:02,  6.99it/s] 83%|████████▎ | 83/100 [00:11<00:02,  7.12it/s] 84%|████████▍ | 84/100 [00:11<00:02,  7.05it/s] 85%|████████▌ | 85/100 [00:11<00:02,  7.14it/s] 86%|████████▌ | 86/100 [00:12<00:01,  7.04it/s] 87%|████████▋ | 87/100 [00:12<00:01,  7.02it/s] 88%|████████▊ | 88/100 [00:12<00:01,  6.87it/s] 89%|████████▉ | 89/100 [00:12<00:01,  6.97it/s] 90%|█████████ | 90/100 [00:12<00:01,  6.83it/s] 91%|█████████ | 91/100 [00:12<00:01,  6.97it/s] 92%|█████████▏| 92/100 [00:12<00:01,  6.89it/s] 93%|█████████▎| 93/100 [00:13<00:00,  7.05it/s] 94%|█████████▍| 94/100 [00:13<00:00,  7.06it/s] 95%|█████████▌| 95/100 [00:13<00:00,  7.19it/s] 96%|█████████▌| 96/100 [00:13<00:00,  7.27it/s] 97%|█████████▋| 97/100 [00:13<00:00,  7.37it/s] 98%|█████████▊| 98/100 [00:13<00:00,  7.18it/s] 99%|█████████▉| 99/100 [00:13<00:00,  7.12it/s]100%|██████████| 100/100 [00:14<00:00,  7.00it/s]100%|██████████| 100/100 [00:14<00:00,  7.13it/s]
FOLD 1
Metric     CE Loss  KL wrt Orig
Model                          
llama_7B  2.643916     0.596669
[2.70181152 0.57477288]
2023-12-04 01:01:54.450758: I tensorflow/core/util/port.cc:110] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2023-12-04 01:01:54.500612: I tensorflow/core/platform/cpu_feature_guard.cc:182] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-12-04 01:01:55.248872: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Could not find TensorRT
Found cached dataset truthful_qa (/home/elicer/.cache/huggingface/datasets/truthful_qa/multiple_choice/1.1.0/63502f6bc6ee493830ce0843991b028d0ab568d221896b2ee3b8a5dfdaa9d7f4)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 354.22it/s]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:00<00:00,  5.29it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  6.19it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  6.03it/s]
head_wise_activation_length:(11012, 32, 4096)
labels_shape:(11012,)
seperated_head_activation shape:11013
Running fold 0
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:28,  1.07it/s]  6%|▋         | 2/32 [00:01<00:28,  1.04it/s]  9%|▉         | 3/32 [00:02<00:27,  1.07it/s] 12%|█▎        | 4/32 [00:03<00:25,  1.09it/s] 16%|█▌        | 5/32 [00:04<00:24,  1.08it/s] 19%|█▉        | 6/32 [00:05<00:24,  1.07it/s] 22%|██▏       | 7/32 [00:06<00:23,  1.06it/s] 25%|██▌       | 8/32 [00:07<00:23,  1.03it/s] 28%|██▊       | 9/32 [00:08<00:22,  1.00it/s] 31%|███▏      | 10/32 [00:09<00:22,  1.02s/it] 34%|███▍      | 11/32 [00:10<00:21,  1.05s/it] 38%|███▊      | 12/32 [00:11<00:20,  1.04s/it] 41%|████      | 13/32 [00:12<00:19,  1.05s/it] 44%|████▍     | 14/32 [00:14<00:19,  1.07s/it] 47%|████▋     | 15/32 [00:15<00:17,  1.06s/it] 50%|█████     | 16/32 [00:16<00:16,  1.06s/it] 53%|█████▎    | 17/32 [00:17<00:15,  1.07s/it] 56%|█████▋    | 18/32 [00:18<00:15,  1.08s/it] 59%|█████▉    | 19/32 [00:19<00:14,  1.10s/it] 62%|██████▎   | 20/32 [00:20<00:13,  1.12s/it] 66%|██████▌   | 21/32 [00:21<00:12,  1.14s/it] 69%|██████▉   | 22/32 [00:22<00:11,  1.12s/it] 72%|███████▏  | 23/32 [00:24<00:10,  1.15s/it] 75%|███████▌  | 24/32 [00:25<00:09,  1.20s/it] 78%|███████▊  | 25/32 [00:26<00:08,  1.18s/it] 81%|████████▏ | 26/32 [00:27<00:07,  1.18s/it] 84%|████████▍ | 27/32 [00:28<00:06,  1.20s/it] 88%|████████▊ | 28/32 [00:30<00:04,  1.15s/it] 91%|█████████ | 29/32 [00:31<00:03,  1.16s/it] 94%|█████████▍| 30/32 [00:32<00:02,  1.14s/it] 97%|█████████▋| 31/32 [00:33<00:01,  1.15s/it]100%|██████████| 32/32 [00:34<00:00,  1.24s/it]100%|██████████| 32/32 [00:34<00:00,  1.09s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
/home/elicer/honest_llama/validation/../TruthfulQA/truthfulqa/metrics.py:284: FutureWarning: load_metric is deprecated and will be removed in the next major version of datasets. Use 'evaluate.load' instead, from the new library 🤗 Evaluate: https://huggingface.co/docs/evaluate
  bleurt = load_metric("bleurt", cache_dir=cache_dir)
[[0.651 0.665 0.645 ... 0.646 0.647 0.652]
 [0.659 0.644 0.645 ... 0.648 0.658 0.656]
 [0.651 0.657 0.685 ... 0.637 0.648 0.667]
 ...
 [0.765 0.762 0.657 ... 0.73  0.704 0.674]
 [0.748 0.678 0.696 ... 0.663 0.769 0.786]
 [0.775 0.815 0.74  ... 0.697 0.809 0.79 ]]
Heads intervened:  [(8, 16), (12, 4), (12, 15), (13, 8), (13, 16), (15, 28), (16, 30), (17, 13), (17, 17), (17, 29), (18, 29), (19, 13), (19, 17), (20, 22), (20, 30), (22, 16), (22, 30), (23, 3), (23, 7), (23, 13), (25, 15), (31, 1), (31, 6), (31, 30)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
2023-12-04 01:02:46.022963: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1635] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 24961 MB memory:  -> device: 0, name: NVIDIA A100 80GB PCIe MIG 3g.40gb, pci bus id: 0000:65:00.0, compute capability: 8.0
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 581.01it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-ec0cf83741fdb3e8.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-d31e6c0c76fafb4d.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:01<01:42,  1.03s/it]  3%|▎         | 3/100 [00:01<00:30,  3.23it/s]  5%|▌         | 5/100 [00:01<00:17,  5.57it/s]  7%|▋         | 7/100 [00:01<00:11,  7.82it/s]  9%|▉         | 9/100 [00:01<00:09,  9.85it/s] 11%|█         | 11/100 [00:01<00:07, 11.65it/s] 13%|█▎        | 13/100 [00:01<00:06, 13.15it/s] 15%|█▌        | 15/100 [00:01<00:05, 14.35it/s] 17%|█▋        | 17/100 [00:01<00:05, 15.26it/s] 19%|█▉        | 19/100 [00:02<00:05, 15.78it/s] 21%|██        | 21/100 [00:02<00:04, 16.32it/s] 23%|██▎       | 23/100 [00:02<00:04, 16.72it/s] 25%|██▌       | 25/100 [00:02<00:04, 17.00it/s] 27%|██▋       | 27/100 [00:02<00:04, 17.20it/s] 29%|██▉       | 29/100 [00:02<00:04, 17.35it/s] 31%|███       | 31/100 [00:02<00:03, 17.43it/s] 33%|███▎      | 33/100 [00:02<00:03, 17.49it/s] 35%|███▌      | 35/100 [00:02<00:03, 17.51it/s] 37%|███▋      | 37/100 [00:03<00:03, 17.18it/s] 39%|███▉      | 39/100 [00:03<00:03, 16.81it/s] 41%|████      | 41/100 [00:03<00:03, 16.65it/s] 43%|████▎     | 43/100 [00:03<00:03, 16.97it/s] 45%|████▌     | 45/100 [00:03<00:03, 17.19it/s] 47%|████▋     | 47/100 [00:03<00:03, 17.28it/s] 49%|████▉     | 49/100 [00:03<00:02, 17.43it/s] 51%|█████     | 51/100 [00:03<00:02, 17.55it/s] 53%|█████▎    | 53/100 [00:04<00:02, 17.63it/s] 55%|█████▌    | 55/100 [00:04<00:02, 17.55it/s] 57%|█████▋    | 57/100 [00:04<00:02, 17.55it/s] 59%|█████▉    | 59/100 [00:04<00:02, 17.57it/s] 61%|██████    | 61/100 [00:04<00:02, 17.52it/s] 63%|██████▎   | 63/100 [00:04<00:02, 17.49it/s] 65%|██████▌   | 65/100 [00:04<00:01, 17.51it/s] 67%|██████▋   | 67/100 [00:04<00:01, 17.40it/s] 69%|██████▉   | 69/100 [00:04<00:01, 17.29it/s] 71%|███████   | 71/100 [00:05<00:01, 17.33it/s] 73%|███████▎  | 73/100 [00:05<00:01, 17.32it/s] 75%|███████▌  | 75/100 [00:05<00:01, 17.36it/s] 77%|███████▋  | 77/100 [00:05<00:01, 17.41it/s] 79%|███████▉  | 79/100 [00:05<00:01, 17.43it/s] 81%|████████  | 81/100 [00:05<00:01, 17.40it/s] 83%|████████▎ | 83/100 [00:05<00:00, 17.42it/s] 85%|████████▌ | 85/100 [00:05<00:00, 17.41it/s] 87%|████████▋ | 87/100 [00:05<00:00, 17.37it/s] 89%|████████▉ | 89/100 [00:06<00:00, 17.44it/s] 91%|█████████ | 91/100 [00:06<00:00, 17.30it/s] 93%|█████████▎| 93/100 [00:06<00:00, 17.30it/s] 95%|█████████▌| 95/100 [00:06<00:00, 17.37it/s] 97%|█████████▋| 97/100 [00:06<00:00, 17.38it/s] 99%|█████████▉| 99/100 [00:06<00:00, 17.39it/s]100%|██████████| 100/100 [00:06<00:00, 14.90it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 347.27it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-1939fcc1eeebdaa7.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-785bb4b6f2089589.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:17,  5.61it/s]  2%|▏         | 2/100 [00:00<00:15,  6.17it/s]  3%|▎         | 3/100 [00:00<00:14,  6.54it/s]  4%|▍         | 4/100 [00:00<00:14,  6.65it/s]  5%|▌         | 5/100 [00:00<00:14,  6.64it/s]  6%|▌         | 6/100 [00:00<00:13,  6.77it/s]  7%|▋         | 7/100 [00:01<00:13,  6.88it/s]  8%|▊         | 8/100 [00:01<00:13,  6.93it/s]  9%|▉         | 9/100 [00:01<00:13,  6.78it/s] 10%|█         | 10/100 [00:01<00:13,  6.90it/s] 11%|█         | 11/100 [00:01<00:12,  6.95it/s] 12%|█▏        | 12/100 [00:01<00:12,  6.84it/s] 13%|█▎        | 13/100 [00:01<00:12,  6.81it/s] 14%|█▍        | 14/100 [00:02<00:12,  6.74it/s] 15%|█▌        | 15/100 [00:02<00:12,  6.79it/s] 16%|█▌        | 16/100 [00:02<00:11,  7.02it/s] 17%|█▋        | 17/100 [00:02<00:12,  6.80it/s] 18%|█▊        | 18/100 [00:02<00:11,  6.85it/s] 19%|█▉        | 19/100 [00:02<00:11,  6.87it/s] 20%|██        | 20/100 [00:02<00:11,  7.06it/s] 21%|██        | 21/100 [00:03<00:10,  7.21it/s] 22%|██▏       | 22/100 [00:03<00:11,  6.93it/s] 23%|██▎       | 23/100 [00:03<00:11,  6.89it/s] 24%|██▍       | 24/100 [00:03<00:11,  6.89it/s] 25%|██▌       | 25/100 [00:03<00:10,  6.95it/s] 26%|██▌       | 26/100 [00:03<00:10,  6.95it/s] 27%|██▋       | 27/100 [00:03<00:10,  6.98it/s] 28%|██▊       | 28/100 [00:04<00:10,  7.18it/s] 29%|██▉       | 29/100 [00:04<00:09,  7.11it/s] 30%|███       | 30/100 [00:04<00:09,  7.20it/s] 31%|███       | 31/100 [00:04<00:09,  7.11it/s] 32%|███▏      | 32/100 [00:04<00:09,  7.12it/s] 33%|███▎      | 33/100 [00:04<00:09,  6.79it/s] 34%|███▍      | 34/100 [00:04<00:09,  6.94it/s] 35%|███▌      | 35/100 [00:05<00:09,  6.86it/s] 36%|███▌      | 36/100 [00:05<00:09,  6.93it/s] 37%|███▋      | 37/100 [00:05<00:08,  7.03it/s] 38%|███▊      | 38/100 [00:05<00:08,  6.97it/s] 39%|███▉      | 39/100 [00:05<00:08,  7.02it/s] 40%|████      | 40/100 [00:05<00:08,  7.20it/s] 41%|████      | 41/100 [00:05<00:08,  7.06it/s] 42%|████▏     | 42/100 [00:06<00:08,  7.15it/s] 43%|████▎     | 43/100 [00:06<00:08,  7.03it/s] 44%|████▍     | 44/100 [00:06<00:08,  6.88it/s] 45%|████▌     | 45/100 [00:06<00:07,  7.09it/s] 46%|████▌     | 46/100 [00:06<00:07,  7.00it/s] 47%|████▋     | 47/100 [00:06<00:07,  6.85it/s] 48%|████▊     | 48/100 [00:06<00:07,  6.80it/s] 49%|████▉     | 49/100 [00:07<00:07,  6.85it/s] 50%|█████     | 50/100 [00:07<00:07,  7.06it/s] 51%|█████     | 51/100 [00:07<00:06,  7.01it/s] 52%|█████▏    | 52/100 [00:07<00:06,  6.97it/s] 53%|█████▎    | 53/100 [00:07<00:06,  7.14it/s] 54%|█████▍    | 54/100 [00:07<00:06,  7.12it/s] 55%|█████▌    | 55/100 [00:07<00:06,  7.20it/s] 56%|█████▌    | 56/100 [00:08<00:06,  6.99it/s] 57%|█████▋    | 57/100 [00:08<00:06,  6.96it/s] 58%|█████▊    | 58/100 [00:08<00:06,  6.83it/s] 59%|█████▉    | 59/100 [00:08<00:05,  6.86it/s] 60%|██████    | 60/100 [00:08<00:05,  6.89it/s] 61%|██████    | 61/100 [00:08<00:05,  6.95it/s] 62%|██████▏   | 62/100 [00:08<00:05,  6.96it/s] 63%|██████▎   | 63/100 [00:09<00:05,  6.87it/s] 64%|██████▍   | 64/100 [00:09<00:05,  6.82it/s] 65%|██████▌   | 65/100 [00:09<00:05,  6.94it/s] 66%|██████▌   | 66/100 [00:09<00:04,  7.13it/s] 67%|██████▋   | 67/100 [00:09<00:04,  6.95it/s] 68%|██████▊   | 68/100 [00:09<00:04,  6.87it/s] 69%|██████▉   | 69/100 [00:09<00:04,  7.07it/s] 70%|███████   | 70/100 [00:10<00:04,  6.97it/s] 71%|███████   | 71/100 [00:10<00:04,  7.11it/s] 72%|███████▏  | 72/100 [00:10<00:03,  7.18it/s] 73%|███████▎  | 73/100 [00:10<00:03,  7.06it/s] 74%|███████▍  | 74/100 [00:10<00:03,  7.14it/s] 75%|███████▌  | 75/100 [00:10<00:03,  7.16it/s] 76%|███████▌  | 76/100 [00:10<00:03,  7.27it/s] 77%|███████▋  | 77/100 [00:11<00:03,  7.21it/s] 78%|███████▊  | 78/100 [00:11<00:03,  7.15it/s] 79%|███████▉  | 79/100 [00:11<00:02,  7.28it/s] 80%|████████  | 80/100 [00:11<00:02,  7.23it/s] 81%|████████  | 81/100 [00:11<00:02,  7.15it/s] 82%|████████▏ | 82/100 [00:11<00:02,  7.26it/s] 83%|████████▎ | 83/100 [00:11<00:02,  6.96it/s] 84%|████████▍ | 84/100 [00:12<00:02,  6.77it/s] 85%|████████▌ | 85/100 [00:12<00:02,  6.94it/s] 86%|████████▌ | 86/100 [00:12<00:02,  6.91it/s] 87%|████████▋ | 87/100 [00:12<00:01,  6.94it/s] 88%|████████▊ | 88/100 [00:12<00:01,  7.01it/s] 89%|████████▉ | 89/100 [00:12<00:01,  6.96it/s] 90%|█████████ | 90/100 [00:12<00:01,  7.05it/s] 91%|█████████ | 91/100 [00:13<00:01,  6.96it/s] 92%|█████████▏| 92/100 [00:13<00:01,  7.08it/s] 93%|█████████▎| 93/100 [00:13<00:01,  6.91it/s] 94%|█████████▍| 94/100 [00:13<00:00,  6.86it/s] 95%|█████████▌| 95/100 [00:13<00:00,  6.96it/s] 96%|█████████▌| 96/100 [00:13<00:00,  7.04it/s] 97%|█████████▋| 97/100 [00:13<00:00,  7.00it/s] 98%|█████████▊| 98/100 [00:14<00:00,  7.03it/s] 99%|█████████▉| 99/100 [00:14<00:00,  7.02it/s]100%|██████████| 100/100 [00:14<00:00,  7.19it/s]100%|██████████| 100/100 [00:14<00:00,  6.98it/s]
FOLD 0
Metric     CE Loss  KL wrt Orig
Model                          
llama_7B  2.815186     0.604953
Running fold 1
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:29,  1.04it/s]  6%|▋         | 2/32 [00:02<00:32,  1.10s/it]  9%|▉         | 3/32 [00:03<00:34,  1.18s/it] 12%|█▎        | 4/32 [00:04<00:33,  1.19s/it] 16%|█▌        | 5/32 [00:05<00:33,  1.23s/it] 19%|█▉        | 6/32 [00:07<00:32,  1.26s/it] 22%|██▏       | 7/32 [00:08<00:31,  1.26s/it] 25%|██▌       | 8/32 [00:09<00:30,  1.26s/it] 28%|██▊       | 9/32 [00:11<00:28,  1.26s/it] 31%|███▏      | 10/32 [00:12<00:27,  1.26s/it] 34%|███▍      | 11/32 [00:13<00:26,  1.25s/it] 38%|███▊      | 12/32 [00:14<00:24,  1.22s/it] 41%|████      | 13/32 [00:15<00:23,  1.22s/it] 44%|████▍     | 14/32 [00:17<00:21,  1.22s/it] 47%|████▋     | 15/32 [00:18<00:20,  1.21s/it] 50%|█████     | 16/32 [00:19<00:19,  1.22s/it] 53%|█████▎    | 17/32 [00:20<00:18,  1.21s/it] 56%|█████▋    | 18/32 [00:21<00:16,  1.21s/it] 59%|█████▉    | 19/32 [00:23<00:16,  1.23s/it] 62%|██████▎   | 20/32 [00:24<00:15,  1.27s/it] 66%|██████▌   | 21/32 [00:25<00:14,  1.28s/it] 69%|██████▉   | 22/32 [00:27<00:12,  1.28s/it] 72%|███████▏  | 23/32 [00:28<00:11,  1.29s/it] 75%|███████▌  | 24/32 [00:29<00:10,  1.31s/it] 78%|███████▊  | 25/32 [00:31<00:09,  1.31s/it] 81%|████████▏ | 26/32 [00:32<00:07,  1.31s/it] 84%|████████▍ | 27/32 [00:33<00:06,  1.32s/it] 88%|████████▊ | 28/32 [00:35<00:05,  1.31s/it] 91%|█████████ | 29/32 [00:36<00:03,  1.32s/it] 94%|█████████▍| 30/32 [00:37<00:02,  1.30s/it] 97%|█████████▋| 31/32 [00:38<00:01,  1.30s/it]100%|██████████| 32/32 [00:40<00:00,  1.36s/it]100%|██████████| 32/32 [00:40<00:00,  1.26s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
[[0.666 0.672 0.662 ... 0.668 0.662 0.67 ]
 [0.662 0.662 0.659 ... 0.677 0.666 0.663]
 [0.668 0.67  0.68  ... 0.661 0.665 0.671]
 ...
 [0.758 0.75  0.674 ... 0.716 0.694 0.677]
 [0.749 0.671 0.686 ... 0.674 0.762 0.76 ]
 [0.765 0.805 0.748 ... 0.743 0.787 0.775]]
Heads intervened:  [(8, 16), (11, 16), (11, 17), (12, 4), (13, 8), (13, 10), (13, 16), (13, 21), (16, 17), (16, 26), (16, 30), (17, 13), (17, 19), (17, 29), (18, 29), (19, 13), (19, 17), (19, 31), (20, 22), (20, 30), (22, 16), (23, 3), (23, 12), (31, 6)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 254.91it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-30ec7b2da7888791.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-4e53eea82b0ecfef.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  2%|▏         | 2/100 [00:00<00:06, 16.29it/s]  4%|▍         | 4/100 [00:00<00:05, 17.20it/s]  6%|▌         | 6/100 [00:00<00:05, 16.81it/s]  8%|▊         | 8/100 [00:00<00:05, 17.25it/s] 10%|█         | 10/100 [00:00<00:05, 17.50it/s] 12%|█▏        | 12/100 [00:00<00:04, 17.64it/s] 14%|█▍        | 14/100 [00:00<00:04, 17.76it/s] 16%|█▌        | 16/100 [00:00<00:04, 17.83it/s] 18%|█▊        | 18/100 [00:01<00:04, 17.86it/s] 20%|██        | 20/100 [00:01<00:04, 17.87it/s] 22%|██▏       | 22/100 [00:01<00:04, 17.91it/s] 24%|██▍       | 24/100 [00:01<00:04, 17.92it/s] 26%|██▌       | 26/100 [00:01<00:04, 17.87it/s] 28%|██▊       | 28/100 [00:01<00:04, 17.87it/s] 30%|███       | 30/100 [00:01<00:04, 17.41it/s] 32%|███▏      | 32/100 [00:01<00:03, 17.21it/s] 34%|███▍      | 34/100 [00:01<00:03, 17.38it/s] 36%|███▌      | 36/100 [00:02<00:03, 17.56it/s] 38%|███▊      | 38/100 [00:02<00:03, 17.68it/s] 40%|████      | 40/100 [00:02<00:03, 17.75it/s] 42%|████▏     | 42/100 [00:02<00:03, 17.82it/s] 44%|████▍     | 44/100 [00:02<00:03, 17.86it/s] 46%|████▌     | 46/100 [00:02<00:03, 17.87it/s] 48%|████▊     | 48/100 [00:02<00:02, 17.93it/s] 50%|█████     | 50/100 [00:02<00:02, 17.96it/s] 52%|█████▏    | 52/100 [00:02<00:02, 17.95it/s] 54%|█████▍    | 54/100 [00:03<00:02, 17.96it/s] 56%|█████▌    | 56/100 [00:03<00:02, 17.96it/s] 58%|█████▊    | 58/100 [00:03<00:02, 18.01it/s] 60%|██████    | 60/100 [00:03<00:02, 18.00it/s] 62%|██████▏   | 62/100 [00:03<00:02, 18.02it/s] 64%|██████▍   | 64/100 [00:03<00:02, 17.96it/s] 66%|██████▌   | 66/100 [00:03<00:01, 17.96it/s] 68%|██████▊   | 68/100 [00:03<00:01, 17.99it/s] 70%|███████   | 70/100 [00:03<00:01, 17.97it/s] 72%|███████▏  | 72/100 [00:04<00:01, 17.76it/s] 74%|███████▍  | 74/100 [00:04<00:01, 17.82it/s] 76%|███████▌  | 76/100 [00:04<00:01, 17.85it/s] 78%|███████▊  | 78/100 [00:04<00:01, 17.27it/s] 80%|████████  | 80/100 [00:04<00:01, 17.19it/s] 82%|████████▏ | 82/100 [00:04<00:01, 17.38it/s] 84%|████████▍ | 84/100 [00:04<00:00, 17.56it/s] 86%|████████▌ | 86/100 [00:04<00:00, 17.67it/s] 88%|████████▊ | 88/100 [00:04<00:00, 17.78it/s] 90%|█████████ | 90/100 [00:05<00:00, 17.84it/s] 92%|█████████▏| 92/100 [00:05<00:00, 17.87it/s] 94%|█████████▍| 94/100 [00:05<00:00, 17.91it/s] 96%|█████████▌| 96/100 [00:05<00:00, 17.92it/s] 98%|█████████▊| 98/100 [00:05<00:00, 17.94it/s]100%|██████████| 100/100 [00:05<00:00, 17.96it/s]100%|██████████| 100/100 [00:05<00:00, 17.75it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 345.98it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-14295f39edd20556.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-10ca04ba0c7bb427.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:17,  5.74it/s]  2%|▏         | 2/100 [00:00<00:14,  6.73it/s]  3%|▎         | 3/100 [00:00<00:14,  6.65it/s]  4%|▍         | 4/100 [00:00<00:14,  6.51it/s]  5%|▌         | 5/100 [00:00<00:14,  6.58it/s]  6%|▌         | 6/100 [00:00<00:13,  6.89it/s]  7%|▋         | 7/100 [00:01<00:13,  6.97it/s]  8%|▊         | 8/100 [00:01<00:13,  7.06it/s]  9%|▉         | 9/100 [00:01<00:12,  7.22it/s] 10%|█         | 10/100 [00:01<00:12,  7.04it/s] 11%|█         | 11/100 [00:01<00:12,  7.07it/s] 12%|█▏        | 12/100 [00:01<00:12,  7.22it/s] 13%|█▎        | 13/100 [00:01<00:11,  7.33it/s] 14%|█▍        | 14/100 [00:02<00:12,  6.89it/s] 15%|█▌        | 15/100 [00:02<00:12,  6.85it/s] 16%|█▌        | 16/100 [00:02<00:11,  7.08it/s] 17%|█▋        | 17/100 [00:02<00:11,  7.03it/s] 18%|█▊        | 18/100 [00:02<00:11,  7.10it/s] 19%|█▉        | 19/100 [00:02<00:11,  7.20it/s] 20%|██        | 20/100 [00:02<00:10,  7.30it/s] 21%|██        | 21/100 [00:02<00:10,  7.29it/s] 22%|██▏       | 22/100 [00:03<00:10,  7.29it/s] 23%|██▎       | 23/100 [00:03<00:10,  7.33it/s] 24%|██▍       | 24/100 [00:03<00:10,  7.22it/s] 25%|██▌       | 25/100 [00:03<00:10,  7.20it/s] 26%|██▌       | 26/100 [00:03<00:10,  7.31it/s] 27%|██▋       | 27/100 [00:03<00:09,  7.33it/s] 28%|██▊       | 28/100 [00:03<00:09,  7.36it/s] 29%|██▉       | 29/100 [00:04<00:09,  7.23it/s] 30%|███       | 30/100 [00:04<00:09,  7.24it/s] 31%|███       | 31/100 [00:04<00:09,  7.36it/s] 32%|███▏      | 32/100 [00:04<00:09,  7.23it/s] 33%|███▎      | 33/100 [00:04<00:09,  7.23it/s] 34%|███▍      | 34/100 [00:04<00:09,  7.26it/s] 35%|███▌      | 35/100 [00:04<00:08,  7.25it/s] 36%|███▌      | 36/100 [00:05<00:09,  7.04it/s] 37%|███▋      | 37/100 [00:05<00:08,  7.13it/s] 38%|███▊      | 38/100 [00:05<00:08,  6.99it/s] 39%|███▉      | 39/100 [00:05<00:08,  7.03it/s] 40%|████      | 40/100 [00:05<00:08,  7.10it/s] 41%|████      | 41/100 [00:05<00:08,  7.15it/s] 42%|████▏     | 42/100 [00:05<00:07,  7.29it/s] 43%|████▎     | 43/100 [00:06<00:07,  7.36it/s] 44%|████▍     | 44/100 [00:06<00:07,  7.21it/s] 45%|████▌     | 45/100 [00:06<00:07,  7.35it/s] 46%|████▌     | 46/100 [00:06<00:07,  7.28it/s] 47%|████▋     | 47/100 [00:06<00:07,  7.38it/s] 48%|████▊     | 48/100 [00:06<00:07,  7.06it/s] 49%|████▉     | 49/100 [00:06<00:07,  7.07it/s] 50%|█████     | 50/100 [00:07<00:06,  7.16it/s] 51%|█████     | 51/100 [00:07<00:06,  7.17it/s] 52%|█████▏    | 52/100 [00:07<00:06,  6.96it/s] 53%|█████▎    | 53/100 [00:07<00:06,  7.09it/s] 54%|█████▍    | 54/100 [00:07<00:06,  7.24it/s] 55%|█████▌    | 55/100 [00:07<00:06,  6.95it/s] 56%|█████▌    | 56/100 [00:07<00:06,  7.10it/s] 57%|█████▋    | 57/100 [00:08<00:06,  6.84it/s] 58%|█████▊    | 58/100 [00:08<00:05,  7.07it/s] 59%|█████▉    | 59/100 [00:08<00:05,  7.07it/s] 60%|██████    | 60/100 [00:08<00:05,  7.22it/s] 61%|██████    | 61/100 [00:08<00:05,  7.19it/s] 62%|██████▏   | 62/100 [00:08<00:05,  7.26it/s] 63%|██████▎   | 63/100 [00:08<00:05,  7.26it/s] 64%|██████▍   | 64/100 [00:08<00:04,  7.24it/s] 65%|██████▌   | 65/100 [00:09<00:04,  7.19it/s] 66%|██████▌   | 66/100 [00:09<00:04,  7.28it/s] 67%|██████▋   | 67/100 [00:09<00:04,  7.10it/s] 68%|██████▊   | 68/100 [00:09<00:04,  7.15it/s] 69%|██████▉   | 69/100 [00:09<00:04,  7.15it/s] 70%|███████   | 70/100 [00:09<00:04,  6.93it/s] 71%|███████   | 71/100 [00:09<00:04,  7.06it/s] 72%|███████▏  | 72/100 [00:10<00:03,  7.14it/s] 73%|███████▎  | 73/100 [00:10<00:03,  6.99it/s] 74%|███████▍  | 74/100 [00:10<00:03,  7.16it/s] 75%|███████▌  | 75/100 [00:10<00:03,  7.02it/s] 76%|███████▌  | 76/100 [00:10<00:03,  7.04it/s] 77%|███████▋  | 77/100 [00:10<00:03,  7.06it/s] 78%|███████▊  | 78/100 [00:10<00:03,  7.19it/s] 79%|███████▉  | 79/100 [00:11<00:02,  7.02it/s] 80%|████████  | 80/100 [00:11<00:02,  7.03it/s] 81%|████████  | 81/100 [00:11<00:02,  6.86it/s] 82%|████████▏ | 82/100 [00:11<00:02,  6.81it/s] 83%|████████▎ | 83/100 [00:11<00:02,  6.99it/s] 84%|████████▍ | 84/100 [00:11<00:02,  7.10it/s] 85%|████████▌ | 85/100 [00:11<00:02,  6.89it/s] 86%|████████▌ | 86/100 [00:12<00:02,  6.91it/s] 87%|████████▋ | 87/100 [00:12<00:01,  7.04it/s] 88%|████████▊ | 88/100 [00:12<00:01,  7.06it/s] 89%|████████▉ | 89/100 [00:12<00:01,  6.90it/s] 90%|█████████ | 90/100 [00:12<00:01,  7.09it/s] 91%|█████████ | 91/100 [00:12<00:01,  7.05it/s] 92%|█████████▏| 92/100 [00:12<00:01,  6.82it/s] 93%|█████████▎| 93/100 [00:13<00:01,  6.87it/s] 94%|█████████▍| 94/100 [00:13<00:00,  7.05it/s] 95%|█████████▌| 95/100 [00:13<00:00,  7.19it/s] 96%|█████████▌| 96/100 [00:13<00:00,  7.24it/s] 97%|█████████▋| 97/100 [00:13<00:00,  7.27it/s] 98%|█████████▊| 98/100 [00:13<00:00,  7.18it/s] 99%|█████████▉| 99/100 [00:13<00:00,  7.02it/s]100%|██████████| 100/100 [00:14<00:00,  7.19it/s]100%|██████████| 100/100 [00:14<00:00,  7.10it/s]
FOLD 1
Metric     CE Loss  KL wrt Orig
Model                          
llama_7B  2.887549       0.8317
[2.85136719 0.71832678]
2023-12-04 01:04:26.269503: I tensorflow/core/util/port.cc:110] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2023-12-04 01:04:26.319126: I tensorflow/core/platform/cpu_feature_guard.cc:182] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-12-04 01:04:27.071649: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Could not find TensorRT
Found cached dataset truthful_qa (/home/elicer/.cache/huggingface/datasets/truthful_qa/multiple_choice/1.1.0/63502f6bc6ee493830ce0843991b028d0ab568d221896b2ee3b8a5dfdaa9d7f4)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 370.95it/s]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:00<00:00,  5.13it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  5.98it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  5.83it/s]
head_wise_activation_length:(11012, 32, 4096)
labels_shape:(11012,)
seperated_head_activation shape:11013
Running fold 0
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:29,  1.06it/s]  6%|▋         | 2/32 [00:01<00:28,  1.04it/s]  9%|▉         | 3/32 [00:02<00:26,  1.07it/s] 12%|█▎        | 4/32 [00:03<00:25,  1.10it/s] 16%|█▌        | 5/32 [00:04<00:24,  1.09it/s] 19%|█▉        | 6/32 [00:05<00:24,  1.08it/s] 22%|██▏       | 7/32 [00:06<00:23,  1.06it/s] 25%|██▌       | 8/32 [00:07<00:23,  1.04it/s] 28%|██▊       | 9/32 [00:08<00:22,  1.02it/s] 31%|███▏      | 10/32 [00:09<00:22,  1.00s/it] 34%|███▍      | 11/32 [00:10<00:21,  1.02s/it] 38%|███▊      | 12/32 [00:11<00:20,  1.02s/it] 41%|████      | 13/32 [00:12<00:19,  1.04s/it] 44%|████▍     | 14/32 [00:13<00:19,  1.06s/it] 47%|████▋     | 15/32 [00:14<00:17,  1.05s/it] 50%|█████     | 16/32 [00:15<00:16,  1.05s/it] 53%|█████▎    | 17/32 [00:17<00:15,  1.06s/it] 56%|█████▋    | 18/32 [00:18<00:14,  1.07s/it] 59%|█████▉    | 19/32 [00:19<00:14,  1.09s/it] 62%|██████▎   | 20/32 [00:20<00:13,  1.11s/it] 66%|██████▌   | 21/32 [00:21<00:12,  1.12s/it] 69%|██████▉   | 22/32 [00:22<00:11,  1.11s/it] 72%|███████▏  | 23/32 [00:23<00:10,  1.14s/it] 75%|███████▌  | 24/32 [00:25<00:09,  1.18s/it] 78%|███████▊  | 25/32 [00:26<00:08,  1.17s/it] 81%|████████▏ | 26/32 [00:27<00:06,  1.16s/it] 84%|████████▍ | 27/32 [00:28<00:05,  1.18s/it] 88%|████████▊ | 28/32 [00:29<00:04,  1.14s/it] 91%|█████████ | 29/32 [00:30<00:03,  1.14s/it] 94%|█████████▍| 30/32 [00:31<00:02,  1.13s/it] 97%|█████████▋| 31/32 [00:33<00:01,  1.14s/it]100%|██████████| 32/32 [00:34<00:00,  1.23s/it]100%|██████████| 32/32 [00:34<00:00,  1.08s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
/home/elicer/honest_llama/validation/../TruthfulQA/truthfulqa/metrics.py:284: FutureWarning: load_metric is deprecated and will be removed in the next major version of datasets. Use 'evaluate.load' instead, from the new library 🤗 Evaluate: https://huggingface.co/docs/evaluate
  bleurt = load_metric("bleurt", cache_dir=cache_dir)
[[0.651 0.665 0.645 ... 0.646 0.647 0.652]
 [0.659 0.644 0.645 ... 0.648 0.658 0.656]
 [0.651 0.657 0.685 ... 0.637 0.648 0.667]
 ...
 [0.765 0.762 0.657 ... 0.73  0.704 0.674]
 [0.748 0.678 0.696 ... 0.663 0.769 0.786]
 [0.775 0.815 0.74  ... 0.697 0.809 0.79 ]]
Heads intervened:  [(8, 16), (12, 4), (12, 15), (13, 8), (13, 16), (14, 2), (14, 20), (15, 28), (16, 17), (16, 26), (16, 30), (17, 4), (17, 9), (17, 13), (17, 17), (17, 29), (18, 29), (19, 13), (19, 17), (19, 31), (20, 22), (20, 30), (21, 18), (22, 16), (22, 23), (22, 30), (23, 3), (23, 4), (23, 7), (23, 13), (25, 15), (31, 1), (31, 3), (31, 6), (31, 25), (31, 30)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
2023-12-04 01:05:18.005688: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1635] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 24961 MB memory:  -> device: 0, name: NVIDIA A100 80GB PCIe MIG 3g.40gb, pci bus id: 0000:65:00.0, compute capability: 8.0
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 290.18it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-ec0cf83741fdb3e8.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-d31e6c0c76fafb4d.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:01<01:42,  1.03s/it]  3%|▎         | 3/100 [00:01<00:30,  3.22it/s]  5%|▌         | 5/100 [00:01<00:17,  5.53it/s]  7%|▋         | 7/100 [00:01<00:12,  7.75it/s]  9%|▉         | 9/100 [00:01<00:09,  9.59it/s] 11%|█         | 11/100 [00:01<00:07, 11.26it/s] 13%|█▎        | 13/100 [00:01<00:06, 12.56it/s] 15%|█▌        | 15/100 [00:01<00:06, 13.73it/s] 17%|█▋        | 17/100 [00:01<00:05, 14.71it/s] 19%|█▉        | 19/100 [00:02<00:05, 15.46it/s] 21%|██        | 21/100 [00:02<00:04, 16.01it/s] 23%|██▎       | 23/100 [00:02<00:04, 16.39it/s] 25%|██▌       | 25/100 [00:02<00:04, 16.67it/s] 27%|██▋       | 27/100 [00:02<00:04, 16.87it/s] 29%|██▉       | 29/100 [00:02<00:04, 17.02it/s] 31%|███       | 31/100 [00:02<00:04, 17.12it/s] 33%|███▎      | 33/100 [00:02<00:03, 17.19it/s] 35%|███▌      | 35/100 [00:03<00:03, 17.23it/s] 37%|███▋      | 37/100 [00:03<00:03, 17.27it/s] 39%|███▉      | 39/100 [00:03<00:03, 17.30it/s] 41%|████      | 41/100 [00:03<00:03, 17.33it/s] 43%|████▎     | 43/100 [00:03<00:03, 17.20it/s] 45%|████▌     | 45/100 [00:03<00:03, 17.18it/s] 47%|████▋     | 47/100 [00:03<00:03, 17.25it/s] 49%|████▉     | 49/100 [00:03<00:02, 17.30it/s] 51%|█████     | 51/100 [00:03<00:02, 17.33it/s] 53%|█████▎    | 53/100 [00:04<00:02, 17.35it/s] 55%|█████▌    | 55/100 [00:04<00:02, 17.36it/s] 57%|█████▋    | 57/100 [00:04<00:02, 17.36it/s] 59%|█████▉    | 59/100 [00:04<00:02, 17.36it/s] 61%|██████    | 61/100 [00:04<00:02, 17.37it/s] 63%|██████▎   | 63/100 [00:04<00:02, 17.39it/s] 65%|██████▌   | 65/100 [00:04<00:02, 17.39it/s] 67%|██████▋   | 67/100 [00:04<00:01, 17.40it/s] 69%|██████▉   | 69/100 [00:04<00:01, 17.40it/s] 71%|███████   | 71/100 [00:05<00:01, 17.40it/s] 73%|███████▎  | 73/100 [00:05<00:01, 17.39it/s] 75%|███████▌  | 75/100 [00:05<00:01, 17.37it/s] 77%|███████▋  | 77/100 [00:05<00:01, 17.38it/s] 79%|███████▉  | 79/100 [00:05<00:01, 17.25it/s] 81%|████████  | 81/100 [00:05<00:01, 17.23it/s] 83%|████████▎ | 83/100 [00:05<00:00, 17.16it/s] 85%|████████▌ | 85/100 [00:05<00:00, 17.23it/s] 87%|████████▋ | 87/100 [00:06<00:00, 17.25it/s] 89%|████████▉ | 89/100 [00:06<00:00, 17.28it/s] 91%|█████████ | 91/100 [00:06<00:00, 17.29it/s] 93%|█████████▎| 93/100 [00:06<00:00, 17.29it/s] 95%|█████████▌| 95/100 [00:06<00:00, 17.24it/s] 97%|█████████▋| 97/100 [00:06<00:00, 17.26it/s] 99%|█████████▉| 99/100 [00:06<00:00, 17.28it/s]100%|██████████| 100/100 [00:06<00:00, 14.76it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 302.62it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-1939fcc1eeebdaa7.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-785bb4b6f2089589.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:18,  5.34it/s]  2%|▏         | 2/100 [00:00<00:16,  6.01it/s]  3%|▎         | 3/100 [00:00<00:15,  6.45it/s]  4%|▍         | 4/100 [00:00<00:14,  6.56it/s]  5%|▌         | 5/100 [00:00<00:14,  6.57it/s]  6%|▌         | 6/100 [00:00<00:14,  6.70it/s]  7%|▋         | 7/100 [00:01<00:13,  6.66it/s]  8%|▊         | 8/100 [00:01<00:13,  6.62it/s]  9%|▉         | 9/100 [00:01<00:13,  6.65it/s] 10%|█         | 10/100 [00:01<00:13,  6.72it/s] 11%|█         | 11/100 [00:01<00:12,  6.87it/s] 12%|█▏        | 12/100 [00:01<00:12,  7.04it/s] 13%|█▎        | 13/100 [00:01<00:12,  6.99it/s] 14%|█▍        | 14/100 [00:02<00:12,  7.10it/s] 15%|█▌        | 15/100 [00:02<00:11,  7.24it/s] 16%|█▌        | 16/100 [00:02<00:11,  7.21it/s] 17%|█▋        | 17/100 [00:02<00:11,  7.25it/s] 18%|█▊        | 18/100 [00:02<00:11,  7.28it/s] 19%|█▉        | 19/100 [00:02<00:11,  7.12it/s] 20%|██        | 20/100 [00:02<00:11,  6.97it/s] 21%|██        | 21/100 [00:03<00:11,  6.97it/s] 22%|██▏       | 22/100 [00:03<00:10,  7.15it/s] 23%|██▎       | 23/100 [00:03<00:10,  7.05it/s] 24%|██▍       | 24/100 [00:03<00:10,  7.14it/s] 25%|██▌       | 25/100 [00:03<00:10,  7.06it/s] 26%|██▌       | 26/100 [00:03<00:10,  7.07it/s] 27%|██▋       | 27/100 [00:03<00:10,  7.11it/s] 28%|██▊       | 28/100 [00:04<00:09,  7.21it/s] 29%|██▉       | 29/100 [00:04<00:09,  7.13it/s] 30%|███       | 30/100 [00:04<00:09,  7.27it/s] 31%|███       | 31/100 [00:04<00:09,  7.37it/s] 32%|███▏      | 32/100 [00:04<00:09,  7.44it/s] 33%|███▎      | 33/100 [00:04<00:09,  7.38it/s] 34%|███▍      | 34/100 [00:04<00:09,  7.23it/s] 35%|███▌      | 35/100 [00:04<00:08,  7.26it/s] 36%|███▌      | 36/100 [00:05<00:08,  7.14it/s] 37%|███▋      | 37/100 [00:05<00:08,  7.26it/s] 38%|███▊      | 38/100 [00:05<00:08,  7.21it/s] 39%|███▉      | 39/100 [00:05<00:08,  7.16it/s] 40%|████      | 40/100 [00:05<00:08,  7.03it/s] 41%|████      | 41/100 [00:05<00:08,  6.94it/s] 42%|████▏     | 42/100 [00:05<00:08,  7.05it/s] 43%|████▎     | 43/100 [00:06<00:08,  6.90it/s] 44%|████▍     | 44/100 [00:06<00:08,  6.91it/s] 45%|████▌     | 45/100 [00:06<00:08,  6.86it/s] 46%|████▌     | 46/100 [00:06<00:07,  6.80it/s] 47%|████▋     | 47/100 [00:06<00:07,  7.01it/s] 48%|████▊     | 48/100 [00:06<00:07,  7.04it/s] 49%|████▉     | 49/100 [00:06<00:07,  7.18it/s] 50%|█████     | 50/100 [00:07<00:07,  6.89it/s] 51%|█████     | 51/100 [00:07<00:07,  6.77it/s] 52%|█████▏    | 52/100 [00:07<00:06,  6.94it/s] 53%|█████▎    | 53/100 [00:07<00:06,  7.13it/s] 54%|█████▍    | 54/100 [00:07<00:06,  7.26it/s] 55%|█████▌    | 55/100 [00:07<00:06,  7.36it/s] 56%|█████▌    | 56/100 [00:07<00:05,  7.43it/s] 57%|█████▋    | 57/100 [00:08<00:05,  7.48it/s] 58%|█████▊    | 58/100 [00:08<00:05,  7.36it/s] 59%|█████▉    | 59/100 [00:08<00:05,  7.24it/s] 60%|██████    | 60/100 [00:08<00:05,  7.14it/s] 61%|██████    | 61/100 [00:08<00:05,  6.89it/s] 62%|██████▏   | 62/100 [00:08<00:05,  6.91it/s] 63%|██████▎   | 63/100 [00:08<00:05,  7.01it/s] 64%|██████▍   | 64/100 [00:09<00:05,  6.88it/s] 65%|██████▌   | 65/100 [00:09<00:05,  6.96it/s] 66%|██████▌   | 66/100 [00:09<00:04,  6.99it/s] 67%|██████▋   | 67/100 [00:09<00:04,  7.12it/s] 68%|██████▊   | 68/100 [00:09<00:04,  7.16it/s] 69%|██████▉   | 69/100 [00:09<00:04,  6.80it/s] 70%|███████   | 70/100 [00:09<00:04,  6.94it/s] 71%|███████   | 71/100 [00:10<00:04,  6.98it/s] 72%|███████▏  | 72/100 [00:10<00:04,  6.90it/s] 73%|███████▎  | 73/100 [00:10<00:03,  6.93it/s] 74%|███████▍  | 74/100 [00:10<00:03,  7.09it/s] 75%|███████▌  | 75/100 [00:10<00:03,  7.22it/s] 76%|███████▌  | 76/100 [00:10<00:03,  7.11it/s] 77%|███████▋  | 77/100 [00:10<00:03,  7.02it/s] 78%|███████▊  | 78/100 [00:11<00:03,  7.07it/s] 79%|███████▉  | 79/100 [00:11<00:02,  7.18it/s] 80%|████████  | 80/100 [00:11<00:02,  6.88it/s] 81%|████████  | 81/100 [00:11<00:02,  6.88it/s] 82%|████████▏ | 82/100 [00:11<00:02,  6.87it/s] 83%|████████▎ | 83/100 [00:11<00:02,  6.87it/s] 84%|████████▍ | 84/100 [00:11<00:02,  7.01it/s] 85%|████████▌ | 85/100 [00:12<00:02,  7.02it/s] 86%|████████▌ | 86/100 [00:12<00:01,  7.02it/s] 87%|████████▋ | 87/100 [00:12<00:01,  6.99it/s] 88%|████████▊ | 88/100 [00:12<00:01,  7.15it/s] 89%|████████▉ | 89/100 [00:12<00:01,  7.25it/s] 90%|█████████ | 90/100 [00:12<00:01,  7.05it/s] 91%|█████████ | 91/100 [00:12<00:01,  6.83it/s] 92%|█████████▏| 92/100 [00:13<00:01,  6.87it/s] 93%|█████████▎| 93/100 [00:13<00:00,  7.07it/s] 94%|█████████▍| 94/100 [00:13<00:00,  7.01it/s] 95%|█████████▌| 95/100 [00:13<00:00,  7.06it/s] 96%|█████████▌| 96/100 [00:13<00:00,  6.99it/s] 97%|█████████▋| 97/100 [00:13<00:00,  7.05it/s] 98%|█████████▊| 98/100 [00:13<00:00,  6.90it/s] 99%|█████████▉| 99/100 [00:14<00:00,  6.81it/s]100%|██████████| 100/100 [00:14<00:00,  6.74it/s]100%|██████████| 100/100 [00:14<00:00,  7.01it/s]
FOLD 0
Metric     CE Loss  KL wrt Orig
Model                          
llama_7B  2.971133     0.768923
Running fold 1
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:28,  1.08it/s]  6%|▋         | 2/32 [00:02<00:32,  1.07s/it]  9%|▉         | 3/32 [00:03<00:33,  1.15s/it] 12%|█▎        | 4/32 [00:04<00:32,  1.16s/it] 16%|█▌        | 5/32 [00:05<00:32,  1.19s/it] 19%|█▉        | 6/32 [00:07<00:31,  1.22s/it] 22%|██▏       | 7/32 [00:08<00:30,  1.23s/it] 25%|██▌       | 8/32 [00:09<00:29,  1.23s/it] 28%|██▊       | 9/32 [00:10<00:28,  1.22s/it] 31%|███▏      | 10/32 [00:11<00:26,  1.23s/it] 34%|███▍      | 11/32 [00:13<00:25,  1.21s/it] 38%|███▊      | 12/32 [00:14<00:23,  1.19s/it] 41%|████      | 13/32 [00:15<00:22,  1.18s/it] 44%|████▍     | 14/32 [00:16<00:21,  1.17s/it] 47%|████▋     | 15/32 [00:17<00:19,  1.17s/it] 50%|█████     | 16/32 [00:18<00:18,  1.17s/it] 53%|█████▎    | 17/32 [00:20<00:17,  1.17s/it] 56%|█████▋    | 18/32 [00:21<00:16,  1.17s/it] 59%|█████▉    | 19/32 [00:22<00:15,  1.19s/it] 62%|██████▎   | 20/32 [00:23<00:14,  1.23s/it] 66%|██████▌   | 21/32 [00:25<00:13,  1.23s/it] 69%|██████▉   | 22/32 [00:26<00:12,  1.22s/it] 72%|███████▏  | 23/32 [00:27<00:11,  1.23s/it] 75%|███████▌  | 24/32 [00:28<00:10,  1.25s/it] 78%|███████▊  | 25/32 [00:30<00:08,  1.25s/it] 81%|████████▏ | 26/32 [00:31<00:07,  1.25s/it] 84%|████████▍ | 27/32 [00:32<00:06,  1.26s/it] 88%|████████▊ | 28/32 [00:33<00:04,  1.25s/it] 91%|█████████ | 29/32 [00:35<00:03,  1.26s/it] 94%|█████████▍| 30/32 [00:36<00:02,  1.25s/it] 97%|█████████▋| 31/32 [00:37<00:01,  1.26s/it]100%|██████████| 32/32 [00:39<00:00,  1.31s/it]100%|██████████| 32/32 [00:39<00:00,  1.22s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
[[0.666 0.672 0.662 ... 0.668 0.662 0.67 ]
 [0.662 0.662 0.659 ... 0.677 0.666 0.663]
 [0.668 0.67  0.68  ... 0.661 0.665 0.671]
 ...
 [0.758 0.75  0.674 ... 0.716 0.694 0.677]
 [0.749 0.671 0.686 ... 0.674 0.762 0.76 ]
 [0.765 0.805 0.748 ... 0.743 0.787 0.775]]
Heads intervened:  [(8, 16), (11, 16), (11, 17), (12, 4), (12, 22), (13, 8), (13, 10), (13, 16), (13, 21), (14, 2), (15, 28), (16, 4), (16, 17), (16, 26), (16, 30), (17, 4), (17, 13), (17, 19), (17, 29), (18, 29), (19, 13), (19, 17), (19, 31), (20, 22), (20, 30), (22, 16), (23, 3), (23, 12), (23, 25), (26, 13), (27, 3), (27, 7), (30, 4), (30, 18), (31, 1), (31, 6)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 259.31it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-30ec7b2da7888791.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-4e53eea82b0ecfef.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  2%|▏         | 2/100 [00:00<00:06, 15.17it/s]  4%|▍         | 4/100 [00:00<00:05, 16.06it/s]  6%|▌         | 6/100 [00:00<00:05, 16.33it/s]  8%|▊         | 8/100 [00:00<00:05, 16.54it/s] 10%|█         | 10/100 [00:00<00:05, 16.64it/s] 12%|█▏        | 12/100 [00:00<00:05, 16.47it/s] 14%|█▍        | 14/100 [00:00<00:05, 15.83it/s] 16%|█▌        | 16/100 [00:00<00:05, 16.12it/s] 18%|█▊        | 18/100 [00:01<00:05, 16.35it/s] 20%|██        | 20/100 [00:01<00:04, 16.44it/s] 22%|██▏       | 22/100 [00:01<00:04, 16.50it/s] 24%|██▍       | 24/100 [00:01<00:04, 16.55it/s] 26%|██▌       | 26/100 [00:01<00:04, 16.57it/s] 28%|██▊       | 28/100 [00:01<00:04, 16.57it/s] 30%|███       | 30/100 [00:01<00:04, 16.56it/s] 32%|███▏      | 32/100 [00:01<00:04, 16.66it/s] 34%|███▍      | 34/100 [00:02<00:03, 16.71it/s] 36%|███▌      | 36/100 [00:02<00:03, 16.75it/s] 38%|███▊      | 38/100 [00:02<00:03, 16.78it/s] 40%|████      | 40/100 [00:02<00:03, 16.60it/s] 42%|████▏     | 42/100 [00:02<00:03, 16.65it/s] 44%|████▍     | 44/100 [00:02<00:03, 16.62it/s] 46%|████▌     | 46/100 [00:02<00:03, 16.66it/s] 48%|████▊     | 48/100 [00:02<00:03, 16.69it/s] 50%|█████     | 50/100 [00:03<00:02, 16.69it/s] 52%|█████▏    | 52/100 [00:03<00:02, 16.75it/s] 54%|█████▍    | 54/100 [00:03<00:02, 16.73it/s] 56%|█████▌    | 56/100 [00:03<00:02, 16.77it/s] 58%|█████▊    | 58/100 [00:03<00:02, 16.76it/s] 60%|██████    | 60/100 [00:03<00:02, 16.78it/s] 62%|██████▏   | 62/100 [00:03<00:02, 16.76it/s] 64%|██████▍   | 64/100 [00:03<00:02, 16.77it/s] 66%|██████▌   | 66/100 [00:03<00:02, 16.68it/s] 68%|██████▊   | 68/100 [00:04<00:01, 16.63it/s] 70%|███████   | 70/100 [00:04<00:01, 16.69it/s] 72%|███████▏  | 72/100 [00:04<00:01, 16.74it/s] 74%|███████▍  | 74/100 [00:04<00:01, 16.78it/s] 76%|███████▌  | 76/100 [00:04<00:01, 16.78it/s] 78%|███████▊  | 78/100 [00:04<00:01, 16.72it/s] 80%|████████  | 80/100 [00:04<00:01, 16.69it/s] 82%|████████▏ | 82/100 [00:04<00:01, 16.67it/s] 84%|████████▍ | 84/100 [00:05<00:00, 16.31it/s] 86%|████████▌ | 86/100 [00:05<00:00, 16.41it/s] 88%|████████▊ | 88/100 [00:05<00:00, 16.36it/s] 90%|█████████ | 90/100 [00:05<00:00, 16.41it/s] 92%|█████████▏| 92/100 [00:05<00:00, 16.46it/s] 94%|█████████▍| 94/100 [00:05<00:00, 16.55it/s] 96%|█████████▌| 96/100 [00:05<00:00, 16.56it/s] 98%|█████████▊| 98/100 [00:05<00:00, 16.56it/s]100%|██████████| 100/100 [00:06<00:00, 16.55it/s]100%|██████████| 100/100 [00:06<00:00, 16.57it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 348.89it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-14295f39edd20556.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-10ca04ba0c7bb427.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:17,  5.71it/s]  2%|▏         | 2/100 [00:00<00:16,  5.98it/s]  3%|▎         | 3/100 [00:00<00:15,  6.32it/s]  4%|▍         | 4/100 [00:00<00:14,  6.49it/s]  5%|▌         | 5/100 [00:00<00:14,  6.75it/s]  6%|▌         | 6/100 [00:00<00:13,  6.74it/s]  7%|▋         | 7/100 [00:01<00:13,  6.85it/s]  8%|▊         | 8/100 [00:01<00:13,  7.01it/s]  9%|▉         | 9/100 [00:01<00:12,  7.12it/s] 10%|█         | 10/100 [00:01<00:12,  7.16it/s] 11%|█         | 11/100 [00:01<00:12,  7.23it/s] 12%|█▏        | 12/100 [00:01<00:12,  7.28it/s] 13%|█▎        | 13/100 [00:01<00:12,  7.10it/s] 14%|█▍        | 14/100 [00:02<00:12,  7.13it/s] 15%|█▌        | 15/100 [00:02<00:12,  6.98it/s] 16%|█▌        | 16/100 [00:02<00:12,  6.84it/s] 17%|█▋        | 17/100 [00:02<00:11,  7.01it/s] 18%|█▊        | 18/100 [00:02<00:11,  7.07it/s] 19%|█▉        | 19/100 [00:02<00:11,  7.12it/s] 20%|██        | 20/100 [00:02<00:11,  7.08it/s] 21%|██        | 21/100 [00:03<00:11,  6.94it/s] 22%|██▏       | 22/100 [00:03<00:11,  7.01it/s] 23%|██▎       | 23/100 [00:03<00:11,  6.92it/s] 24%|██▍       | 24/100 [00:03<00:10,  7.00it/s] 25%|██▌       | 25/100 [00:03<00:10,  6.88it/s] 26%|██▌       | 26/100 [00:03<00:10,  6.76it/s] 27%|██▋       | 27/100 [00:03<00:10,  6.74it/s] 28%|██▊       | 28/100 [00:04<00:10,  6.87it/s] 29%|██▉       | 29/100 [00:04<00:10,  6.97it/s] 30%|███       | 30/100 [00:04<00:09,  7.07it/s] 31%|███       | 31/100 [00:04<00:09,  7.12it/s] 32%|███▏      | 32/100 [00:04<00:09,  7.23it/s] 33%|███▎      | 33/100 [00:04<00:09,  7.31it/s] 34%|███▍      | 34/100 [00:04<00:09,  7.29it/s] 35%|███▌      | 35/100 [00:05<00:08,  7.35it/s] 36%|███▌      | 36/100 [00:05<00:08,  7.16it/s] 37%|███▋      | 37/100 [00:05<00:08,  7.05it/s] 38%|███▊      | 38/100 [00:05<00:08,  7.00it/s] 39%|███▉      | 39/100 [00:05<00:08,  6.84it/s] 40%|████      | 40/100 [00:05<00:08,  6.96it/s] 41%|████      | 41/100 [00:05<00:08,  6.86it/s] 42%|████▏     | 42/100 [00:06<00:08,  6.97it/s] 43%|████▎     | 43/100 [00:06<00:08,  6.95it/s] 44%|████▍     | 44/100 [00:06<00:07,  7.11it/s] 45%|████▌     | 45/100 [00:06<00:07,  7.13it/s] 46%|████▌     | 46/100 [00:06<00:07,  7.05it/s] 47%|████▋     | 47/100 [00:06<00:07,  6.91it/s] 48%|████▊     | 48/100 [00:06<00:07,  7.01it/s] 49%|████▉     | 49/100 [00:07<00:07,  6.89it/s] 50%|█████     | 50/100 [00:07<00:07,  6.99it/s] 51%|█████     | 51/100 [00:07<00:07,  6.95it/s] 52%|█████▏    | 52/100 [00:07<00:06,  6.96it/s] 53%|█████▎    | 53/100 [00:07<00:06,  7.11it/s] 54%|█████▍    | 54/100 [00:07<00:06,  7.22it/s] 55%|█████▌    | 55/100 [00:07<00:06,  7.26it/s] 56%|█████▌    | 56/100 [00:08<00:06,  7.12it/s] 57%|█████▋    | 57/100 [00:08<00:06,  7.09it/s] 58%|█████▊    | 58/100 [00:08<00:06,  6.99it/s] 59%|█████▉    | 59/100 [00:08<00:05,  7.06it/s] 60%|██████    | 60/100 [00:08<00:05,  7.18it/s] 61%|██████    | 61/100 [00:08<00:05,  7.24it/s] 62%|██████▏   | 62/100 [00:08<00:05,  7.12it/s] 63%|██████▎   | 63/100 [00:08<00:05,  7.24it/s] 64%|██████▍   | 64/100 [00:09<00:04,  7.22it/s] 65%|██████▌   | 65/100 [00:09<00:04,  7.06it/s] 66%|██████▌   | 66/100 [00:09<00:04,  7.10it/s] 67%|██████▋   | 67/100 [00:09<00:04,  6.95it/s] 68%|██████▊   | 68/100 [00:09<00:04,  7.03it/s] 69%|██████▉   | 69/100 [00:09<00:04,  6.90it/s] 70%|███████   | 70/100 [00:10<00:04,  6.75it/s] 71%|███████   | 71/100 [00:10<00:04,  6.96it/s] 72%|███████▏  | 72/100 [00:10<00:03,  7.11it/s] 73%|███████▎  | 73/100 [00:10<00:03,  7.07it/s] 74%|███████▍  | 74/100 [00:10<00:03,  7.18it/s] 75%|███████▌  | 75/100 [00:10<00:03,  7.07it/s] 76%|███████▌  | 76/100 [00:10<00:03,  7.15it/s] 77%|███████▋  | 77/100 [00:10<00:03,  7.25it/s] 78%|███████▊  | 78/100 [00:11<00:03,  7.26it/s] 79%|███████▉  | 79/100 [00:11<00:02,  7.18it/s] 80%|████████  | 80/100 [00:11<00:02,  7.19it/s] 81%|████████  | 81/100 [00:11<00:02,  7.18it/s] 82%|████████▏ | 82/100 [00:11<00:02,  6.89it/s] 83%|████████▎ | 83/100 [00:11<00:02,  6.76it/s] 84%|████████▍ | 84/100 [00:11<00:02,  6.86it/s] 85%|████████▌ | 85/100 [00:12<00:02,  6.81it/s] 86%|████████▌ | 86/100 [00:12<00:02,  6.93it/s] 87%|████████▋ | 87/100 [00:12<00:01,  6.82it/s] 88%|████████▊ | 88/100 [00:12<00:01,  6.94it/s] 89%|████████▉ | 89/100 [00:12<00:01,  6.98it/s] 90%|█████████ | 90/100 [00:12<00:01,  7.06it/s] 91%|█████████ | 91/100 [00:12<00:01,  7.14it/s] 92%|█████████▏| 92/100 [00:13<00:01,  7.17it/s] 93%|█████████▎| 93/100 [00:13<00:00,  7.16it/s] 94%|█████████▍| 94/100 [00:13<00:00,  7.22it/s] 95%|█████████▌| 95/100 [00:13<00:00,  7.06it/s] 96%|█████████▌| 96/100 [00:13<00:00,  7.14it/s] 97%|█████████▋| 97/100 [00:13<00:00,  7.24it/s] 98%|█████████▊| 98/100 [00:13<00:00,  7.31it/s] 99%|█████████▉| 99/100 [00:14<00:00,  7.28it/s]100%|██████████| 100/100 [00:14<00:00,  7.28it/s]100%|██████████| 100/100 [00:14<00:00,  7.03it/s]
FOLD 1
Metric     CE Loss  KL wrt Orig
Model                          
llama_7B  2.958838     0.873872
[2.96498535 0.82139762]
2023-12-04 01:06:56.964812: I tensorflow/core/util/port.cc:110] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2023-12-04 01:06:57.015103: I tensorflow/core/platform/cpu_feature_guard.cc:182] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-12-04 01:06:57.764205: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Could not find TensorRT
Found cached dataset truthful_qa (/home/elicer/.cache/huggingface/datasets/truthful_qa/multiple_choice/1.1.0/63502f6bc6ee493830ce0843991b028d0ab568d221896b2ee3b8a5dfdaa9d7f4)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 362.26it/s]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:00<00:00,  5.21it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  6.14it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  5.97it/s]
head_wise_activation_length:(11012, 32, 4096)
labels_shape:(11012,)
seperated_head_activation shape:11013
Running fold 0
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:28,  1.08it/s]  6%|▋         | 2/32 [00:01<00:28,  1.05it/s]  9%|▉         | 3/32 [00:02<00:26,  1.08it/s] 12%|█▎        | 4/32 [00:03<00:25,  1.10it/s] 16%|█▌        | 5/32 [00:04<00:24,  1.09it/s] 19%|█▉        | 6/32 [00:05<00:24,  1.07it/s] 22%|██▏       | 7/32 [00:06<00:23,  1.06it/s] 25%|██▌       | 8/32 [00:07<00:23,  1.04it/s] 28%|██▊       | 9/32 [00:08<00:22,  1.01it/s] 31%|███▏      | 10/32 [00:09<00:22,  1.01s/it] 34%|███▍      | 11/32 [00:10<00:21,  1.03s/it] 38%|███▊      | 12/32 [00:11<00:20,  1.02s/it] 41%|████      | 13/32 [00:12<00:19,  1.03s/it] 44%|████▍     | 14/32 [00:13<00:18,  1.05s/it] 47%|████▋     | 15/32 [00:14<00:17,  1.04s/it] 50%|█████     | 16/32 [00:15<00:16,  1.04s/it] 53%|█████▎    | 17/32 [00:17<00:15,  1.05s/it] 56%|█████▋    | 18/32 [00:18<00:14,  1.06s/it] 59%|█████▉    | 19/32 [00:19<00:14,  1.08s/it] 62%|██████▎   | 20/32 [00:20<00:13,  1.10s/it] 66%|██████▌   | 21/32 [00:21<00:12,  1.12s/it] 69%|██████▉   | 22/32 [00:22<00:11,  1.10s/it] 72%|███████▏  | 23/32 [00:23<00:10,  1.13s/it] 75%|███████▌  | 24/32 [00:25<00:09,  1.18s/it] 78%|███████▊  | 25/32 [00:26<00:08,  1.16s/it] 81%|████████▏ | 26/32 [00:27<00:06,  1.15s/it] 84%|████████▍ | 27/32 [00:28<00:05,  1.18s/it] 88%|████████▊ | 28/32 [00:29<00:04,  1.14s/it] 91%|█████████ | 29/32 [00:30<00:03,  1.14s/it] 94%|█████████▍| 30/32 [00:31<00:02,  1.12s/it] 97%|█████████▋| 31/32 [00:32<00:01,  1.13s/it]100%|██████████| 32/32 [00:34<00:00,  1.23s/it]100%|██████████| 32/32 [00:34<00:00,  1.08s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
/home/elicer/honest_llama/validation/../TruthfulQA/truthfulqa/metrics.py:284: FutureWarning: load_metric is deprecated and will be removed in the next major version of datasets. Use 'evaluate.load' instead, from the new library 🤗 Evaluate: https://huggingface.co/docs/evaluate
  bleurt = load_metric("bleurt", cache_dir=cache_dir)
[[0.651 0.665 0.645 ... 0.646 0.647 0.652]
 [0.659 0.644 0.645 ... 0.648 0.658 0.656]
 [0.651 0.657 0.685 ... 0.637 0.648 0.667]
 ...
 [0.765 0.762 0.657 ... 0.73  0.704 0.674]
 [0.748 0.678 0.696 ... 0.663 0.769 0.786]
 [0.775 0.815 0.74  ... 0.697 0.809 0.79 ]]
Heads intervened:  [(8, 16), (8, 19), (10, 18), (11, 16), (11, 17), (12, 4), (12, 15), (12, 22), (13, 8), (13, 16), (14, 2), (14, 20), (15, 28), (16, 17), (16, 26), (16, 30), (17, 4), (17, 9), (17, 13), (17, 17), (17, 29), (18, 29), (19, 13), (19, 17), (19, 31), (20, 22), (20, 30), (21, 18), (22, 2), (22, 8), (22, 16), (22, 23), (22, 30), (23, 3), (23, 4), (23, 7), (23, 12), (23, 13), (23, 25), (25, 15), (30, 14), (30, 23), (31, 1), (31, 3), (31, 6), (31, 11), (31, 25), (31, 30)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
2023-12-04 01:07:48.374196: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1635] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 24961 MB memory:  -> device: 0, name: NVIDIA A100 80GB PCIe MIG 3g.40gb, pci bus id: 0000:65:00.0, compute capability: 8.0
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 276.09it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-ec0cf83741fdb3e8.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-d31e6c0c76fafb4d.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:01<01:42,  1.04s/it]  3%|▎         | 3/100 [00:01<00:30,  3.19it/s]  5%|▌         | 5/100 [00:01<00:17,  5.46it/s]  7%|▋         | 7/100 [00:01<00:12,  7.63it/s]  9%|▉         | 9/100 [00:01<00:09,  9.58it/s] 11%|█         | 11/100 [00:01<00:07, 11.16it/s] 13%|█▎        | 13/100 [00:01<00:06, 12.44it/s] 15%|█▌        | 15/100 [00:01<00:06, 13.54it/s] 17%|█▋        | 17/100 [00:02<00:05, 14.38it/s] 19%|█▉        | 19/100 [00:02<00:05, 15.00it/s] 21%|██        | 21/100 [00:02<00:05, 15.34it/s] 23%|██▎       | 23/100 [00:02<00:04, 15.60it/s] 25%|██▌       | 25/100 [00:02<00:04, 15.81it/s] 27%|██▋       | 27/100 [00:02<00:04, 15.95it/s] 29%|██▉       | 29/100 [00:02<00:04, 16.08it/s] 31%|███       | 31/100 [00:02<00:04, 16.13it/s] 33%|███▎      | 33/100 [00:02<00:04, 16.18it/s] 35%|███▌      | 35/100 [00:03<00:04, 16.09it/s] 37%|███▋      | 37/100 [00:03<00:03, 16.14it/s] 39%|███▉      | 39/100 [00:03<00:03, 16.20it/s] 41%|████      | 41/100 [00:03<00:03, 16.25it/s] 43%|████▎     | 43/100 [00:03<00:03, 16.29it/s] 45%|████▌     | 45/100 [00:03<00:03, 16.29it/s] 47%|████▋     | 47/100 [00:03<00:03, 16.31it/s] 49%|████▉     | 49/100 [00:03<00:03, 16.30it/s] 51%|█████     | 51/100 [00:04<00:02, 16.40it/s] 53%|█████▎    | 53/100 [00:04<00:02, 16.47it/s] 55%|█████▌    | 55/100 [00:04<00:02, 16.51it/s] 57%|█████▋    | 57/100 [00:04<00:02, 16.14it/s] 59%|█████▉    | 59/100 [00:04<00:02, 16.22it/s] 61%|██████    | 61/100 [00:04<00:02, 16.31it/s] 63%|██████▎   | 63/100 [00:04<00:02, 16.37it/s] 65%|██████▌   | 65/100 [00:04<00:02, 16.44it/s] 67%|██████▋   | 67/100 [00:05<00:02, 16.48it/s] 69%|██████▉   | 69/100 [00:05<00:01, 16.26it/s] 71%|███████   | 71/100 [00:05<00:01, 16.29it/s] 73%|███████▎  | 73/100 [00:05<00:01, 16.41it/s] 75%|███████▌  | 75/100 [00:05<00:01, 16.43it/s] 77%|███████▋  | 77/100 [00:05<00:01, 16.42it/s] 79%|███████▉  | 79/100 [00:05<00:01, 16.33it/s] 81%|████████  | 81/100 [00:05<00:01, 16.42it/s] 83%|████████▎ | 83/100 [00:06<00:01, 16.45it/s] 85%|████████▌ | 85/100 [00:06<00:00, 16.39it/s] 87%|████████▋ | 87/100 [00:06<00:00, 16.41it/s] 89%|████████▉ | 89/100 [00:06<00:00, 16.40it/s] 91%|█████████ | 91/100 [00:06<00:00, 16.38it/s] 93%|█████████▎| 93/100 [00:06<00:00, 16.38it/s] 95%|█████████▌| 95/100 [00:06<00:00, 16.35it/s] 97%|█████████▋| 97/100 [00:06<00:00, 16.38it/s] 99%|█████████▉| 99/100 [00:07<00:00, 16.36it/s]100%|██████████| 100/100 [00:07<00:00, 14.11it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 339.32it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-1939fcc1eeebdaa7.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-785bb4b6f2089589.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:17,  5.52it/s]  2%|▏         | 2/100 [00:00<00:16,  6.05it/s]  3%|▎         | 3/100 [00:00<00:15,  6.34it/s]  4%|▍         | 4/100 [00:00<00:14,  6.40it/s]  5%|▌         | 5/100 [00:00<00:14,  6.72it/s]  6%|▌         | 6/100 [00:00<00:13,  6.72it/s]  7%|▋         | 7/100 [00:01<00:13,  6.73it/s]  8%|▊         | 8/100 [00:01<00:13,  6.83it/s]  9%|▉         | 9/100 [00:01<00:13,  6.81it/s] 10%|█         | 10/100 [00:01<00:13,  6.77it/s] 11%|█         | 11/100 [00:01<00:13,  6.66it/s] 12%|█▏        | 12/100 [00:01<00:13,  6.59it/s] 13%|█▎        | 13/100 [00:01<00:13,  6.65it/s] 14%|█▍        | 14/100 [00:02<00:12,  6.78it/s] 15%|█▌        | 15/100 [00:02<00:12,  6.86it/s] 16%|█▌        | 16/100 [00:02<00:11,  7.02it/s] 17%|█▋        | 17/100 [00:02<00:11,  7.11it/s] 18%|█▊        | 18/100 [00:02<00:11,  7.16it/s] 19%|█▉        | 19/100 [00:02<00:11,  7.06it/s] 20%|██        | 20/100 [00:02<00:11,  6.99it/s] 21%|██        | 21/100 [00:03<00:11,  6.95it/s] 22%|██▏       | 22/100 [00:03<00:11,  6.92it/s] 23%|██▎       | 23/100 [00:03<00:10,  7.08it/s] 24%|██▍       | 24/100 [00:03<00:11,  6.82it/s] 25%|██▌       | 25/100 [00:03<00:11,  6.67it/s] 26%|██▌       | 26/100 [00:03<00:11,  6.48it/s] 27%|██▋       | 27/100 [00:04<00:11,  6.59it/s] 28%|██▊       | 28/100 [00:04<00:10,  6.80it/s] 29%|██▉       | 29/100 [00:04<00:10,  6.90it/s] 30%|███       | 30/100 [00:04<00:10,  6.67it/s] 31%|███       | 31/100 [00:04<00:10,  6.46it/s] 32%|███▏      | 32/100 [00:04<00:10,  6.55it/s] 33%|███▎      | 33/100 [00:04<00:10,  6.49it/s] 34%|███▍      | 34/100 [00:05<00:10,  6.44it/s] 35%|███▌      | 35/100 [00:05<00:09,  6.53it/s] 36%|███▌      | 36/100 [00:05<00:09,  6.60it/s] 37%|███▋      | 37/100 [00:05<00:09,  6.68it/s] 38%|███▊      | 38/100 [00:05<00:08,  6.91it/s] 39%|███▉      | 39/100 [00:05<00:08,  7.05it/s] 40%|████      | 40/100 [00:05<00:08,  7.09it/s] 41%|████      | 41/100 [00:06<00:08,  7.20it/s] 42%|████▏     | 42/100 [00:06<00:07,  7.27it/s] 43%|████▎     | 43/100 [00:06<00:08,  6.95it/s] 44%|████▍     | 44/100 [00:06<00:08,  6.78it/s] 45%|████▌     | 45/100 [00:06<00:08,  6.81it/s] 46%|████▌     | 46/100 [00:06<00:07,  6.85it/s] 47%|████▋     | 47/100 [00:06<00:07,  6.86it/s] 48%|████▊     | 48/100 [00:07<00:07,  7.01it/s] 49%|████▉     | 49/100 [00:07<00:07,  7.14it/s] 50%|█████     | 50/100 [00:07<00:07,  7.10it/s] 51%|█████     | 51/100 [00:07<00:06,  7.00it/s] 52%|█████▏    | 52/100 [00:07<00:06,  6.94it/s] 53%|█████▎    | 53/100 [00:07<00:06,  6.96it/s] 54%|█████▍    | 54/100 [00:07<00:06,  6.90it/s] 55%|█████▌    | 55/100 [00:08<00:06,  6.93it/s] 56%|█████▌    | 56/100 [00:08<00:06,  6.72it/s] 57%|█████▋    | 57/100 [00:08<00:06,  6.85it/s] 58%|█████▊    | 58/100 [00:08<00:06,  6.87it/s] 59%|█████▉    | 59/100 [00:08<00:05,  6.98it/s] 60%|██████    | 60/100 [00:08<00:05,  6.99it/s] 61%|██████    | 61/100 [00:08<00:05,  7.04it/s] 62%|██████▏   | 62/100 [00:09<00:05,  6.86it/s] 63%|██████▎   | 63/100 [00:09<00:05,  7.03it/s] 64%|██████▍   | 64/100 [00:09<00:05,  6.96it/s] 65%|██████▌   | 65/100 [00:09<00:04,  7.03it/s] 66%|██████▌   | 66/100 [00:09<00:04,  6.90it/s] 67%|██████▋   | 67/100 [00:09<00:04,  6.86it/s] 68%|██████▊   | 68/100 [00:09<00:04,  6.89it/s] 69%|██████▉   | 69/100 [00:10<00:04,  6.60it/s] 70%|███████   | 70/100 [00:10<00:04,  6.58it/s] 71%|███████   | 71/100 [00:10<00:04,  6.61it/s] 72%|███████▏  | 72/100 [00:10<00:04,  6.51it/s] 73%|███████▎  | 73/100 [00:10<00:04,  6.60it/s] 74%|███████▍  | 74/100 [00:10<00:03,  6.67it/s] 75%|███████▌  | 75/100 [00:11<00:03,  6.61it/s] 76%|███████▌  | 76/100 [00:11<00:03,  6.62it/s] 77%|███████▋  | 77/100 [00:11<00:03,  6.56it/s] 78%|███████▊  | 78/100 [00:11<00:03,  6.65it/s] 79%|███████▉  | 79/100 [00:11<00:03,  6.57it/s] 80%|████████  | 80/100 [00:11<00:02,  6.70it/s] 81%|████████  | 81/100 [00:11<00:02,  6.72it/s] 82%|████████▏ | 82/100 [00:12<00:02,  6.74it/s] 83%|████████▎ | 83/100 [00:12<00:02,  6.95it/s] 84%|████████▍ | 84/100 [00:12<00:02,  7.04it/s] 85%|████████▌ | 85/100 [00:12<00:02,  6.89it/s] 86%|████████▌ | 86/100 [00:12<00:01,  7.04it/s] 87%|████████▋ | 87/100 [00:12<00:01,  7.16it/s] 88%|████████▊ | 88/100 [00:12<00:01,  6.99it/s] 89%|████████▉ | 89/100 [00:13<00:01,  6.94it/s] 90%|█████████ | 90/100 [00:13<00:01,  6.78it/s] 91%|█████████ | 91/100 [00:13<00:01,  6.67it/s] 92%|█████████▏| 92/100 [00:13<00:01,  6.72it/s] 93%|█████████▎| 93/100 [00:13<00:01,  6.92it/s] 94%|█████████▍| 94/100 [00:13<00:00,  6.84it/s] 95%|█████████▌| 95/100 [00:13<00:00,  6.71it/s] 96%|█████████▌| 96/100 [00:14<00:00,  6.63it/s] 97%|█████████▋| 97/100 [00:14<00:00,  6.66it/s] 98%|█████████▊| 98/100 [00:14<00:00,  6.76it/s] 99%|█████████▉| 99/100 [00:14<00:00,  6.88it/s]100%|██████████| 100/100 [00:14<00:00,  6.95it/s]100%|██████████| 100/100 [00:14<00:00,  6.81it/s]
FOLD 0
Metric     CE Loss  KL wrt Orig
Model                          
llama_7B  3.350273     1.158718
Running fold 1
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:28,  1.10it/s]  6%|▋         | 2/32 [00:02<00:31,  1.05s/it]  9%|▉         | 3/32 [00:03<00:32,  1.12s/it] 12%|█▎        | 4/32 [00:04<00:31,  1.14s/it] 16%|█▌        | 5/32 [00:05<00:31,  1.18s/it] 19%|█▉        | 6/32 [00:06<00:31,  1.22s/it] 22%|██▏       | 7/32 [00:08<00:30,  1.23s/it] 25%|██▌       | 8/32 [00:09<00:29,  1.22s/it] 28%|██▊       | 9/32 [00:10<00:28,  1.22s/it] 31%|███▏      | 10/32 [00:11<00:26,  1.23s/it] 34%|███▍      | 11/32 [00:13<00:25,  1.21s/it] 38%|███▊      | 12/32 [00:14<00:23,  1.19s/it] 41%|████      | 13/32 [00:15<00:22,  1.19s/it] 44%|████▍     | 14/32 [00:16<00:21,  1.18s/it] 47%|████▋     | 15/32 [00:17<00:20,  1.18s/it] 50%|█████     | 16/32 [00:18<00:18,  1.18s/it] 53%|█████▎    | 17/32 [00:20<00:17,  1.18s/it] 56%|█████▋    | 18/32 [00:21<00:16,  1.19s/it] 59%|█████▉    | 19/32 [00:22<00:15,  1.21s/it] 62%|██████▎   | 20/32 [00:23<00:14,  1.24s/it] 66%|██████▌   | 21/32 [00:25<00:13,  1.24s/it] 69%|██████▉   | 22/32 [00:26<00:12,  1.24s/it] 72%|███████▏  | 23/32 [00:27<00:11,  1.25s/it] 75%|███████▌  | 24/32 [00:28<00:10,  1.28s/it] 78%|███████▊  | 25/32 [00:30<00:08,  1.28s/it] 81%|████████▏ | 26/32 [00:31<00:07,  1.27s/it] 84%|████████▍ | 27/32 [00:32<00:06,  1.28s/it] 88%|████████▊ | 28/32 [00:34<00:05,  1.27s/it] 91%|█████████ | 29/32 [00:35<00:03,  1.28s/it] 94%|█████████▍| 30/32 [00:36<00:02,  1.27s/it] 97%|█████████▋| 31/32 [00:37<00:01,  1.27s/it]100%|██████████| 32/32 [00:39<00:00,  1.32s/it]100%|██████████| 32/32 [00:39<00:00,  1.23s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
[[0.666 0.672 0.662 ... 0.668 0.662 0.67 ]
 [0.662 0.662 0.659 ... 0.677 0.666 0.663]
 [0.668 0.67  0.68  ... 0.661 0.665 0.671]
 ...
 [0.758 0.75  0.674 ... 0.716 0.694 0.677]
 [0.749 0.671 0.686 ... 0.674 0.762 0.76 ]
 [0.765 0.805 0.748 ... 0.743 0.787 0.775]]
Heads intervened:  [(5, 10), (8, 16), (11, 16), (11, 17), (12, 4), (12, 22), (13, 8), (13, 10), (13, 16), (13, 21), (14, 2), (15, 1), (15, 10), (15, 28), (16, 3), (16, 4), (16, 17), (16, 26), (16, 30), (17, 4), (17, 13), (17, 17), (17, 19), (17, 29), (18, 29), (19, 13), (19, 17), (19, 28), (19, 31), (20, 22), (20, 30), (21, 23), (22, 16), (23, 3), (23, 4), (23, 12), (23, 13), (23, 25), (26, 13), (27, 3), (27, 7), (30, 4), (30, 18), (30, 23), (31, 1), (31, 6), (31, 10), (31, 18)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 259.52it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-30ec7b2da7888791.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-4e53eea82b0ecfef.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  2%|▏         | 2/100 [00:00<00:06, 14.79it/s]  4%|▍         | 4/100 [00:00<00:06, 15.55it/s]  6%|▌         | 6/100 [00:00<00:05, 15.86it/s]  8%|▊         | 8/100 [00:00<00:05, 16.08it/s] 10%|█         | 10/100 [00:00<00:05, 16.21it/s] 12%|█▏        | 12/100 [00:00<00:05, 16.27it/s] 14%|█▍        | 14/100 [00:00<00:05, 16.29it/s] 16%|█▌        | 16/100 [00:00<00:05, 16.30it/s] 18%|█▊        | 18/100 [00:01<00:05, 16.29it/s] 20%|██        | 20/100 [00:01<00:04, 16.33it/s] 22%|██▏       | 22/100 [00:01<00:04, 16.30it/s] 24%|██▍       | 24/100 [00:01<00:04, 16.33it/s] 26%|██▌       | 26/100 [00:01<00:04, 16.37it/s] 28%|██▊       | 28/100 [00:01<00:04, 16.35it/s] 30%|███       | 30/100 [00:01<00:04, 16.22it/s] 32%|███▏      | 32/100 [00:01<00:04, 16.18it/s] 34%|███▍      | 34/100 [00:02<00:04, 16.21it/s] 36%|███▌      | 36/100 [00:02<00:03, 16.24it/s] 38%|███▊      | 38/100 [00:02<00:03, 16.10it/s] 40%|████      | 40/100 [00:02<00:03, 16.13it/s] 42%|████▏     | 42/100 [00:02<00:03, 16.20it/s] 44%|████▍     | 44/100 [00:02<00:03, 16.25it/s] 46%|████▌     | 46/100 [00:02<00:03, 16.26it/s] 48%|████▊     | 48/100 [00:02<00:03, 16.29it/s] 50%|█████     | 50/100 [00:03<00:03, 16.34it/s] 52%|█████▏    | 52/100 [00:03<00:02, 16.35it/s] 54%|█████▍    | 54/100 [00:03<00:02, 16.37it/s] 56%|█████▌    | 56/100 [00:03<00:02, 16.34it/s] 58%|█████▊    | 58/100 [00:03<00:02, 16.35it/s] 60%|██████    | 60/100 [00:03<00:02, 16.36it/s] 62%|██████▏   | 62/100 [00:03<00:02, 16.17it/s] 64%|██████▍   | 64/100 [00:03<00:02, 16.10it/s] 66%|██████▌   | 66/100 [00:04<00:02, 16.18it/s] 68%|██████▊   | 68/100 [00:04<00:01, 16.24it/s] 70%|███████   | 70/100 [00:04<00:01, 16.27it/s] 72%|███████▏  | 72/100 [00:04<00:01, 16.12it/s] 74%|███████▍  | 74/100 [00:04<00:01, 16.02it/s] 76%|███████▌  | 76/100 [00:04<00:01, 16.15it/s] 78%|███████▊  | 78/100 [00:04<00:01, 16.25it/s] 80%|████████  | 80/100 [00:04<00:01, 16.32it/s] 82%|████████▏ | 82/100 [00:05<00:01, 16.38it/s] 84%|████████▍ | 84/100 [00:05<00:00, 16.41it/s] 86%|████████▌ | 86/100 [00:05<00:00, 16.43it/s] 88%|████████▊ | 88/100 [00:05<00:00, 16.43it/s] 90%|█████████ | 90/100 [00:05<00:00, 16.45it/s] 92%|█████████▏| 92/100 [00:05<00:00, 16.47it/s] 94%|█████████▍| 94/100 [00:05<00:00, 16.48it/s] 96%|█████████▌| 96/100 [00:05<00:00, 16.45it/s] 98%|█████████▊| 98/100 [00:06<00:00, 16.46it/s]100%|██████████| 100/100 [00:06<00:00, 16.45it/s]100%|██████████| 100/100 [00:06<00:00, 16.27it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 344.36it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-14295f39edd20556.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-10ca04ba0c7bb427.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:17,  5.74it/s]  2%|▏         | 2/100 [00:00<00:16,  6.02it/s]  3%|▎         | 3/100 [00:00<00:15,  6.18it/s]  4%|▍         | 4/100 [00:00<00:15,  6.38it/s]  5%|▌         | 5/100 [00:00<00:14,  6.70it/s]  6%|▌         | 6/100 [00:00<00:13,  6.90it/s]  7%|▋         | 7/100 [00:01<00:13,  6.95it/s]  8%|▊         | 8/100 [00:01<00:13,  6.81it/s]  9%|▉         | 9/100 [00:01<00:13,  6.66it/s] 10%|█         | 10/100 [00:01<00:13,  6.68it/s] 11%|█         | 11/100 [00:01<00:12,  6.87it/s] 12%|█▏        | 12/100 [00:01<00:12,  7.00it/s] 13%|█▎        | 13/100 [00:01<00:12,  6.87it/s] 14%|█▍        | 14/100 [00:02<00:12,  6.87it/s] 15%|█▌        | 15/100 [00:02<00:12,  7.01it/s] 16%|█▌        | 16/100 [00:02<00:12,  6.83it/s] 17%|█▋        | 17/100 [00:02<00:12,  6.75it/s] 18%|█▊        | 18/100 [00:02<00:12,  6.47it/s] 19%|█▉        | 19/100 [00:02<00:12,  6.57it/s] 20%|██        | 20/100 [00:02<00:12,  6.62it/s] 21%|██        | 21/100 [00:03<00:11,  6.68it/s] 22%|██▏       | 22/100 [00:03<00:11,  6.88it/s] 23%|██▎       | 23/100 [00:03<00:10,  7.01it/s] 24%|██▍       | 24/100 [00:03<00:11,  6.86it/s] 25%|██▌       | 25/100 [00:03<00:11,  6.78it/s] 26%|██▌       | 26/100 [00:03<00:10,  6.75it/s] 27%|██▋       | 27/100 [00:04<00:10,  6.90it/s] 28%|██▊       | 28/100 [00:04<00:10,  7.03it/s] 29%|██▉       | 29/100 [00:04<00:10,  6.82it/s] 30%|███       | 30/100 [00:04<00:10,  6.89it/s] 31%|███       | 31/100 [00:04<00:10,  6.82it/s] 32%|███▏      | 32/100 [00:04<00:09,  6.94it/s] 33%|███▎      | 33/100 [00:04<00:09,  6.85it/s] 34%|███▍      | 34/100 [00:05<00:09,  6.92it/s] 35%|███▌      | 35/100 [00:05<00:09,  6.92it/s] 36%|███▌      | 36/100 [00:05<00:09,  6.83it/s] 37%|███▋      | 37/100 [00:05<00:09,  6.92it/s] 38%|███▊      | 38/100 [00:05<00:09,  6.78it/s] 39%|███▉      | 39/100 [00:05<00:08,  6.86it/s] 40%|████      | 40/100 [00:05<00:08,  6.90it/s] 41%|████      | 41/100 [00:06<00:08,  6.86it/s] 42%|████▏     | 42/100 [00:06<00:08,  6.77it/s] 43%|████▎     | 43/100 [00:06<00:08,  6.68it/s] 44%|████▍     | 44/100 [00:06<00:08,  6.85it/s] 45%|████▌     | 45/100 [00:06<00:07,  6.97it/s] 46%|████▌     | 46/100 [00:06<00:07,  6.85it/s] 47%|████▋     | 47/100 [00:06<00:07,  6.76it/s] 48%|████▊     | 48/100 [00:07<00:07,  6.68it/s] 49%|████▉     | 49/100 [00:07<00:07,  6.80it/s] 50%|█████     | 50/100 [00:07<00:07,  6.58it/s] 51%|█████     | 51/100 [00:07<00:07,  6.40it/s] 52%|█████▏    | 52/100 [00:07<00:07,  6.43it/s] 53%|█████▎    | 53/100 [00:07<00:07,  6.55it/s] 54%|█████▍    | 54/100 [00:07<00:06,  6.62it/s] 55%|█████▌    | 55/100 [00:08<00:06,  6.66it/s] 56%|█████▌    | 56/100 [00:08<00:06,  6.66it/s] 57%|█████▋    | 57/100 [00:08<00:06,  6.60it/s] 58%|█████▊    | 58/100 [00:08<00:06,  6.73it/s] 59%|█████▉    | 59/100 [00:08<00:06,  6.78it/s] 60%|██████    | 60/100 [00:08<00:05,  6.80it/s] 61%|██████    | 61/100 [00:09<00:05,  6.77it/s] 62%|██████▏   | 62/100 [00:09<00:05,  6.86it/s] 63%|██████▎   | 63/100 [00:09<00:05,  6.73it/s] 64%|██████▍   | 64/100 [00:09<00:05,  6.84it/s] 65%|██████▌   | 65/100 [00:09<00:05,  6.86it/s] 66%|██████▌   | 66/100 [00:09<00:05,  6.73it/s] 67%|██████▋   | 67/100 [00:09<00:04,  6.66it/s] 68%|██████▊   | 68/100 [00:10<00:04,  6.53it/s] 69%|██████▉   | 69/100 [00:10<00:04,  6.67it/s] 70%|███████   | 70/100 [00:10<00:04,  6.70it/s] 71%|███████   | 71/100 [00:10<00:04,  6.72it/s] 72%|███████▏  | 72/100 [00:10<00:04,  6.88it/s] 73%|███████▎  | 73/100 [00:10<00:03,  6.77it/s] 74%|███████▍  | 74/100 [00:10<00:03,  6.77it/s] 75%|███████▌  | 75/100 [00:11<00:03,  6.63it/s] 76%|███████▌  | 76/100 [00:11<00:03,  6.61it/s] 77%|███████▋  | 77/100 [00:11<00:03,  6.71it/s] 78%|███████▊  | 78/100 [00:11<00:03,  6.51it/s] 79%|███████▉  | 79/100 [00:11<00:03,  6.59it/s] 80%|████████  | 80/100 [00:11<00:03,  6.55it/s] 81%|████████  | 81/100 [00:12<00:02,  6.78it/s] 82%|████████▏ | 82/100 [00:12<00:02,  6.74it/s] 83%|████████▎ | 83/100 [00:12<00:02,  6.60it/s] 84%|████████▍ | 84/100 [00:12<00:02,  6.82it/s] 85%|████████▌ | 85/100 [00:12<00:02,  6.88it/s] 86%|████████▌ | 86/100 [00:12<00:02,  6.80it/s] 87%|████████▋ | 87/100 [00:12<00:01,  6.78it/s] 88%|████████▊ | 88/100 [00:13<00:01,  6.72it/s] 89%|████████▉ | 89/100 [00:13<00:01,  6.73it/s] 90%|█████████ | 90/100 [00:13<00:01,  6.92it/s] 91%|█████████ | 91/100 [00:13<00:01,  6.92it/s] 92%|█████████▏| 92/100 [00:13<00:01,  6.88it/s] 93%|█████████▎| 93/100 [00:13<00:01,  6.73it/s] 94%|█████████▍| 94/100 [00:13<00:00,  6.70it/s] 95%|█████████▌| 95/100 [00:14<00:00,  6.67it/s] 96%|█████████▌| 96/100 [00:14<00:00,  6.71it/s] 97%|█████████▋| 97/100 [00:14<00:00,  6.61it/s] 98%|█████████▊| 98/100 [00:14<00:00,  6.56it/s] 99%|█████████▉| 99/100 [00:14<00:00,  6.46it/s]100%|██████████| 100/100 [00:14<00:00,  6.54it/s]100%|██████████| 100/100 [00:14<00:00,  6.73it/s]
FOLD 1
Metric    CE Loss  KL wrt Orig
Model                         
llama_7B  4.83457      2.59068
[4.09242188 1.87469906]
2023-12-04 01:09:29.682615: I tensorflow/core/util/port.cc:110] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2023-12-04 01:09:29.731886: I tensorflow/core/platform/cpu_feature_guard.cc:182] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-12-04 01:09:30.493029: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Could not find TensorRT
Found cached dataset truthful_qa (/home/elicer/.cache/huggingface/datasets/truthful_qa/multiple_choice/1.1.0/63502f6bc6ee493830ce0843991b028d0ab568d221896b2ee3b8a5dfdaa9d7f4)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 475.81it/s]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:00<00:00,  5.60it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  6.06it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  5.98it/s]
head_wise_activation_length:(11012, 32, 4096)
labels_shape:(11012,)
seperated_head_activation shape:11013
Running fold 0
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:29,  1.05it/s]  6%|▋         | 2/32 [00:01<00:28,  1.04it/s]  9%|▉         | 3/32 [00:02<00:27,  1.07it/s] 12%|█▎        | 4/32 [00:03<00:25,  1.09it/s] 16%|█▌        | 5/32 [00:04<00:24,  1.09it/s] 19%|█▉        | 6/32 [00:05<00:24,  1.07it/s] 22%|██▏       | 7/32 [00:06<00:23,  1.06it/s] 25%|██▌       | 8/32 [00:07<00:23,  1.03it/s] 28%|██▊       | 9/32 [00:08<00:22,  1.01it/s] 31%|███▏      | 10/32 [00:09<00:22,  1.02s/it] 34%|███▍      | 11/32 [00:10<00:21,  1.05s/it] 38%|███▊      | 12/32 [00:11<00:20,  1.04s/it] 41%|████      | 13/32 [00:12<00:20,  1.05s/it] 44%|████▍     | 14/32 [00:14<00:19,  1.07s/it] 47%|████▋     | 15/32 [00:15<00:18,  1.07s/it] 50%|█████     | 16/32 [00:16<00:17,  1.07s/it] 53%|█████▎    | 17/32 [00:17<00:16,  1.08s/it] 56%|█████▋    | 18/32 [00:18<00:15,  1.09s/it] 59%|█████▉    | 19/32 [00:19<00:14,  1.12s/it] 62%|██████▎   | 20/32 [00:20<00:13,  1.13s/it] 66%|██████▌   | 21/32 [00:21<00:12,  1.15s/it] 69%|██████▉   | 22/32 [00:23<00:11,  1.13s/it] 72%|███████▏  | 23/32 [00:24<00:10,  1.16s/it] 75%|███████▌  | 24/32 [00:25<00:09,  1.21s/it] 78%|███████▊  | 25/32 [00:26<00:08,  1.19s/it] 81%|████████▏ | 26/32 [00:27<00:07,  1.18s/it] 84%|████████▍ | 27/32 [00:29<00:05,  1.20s/it] 88%|████████▊ | 28/32 [00:30<00:04,  1.17s/it] 91%|█████████ | 29/32 [00:31<00:03,  1.17s/it] 94%|█████████▍| 30/32 [00:32<00:02,  1.15s/it] 97%|█████████▋| 31/32 [00:33<00:01,  1.16s/it]100%|██████████| 32/32 [00:35<00:00,  1.26s/it]100%|██████████| 32/32 [00:35<00:00,  1.10s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
/home/elicer/honest_llama/validation/../TruthfulQA/truthfulqa/metrics.py:284: FutureWarning: load_metric is deprecated and will be removed in the next major version of datasets. Use 'evaluate.load' instead, from the new library 🤗 Evaluate: https://huggingface.co/docs/evaluate
  bleurt = load_metric("bleurt", cache_dir=cache_dir)
[[0.651 0.665 0.645 ... 0.646 0.647 0.652]
 [0.659 0.644 0.645 ... 0.648 0.658 0.656]
 [0.651 0.657 0.685 ... 0.637 0.648 0.667]
 ...
 [0.765 0.762 0.657 ... 0.73  0.704 0.674]
 [0.748 0.678 0.696 ... 0.663 0.769 0.786]
 [0.775 0.815 0.74  ... 0.697 0.809 0.79 ]]
Heads intervened:  [(8, 16), (12, 4), (13, 8), (13, 16), (16, 30), (17, 29), (18, 29), (19, 17), (20, 30), (22, 16), (23, 3), (31, 6)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
2023-12-04 01:10:22.066733: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1635] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 24961 MB memory:  -> device: 0, name: NVIDIA A100 80GB PCIe MIG 3g.40gb, pci bus id: 0000:65:00.0, compute capability: 8.0
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 262.87it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-ec0cf83741fdb3e8.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-d31e6c0c76fafb4d.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:01<01:41,  1.03s/it]  3%|▎         | 3/100 [00:01<00:29,  3.26it/s]  5%|▌         | 5/100 [00:01<00:16,  5.65it/s]  7%|▋         | 7/100 [00:01<00:11,  8.01it/s]  9%|▉         | 9/100 [00:01<00:08, 10.20it/s] 11%|█         | 11/100 [00:01<00:07, 12.10it/s] 13%|█▎        | 13/100 [00:01<00:06, 13.69it/s] 15%|█▌        | 15/100 [00:01<00:05, 14.96it/s] 17%|█▋        | 17/100 [00:01<00:05, 15.95it/s] 19%|█▉        | 19/100 [00:02<00:04, 16.52it/s] 21%|██        | 21/100 [00:02<00:04, 17.10it/s] 23%|██▎       | 23/100 [00:02<00:04, 17.53it/s] 25%|██▌       | 25/100 [00:02<00:04, 17.83it/s] 27%|██▋       | 27/100 [00:02<00:04, 18.04it/s] 29%|██▉       | 29/100 [00:02<00:03, 18.17it/s] 31%|███       | 31/100 [00:02<00:03, 18.30it/s] 33%|███▎      | 33/100 [00:02<00:03, 18.39it/s] 35%|███▌      | 35/100 [00:02<00:03, 18.45it/s] 37%|███▋      | 37/100 [00:02<00:03, 18.49it/s] 39%|███▉      | 39/100 [00:03<00:03, 18.51it/s] 41%|████      | 41/100 [00:03<00:03, 18.53it/s] 43%|████▎     | 43/100 [00:03<00:03, 18.55it/s] 45%|████▌     | 45/100 [00:03<00:02, 18.56it/s] 47%|████▋     | 47/100 [00:03<00:02, 18.56it/s] 49%|████▉     | 49/100 [00:03<00:02, 18.57it/s] 51%|█████     | 51/100 [00:03<00:02, 18.58it/s] 53%|█████▎    | 53/100 [00:03<00:02, 18.59it/s] 55%|█████▌    | 55/100 [00:03<00:02, 18.58it/s] 57%|█████▋    | 57/100 [00:04<00:02, 18.16it/s] 59%|█████▉    | 59/100 [00:04<00:02, 18.05it/s] 61%|██████    | 61/100 [00:04<00:02, 18.20it/s] 63%|██████▎   | 63/100 [00:04<00:02, 18.30it/s] 65%|██████▌   | 65/100 [00:04<00:01, 18.39it/s] 67%|██████▋   | 67/100 [00:04<00:01, 18.46it/s] 69%|██████▉   | 69/100 [00:04<00:01, 18.51it/s] 71%|███████   | 71/100 [00:04<00:01, 18.54it/s] 73%|███████▎  | 73/100 [00:04<00:01, 18.57it/s] 75%|███████▌  | 75/100 [00:05<00:01, 18.59it/s] 77%|███████▋  | 77/100 [00:05<00:01, 18.59it/s] 79%|███████▉  | 79/100 [00:05<00:01, 18.60it/s] 81%|████████  | 81/100 [00:05<00:01, 18.61it/s] 83%|████████▎ | 83/100 [00:05<00:00, 18.62it/s] 85%|████████▌ | 85/100 [00:05<00:00, 18.62it/s] 87%|████████▋ | 87/100 [00:05<00:00, 18.58it/s] 89%|████████▉ | 89/100 [00:05<00:00, 18.59it/s] 91%|█████████ | 91/100 [00:05<00:00, 18.55it/s] 93%|█████████▎| 93/100 [00:05<00:00, 18.56it/s] 95%|█████████▌| 95/100 [00:06<00:00, 18.57it/s] 97%|█████████▋| 97/100 [00:06<00:00, 18.58it/s] 99%|█████████▉| 99/100 [00:06<00:00, 18.59it/s]100%|██████████| 100/100 [00:06<00:00, 15.69it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 762.60it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-1939fcc1eeebdaa7.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-785bb4b6f2089589.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:16,  6.16it/s]  2%|▏         | 2/100 [00:00<00:13,  7.01it/s]  3%|▎         | 3/100 [00:00<00:13,  7.34it/s]  4%|▍         | 4/100 [00:00<00:12,  7.53it/s]  5%|▌         | 5/100 [00:00<00:12,  7.60it/s]  6%|▌         | 6/100 [00:00<00:12,  7.61it/s]  7%|▋         | 7/100 [00:00<00:12,  7.67it/s]  8%|▊         | 8/100 [00:01<00:11,  7.71it/s]  9%|▉         | 9/100 [00:01<00:11,  7.75it/s] 10%|█         | 10/100 [00:01<00:11,  7.75it/s] 11%|█         | 11/100 [00:01<00:11,  7.76it/s] 12%|█▏        | 12/100 [00:01<00:11,  7.78it/s] 13%|█▎        | 13/100 [00:01<00:11,  7.78it/s] 14%|█▍        | 14/100 [00:01<00:11,  7.80it/s] 15%|█▌        | 15/100 [00:01<00:10,  7.78it/s] 16%|█▌        | 16/100 [00:02<00:10,  7.78it/s] 17%|█▋        | 17/100 [00:02<00:10,  7.78it/s] 18%|█▊        | 18/100 [00:02<00:10,  7.74it/s] 19%|█▉        | 19/100 [00:02<00:10,  7.77it/s] 20%|██        | 20/100 [00:02<00:10,  7.76it/s] 21%|██        | 21/100 [00:02<00:10,  7.77it/s] 22%|██▏       | 22/100 [00:02<00:10,  7.78it/s] 23%|██▎       | 23/100 [00:02<00:09,  7.78it/s] 24%|██▍       | 24/100 [00:03<00:09,  7.80it/s] 25%|██▌       | 25/100 [00:03<00:09,  7.79it/s] 26%|██▌       | 26/100 [00:03<00:09,  7.79it/s] 27%|██▋       | 27/100 [00:03<00:09,  7.79it/s] 28%|██▊       | 28/100 [00:03<00:09,  7.79it/s] 29%|██▉       | 29/100 [00:03<00:09,  7.77it/s] 30%|███       | 30/100 [00:03<00:09,  7.76it/s] 31%|███       | 31/100 [00:04<00:08,  7.77it/s] 32%|███▏      | 32/100 [00:04<00:08,  7.77it/s] 33%|███▎      | 33/100 [00:04<00:08,  7.78it/s] 34%|███▍      | 34/100 [00:04<00:08,  7.80it/s] 35%|███▌      | 35/100 [00:04<00:08,  7.78it/s] 36%|███▌      | 36/100 [00:04<00:08,  7.79it/s] 37%|███▋      | 37/100 [00:04<00:08,  7.79it/s] 38%|███▊      | 38/100 [00:04<00:07,  7.79it/s] 39%|███▉      | 39/100 [00:05<00:07,  7.80it/s] 40%|████      | 40/100 [00:05<00:08,  7.45it/s] 41%|████      | 41/100 [00:05<00:07,  7.49it/s] 42%|████▏     | 42/100 [00:05<00:07,  7.59it/s] 43%|████▎     | 43/100 [00:05<00:07,  7.64it/s] 44%|████▍     | 44/100 [00:05<00:07,  7.70it/s] 45%|████▌     | 45/100 [00:05<00:07,  7.72it/s] 46%|████▌     | 46/100 [00:05<00:06,  7.74it/s] 47%|████▋     | 47/100 [00:06<00:06,  7.76it/s] 48%|████▊     | 48/100 [00:06<00:06,  7.70it/s] 49%|████▉     | 49/100 [00:06<00:06,  7.68it/s] 50%|█████     | 50/100 [00:06<00:06,  7.70it/s] 51%|█████     | 51/100 [00:06<00:06,  7.73it/s] 52%|█████▏    | 52/100 [00:06<00:06,  7.76it/s] 53%|█████▎    | 53/100 [00:06<00:06,  7.77it/s] 54%|█████▍    | 54/100 [00:07<00:05,  7.77it/s] 55%|█████▌    | 55/100 [00:07<00:05,  7.76it/s] 56%|█████▌    | 56/100 [00:07<00:05,  7.66it/s] 57%|█████▋    | 57/100 [00:07<00:05,  7.47it/s] 58%|█████▊    | 58/100 [00:07<00:05,  7.54it/s] 59%|█████▉    | 59/100 [00:07<00:05,  7.58it/s] 60%|██████    | 60/100 [00:07<00:05,  7.59it/s] 61%|██████    | 61/100 [00:07<00:05,  7.64it/s] 62%|██████▏   | 62/100 [00:08<00:04,  7.65it/s] 63%|██████▎   | 63/100 [00:08<00:04,  7.67it/s] 64%|██████▍   | 64/100 [00:08<00:04,  7.68it/s] 65%|██████▌   | 65/100 [00:08<00:04,  7.67it/s] 66%|██████▌   | 66/100 [00:08<00:04,  7.70it/s] 67%|██████▋   | 67/100 [00:08<00:04,  7.67it/s] 68%|██████▊   | 68/100 [00:08<00:04,  7.66it/s] 69%|██████▉   | 69/100 [00:08<00:04,  7.69it/s] 70%|███████   | 70/100 [00:09<00:03,  7.70it/s] 71%|███████   | 71/100 [00:09<00:03,  7.71it/s] 72%|███████▏  | 72/100 [00:09<00:03,  7.72it/s] 73%|███████▎  | 73/100 [00:09<00:03,  7.73it/s] 74%|███████▍  | 74/100 [00:09<00:03,  7.76it/s] 75%|███████▌  | 75/100 [00:09<00:03,  7.75it/s] 76%|███████▌  | 76/100 [00:09<00:03,  7.76it/s] 77%|███████▋  | 77/100 [00:10<00:03,  7.65it/s] 78%|███████▊  | 78/100 [00:10<00:02,  7.67it/s] 79%|███████▉  | 79/100 [00:10<00:02,  7.70it/s] 80%|████████  | 80/100 [00:10<00:02,  7.65it/s] 81%|████████  | 81/100 [00:10<00:02,  7.68it/s] 82%|████████▏ | 82/100 [00:10<00:02,  7.70it/s] 83%|████████▎ | 83/100 [00:10<00:02,  7.69it/s] 84%|████████▍ | 84/100 [00:10<00:02,  7.70it/s] 85%|████████▌ | 85/100 [00:11<00:01,  7.69it/s] 86%|████████▌ | 86/100 [00:11<00:01,  7.66it/s] 87%|████████▋ | 87/100 [00:11<00:01,  7.67it/s] 88%|████████▊ | 88/100 [00:11<00:01,  7.63it/s] 89%|████████▉ | 89/100 [00:11<00:01,  7.63it/s] 90%|█████████ | 90/100 [00:11<00:01,  7.65it/s] 91%|█████████ | 91/100 [00:11<00:01,  7.65it/s] 92%|█████████▏| 92/100 [00:11<00:01,  7.69it/s] 93%|█████████▎| 93/100 [00:12<00:00,  7.69it/s] 94%|█████████▍| 94/100 [00:12<00:00,  7.72it/s] 95%|█████████▌| 95/100 [00:12<00:00,  7.72it/s] 96%|█████████▌| 96/100 [00:12<00:00,  7.54it/s] 97%|█████████▋| 97/100 [00:12<00:00,  7.58it/s] 98%|█████████▊| 98/100 [00:12<00:00,  7.61it/s] 99%|█████████▉| 99/100 [00:12<00:00,  7.64it/s]100%|██████████| 100/100 [00:13<00:00,  7.55it/s]100%|██████████| 100/100 [00:13<00:00,  7.68it/s]
FOLD 0
Metric    CE Loss  KL wrt Orig
Model                         
llama_7B  3.63127     1.436845
Running fold 1
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:30,  1.03it/s]  6%|▋         | 2/32 [00:02<00:33,  1.10s/it]  9%|▉         | 3/32 [00:03<00:34,  1.19s/it] 12%|█▎        | 4/32 [00:04<00:33,  1.20s/it] 16%|█▌        | 5/32 [00:05<00:33,  1.23s/it] 19%|█▉        | 6/32 [00:07<00:33,  1.27s/it] 22%|██▏       | 7/32 [00:08<00:32,  1.29s/it] 25%|██▌       | 8/32 [00:09<00:30,  1.29s/it] 28%|██▊       | 9/32 [00:11<00:29,  1.29s/it] 31%|███▏      | 10/32 [00:12<00:28,  1.29s/it] 34%|███▍      | 11/32 [00:13<00:26,  1.28s/it] 38%|███▊      | 12/32 [00:14<00:25,  1.25s/it] 41%|████      | 13/32 [00:16<00:23,  1.24s/it] 44%|████▍     | 14/32 [00:17<00:22,  1.24s/it] 47%|████▋     | 15/32 [00:18<00:20,  1.23s/it] 50%|█████     | 16/32 [00:19<00:19,  1.24s/it] 53%|█████▎    | 17/32 [00:21<00:18,  1.23s/it] 56%|█████▋    | 18/32 [00:22<00:17,  1.23s/it] 59%|█████▉    | 19/32 [00:23<00:16,  1.26s/it] 62%|██████▎   | 20/32 [00:25<00:15,  1.30s/it] 66%|██████▌   | 21/32 [00:26<00:14,  1.30s/it] 69%|██████▉   | 22/32 [00:27<00:13,  1.30s/it] 72%|███████▏  | 23/32 [00:28<00:11,  1.31s/it] 75%|███████▌  | 24/32 [00:30<00:10,  1.34s/it] 78%|███████▊  | 25/32 [00:31<00:09,  1.34s/it] 81%|████████▏ | 26/32 [00:33<00:07,  1.33s/it] 84%|████████▍ | 27/32 [00:34<00:06,  1.34s/it] 88%|████████▊ | 28/32 [00:35<00:05,  1.33s/it] 91%|█████████ | 29/32 [00:37<00:04,  1.34s/it] 94%|█████████▍| 30/32 [00:38<00:02,  1.33s/it] 97%|█████████▋| 31/32 [00:39<00:01,  1.33s/it]100%|██████████| 32/32 [00:41<00:00,  1.38s/it]100%|██████████| 32/32 [00:41<00:00,  1.29s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
[[0.666 0.672 0.662 ... 0.668 0.662 0.67 ]
 [0.662 0.662 0.659 ... 0.677 0.666 0.663]
 [0.668 0.67  0.68  ... 0.661 0.665 0.671]
 ...
 [0.758 0.75  0.674 ... 0.716 0.694 0.677]
 [0.749 0.671 0.686 ... 0.674 0.762 0.76 ]
 [0.765 0.805 0.748 ... 0.743 0.787 0.775]]
Heads intervened:  [(8, 16), (11, 17), (12, 4), (13, 8), (13, 16), (16, 17), (17, 13), (17, 29), (18, 29), (19, 17), (20, 30), (23, 3)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 260.95it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-30ec7b2da7888791.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-4e53eea82b0ecfef.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  2%|▏         | 2/100 [00:00<00:05, 16.85it/s]  4%|▍         | 4/100 [00:00<00:05, 17.97it/s]  6%|▌         | 6/100 [00:00<00:05, 18.37it/s]  8%|▊         | 8/100 [00:00<00:04, 18.57it/s] 10%|█         | 10/100 [00:00<00:04, 18.68it/s] 12%|█▏        | 12/100 [00:00<00:04, 18.75it/s] 14%|█▍        | 14/100 [00:00<00:04, 18.78it/s] 16%|█▌        | 16/100 [00:00<00:04, 18.81it/s] 18%|█▊        | 18/100 [00:00<00:04, 18.83it/s] 20%|██        | 20/100 [00:01<00:04, 18.85it/s] 22%|██▏       | 22/100 [00:01<00:04, 18.85it/s] 24%|██▍       | 24/100 [00:01<00:04, 18.54it/s] 26%|██▌       | 26/100 [00:01<00:03, 18.60it/s] 28%|██▊       | 28/100 [00:01<00:03, 18.66it/s] 30%|███       | 30/100 [00:01<00:03, 18.72it/s] 32%|███▏      | 32/100 [00:01<00:03, 18.76it/s] 34%|███▍      | 34/100 [00:01<00:03, 18.79it/s] 36%|███▌      | 36/100 [00:01<00:03, 18.82it/s] 38%|███▊      | 38/100 [00:02<00:03, 18.83it/s] 40%|████      | 40/100 [00:02<00:03, 18.84it/s] 42%|████▏     | 42/100 [00:02<00:03, 18.85it/s] 44%|████▍     | 44/100 [00:02<00:02, 18.84it/s] 46%|████▌     | 46/100 [00:02<00:02, 18.84it/s] 48%|████▊     | 48/100 [00:02<00:02, 18.86it/s] 50%|█████     | 50/100 [00:02<00:02, 18.85it/s] 52%|█████▏    | 52/100 [00:02<00:02, 18.86it/s] 54%|█████▍    | 54/100 [00:02<00:02, 18.86it/s] 56%|█████▌    | 56/100 [00:02<00:02, 18.86it/s] 58%|█████▊    | 58/100 [00:03<00:02, 18.85it/s] 60%|██████    | 60/100 [00:03<00:02, 18.85it/s] 62%|██████▏   | 62/100 [00:03<00:02, 18.71it/s] 64%|██████▍   | 64/100 [00:03<00:01, 18.57it/s] 66%|██████▌   | 66/100 [00:03<00:01, 18.65it/s] 68%|██████▊   | 68/100 [00:03<00:01, 18.73it/s] 70%|███████   | 70/100 [00:03<00:01, 18.78it/s] 72%|███████▏  | 72/100 [00:03<00:01, 18.81it/s] 74%|███████▍  | 74/100 [00:03<00:01, 18.84it/s] 76%|███████▌  | 76/100 [00:04<00:01, 18.84it/s] 78%|███████▊  | 78/100 [00:04<00:01, 18.86it/s] 80%|████████  | 80/100 [00:04<00:01, 18.86it/s] 82%|████████▏ | 82/100 [00:04<00:00, 18.87it/s] 84%|████████▍ | 84/100 [00:04<00:00, 18.87it/s] 86%|████████▌ | 86/100 [00:04<00:00, 18.87it/s] 88%|████████▊ | 88/100 [00:04<00:00, 18.87it/s] 90%|█████████ | 90/100 [00:04<00:00, 18.87it/s] 92%|█████████▏| 92/100 [00:04<00:00, 18.89it/s] 94%|█████████▍| 94/100 [00:05<00:00, 18.88it/s] 96%|█████████▌| 96/100 [00:05<00:00, 18.88it/s] 98%|█████████▊| 98/100 [00:05<00:00, 18.87it/s]100%|██████████| 100/100 [00:05<00:00, 18.85it/s]100%|██████████| 100/100 [00:05<00:00, 18.77it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 355.60it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-14295f39edd20556.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-10ca04ba0c7bb427.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:16,  5.96it/s]  2%|▏         | 2/100 [00:00<00:14,  6.74it/s]  3%|▎         | 3/100 [00:00<00:13,  7.13it/s]  4%|▍         | 4/100 [00:00<00:12,  7.41it/s]  5%|▌         | 5/100 [00:00<00:12,  7.54it/s]  6%|▌         | 6/100 [00:00<00:12,  7.63it/s]  7%|▋         | 7/100 [00:00<00:12,  7.70it/s]  8%|▊         | 8/100 [00:01<00:11,  7.74it/s]  9%|▉         | 9/100 [00:01<00:11,  7.78it/s] 10%|█         | 10/100 [00:01<00:11,  7.78it/s] 11%|█         | 11/100 [00:01<00:11,  7.79it/s] 12%|█▏        | 12/100 [00:01<00:11,  7.80it/s] 13%|█▎        | 13/100 [00:01<00:11,  7.81it/s] 14%|█▍        | 14/100 [00:01<00:10,  7.83it/s] 15%|█▌        | 15/100 [00:01<00:10,  7.80it/s] 16%|█▌        | 16/100 [00:02<00:10,  7.80it/s] 17%|█▋        | 17/100 [00:02<00:10,  7.81it/s] 18%|█▊        | 18/100 [00:02<00:10,  7.77it/s] 19%|█▉        | 19/100 [00:02<00:10,  7.78it/s] 20%|██        | 20/100 [00:02<00:10,  7.77it/s] 21%|██        | 21/100 [00:02<00:10,  7.79it/s] 22%|██▏       | 22/100 [00:02<00:09,  7.80it/s] 23%|██▎       | 23/100 [00:02<00:09,  7.80it/s] 24%|██▍       | 24/100 [00:03<00:09,  7.81it/s] 25%|██▌       | 25/100 [00:03<00:09,  7.80it/s] 26%|██▌       | 26/100 [00:03<00:09,  7.81it/s] 27%|██▋       | 27/100 [00:03<00:09,  7.81it/s] 28%|██▊       | 28/100 [00:03<00:09,  7.81it/s] 29%|██▉       | 29/100 [00:03<00:09,  7.83it/s] 30%|███       | 30/100 [00:03<00:08,  7.81it/s] 31%|███       | 31/100 [00:04<00:08,  7.81it/s] 32%|███▏      | 32/100 [00:04<00:08,  7.82it/s] 33%|███▎      | 33/100 [00:04<00:08,  7.81it/s] 34%|███▍      | 34/100 [00:04<00:08,  7.82it/s] 35%|███▌      | 35/100 [00:04<00:08,  7.76it/s] 36%|███▌      | 36/100 [00:04<00:08,  7.78it/s] 37%|███▋      | 37/100 [00:04<00:08,  7.80it/s] 38%|███▊      | 38/100 [00:04<00:07,  7.80it/s] 39%|███▉      | 39/100 [00:05<00:07,  7.82it/s] 40%|████      | 40/100 [00:05<00:07,  7.80it/s] 41%|████      | 41/100 [00:05<00:07,  7.80it/s] 42%|████▏     | 42/100 [00:05<00:07,  7.81it/s] 43%|████▎     | 43/100 [00:05<00:07,  7.81it/s] 44%|████▍     | 44/100 [00:05<00:07,  7.82it/s] 45%|████▌     | 45/100 [00:05<00:07,  7.81it/s] 46%|████▌     | 46/100 [00:05<00:06,  7.81it/s] 47%|████▋     | 47/100 [00:06<00:06,  7.82it/s] 48%|████▊     | 48/100 [00:06<00:06,  7.81it/s] 49%|████▉     | 49/100 [00:06<00:06,  7.83it/s] 50%|█████     | 50/100 [00:06<00:06,  7.81it/s] 51%|█████     | 51/100 [00:06<00:06,  7.73it/s] 52%|█████▏    | 52/100 [00:06<00:06,  7.76it/s] 53%|█████▎    | 53/100 [00:06<00:06,  7.78it/s] 54%|█████▍    | 54/100 [00:06<00:05,  7.80it/s] 55%|█████▌    | 55/100 [00:07<00:05,  7.78it/s] 56%|█████▌    | 56/100 [00:07<00:05,  7.79it/s] 57%|█████▋    | 57/100 [00:07<00:05,  7.46it/s] 58%|█████▊    | 58/100 [00:07<00:05,  7.55it/s] 59%|█████▉    | 59/100 [00:07<00:05,  7.64it/s] 60%|██████    | 60/100 [00:07<00:05,  7.67it/s] 61%|██████    | 61/100 [00:07<00:05,  7.72it/s] 62%|██████▏   | 62/100 [00:08<00:04,  7.75it/s] 63%|██████▎   | 63/100 [00:08<00:04,  7.76it/s] 64%|██████▍   | 64/100 [00:08<00:04,  7.78it/s] 65%|██████▌   | 65/100 [00:08<00:04,  7.78it/s] 66%|██████▌   | 66/100 [00:08<00:04,  7.79it/s] 67%|██████▋   | 67/100 [00:08<00:04,  7.70it/s] 68%|██████▊   | 68/100 [00:08<00:04,  7.73it/s] 69%|██████▉   | 69/100 [00:08<00:03,  7.77it/s] 70%|███████   | 70/100 [00:09<00:03,  7.77it/s] 71%|███████   | 71/100 [00:09<00:03,  7.78it/s] 72%|███████▏  | 72/100 [00:09<00:03,  7.80it/s] 73%|███████▎  | 73/100 [00:09<00:03,  7.80it/s] 74%|███████▍  | 74/100 [00:09<00:03,  7.79it/s] 75%|███████▌  | 75/100 [00:09<00:03,  7.79it/s] 76%|███████▌  | 76/100 [00:09<00:03,  7.79it/s] 77%|███████▋  | 77/100 [00:09<00:02,  7.81it/s] 78%|███████▊  | 78/100 [00:10<00:02,  7.80it/s] 79%|███████▉  | 79/100 [00:10<00:02,  7.82it/s] 80%|████████  | 80/100 [00:10<00:02,  7.80it/s] 81%|████████  | 81/100 [00:10<00:02,  7.81it/s] 82%|████████▏ | 82/100 [00:10<00:02,  7.81it/s] 83%|████████▎ | 83/100 [00:10<00:02,  7.59it/s] 84%|████████▍ | 84/100 [00:10<00:02,  7.65it/s] 85%|████████▌ | 85/100 [00:10<00:01,  7.67it/s] 86%|████████▌ | 86/100 [00:11<00:01,  7.71it/s] 87%|████████▋ | 87/100 [00:11<00:01,  7.74it/s] 88%|████████▊ | 88/100 [00:11<00:01,  7.76it/s] 89%|████████▉ | 89/100 [00:11<00:01,  7.79it/s] 90%|█████████ | 90/100 [00:11<00:01,  7.78it/s] 91%|█████████ | 91/100 [00:11<00:01,  7.79it/s] 92%|█████████▏| 92/100 [00:11<00:01,  7.80it/s] 93%|█████████▎| 93/100 [00:12<00:00,  7.80it/s] 94%|█████████▍| 94/100 [00:12<00:00,  7.79it/s] 95%|█████████▌| 95/100 [00:12<00:00,  7.78it/s] 96%|█████████▌| 96/100 [00:12<00:00,  7.79it/s] 97%|█████████▋| 97/100 [00:12<00:00,  7.80it/s] 98%|█████████▊| 98/100 [00:12<00:00,  7.80it/s] 99%|█████████▉| 99/100 [00:12<00:00,  7.81it/s]100%|██████████| 100/100 [00:12<00:00,  7.79it/s]100%|██████████| 100/100 [00:12<00:00,  7.75it/s]
FOLD 1
Metric     CE Loss  KL wrt Orig
Model                          
llama_7B  3.772012     1.721595
[3.70164063 1.57922012]
2023-12-04 01:11:59.301422: I tensorflow/core/util/port.cc:110] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2023-12-04 01:11:59.352021: I tensorflow/core/platform/cpu_feature_guard.cc:182] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-12-04 01:12:00.101338: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Could not find TensorRT
Found cached dataset truthful_qa (/home/elicer/.cache/huggingface/datasets/truthful_qa/multiple_choice/1.1.0/63502f6bc6ee493830ce0843991b028d0ab568d221896b2ee3b8a5dfdaa9d7f4)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 374.66it/s]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:00<00:00,  5.16it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  6.21it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  6.02it/s]
head_wise_activation_length:(11012, 32, 4096)
labels_shape:(11012,)
seperated_head_activation shape:11013
Running fold 0
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:28,  1.08it/s]  6%|▋         | 2/32 [00:01<00:28,  1.06it/s]  9%|▉         | 3/32 [00:02<00:26,  1.08it/s] 12%|█▎        | 4/32 [00:03<00:25,  1.11it/s] 16%|█▌        | 5/32 [00:04<00:24,  1.10it/s] 19%|█▉        | 6/32 [00:05<00:23,  1.08it/s] 22%|██▏       | 7/32 [00:06<00:23,  1.07it/s] 25%|██▌       | 8/32 [00:07<00:23,  1.04it/s] 28%|██▊       | 9/32 [00:08<00:22,  1.02it/s] 31%|███▏      | 10/32 [00:09<00:22,  1.01s/it] 34%|███▍      | 11/32 [00:10<00:21,  1.03s/it] 38%|███▊      | 12/32 [00:11<00:20,  1.03s/it] 41%|████      | 13/32 [00:12<00:19,  1.04s/it] 44%|████▍     | 14/32 [00:13<00:19,  1.06s/it] 47%|████▋     | 15/32 [00:14<00:17,  1.05s/it] 50%|█████     | 16/32 [00:15<00:16,  1.05s/it] 53%|█████▎    | 17/32 [00:17<00:15,  1.06s/it] 56%|█████▋    | 18/32 [00:18<00:15,  1.07s/it] 59%|█████▉    | 19/32 [00:19<00:14,  1.10s/it] 62%|██████▎   | 20/32 [00:20<00:13,  1.11s/it] 66%|██████▌   | 21/32 [00:21<00:12,  1.13s/it] 69%|██████▉   | 22/32 [00:22<00:11,  1.11s/it] 72%|███████▏  | 23/32 [00:23<00:10,  1.14s/it] 75%|███████▌  | 24/32 [00:25<00:09,  1.19s/it] 78%|███████▊  | 25/32 [00:26<00:08,  1.17s/it] 81%|████████▏ | 26/32 [00:27<00:06,  1.16s/it] 84%|████████▍ | 27/32 [00:28<00:05,  1.19s/it] 88%|████████▊ | 28/32 [00:29<00:04,  1.14s/it] 91%|█████████ | 29/32 [00:30<00:03,  1.14s/it] 94%|█████████▍| 30/32 [00:31<00:02,  1.12s/it] 97%|█████████▋| 31/32 [00:33<00:01,  1.13s/it]100%|██████████| 32/32 [00:34<00:00,  1.22s/it]100%|██████████| 32/32 [00:34<00:00,  1.08s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
/home/elicer/honest_llama/validation/../TruthfulQA/truthfulqa/metrics.py:284: FutureWarning: load_metric is deprecated and will be removed in the next major version of datasets. Use 'evaluate.load' instead, from the new library 🤗 Evaluate: https://huggingface.co/docs/evaluate
  bleurt = load_metric("bleurt", cache_dir=cache_dir)
[[0.651 0.665 0.645 ... 0.646 0.647 0.652]
 [0.659 0.644 0.645 ... 0.648 0.658 0.656]
 [0.651 0.657 0.685 ... 0.637 0.648 0.667]
 ...
 [0.765 0.762 0.657 ... 0.73  0.704 0.674]
 [0.748 0.678 0.696 ... 0.663 0.769 0.786]
 [0.775 0.815 0.74  ... 0.697 0.809 0.79 ]]
Heads intervened:  [(8, 16), (12, 4), (12, 15), (13, 8), (13, 16), (15, 28), (16, 30), (17, 13), (17, 17), (17, 29), (18, 29), (19, 13), (19, 17), (20, 22), (20, 30), (22, 16), (22, 30), (23, 3), (23, 7), (23, 13), (25, 15), (31, 1), (31, 6), (31, 30)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
2023-12-04 01:12:50.483113: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1635] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 24961 MB memory:  -> device: 0, name: NVIDIA A100 80GB PCIe MIG 3g.40gb, pci bus id: 0000:65:00.0, compute capability: 8.0
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 289.18it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-ec0cf83741fdb3e8.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-d31e6c0c76fafb4d.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:01<01:43,  1.04s/it]  3%|▎         | 3/100 [00:01<00:30,  3.20it/s]  5%|▌         | 5/100 [00:01<00:17,  5.55it/s]  7%|▋         | 7/100 [00:01<00:11,  7.84it/s]  9%|▉         | 9/100 [00:01<00:09,  9.96it/s] 11%|█         | 11/100 [00:01<00:07, 11.79it/s] 13%|█▎        | 13/100 [00:01<00:06, 13.32it/s] 15%|█▌        | 15/100 [00:01<00:05, 14.53it/s] 17%|█▋        | 17/100 [00:01<00:05, 15.46it/s] 19%|█▉        | 19/100 [00:02<00:05, 16.16it/s] 21%|██        | 21/100 [00:02<00:04, 16.67it/s] 23%|██▎       | 23/100 [00:02<00:04, 17.05it/s] 25%|██▌       | 25/100 [00:02<00:04, 17.32it/s] 27%|██▋       | 27/100 [00:02<00:04, 17.51it/s] 29%|██▉       | 29/100 [00:02<00:04, 17.64it/s] 31%|███       | 31/100 [00:02<00:03, 17.74it/s] 33%|███▎      | 33/100 [00:02<00:03, 17.80it/s] 35%|███▌      | 35/100 [00:02<00:03, 17.85it/s] 37%|███▋      | 37/100 [00:03<00:03, 17.87it/s] 39%|███▉      | 39/100 [00:03<00:03, 17.90it/s] 41%|████      | 41/100 [00:03<00:03, 17.92it/s] 43%|████▎     | 43/100 [00:03<00:03, 17.94it/s] 45%|████▌     | 45/100 [00:03<00:03, 17.95it/s] 47%|████▋     | 47/100 [00:03<00:02, 17.96it/s] 49%|████▉     | 49/100 [00:03<00:02, 17.96it/s] 51%|█████     | 51/100 [00:03<00:02, 17.97it/s] 53%|█████▎    | 53/100 [00:03<00:02, 17.97it/s] 55%|█████▌    | 55/100 [00:04<00:02, 17.97it/s] 57%|█████▋    | 57/100 [00:04<00:02, 17.97it/s] 59%|█████▉    | 59/100 [00:04<00:02, 17.98it/s] 61%|██████    | 61/100 [00:04<00:02, 17.98it/s] 63%|██████▎   | 63/100 [00:04<00:02, 17.98it/s] 65%|██████▌   | 65/100 [00:04<00:01, 17.97it/s] 67%|██████▋   | 67/100 [00:04<00:01, 17.97it/s] 69%|██████▉   | 69/100 [00:04<00:01, 17.98it/s] 71%|███████   | 71/100 [00:04<00:01, 17.98it/s] 73%|███████▎  | 73/100 [00:05<00:01, 17.97it/s] 75%|███████▌  | 75/100 [00:05<00:01, 17.95it/s] 77%|███████▋  | 77/100 [00:05<00:01, 17.96it/s] 79%|███████▉  | 79/100 [00:05<00:01, 17.96it/s] 81%|████████  | 81/100 [00:05<00:01, 17.95it/s] 83%|████████▎ | 83/100 [00:05<00:00, 17.96it/s] 85%|████████▌ | 85/100 [00:05<00:00, 17.97it/s] 87%|████████▋ | 87/100 [00:05<00:00, 17.97it/s] 89%|████████▉ | 89/100 [00:05<00:00, 17.98it/s] 91%|█████████ | 91/100 [00:06<00:00, 17.98it/s] 93%|█████████▎| 93/100 [00:06<00:00, 17.98it/s] 95%|█████████▌| 95/100 [00:06<00:00, 17.98it/s] 97%|█████████▋| 97/100 [00:06<00:00, 17.99it/s] 99%|█████████▉| 99/100 [00:06<00:00, 17.98it/s]100%|██████████| 100/100 [00:06<00:00, 15.26it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 333.17it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-1939fcc1eeebdaa7.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-785bb4b6f2089589.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:16,  5.93it/s]  2%|▏         | 2/100 [00:00<00:14,  6.84it/s]  3%|▎         | 3/100 [00:00<00:13,  7.19it/s]  4%|▍         | 4/100 [00:00<00:12,  7.40it/s]  5%|▌         | 5/100 [00:00<00:12,  7.51it/s]  6%|▌         | 6/100 [00:00<00:12,  7.55it/s]  7%|▋         | 7/100 [00:00<00:12,  7.61it/s]  8%|▊         | 8/100 [00:01<00:12,  7.65it/s]  9%|▉         | 9/100 [00:01<00:11,  7.68it/s] 10%|█         | 10/100 [00:01<00:11,  7.69it/s] 11%|█         | 11/100 [00:01<00:11,  7.69it/s] 12%|█▏        | 12/100 [00:01<00:11,  7.72it/s] 13%|█▎        | 13/100 [00:01<00:11,  7.72it/s] 14%|█▍        | 14/100 [00:01<00:11,  7.73it/s] 15%|█▌        | 15/100 [00:01<00:11,  7.73it/s] 16%|█▌        | 16/100 [00:02<00:10,  7.72it/s] 17%|█▋        | 17/100 [00:02<00:10,  7.69it/s] 18%|█▊        | 18/100 [00:02<00:10,  7.67it/s] 19%|█▉        | 19/100 [00:02<00:10,  7.59it/s] 20%|██        | 20/100 [00:02<00:10,  7.62it/s] 21%|██        | 21/100 [00:02<00:10,  7.65it/s] 22%|██▏       | 22/100 [00:02<00:10,  7.68it/s] 23%|██▎       | 23/100 [00:03<00:10,  7.70it/s] 24%|██▍       | 24/100 [00:03<00:09,  7.71it/s] 25%|██▌       | 25/100 [00:03<00:09,  7.71it/s] 26%|██▌       | 26/100 [00:03<00:09,  7.71it/s] 27%|██▋       | 27/100 [00:03<00:09,  7.73it/s] 28%|██▊       | 28/100 [00:03<00:09,  7.68it/s] 29%|██▉       | 29/100 [00:03<00:09,  7.71it/s] 30%|███       | 30/100 [00:03<00:09,  7.71it/s] 31%|███       | 31/100 [00:04<00:08,  7.71it/s] 32%|███▏      | 32/100 [00:04<00:08,  7.72it/s] 33%|███▎      | 33/100 [00:04<00:08,  7.73it/s] 34%|███▍      | 34/100 [00:04<00:08,  7.73it/s] 35%|███▌      | 35/100 [00:04<00:08,  7.71it/s] 36%|███▌      | 36/100 [00:04<00:08,  7.71it/s] 37%|███▋      | 37/100 [00:04<00:08,  7.73it/s] 38%|███▊      | 38/100 [00:04<00:08,  7.73it/s] 39%|███▉      | 39/100 [00:05<00:07,  7.68it/s] 40%|████      | 40/100 [00:05<00:07,  7.69it/s] 41%|████      | 41/100 [00:05<00:07,  7.69it/s] 42%|████▏     | 42/100 [00:05<00:07,  7.71it/s] 43%|████▎     | 43/100 [00:05<00:07,  7.71it/s] 44%|████▍     | 44/100 [00:05<00:07,  7.72it/s] 45%|████▌     | 45/100 [00:05<00:07,  7.72it/s] 46%|████▌     | 46/100 [00:06<00:06,  7.72it/s] 47%|████▋     | 47/100 [00:06<00:06,  7.73it/s] 48%|████▊     | 48/100 [00:06<00:06,  7.73it/s] 49%|████▉     | 49/100 [00:06<00:06,  7.74it/s] 50%|█████     | 50/100 [00:06<00:06,  7.48it/s] 51%|█████     | 51/100 [00:06<00:06,  7.40it/s] 52%|█████▏    | 52/100 [00:06<00:06,  7.50it/s] 53%|█████▎    | 53/100 [00:06<00:06,  7.57it/s] 54%|█████▍    | 54/100 [00:07<00:06,  7.62it/s] 55%|█████▌    | 55/100 [00:07<00:05,  7.65it/s] 56%|█████▌    | 56/100 [00:07<00:05,  7.66it/s] 57%|█████▋    | 57/100 [00:07<00:05,  7.69it/s] 58%|█████▊    | 58/100 [00:07<00:05,  7.70it/s] 59%|█████▉    | 59/100 [00:07<00:05,  7.72it/s] 60%|██████    | 60/100 [00:07<00:05,  7.71it/s] 61%|██████    | 61/100 [00:07<00:05,  7.71it/s] 62%|██████▏   | 62/100 [00:08<00:04,  7.73it/s] 63%|██████▎   | 63/100 [00:08<00:04,  7.72it/s] 64%|██████▍   | 64/100 [00:08<00:04,  7.73it/s] 65%|██████▌   | 65/100 [00:08<00:04,  7.72it/s] 66%|██████▌   | 66/100 [00:08<00:04,  7.71it/s] 67%|██████▋   | 67/100 [00:08<00:04,  7.72it/s] 68%|██████▊   | 68/100 [00:08<00:04,  7.72it/s] 69%|██████▉   | 69/100 [00:09<00:04,  7.73it/s] 70%|███████   | 70/100 [00:09<00:03,  7.72it/s] 71%|███████   | 71/100 [00:09<00:03,  7.71it/s] 72%|███████▏  | 72/100 [00:09<00:03,  7.73it/s] 73%|███████▎  | 73/100 [00:09<00:03,  7.73it/s] 74%|███████▍  | 74/100 [00:09<00:03,  7.73it/s] 75%|███████▌  | 75/100 [00:09<00:03,  7.73it/s] 76%|███████▌  | 76/100 [00:09<00:03,  7.72it/s] 77%|███████▋  | 77/100 [00:10<00:02,  7.73it/s] 78%|███████▊  | 78/100 [00:10<00:02,  7.73it/s] 79%|███████▉  | 79/100 [00:10<00:02,  7.74it/s] 80%|████████  | 80/100 [00:10<00:02,  7.72it/s] 81%|████████  | 81/100 [00:10<00:02,  7.72it/s] 82%|████████▏ | 82/100 [00:10<00:02,  7.72it/s] 83%|████████▎ | 83/100 [00:10<00:02,  7.72it/s] 84%|████████▍ | 84/100 [00:10<00:02,  7.73it/s] 85%|████████▌ | 85/100 [00:11<00:01,  7.72it/s] 86%|████████▌ | 86/100 [00:11<00:01,  7.72it/s] 87%|████████▋ | 87/100 [00:11<00:01,  7.73it/s] 88%|████████▊ | 88/100 [00:11<00:01,  7.73it/s] 89%|████████▉ | 89/100 [00:11<00:01,  7.73it/s] 90%|█████████ | 90/100 [00:11<00:01,  7.72it/s] 91%|█████████ | 91/100 [00:11<00:01,  7.72it/s] 92%|█████████▏| 92/100 [00:11<00:01,  7.73it/s] 93%|█████████▎| 93/100 [00:12<00:00,  7.73it/s] 94%|█████████▍| 94/100 [00:12<00:00,  7.74it/s] 95%|█████████▌| 95/100 [00:12<00:00,  7.72it/s] 96%|█████████▌| 96/100 [00:12<00:00,  7.72it/s] 97%|█████████▋| 97/100 [00:12<00:00,  7.73it/s] 98%|█████████▊| 98/100 [00:12<00:00,  7.66it/s] 99%|█████████▉| 99/100 [00:12<00:00,  7.59it/s]100%|██████████| 100/100 [00:13<00:00,  7.63it/s]100%|██████████| 100/100 [00:13<00:00,  7.67it/s]
FOLD 0
Metric     CE Loss  KL wrt Orig
Model                          
llama_7B  3.860313     1.672035
Running fold 1
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:29,  1.05it/s]  6%|▋         | 2/32 [00:02<00:32,  1.09s/it]  9%|▉         | 3/32 [00:03<00:33,  1.17s/it] 12%|█▎        | 4/32 [00:04<00:33,  1.18s/it] 16%|█▌        | 5/32 [00:05<00:32,  1.22s/it] 19%|█▉        | 6/32 [00:07<00:32,  1.25s/it] 22%|██▏       | 7/32 [00:08<00:31,  1.26s/it] 25%|██▌       | 8/32 [00:09<00:30,  1.25s/it] 28%|██▊       | 9/32 [00:10<00:28,  1.25s/it] 31%|███▏      | 10/32 [00:12<00:27,  1.26s/it] 34%|███▍      | 11/32 [00:13<00:26,  1.24s/it] 38%|███▊      | 12/32 [00:14<00:24,  1.22s/it] 41%|████      | 13/32 [00:15<00:22,  1.21s/it] 44%|████▍     | 14/32 [00:16<00:21,  1.20s/it] 47%|████▋     | 15/32 [00:18<00:20,  1.20s/it] 50%|█████     | 16/32 [00:19<00:19,  1.21s/it] 53%|█████▎    | 17/32 [00:20<00:18,  1.20s/it] 56%|█████▋    | 18/32 [00:21<00:16,  1.20s/it] 59%|█████▉    | 19/32 [00:23<00:15,  1.23s/it] 62%|██████▎   | 20/32 [00:24<00:15,  1.26s/it] 66%|██████▌   | 21/32 [00:25<00:13,  1.27s/it] 69%|██████▉   | 22/32 [00:26<00:12,  1.26s/it] 72%|███████▏  | 23/32 [00:28<00:11,  1.27s/it] 75%|███████▌  | 24/32 [00:29<00:10,  1.29s/it] 78%|███████▊  | 25/32 [00:30<00:09,  1.29s/it] 81%|████████▏ | 26/32 [00:32<00:07,  1.28s/it] 84%|████████▍ | 27/32 [00:33<00:06,  1.29s/it] 88%|████████▊ | 28/32 [00:34<00:05,  1.28s/it] 91%|█████████ | 29/32 [00:35<00:03,  1.28s/it] 94%|█████████▍| 30/32 [00:37<00:02,  1.28s/it] 97%|█████████▋| 31/32 [00:38<00:01,  1.28s/it]100%|██████████| 32/32 [00:39<00:00,  1.34s/it]100%|██████████| 32/32 [00:39<00:00,  1.25s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
[[0.666 0.672 0.662 ... 0.668 0.662 0.67 ]
 [0.662 0.662 0.659 ... 0.677 0.666 0.663]
 [0.668 0.67  0.68  ... 0.661 0.665 0.671]
 ...
 [0.758 0.75  0.674 ... 0.716 0.694 0.677]
 [0.749 0.671 0.686 ... 0.674 0.762 0.76 ]
 [0.765 0.805 0.748 ... 0.743 0.787 0.775]]
Heads intervened:  [(8, 16), (11, 16), (11, 17), (12, 4), (13, 8), (13, 10), (13, 16), (13, 21), (16, 17), (16, 26), (16, 30), (17, 13), (17, 19), (17, 29), (18, 29), (19, 13), (19, 17), (19, 31), (20, 22), (20, 30), (22, 16), (23, 3), (23, 12), (31, 6)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 259.39it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-30ec7b2da7888791.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-4e53eea82b0ecfef.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  2%|▏         | 2/100 [00:00<00:06, 16.29it/s]  4%|▍         | 4/100 [00:00<00:05, 16.88it/s]  6%|▌         | 6/100 [00:00<00:05, 17.29it/s]  8%|▊         | 8/100 [00:00<00:05, 16.87it/s] 10%|█         | 10/100 [00:00<00:05, 17.25it/s] 12%|█▏        | 12/100 [00:00<00:05, 17.50it/s] 14%|█▍        | 14/100 [00:00<00:04, 17.68it/s] 16%|█▌        | 16/100 [00:00<00:04, 17.81it/s] 18%|█▊        | 18/100 [00:01<00:04, 17.87it/s] 20%|██        | 20/100 [00:01<00:04, 17.91it/s] 22%|██▏       | 22/100 [00:01<00:04, 17.94it/s] 24%|██▍       | 24/100 [00:01<00:04, 17.95it/s] 26%|██▌       | 26/100 [00:01<00:04, 17.96it/s] 28%|██▊       | 28/100 [00:01<00:04, 17.46it/s] 30%|███       | 30/100 [00:01<00:04, 17.35it/s] 32%|███▏      | 32/100 [00:01<00:03, 17.54it/s] 34%|███▍      | 34/100 [00:01<00:03, 17.64it/s] 36%|███▌      | 36/100 [00:02<00:03, 17.71it/s] 38%|███▊      | 38/100 [00:02<00:03, 17.80it/s] 40%|████      | 40/100 [00:02<00:03, 17.83it/s] 42%|████▏     | 42/100 [00:02<00:03, 17.88it/s] 44%|████▍     | 44/100 [00:02<00:03, 17.89it/s] 46%|████▌     | 46/100 [00:02<00:03, 17.90it/s] 48%|████▊     | 48/100 [00:02<00:02, 17.93it/s] 50%|█████     | 50/100 [00:02<00:02, 17.92it/s] 52%|█████▏    | 52/100 [00:02<00:02, 17.96it/s] 54%|█████▍    | 54/100 [00:03<00:02, 17.88it/s] 56%|█████▌    | 56/100 [00:03<00:02, 17.89it/s] 58%|█████▊    | 58/100 [00:03<00:02, 17.85it/s] 60%|██████    | 60/100 [00:03<00:02, 17.84it/s] 62%|██████▏   | 62/100 [00:03<00:02, 17.83it/s] 64%|██████▍   | 64/100 [00:03<00:02, 17.84it/s] 66%|██████▌   | 66/100 [00:03<00:01, 17.82it/s] 68%|██████▊   | 68/100 [00:03<00:01, 17.81it/s] 70%|███████   | 70/100 [00:03<00:01, 17.90it/s] 72%|███████▏  | 72/100 [00:04<00:01, 17.97it/s] 74%|███████▍  | 74/100 [00:04<00:01, 18.03it/s] 76%|███████▌  | 76/100 [00:04<00:01, 18.06it/s] 78%|███████▊  | 78/100 [00:04<00:01, 17.89it/s] 80%|████████  | 80/100 [00:04<00:01, 17.81it/s] 82%|████████▏ | 82/100 [00:04<00:01, 17.65it/s] 84%|████████▍ | 84/100 [00:04<00:00, 17.76it/s] 86%|████████▌ | 86/100 [00:04<00:00, 17.83it/s] 88%|████████▊ | 88/100 [00:04<00:00, 17.89it/s] 90%|█████████ | 90/100 [00:05<00:00, 17.94it/s] 92%|█████████▏| 92/100 [00:05<00:00, 17.92it/s] 94%|█████████▍| 94/100 [00:05<00:00, 17.81it/s] 96%|█████████▌| 96/100 [00:05<00:00, 17.89it/s] 98%|█████████▊| 98/100 [00:05<00:00, 17.82it/s]100%|██████████| 100/100 [00:05<00:00, 17.69it/s]100%|██████████| 100/100 [00:05<00:00, 17.76it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 340.56it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-14295f39edd20556.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-10ca04ba0c7bb427.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:17,  5.63it/s]  2%|▏         | 2/100 [00:00<00:15,  6.24it/s]  3%|▎         | 3/100 [00:00<00:14,  6.69it/s]  4%|▍         | 4/100 [00:00<00:14,  6.83it/s]  5%|▌         | 5/100 [00:00<00:13,  6.91it/s]  6%|▌         | 6/100 [00:00<00:13,  7.07it/s]  7%|▋         | 7/100 [00:01<00:13,  6.95it/s]  8%|▊         | 8/100 [00:01<00:13,  6.80it/s]  9%|▉         | 9/100 [00:01<00:12,  7.04it/s] 10%|█         | 10/100 [00:01<00:12,  6.95it/s] 11%|█         | 11/100 [00:01<00:12,  7.06it/s] 12%|█▏        | 12/100 [00:01<00:12,  7.16it/s] 13%|█▎        | 13/100 [00:01<00:12,  7.14it/s] 14%|█▍        | 14/100 [00:02<00:11,  7.26it/s] 15%|█▌        | 15/100 [00:02<00:11,  7.40it/s] 16%|█▌        | 16/100 [00:02<00:11,  7.14it/s] 17%|█▋        | 17/100 [00:02<00:12,  6.89it/s] 18%|█▊        | 18/100 [00:02<00:11,  7.05it/s] 19%|█▉        | 19/100 [00:02<00:11,  7.17it/s] 20%|██        | 20/100 [00:02<00:11,  6.97it/s] 21%|██        | 21/100 [00:03<00:11,  6.98it/s] 22%|██▏       | 22/100 [00:03<00:11,  6.56it/s] 23%|██▎       | 23/100 [00:03<00:11,  6.55it/s] 24%|██▍       | 24/100 [00:03<00:11,  6.70it/s] 25%|██▌       | 25/100 [00:03<00:11,  6.79it/s] 26%|██▌       | 26/100 [00:03<00:10,  6.83it/s] 27%|██▋       | 27/100 [00:03<00:10,  6.97it/s] 28%|██▊       | 28/100 [00:04<00:10,  6.91it/s] 29%|██▉       | 29/100 [00:04<00:10,  6.90it/s] 30%|███       | 30/100 [00:04<00:10,  6.95it/s] 31%|███       | 31/100 [00:04<00:09,  6.97it/s] 32%|███▏      | 32/100 [00:04<00:09,  6.82it/s] 33%|███▎      | 33/100 [00:04<00:09,  6.75it/s] 34%|███▍      | 34/100 [00:04<00:09,  6.99it/s] 35%|███▌      | 35/100 [00:05<00:09,  6.83it/s] 36%|███▌      | 36/100 [00:05<00:09,  6.89it/s] 37%|███▋      | 37/100 [00:05<00:09,  6.81it/s] 38%|███▊      | 38/100 [00:05<00:08,  6.90it/s] 39%|███▉      | 39/100 [00:05<00:08,  7.08it/s] 40%|████      | 40/100 [00:05<00:08,  6.92it/s] 41%|████      | 41/100 [00:05<00:08,  7.04it/s] 42%|████▏     | 42/100 [00:06<00:08,  7.07it/s] 43%|████▎     | 43/100 [00:06<00:08,  7.00it/s] 44%|████▍     | 44/100 [00:06<00:07,  7.09it/s] 45%|████▌     | 45/100 [00:06<00:07,  6.89it/s] 46%|████▌     | 46/100 [00:06<00:07,  6.94it/s] 47%|████▋     | 47/100 [00:06<00:07,  6.93it/s] 48%|████▊     | 48/100 [00:06<00:07,  6.92it/s] 49%|████▉     | 49/100 [00:07<00:07,  7.00it/s] 50%|█████     | 50/100 [00:07<00:07,  6.85it/s] 51%|█████     | 51/100 [00:07<00:07,  6.89it/s] 52%|█████▏    | 52/100 [00:07<00:06,  7.12it/s] 53%|█████▎    | 53/100 [00:07<00:06,  7.27it/s] 54%|█████▍    | 54/100 [00:07<00:06,  7.00it/s] 55%|█████▌    | 55/100 [00:07<00:06,  6.58it/s] 56%|█████▌    | 56/100 [00:08<00:06,  6.78it/s] 57%|█████▋    | 57/100 [00:08<00:06,  6.90it/s] 58%|█████▊    | 58/100 [00:08<00:06,  6.96it/s] 59%|█████▉    | 59/100 [00:08<00:05,  7.09it/s] 60%|██████    | 60/100 [00:08<00:05,  7.07it/s] 61%|██████    | 61/100 [00:08<00:05,  7.21it/s] 62%|██████▏   | 62/100 [00:08<00:05,  7.30it/s] 63%|██████▎   | 63/100 [00:09<00:05,  7.19it/s] 64%|██████▍   | 64/100 [00:09<00:05,  7.15it/s] 65%|██████▌   | 65/100 [00:09<00:04,  7.06it/s] 66%|██████▌   | 66/100 [00:09<00:04,  6.94it/s] 67%|██████▋   | 67/100 [00:09<00:04,  6.95it/s] 68%|██████▊   | 68/100 [00:09<00:04,  6.93it/s] 69%|██████▉   | 69/100 [00:09<00:04,  6.84it/s] 70%|███████   | 70/100 [00:10<00:04,  6.84it/s] 71%|███████   | 71/100 [00:10<00:04,  7.00it/s] 72%|███████▏  | 72/100 [00:10<00:04,  6.98it/s] 73%|███████▎  | 73/100 [00:10<00:03,  7.11it/s] 74%|███████▍  | 74/100 [00:10<00:03,  7.20it/s] 75%|███████▌  | 75/100 [00:10<00:03,  7.23it/s] 76%|███████▌  | 76/100 [00:10<00:03,  7.36it/s] 77%|███████▋  | 77/100 [00:11<00:03,  7.42it/s] 78%|███████▊  | 78/100 [00:11<00:03,  7.23it/s] 79%|███████▉  | 79/100 [00:11<00:02,  7.26it/s] 80%|████████  | 80/100 [00:11<00:02,  7.28it/s] 81%|████████  | 81/100 [00:11<00:02,  7.24it/s] 82%|████████▏ | 82/100 [00:11<00:02,  7.13it/s] 83%|████████▎ | 83/100 [00:11<00:02,  7.29it/s] 84%|████████▍ | 84/100 [00:11<00:02,  7.36it/s] 85%|████████▌ | 85/100 [00:12<00:02,  7.45it/s] 86%|████████▌ | 86/100 [00:12<00:01,  7.50it/s] 87%|████████▋ | 87/100 [00:12<00:01,  7.53it/s] 88%|████████▊ | 88/100 [00:12<00:01,  7.55it/s] 89%|████████▉ | 89/100 [00:12<00:01,  7.40it/s] 90%|█████████ | 90/100 [00:12<00:01,  7.34it/s] 91%|█████████ | 91/100 [00:12<00:01,  7.38it/s] 92%|█████████▏| 92/100 [00:13<00:01,  7.13it/s] 93%|█████████▎| 93/100 [00:13<00:00,  7.04it/s] 94%|█████████▍| 94/100 [00:13<00:00,  7.03it/s] 95%|█████████▌| 95/100 [00:13<00:00,  7.15it/s] 96%|█████████▌| 96/100 [00:13<00:00,  7.06it/s] 97%|█████████▋| 97/100 [00:13<00:00,  7.13it/s] 98%|█████████▊| 98/100 [00:13<00:00,  7.29it/s] 99%|█████████▉| 99/100 [00:14<00:00,  7.07it/s]100%|██████████| 100/100 [00:14<00:00,  6.94it/s]100%|██████████| 100/100 [00:14<00:00,  7.03it/s]
FOLD 1
Metric     CE Loss  KL wrt Orig
Model                          
llama_7B  4.418496     2.360802
[4.1394043  2.01641829]
2023-12-04 01:14:28.994560: I tensorflow/core/util/port.cc:110] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2023-12-04 01:14:29.044765: I tensorflow/core/platform/cpu_feature_guard.cc:182] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-12-04 01:14:29.808329: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Could not find TensorRT
Found cached dataset truthful_qa (/home/elicer/.cache/huggingface/datasets/truthful_qa/multiple_choice/1.1.0/63502f6bc6ee493830ce0843991b028d0ab568d221896b2ee3b8a5dfdaa9d7f4)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 299.74it/s]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:00<00:00,  5.24it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  5.74it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  5.66it/s]
head_wise_activation_length:(11012, 32, 4096)
labels_shape:(11012,)
seperated_head_activation shape:11013
Running fold 0
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:29,  1.04it/s]  6%|▋         | 2/32 [00:01<00:29,  1.02it/s]  9%|▉         | 3/32 [00:02<00:27,  1.05it/s] 12%|█▎        | 4/32 [00:03<00:26,  1.07it/s] 16%|█▌        | 5/32 [00:04<00:25,  1.07it/s] 19%|█▉        | 6/32 [00:05<00:24,  1.05it/s] 22%|██▏       | 7/32 [00:06<00:23,  1.04it/s] 25%|██▌       | 8/32 [00:07<00:23,  1.01it/s] 28%|██▊       | 9/32 [00:08<00:23,  1.01s/it] 31%|███▏      | 10/32 [00:09<00:22,  1.04s/it] 34%|███▍      | 11/32 [00:11<00:22,  1.06s/it] 38%|███▊      | 12/32 [00:12<00:21,  1.05s/it] 41%|████      | 13/32 [00:13<00:20,  1.06s/it] 44%|████▍     | 14/32 [00:14<00:19,  1.08s/it] 47%|████▋     | 15/32 [00:15<00:18,  1.07s/it] 50%|█████     | 16/32 [00:16<00:17,  1.08s/it] 53%|█████▎    | 17/32 [00:17<00:16,  1.07s/it] 56%|█████▋    | 18/32 [00:18<00:15,  1.08s/it] 59%|█████▉    | 19/32 [00:19<00:14,  1.10s/it] 62%|██████▎   | 20/32 [00:20<00:13,  1.11s/it] 66%|██████▌   | 21/32 [00:21<00:12,  1.12s/it] 69%|██████▉   | 22/32 [00:23<00:11,  1.10s/it] 72%|███████▏  | 23/32 [00:24<00:10,  1.13s/it] 75%|███████▌  | 24/32 [00:25<00:09,  1.19s/it] 78%|███████▊  | 25/32 [00:26<00:08,  1.17s/it] 81%|████████▏ | 26/32 [00:27<00:06,  1.16s/it] 84%|████████▍ | 27/32 [00:29<00:05,  1.19s/it] 88%|████████▊ | 28/32 [00:30<00:04,  1.14s/it] 91%|█████████ | 29/32 [00:31<00:03,  1.15s/it] 94%|█████████▍| 30/32 [00:32<00:02,  1.13s/it] 97%|█████████▋| 31/32 [00:33<00:01,  1.14s/it]100%|██████████| 32/32 [00:35<00:00,  1.24s/it]100%|██████████| 32/32 [00:35<00:00,  1.09s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
/home/elicer/honest_llama/validation/../TruthfulQA/truthfulqa/metrics.py:284: FutureWarning: load_metric is deprecated and will be removed in the next major version of datasets. Use 'evaluate.load' instead, from the new library 🤗 Evaluate: https://huggingface.co/docs/evaluate
  bleurt = load_metric("bleurt", cache_dir=cache_dir)
[[0.651 0.665 0.645 ... 0.646 0.647 0.652]
 [0.659 0.644 0.645 ... 0.648 0.658 0.656]
 [0.651 0.657 0.685 ... 0.637 0.648 0.667]
 ...
 [0.765 0.762 0.657 ... 0.73  0.704 0.674]
 [0.748 0.678 0.696 ... 0.663 0.769 0.786]
 [0.775 0.815 0.74  ... 0.697 0.809 0.79 ]]
Heads intervened:  [(8, 16), (12, 4), (12, 15), (13, 8), (13, 16), (14, 2), (14, 20), (15, 28), (16, 17), (16, 26), (16, 30), (17, 4), (17, 9), (17, 13), (17, 17), (17, 29), (18, 29), (19, 13), (19, 17), (19, 31), (20, 22), (20, 30), (21, 18), (22, 16), (22, 23), (22, 30), (23, 3), (23, 4), (23, 7), (23, 13), (25, 15), (31, 1), (31, 3), (31, 6), (31, 25), (31, 30)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
2023-12-04 01:15:21.880464: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1635] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 24961 MB memory:  -> device: 0, name: NVIDIA A100 80GB PCIe MIG 3g.40gb, pci bus id: 0000:65:00.0, compute capability: 8.0
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 266.10it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-ec0cf83741fdb3e8.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-d31e6c0c76fafb4d.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:01<01:42,  1.04s/it]  3%|▎         | 3/100 [00:01<00:30,  3.20it/s]  5%|▌         | 5/100 [00:01<00:17,  5.50it/s]  7%|▋         | 7/100 [00:01<00:12,  7.73it/s]  9%|▉         | 9/100 [00:01<00:09,  9.76it/s] 11%|█         | 11/100 [00:01<00:07, 11.26it/s] 13%|█▎        | 13/100 [00:01<00:06, 12.70it/s] 15%|█▌        | 15/100 [00:01<00:06, 13.79it/s] 17%|█▋        | 17/100 [00:01<00:05, 14.71it/s] 19%|█▉        | 19/100 [00:02<00:05, 15.37it/s] 21%|██        | 21/100 [00:02<00:05, 15.70it/s] 23%|██▎       | 23/100 [00:02<00:04, 16.03it/s] 25%|██▌       | 25/100 [00:02<00:04, 16.31it/s] 27%|██▋       | 27/100 [00:02<00:04, 16.58it/s] 29%|██▉       | 29/100 [00:02<00:04, 16.76it/s] 31%|███       | 31/100 [00:02<00:04, 16.84it/s] 33%|███▎      | 33/100 [00:02<00:03, 16.95it/s] 35%|███▌      | 35/100 [00:03<00:03, 17.02it/s] 37%|███▋      | 37/100 [00:03<00:03, 17.12it/s] 39%|███▉      | 39/100 [00:03<00:03, 17.20it/s] 41%|████      | 41/100 [00:03<00:03, 17.22it/s] 43%|████▎     | 43/100 [00:03<00:03, 17.27it/s] 45%|████▌     | 45/100 [00:03<00:03, 17.29it/s] 47%|████▋     | 47/100 [00:03<00:03, 17.31it/s] 49%|████▉     | 49/100 [00:03<00:02, 17.29it/s] 51%|█████     | 51/100 [00:03<00:02, 17.29it/s] 53%|█████▎    | 53/100 [00:04<00:02, 17.28it/s] 55%|█████▌    | 55/100 [00:04<00:02, 17.26it/s] 57%|█████▋    | 57/100 [00:04<00:02, 17.08it/s] 59%|█████▉    | 59/100 [00:04<00:02, 17.05it/s] 61%|██████    | 61/100 [00:04<00:02, 17.05it/s] 63%|██████▎   | 63/100 [00:04<00:02, 17.08it/s] 65%|██████▌   | 65/100 [00:04<00:02, 17.11it/s] 67%|██████▋   | 67/100 [00:04<00:01, 17.16it/s] 69%|██████▉   | 69/100 [00:05<00:01, 17.13it/s] 71%|███████   | 71/100 [00:05<00:01, 17.20it/s] 73%|███████▎  | 73/100 [00:05<00:01, 17.22it/s] 75%|███████▌  | 75/100 [00:05<00:01, 17.25it/s] 77%|███████▋  | 77/100 [00:05<00:01, 17.28it/s] 79%|███████▉  | 79/100 [00:05<00:01, 17.25it/s] 81%|████████  | 81/100 [00:05<00:01, 17.18it/s] 83%|████████▎ | 83/100 [00:05<00:00, 17.15it/s] 85%|████████▌ | 85/100 [00:05<00:00, 17.15it/s] 87%|████████▋ | 87/100 [00:06<00:00, 17.18it/s] 89%|████████▉ | 89/100 [00:06<00:00, 17.10it/s] 91%|█████████ | 91/100 [00:06<00:00, 17.05it/s] 93%|█████████▎| 93/100 [00:06<00:00, 17.07it/s] 95%|█████████▌| 95/100 [00:06<00:00, 17.13it/s] 97%|█████████▋| 97/100 [00:06<00:00, 17.19it/s] 99%|█████████▉| 99/100 [00:06<00:00, 17.24it/s]100%|██████████| 100/100 [00:06<00:00, 14.66it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 347.21it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-1939fcc1eeebdaa7.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-785bb4b6f2089589.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:18,  5.44it/s]  2%|▏         | 2/100 [00:00<00:16,  5.87it/s]  3%|▎         | 3/100 [00:00<00:14,  6.49it/s]  4%|▍         | 4/100 [00:00<00:14,  6.83it/s]  5%|▌         | 5/100 [00:00<00:14,  6.64it/s]  6%|▌         | 6/100 [00:00<00:14,  6.69it/s]  7%|▋         | 7/100 [00:01<00:13,  6.79it/s]  8%|▊         | 8/100 [00:01<00:13,  6.79it/s]  9%|▉         | 9/100 [00:01<00:13,  6.75it/s] 10%|█         | 10/100 [00:01<00:13,  6.89it/s] 11%|█         | 11/100 [00:01<00:12,  6.97it/s] 12%|█▏        | 12/100 [00:01<00:12,  6.86it/s] 13%|█▎        | 13/100 [00:01<00:12,  6.98it/s] 14%|█▍        | 14/100 [00:02<00:12,  7.12it/s] 15%|█▌        | 15/100 [00:02<00:12,  6.89it/s] 16%|█▌        | 16/100 [00:02<00:12,  6.89it/s] 17%|█▋        | 17/100 [00:02<00:12,  6.89it/s] 18%|█▊        | 18/100 [00:02<00:11,  6.98it/s] 19%|█▉        | 19/100 [00:02<00:11,  7.07it/s] 20%|██        | 20/100 [00:02<00:11,  7.00it/s] 21%|██        | 21/100 [00:03<00:11,  7.04it/s] 22%|██▏       | 22/100 [00:03<00:11,  6.90it/s] 23%|██▎       | 23/100 [00:03<00:11,  6.84it/s] 24%|██▍       | 24/100 [00:03<00:11,  6.81it/s] 25%|██▌       | 25/100 [00:03<00:10,  7.01it/s] 26%|██▌       | 26/100 [00:03<00:10,  7.06it/s] 27%|██▋       | 27/100 [00:03<00:10,  7.20it/s] 28%|██▊       | 28/100 [00:04<00:10,  7.09it/s] 29%|██▉       | 29/100 [00:04<00:09,  7.12it/s] 30%|███       | 30/100 [00:04<00:10,  7.00it/s] 31%|███       | 31/100 [00:04<00:10,  6.80it/s] 32%|███▏      | 32/100 [00:04<00:09,  6.83it/s] 33%|███▎      | 33/100 [00:04<00:09,  6.96it/s] 34%|███▍      | 34/100 [00:04<00:09,  6.98it/s] 35%|███▌      | 35/100 [00:05<00:09,  7.01it/s] 36%|███▌      | 36/100 [00:05<00:09,  6.98it/s] 37%|███▋      | 37/100 [00:05<00:08,  7.02it/s] 38%|███▊      | 38/100 [00:05<00:08,  7.04it/s] 39%|███▉      | 39/100 [00:05<00:08,  7.02it/s] 40%|████      | 40/100 [00:05<00:08,  7.03it/s] 41%|████      | 41/100 [00:05<00:08,  7.00it/s] 42%|████▏     | 42/100 [00:06<00:08,  7.15it/s] 43%|████▎     | 43/100 [00:06<00:07,  7.20it/s] 44%|████▍     | 44/100 [00:06<00:07,  7.04it/s] 45%|████▌     | 45/100 [00:06<00:07,  7.02it/s] 46%|████▌     | 46/100 [00:06<00:08,  6.74it/s] 47%|████▋     | 47/100 [00:06<00:07,  6.96it/s] 48%|████▊     | 48/100 [00:06<00:07,  7.01it/s] 49%|████▉     | 49/100 [00:07<00:07,  6.90it/s] 50%|█████     | 50/100 [00:07<00:07,  7.09it/s] 51%|█████     | 51/100 [00:07<00:06,  7.22it/s] 52%|█████▏    | 52/100 [00:07<00:06,  7.11it/s] 53%|█████▎    | 53/100 [00:07<00:06,  7.23it/s] 54%|█████▍    | 54/100 [00:07<00:06,  7.32it/s] 55%|█████▌    | 55/100 [00:07<00:06,  7.33it/s] 56%|█████▌    | 56/100 [00:08<00:06,  7.24it/s] 57%|█████▋    | 57/100 [00:08<00:05,  7.32it/s] 58%|█████▊    | 58/100 [00:08<00:05,  7.14it/s] 59%|█████▉    | 59/100 [00:08<00:05,  7.23it/s] 60%|██████    | 60/100 [00:08<00:05,  7.24it/s] 61%|██████    | 61/100 [00:08<00:05,  7.08it/s] 62%|██████▏   | 62/100 [00:08<00:05,  7.08it/s] 63%|██████▎   | 63/100 [00:09<00:05,  6.99it/s] 64%|██████▍   | 64/100 [00:09<00:05,  7.04it/s] 65%|██████▌   | 65/100 [00:09<00:04,  7.14it/s] 66%|██████▌   | 66/100 [00:09<00:04,  7.06it/s] 67%|██████▋   | 67/100 [00:09<00:04,  7.10it/s] 68%|██████▊   | 68/100 [00:09<00:04,  7.18it/s] 69%|██████▉   | 69/100 [00:09<00:04,  7.03it/s] 70%|███████   | 70/100 [00:10<00:04,  7.18it/s] 71%|███████   | 71/100 [00:10<00:04,  7.05it/s] 72%|███████▏  | 72/100 [00:10<00:03,  7.16it/s] 73%|███████▎  | 73/100 [00:10<00:03,  7.11it/s] 74%|███████▍  | 74/100 [00:10<00:03,  7.11it/s] 75%|███████▌  | 75/100 [00:10<00:03,  7.24it/s] 76%|███████▌  | 76/100 [00:10<00:03,  7.06it/s] 77%|███████▋  | 77/100 [00:10<00:03,  7.12it/s] 78%|███████▊  | 78/100 [00:11<00:03,  7.04it/s] 79%|███████▉  | 79/100 [00:11<00:02,  7.03it/s] 80%|████████  | 80/100 [00:11<00:02,  6.91it/s] 81%|████████  | 81/100 [00:11<00:02,  7.10it/s] 82%|████████▏ | 82/100 [00:11<00:02,  7.03it/s] 83%|████████▎ | 83/100 [00:11<00:02,  6.99it/s] 84%|████████▍ | 84/100 [00:11<00:02,  7.03it/s] 85%|████████▌ | 85/100 [00:12<00:02,  6.98it/s] 86%|████████▌ | 86/100 [00:12<00:02,  6.94it/s] 87%|████████▋ | 87/100 [00:12<00:01,  7.01it/s] 88%|████████▊ | 88/100 [00:12<00:01,  7.09it/s] 89%|████████▉ | 89/100 [00:12<00:01,  7.00it/s] 90%|█████████ | 90/100 [00:12<00:01,  7.11it/s] 91%|█████████ | 91/100 [00:12<00:01,  7.01it/s] 92%|█████████▏| 92/100 [00:13<00:01,  7.15it/s] 93%|█████████▎| 93/100 [00:13<00:00,  7.03it/s] 94%|█████████▍| 94/100 [00:13<00:00,  6.93it/s] 95%|█████████▌| 95/100 [00:13<00:00,  6.91it/s] 96%|█████████▌| 96/100 [00:13<00:00,  7.08it/s] 97%|█████████▋| 97/100 [00:13<00:00,  6.92it/s] 98%|█████████▊| 98/100 [00:13<00:00,  6.99it/s] 99%|█████████▉| 99/100 [00:14<00:00,  6.88it/s]100%|██████████| 100/100 [00:14<00:00,  6.93it/s]100%|██████████| 100/100 [00:14<00:00,  7.00it/s]
FOLD 0
Metric     CE Loss  KL wrt Orig
Model                          
llama_7B  4.422344     2.254058
Running fold 1
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:29,  1.06it/s]  6%|▋         | 2/32 [00:02<00:32,  1.09s/it]  9%|▉         | 3/32 [00:03<00:33,  1.17s/it] 12%|█▎        | 4/32 [00:04<00:33,  1.18s/it] 16%|█▌        | 5/32 [00:05<00:32,  1.22s/it] 19%|█▉        | 6/32 [00:07<00:32,  1.25s/it] 22%|██▏       | 7/32 [00:08<00:31,  1.27s/it] 25%|██▌       | 8/32 [00:09<00:30,  1.26s/it] 28%|██▊       | 9/32 [00:10<00:28,  1.26s/it] 31%|███▏      | 10/32 [00:12<00:27,  1.26s/it] 34%|███▍      | 11/32 [00:13<00:26,  1.24s/it] 38%|███▊      | 12/32 [00:14<00:24,  1.22s/it] 41%|████      | 13/32 [00:15<00:23,  1.21s/it] 44%|████▍     | 14/32 [00:17<00:21,  1.21s/it] 47%|████▋     | 15/32 [00:18<00:20,  1.21s/it] 50%|█████     | 16/32 [00:19<00:19,  1.22s/it] 53%|█████▎    | 17/32 [00:20<00:18,  1.21s/it] 56%|█████▋    | 18/32 [00:21<00:16,  1.21s/it] 59%|█████▉    | 19/32 [00:23<00:16,  1.24s/it] 62%|██████▎   | 20/32 [00:24<00:15,  1.28s/it] 66%|██████▌   | 21/32 [00:25<00:14,  1.28s/it] 69%|██████▉   | 22/32 [00:27<00:12,  1.28s/it] 72%|███████▏  | 23/32 [00:28<00:11,  1.29s/it] 75%|███████▌  | 24/32 [00:29<00:10,  1.32s/it] 78%|███████▊  | 25/32 [00:31<00:09,  1.32s/it] 81%|████████▏ | 26/32 [00:32<00:07,  1.31s/it] 84%|████████▍ | 27/32 [00:33<00:06,  1.32s/it] 88%|████████▊ | 28/32 [00:35<00:05,  1.31s/it] 91%|█████████ | 29/32 [00:36<00:03,  1.32s/it] 94%|█████████▍| 30/32 [00:37<00:02,  1.30s/it] 97%|█████████▋| 31/32 [00:38<00:01,  1.30s/it]100%|██████████| 32/32 [00:40<00:00,  1.35s/it]100%|██████████| 32/32 [00:40<00:00,  1.26s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
[[0.666 0.672 0.662 ... 0.668 0.662 0.67 ]
 [0.662 0.662 0.659 ... 0.677 0.666 0.663]
 [0.668 0.67  0.68  ... 0.661 0.665 0.671]
 ...
 [0.758 0.75  0.674 ... 0.716 0.694 0.677]
 [0.749 0.671 0.686 ... 0.674 0.762 0.76 ]
 [0.765 0.805 0.748 ... 0.743 0.787 0.775]]
Heads intervened:  [(8, 16), (11, 16), (11, 17), (12, 4), (12, 22), (13, 8), (13, 10), (13, 16), (13, 21), (14, 2), (15, 28), (16, 4), (16, 17), (16, 26), (16, 30), (17, 4), (17, 13), (17, 19), (17, 29), (18, 29), (19, 13), (19, 17), (19, 31), (20, 22), (20, 30), (22, 16), (23, 3), (23, 12), (23, 25), (26, 13), (27, 3), (27, 7), (30, 4), (30, 18), (31, 1), (31, 6)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 258.91it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-30ec7b2da7888791.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-4e53eea82b0ecfef.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  2%|▏         | 2/100 [00:00<00:06, 15.09it/s]  4%|▍         | 4/100 [00:00<00:05, 16.13it/s]  6%|▌         | 6/100 [00:00<00:05, 16.42it/s]  8%|▊         | 8/100 [00:00<00:05, 16.61it/s] 10%|█         | 10/100 [00:00<00:05, 16.72it/s] 12%|█▏        | 12/100 [00:00<00:05, 16.79it/s] 14%|█▍        | 14/100 [00:00<00:05, 16.84it/s] 16%|█▌        | 16/100 [00:00<00:04, 16.87it/s] 18%|█▊        | 18/100 [00:01<00:04, 16.90it/s] 20%|██        | 20/100 [00:01<00:04, 16.90it/s] 22%|██▏       | 22/100 [00:01<00:04, 16.92it/s] 24%|██▍       | 24/100 [00:01<00:04, 16.94it/s] 26%|██▌       | 26/100 [00:01<00:04, 16.94it/s] 28%|██▊       | 28/100 [00:01<00:04, 16.95it/s] 30%|███       | 30/100 [00:01<00:04, 16.95it/s] 32%|███▏      | 32/100 [00:01<00:04, 16.94it/s] 34%|███▍      | 34/100 [00:02<00:03, 16.95it/s] 36%|███▌      | 36/100 [00:02<00:03, 16.94it/s] 38%|███▊      | 38/100 [00:02<00:03, 16.93it/s] 40%|████      | 40/100 [00:02<00:03, 16.95it/s] 42%|████▏     | 42/100 [00:02<00:03, 16.90it/s] 44%|████▍     | 44/100 [00:02<00:03, 16.92it/s] 46%|████▌     | 46/100 [00:02<00:03, 16.93it/s] 48%|████▊     | 48/100 [00:02<00:03, 16.93it/s] 50%|█████     | 50/100 [00:02<00:02, 16.93it/s] 52%|█████▏    | 52/100 [00:03<00:02, 16.93it/s] 54%|█████▍    | 54/100 [00:03<00:02, 16.95it/s] 56%|█████▌    | 56/100 [00:03<00:02, 16.95it/s] 58%|█████▊    | 58/100 [00:03<00:02, 16.97it/s] 60%|██████    | 60/100 [00:03<00:02, 16.96it/s] 62%|██████▏   | 62/100 [00:03<00:02, 16.96it/s] 64%|██████▍   | 64/100 [00:03<00:02, 16.96it/s] 66%|██████▌   | 66/100 [00:03<00:02, 16.95it/s] 68%|██████▊   | 68/100 [00:04<00:01, 16.96it/s] 70%|███████   | 70/100 [00:04<00:01, 16.95it/s] 72%|███████▏  | 72/100 [00:04<00:01, 16.96it/s] 74%|███████▍  | 74/100 [00:04<00:01, 16.96it/s] 76%|███████▌  | 76/100 [00:04<00:01, 16.89it/s] 78%|███████▊  | 78/100 [00:04<00:01, 16.90it/s] 80%|████████  | 80/100 [00:04<00:01, 16.91it/s] 82%|████████▏ | 82/100 [00:04<00:01, 16.92it/s] 84%|████████▍ | 84/100 [00:04<00:00, 16.94it/s] 86%|████████▌ | 86/100 [00:05<00:00, 16.94it/s] 88%|████████▊ | 88/100 [00:05<00:00, 16.94it/s] 90%|█████████ | 90/100 [00:05<00:00, 16.95it/s] 92%|█████████▏| 92/100 [00:05<00:00, 16.95it/s] 94%|█████████▍| 94/100 [00:05<00:00, 16.95it/s] 96%|█████████▌| 96/100 [00:05<00:00, 16.97it/s] 98%|█████████▊| 98/100 [00:05<00:00, 16.96it/s]100%|██████████| 100/100 [00:05<00:00, 16.95it/s]100%|██████████| 100/100 [00:05<00:00, 16.90it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 340.58it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-14295f39edd20556.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-10ca04ba0c7bb427.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:16,  5.84it/s]  2%|▏         | 2/100 [00:00<00:15,  6.30it/s]  3%|▎         | 3/100 [00:00<00:14,  6.78it/s]  4%|▍         | 4/100 [00:00<00:14,  6.78it/s]  5%|▌         | 5/100 [00:00<00:13,  6.95it/s]  6%|▌         | 6/100 [00:00<00:13,  6.95it/s]  7%|▋         | 7/100 [00:01<00:13,  7.08it/s]  8%|▊         | 8/100 [00:01<00:13,  6.94it/s]  9%|▉         | 9/100 [00:01<00:13,  6.96it/s] 10%|█         | 10/100 [00:01<00:12,  7.11it/s] 11%|█         | 11/100 [00:01<00:12,  7.21it/s] 12%|█▏        | 12/100 [00:01<00:12,  7.17it/s] 13%|█▎        | 13/100 [00:01<00:11,  7.26it/s] 14%|█▍        | 14/100 [00:02<00:12,  7.08it/s] 15%|█▌        | 15/100 [00:02<00:12,  6.91it/s] 16%|█▌        | 16/100 [00:02<00:12,  6.79it/s] 17%|█▋        | 17/100 [00:02<00:12,  6.82it/s] 18%|█▊        | 18/100 [00:02<00:11,  7.01it/s] 19%|█▉        | 19/100 [00:02<00:11,  7.04it/s] 20%|██        | 20/100 [00:02<00:11,  7.14it/s] 21%|██        | 21/100 [00:03<00:11,  6.91it/s] 22%|██▏       | 22/100 [00:03<00:11,  6.79it/s] 23%|██▎       | 23/100 [00:03<00:11,  6.83it/s] 24%|██▍       | 24/100 [00:03<00:10,  6.96it/s] 25%|██▌       | 25/100 [00:03<00:11,  6.81it/s] 26%|██▌       | 26/100 [00:03<00:10,  6.76it/s] 27%|██▋       | 27/100 [00:03<00:10,  6.97it/s] 28%|██▊       | 28/100 [00:04<00:10,  7.12it/s] 29%|██▉       | 29/100 [00:04<00:10,  7.03it/s] 30%|███       | 30/100 [00:04<00:09,  7.08it/s] 31%|███       | 31/100 [00:04<00:09,  7.09it/s] 32%|███▏      | 32/100 [00:04<00:09,  7.14it/s] 33%|███▎      | 33/100 [00:04<00:09,  7.04it/s] 34%|███▍      | 34/100 [00:04<00:09,  6.97it/s] 35%|███▌      | 35/100 [00:05<00:09,  6.91it/s] 36%|███▌      | 36/100 [00:05<00:09,  6.91it/s] 37%|███▋      | 37/100 [00:05<00:09,  6.83it/s] 38%|███▊      | 38/100 [00:05<00:08,  7.01it/s] 39%|███▉      | 39/100 [00:05<00:08,  7.05it/s] 40%|████      | 40/100 [00:05<00:08,  7.11it/s] 41%|████      | 41/100 [00:05<00:08,  7.06it/s] 42%|████▏     | 42/100 [00:06<00:08,  7.03it/s] 43%|████▎     | 43/100 [00:06<00:08,  6.86it/s] 44%|████▍     | 44/100 [00:06<00:08,  6.96it/s] 45%|████▌     | 45/100 [00:06<00:07,  7.01it/s] 46%|████▌     | 46/100 [00:06<00:07,  7.15it/s] 47%|████▋     | 47/100 [00:06<00:07,  6.90it/s] 48%|████▊     | 48/100 [00:06<00:07,  6.90it/s] 49%|████▉     | 49/100 [00:07<00:07,  7.05it/s] 50%|█████     | 50/100 [00:07<00:07,  7.06it/s] 51%|█████     | 51/100 [00:07<00:06,  7.02it/s] 52%|█████▏    | 52/100 [00:07<00:06,  7.00it/s] 53%|█████▎    | 53/100 [00:07<00:06,  6.97it/s] 54%|█████▍    | 54/100 [00:07<00:06,  7.05it/s] 55%|█████▌    | 55/100 [00:07<00:06,  7.01it/s] 56%|█████▌    | 56/100 [00:08<00:06,  6.84it/s] 57%|█████▋    | 57/100 [00:08<00:06,  6.93it/s] 58%|█████▊    | 58/100 [00:08<00:06,  6.93it/s] 59%|█████▉    | 59/100 [00:08<00:05,  7.09it/s] 60%|██████    | 60/100 [00:08<00:05,  7.08it/s] 61%|██████    | 61/100 [00:08<00:05,  7.11it/s] 62%|██████▏   | 62/100 [00:08<00:05,  6.96it/s] 63%|██████▎   | 63/100 [00:09<00:05,  6.96it/s] 64%|██████▍   | 64/100 [00:09<00:05,  6.83it/s] 65%|██████▌   | 65/100 [00:09<00:05,  6.86it/s] 66%|██████▌   | 66/100 [00:09<00:04,  7.02it/s] 67%|██████▋   | 67/100 [00:09<00:04,  7.09it/s] 68%|██████▊   | 68/100 [00:09<00:04,  7.03it/s] 69%|██████▉   | 69/100 [00:09<00:04,  6.92it/s] 70%|███████   | 70/100 [00:10<00:04,  6.95it/s] 71%|███████   | 71/100 [00:10<00:04,  6.94it/s] 72%|███████▏  | 72/100 [00:10<00:04,  6.92it/s] 73%|███████▎  | 73/100 [00:10<00:03,  6.98it/s] 74%|███████▍  | 74/100 [00:10<00:03,  6.84it/s] 75%|███████▌  | 75/100 [00:10<00:03,  6.95it/s] 76%|███████▌  | 76/100 [00:10<00:03,  6.90it/s] 77%|███████▋  | 77/100 [00:11<00:03,  6.98it/s] 78%|███████▊  | 78/100 [00:11<00:03,  6.95it/s] 79%|███████▉  | 79/100 [00:11<00:02,  7.08it/s] 80%|████████  | 80/100 [00:11<00:02,  7.09it/s] 81%|████████  | 81/100 [00:11<00:02,  7.10it/s] 82%|████████▏ | 82/100 [00:11<00:02,  7.00it/s] 83%|████████▎ | 83/100 [00:11<00:02,  7.00it/s] 84%|████████▍ | 84/100 [00:12<00:02,  6.97it/s] 85%|████████▌ | 85/100 [00:12<00:02,  7.12it/s] 86%|████████▌ | 86/100 [00:12<00:01,  7.13it/s] 87%|████████▋ | 87/100 [00:12<00:01,  7.06it/s] 88%|████████▊ | 88/100 [00:12<00:01,  7.12it/s] 89%|████████▉ | 89/100 [00:12<00:01,  6.98it/s] 90%|█████████ | 90/100 [00:12<00:01,  6.97it/s] 91%|█████████ | 91/100 [00:13<00:01,  7.12it/s] 92%|█████████▏| 92/100 [00:13<00:01,  7.08it/s] 93%|█████████▎| 93/100 [00:13<00:00,  7.11it/s] 94%|█████████▍| 94/100 [00:13<00:00,  7.17it/s] 95%|█████████▌| 95/100 [00:13<00:00,  6.94it/s] 96%|█████████▌| 96/100 [00:13<00:00,  6.92it/s] 97%|█████████▋| 97/100 [00:13<00:00,  7.08it/s] 98%|█████████▊| 98/100 [00:14<00:00,  7.21it/s] 99%|█████████▉| 99/100 [00:14<00:00,  7.28it/s]100%|██████████| 100/100 [00:14<00:00,  7.35it/s]100%|██████████| 100/100 [00:14<00:00,  7.00it/s]
FOLD 1
Metric     CE Loss  KL wrt Orig
Model                          
llama_7B  4.817324     2.696348
[4.61983398 2.47520302]
2023-12-04 01:17:02.597395: I tensorflow/core/util/port.cc:110] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2023-12-04 01:17:02.646996: I tensorflow/core/platform/cpu_feature_guard.cc:182] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-12-04 01:17:03.394195: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Could not find TensorRT
Found cached dataset truthful_qa (/home/elicer/.cache/huggingface/datasets/truthful_qa/multiple_choice/1.1.0/63502f6bc6ee493830ce0843991b028d0ab568d221896b2ee3b8a5dfdaa9d7f4)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 349.79it/s]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:00<00:00,  5.72it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  6.10it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  6.03it/s]
head_wise_activation_length:(11012, 32, 4096)
labels_shape:(11012,)
seperated_head_activation shape:11013
Running fold 0
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:28,  1.09it/s]  6%|▋         | 2/32 [00:01<00:28,  1.06it/s]  9%|▉         | 3/32 [00:02<00:26,  1.09it/s] 12%|█▎        | 4/32 [00:03<00:25,  1.11it/s] 16%|█▌        | 5/32 [00:04<00:24,  1.11it/s] 19%|█▉        | 6/32 [00:05<00:23,  1.09it/s] 22%|██▏       | 7/32 [00:06<00:23,  1.08it/s] 25%|██▌       | 8/32 [00:07<00:22,  1.06it/s] 28%|██▊       | 9/32 [00:08<00:22,  1.03it/s] 31%|███▏      | 10/32 [00:09<00:21,  1.01it/s] 34%|███▍      | 11/32 [00:10<00:21,  1.02s/it] 38%|███▊      | 12/32 [00:11<00:20,  1.01s/it] 41%|████      | 13/32 [00:12<00:19,  1.03s/it] 44%|████▍     | 14/32 [00:13<00:18,  1.04s/it] 47%|████▋     | 15/32 [00:14<00:17,  1.04s/it] 50%|█████     | 16/32 [00:15<00:16,  1.04s/it] 53%|█████▎    | 17/32 [00:16<00:15,  1.05s/it] 56%|█████▋    | 18/32 [00:17<00:14,  1.06s/it] 59%|█████▉    | 19/32 [00:19<00:14,  1.08s/it] 62%|██████▎   | 20/32 [00:20<00:13,  1.10s/it] 66%|██████▌   | 21/32 [00:21<00:12,  1.10s/it] 69%|██████▉   | 22/32 [00:22<00:10,  1.08s/it] 72%|███████▏  | 23/32 [00:23<00:09,  1.11s/it] 75%|███████▌  | 24/32 [00:24<00:09,  1.16s/it] 78%|███████▊  | 25/32 [00:25<00:07,  1.14s/it] 81%|████████▏ | 26/32 [00:26<00:06,  1.13s/it] 84%|████████▍ | 27/32 [00:28<00:05,  1.15s/it] 88%|████████▊ | 28/32 [00:29<00:04,  1.10s/it] 91%|█████████ | 29/32 [00:30<00:03,  1.11s/it] 94%|█████████▍| 30/32 [00:31<00:02,  1.09s/it] 97%|█████████▋| 31/32 [00:32<00:01,  1.11s/it]100%|██████████| 32/32 [00:33<00:00,  1.20s/it]100%|██████████| 32/32 [00:33<00:00,  1.06s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
/home/elicer/honest_llama/validation/../TruthfulQA/truthfulqa/metrics.py:284: FutureWarning: load_metric is deprecated and will be removed in the next major version of datasets. Use 'evaluate.load' instead, from the new library 🤗 Evaluate: https://huggingface.co/docs/evaluate
  bleurt = load_metric("bleurt", cache_dir=cache_dir)
[[0.651 0.665 0.645 ... 0.646 0.647 0.652]
 [0.659 0.644 0.645 ... 0.648 0.658 0.656]
 [0.651 0.657 0.685 ... 0.637 0.648 0.667]
 ...
 [0.765 0.762 0.657 ... 0.73  0.704 0.674]
 [0.748 0.678 0.696 ... 0.663 0.769 0.786]
 [0.775 0.815 0.74  ... 0.697 0.809 0.79 ]]
Heads intervened:  [(8, 16), (8, 19), (10, 18), (11, 16), (11, 17), (12, 4), (12, 15), (12, 22), (13, 8), (13, 16), (14, 2), (14, 20), (15, 28), (16, 17), (16, 26), (16, 30), (17, 4), (17, 9), (17, 13), (17, 17), (17, 29), (18, 29), (19, 13), (19, 17), (19, 31), (20, 22), (20, 30), (21, 18), (22, 2), (22, 8), (22, 16), (22, 23), (22, 30), (23, 3), (23, 4), (23, 7), (23, 12), (23, 13), (23, 25), (25, 15), (30, 14), (30, 23), (31, 1), (31, 3), (31, 6), (31, 11), (31, 25), (31, 30)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
2023-12-04 01:17:53.951099: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1635] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 24961 MB memory:  -> device: 0, name: NVIDIA A100 80GB PCIe MIG 3g.40gb, pci bus id: 0000:65:00.0, compute capability: 8.0
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 582.87it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-ec0cf83741fdb3e8.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-d31e6c0c76fafb4d.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:01<01:42,  1.03s/it]  3%|▎         | 3/100 [00:01<00:30,  3.20it/s]  5%|▌         | 5/100 [00:01<00:17,  5.46it/s]  7%|▋         | 7/100 [00:01<00:12,  7.62it/s]  9%|▉         | 9/100 [00:01<00:09,  9.57it/s] 11%|█         | 11/100 [00:01<00:07, 11.22it/s] 13%|█▎        | 13/100 [00:01<00:06, 12.57it/s] 15%|█▌        | 15/100 [00:01<00:06, 13.62it/s] 17%|█▋        | 17/100 [00:02<00:05, 14.29it/s] 19%|█▉        | 19/100 [00:02<00:05, 14.92it/s] 21%|██        | 21/100 [00:02<00:05, 15.38it/s] 23%|██▎       | 23/100 [00:02<00:04, 15.71it/s] 25%|██▌       | 25/100 [00:02<00:04, 15.95it/s] 27%|██▋       | 27/100 [00:02<00:04, 16.12it/s] 29%|██▉       | 29/100 [00:02<00:04, 16.23it/s] 31%|███       | 31/100 [00:02<00:04, 16.31it/s] 33%|███▎      | 33/100 [00:02<00:04, 16.37it/s] 35%|███▌      | 35/100 [00:03<00:03, 16.38it/s] 37%|███▋      | 37/100 [00:03<00:03, 16.43it/s] 39%|███▉      | 39/100 [00:03<00:03, 16.46it/s] 41%|████      | 41/100 [00:03<00:03, 16.49it/s] 43%|████▎     | 43/100 [00:03<00:03, 16.50it/s] 45%|████▌     | 45/100 [00:03<00:03, 16.52it/s] 47%|████▋     | 47/100 [00:03<00:03, 16.53it/s] 49%|████▉     | 49/100 [00:03<00:03, 16.54it/s] 51%|█████     | 51/100 [00:04<00:03, 16.28it/s] 53%|█████▎    | 53/100 [00:04<00:02, 16.21it/s] 55%|█████▌    | 55/100 [00:04<00:02, 16.29it/s] 57%|█████▋    | 57/100 [00:04<00:02, 16.37it/s] 59%|█████▉    | 59/100 [00:04<00:02, 16.43it/s] 61%|██████    | 61/100 [00:04<00:02, 16.47it/s] 63%|██████▎   | 63/100 [00:04<00:02, 16.47it/s] 65%|██████▌   | 65/100 [00:04<00:02, 16.49it/s] 67%|██████▋   | 67/100 [00:05<00:01, 16.51it/s] 69%|██████▉   | 69/100 [00:05<00:01, 16.52it/s] 71%|███████   | 71/100 [00:05<00:01, 16.51it/s] 73%|███████▎  | 73/100 [00:05<00:01, 16.51it/s] 75%|███████▌  | 75/100 [00:05<00:01, 16.53it/s] 77%|███████▋  | 77/100 [00:05<00:01, 16.53it/s] 79%|███████▉  | 79/100 [00:05<00:01, 16.55it/s] 81%|████████  | 81/100 [00:05<00:01, 16.55it/s] 83%|████████▎ | 83/100 [00:06<00:01, 16.56it/s] 85%|████████▌ | 85/100 [00:06<00:00, 16.56it/s] 87%|████████▋ | 87/100 [00:06<00:00, 16.56it/s] 89%|████████▉ | 89/100 [00:06<00:00, 16.56it/s] 91%|█████████ | 91/100 [00:06<00:00, 16.57it/s] 93%|█████████▎| 93/100 [00:06<00:00, 16.56it/s] 95%|█████████▌| 95/100 [00:06<00:00, 16.49it/s] 97%|█████████▋| 97/100 [00:06<00:00, 16.48it/s] 99%|█████████▉| 99/100 [00:06<00:00, 16.51it/s]100%|██████████| 100/100 [00:07<00:00, 14.21it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 263.54it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-1939fcc1eeebdaa7.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-785bb4b6f2089589.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:17,  5.63it/s]  2%|▏         | 2/100 [00:00<00:14,  6.58it/s]  3%|▎         | 3/100 [00:00<00:13,  6.94it/s]  4%|▍         | 4/100 [00:00<00:13,  7.13it/s]  5%|▌         | 5/100 [00:00<00:13,  7.23it/s]  6%|▌         | 6/100 [00:00<00:12,  7.29it/s]  7%|▋         | 7/100 [00:00<00:12,  7.34it/s]  8%|▊         | 8/100 [00:01<00:12,  7.37it/s]  9%|▉         | 9/100 [00:01<00:12,  7.40it/s] 10%|█         | 10/100 [00:01<00:12,  7.39it/s] 11%|█         | 11/100 [00:01<00:12,  7.40it/s] 12%|█▏        | 12/100 [00:01<00:11,  7.42it/s] 13%|█▎        | 13/100 [00:01<00:11,  7.43it/s] 14%|█▍        | 14/100 [00:01<00:11,  7.44it/s] 15%|█▌        | 15/100 [00:02<00:11,  7.43it/s] 16%|█▌        | 16/100 [00:02<00:11,  7.42it/s] 17%|█▋        | 17/100 [00:02<00:11,  7.44it/s] 18%|█▊        | 18/100 [00:02<00:11,  7.43it/s] 19%|█▉        | 19/100 [00:02<00:10,  7.44it/s] 20%|██        | 20/100 [00:02<00:10,  7.44it/s] 21%|██        | 21/100 [00:02<00:10,  7.44it/s] 22%|██▏       | 22/100 [00:03<00:10,  7.44it/s] 23%|██▎       | 23/100 [00:03<00:10,  7.44it/s] 24%|██▍       | 24/100 [00:03<00:10,  7.45it/s] 25%|██▌       | 25/100 [00:03<00:10,  7.43it/s] 26%|██▌       | 26/100 [00:03<00:09,  7.43it/s] 27%|██▋       | 27/100 [00:03<00:09,  7.44it/s] 28%|██▊       | 28/100 [00:03<00:09,  7.44it/s] 29%|██▉       | 29/100 [00:03<00:09,  7.44it/s] 30%|███       | 30/100 [00:04<00:09,  7.44it/s] 31%|███       | 31/100 [00:04<00:09,  7.44it/s] 32%|███▏      | 32/100 [00:04<00:09,  7.45it/s] 33%|███▎      | 33/100 [00:04<00:08,  7.45it/s] 34%|███▍      | 34/100 [00:04<00:08,  7.45it/s] 35%|███▌      | 35/100 [00:04<00:08,  7.44it/s] 36%|███▌      | 36/100 [00:04<00:08,  7.43it/s] 37%|███▋      | 37/100 [00:05<00:08,  7.44it/s] 38%|███▊      | 38/100 [00:05<00:08,  7.44it/s] 39%|███▉      | 39/100 [00:05<00:08,  7.45it/s] 40%|████      | 40/100 [00:05<00:08,  7.43it/s] 41%|████      | 41/100 [00:05<00:07,  7.38it/s] 42%|████▏     | 42/100 [00:05<00:07,  7.40it/s] 43%|████▎     | 43/100 [00:05<00:07,  7.41it/s] 44%|████▍     | 44/100 [00:05<00:07,  7.43it/s] 45%|████▌     | 45/100 [00:06<00:07,  7.43it/s] 46%|████▌     | 46/100 [00:06<00:07,  7.43it/s] 47%|████▋     | 47/100 [00:06<00:07,  7.44it/s] 48%|████▊     | 48/100 [00:06<00:06,  7.44it/s] 49%|████▉     | 49/100 [00:06<00:06,  7.44it/s] 50%|█████     | 50/100 [00:06<00:06,  7.42it/s] 51%|█████     | 51/100 [00:06<00:06,  7.42it/s] 52%|█████▏    | 52/100 [00:07<00:06,  7.43it/s] 53%|█████▎    | 53/100 [00:07<00:06,  7.43it/s] 54%|█████▍    | 54/100 [00:07<00:06,  7.44it/s] 55%|█████▌    | 55/100 [00:07<00:06,  7.44it/s] 56%|█████▌    | 56/100 [00:07<00:05,  7.42it/s] 57%|█████▋    | 57/100 [00:07<00:05,  7.44it/s] 58%|█████▊    | 58/100 [00:07<00:05,  7.43it/s] 59%|█████▉    | 59/100 [00:07<00:05,  7.44it/s] 60%|██████    | 60/100 [00:08<00:05,  7.43it/s] 61%|██████    | 61/100 [00:08<00:05,  7.39it/s] 62%|██████▏   | 62/100 [00:08<00:05,  7.41it/s] 63%|██████▎   | 63/100 [00:08<00:04,  7.42it/s] 64%|██████▍   | 64/100 [00:08<00:04,  7.43it/s] 65%|██████▌   | 65/100 [00:08<00:04,  7.43it/s] 66%|██████▌   | 66/100 [00:08<00:04,  7.43it/s] 67%|██████▋   | 67/100 [00:09<00:04,  7.43it/s] 68%|██████▊   | 68/100 [00:09<00:04,  7.43it/s] 69%|██████▉   | 69/100 [00:09<00:04,  7.44it/s] 70%|███████   | 70/100 [00:09<00:04,  7.43it/s] 71%|███████   | 71/100 [00:09<00:03,  7.36it/s] 72%|███████▏  | 72/100 [00:09<00:03,  7.32it/s] 73%|███████▎  | 73/100 [00:09<00:03,  7.35it/s] 74%|███████▍  | 74/100 [00:10<00:03,  7.38it/s] 75%|███████▌  | 75/100 [00:10<00:03,  7.39it/s] 76%|███████▌  | 76/100 [00:10<00:03,  7.40it/s] 77%|███████▋  | 77/100 [00:10<00:03,  7.42it/s] 78%|███████▊  | 78/100 [00:10<00:02,  7.42it/s] 79%|███████▉  | 79/100 [00:10<00:02,  7.43it/s] 80%|████████  | 80/100 [00:10<00:02,  7.43it/s] 81%|████████  | 81/100 [00:10<00:02,  7.42it/s] 82%|████████▏ | 82/100 [00:11<00:02,  7.39it/s] 83%|████████▎ | 83/100 [00:11<00:02,  7.41it/s] 84%|████████▍ | 84/100 [00:11<00:02,  7.42it/s] 85%|████████▌ | 85/100 [00:11<00:02,  7.42it/s] 86%|████████▌ | 86/100 [00:11<00:01,  7.42it/s] 87%|████████▋ | 87/100 [00:11<00:01,  7.42it/s] 88%|████████▊ | 88/100 [00:11<00:01,  7.42it/s] 89%|████████▉ | 89/100 [00:12<00:01,  7.43it/s] 90%|█████████ | 90/100 [00:12<00:01,  7.43it/s] 91%|█████████ | 91/100 [00:12<00:01,  7.43it/s] 92%|█████████▏| 92/100 [00:12<00:01,  7.44it/s] 93%|█████████▎| 93/100 [00:12<00:00,  7.08it/s] 94%|█████████▍| 94/100 [00:12<00:00,  7.18it/s] 95%|█████████▌| 95/100 [00:12<00:00,  7.25it/s] 96%|█████████▌| 96/100 [00:12<00:00,  7.30it/s] 97%|█████████▋| 97/100 [00:13<00:00,  7.35it/s] 98%|█████████▊| 98/100 [00:13<00:00,  7.37it/s] 99%|█████████▉| 99/100 [00:13<00:00,  7.40it/s]100%|██████████| 100/100 [00:13<00:00,  7.40it/s]100%|██████████| 100/100 [00:13<00:00,  7.39it/s]
FOLD 0
Metric    CE Loss  KL wrt Orig
Model                         
llama_7B  6.09168     4.010005
Running fold 1
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:29,  1.07it/s]  6%|▋         | 2/32 [00:02<00:32,  1.07s/it]  9%|▉         | 3/32 [00:03<00:33,  1.15s/it] 12%|█▎        | 4/32 [00:04<00:32,  1.16s/it] 16%|█▌        | 5/32 [00:05<00:32,  1.20s/it] 19%|█▉        | 6/32 [00:07<00:31,  1.23s/it] 22%|██▏       | 7/32 [00:08<00:30,  1.24s/it] 25%|██▌       | 8/32 [00:09<00:29,  1.23s/it] 28%|██▊       | 9/32 [00:10<00:28,  1.23s/it] 31%|███▏      | 10/32 [00:12<00:27,  1.23s/it] 34%|███▍      | 11/32 [00:13<00:25,  1.21s/it] 38%|███▊      | 12/32 [00:14<00:23,  1.20s/it] 41%|████      | 13/32 [00:15<00:22,  1.18s/it] 44%|████▍     | 14/32 [00:16<00:21,  1.17s/it] 47%|████▋     | 15/32 [00:17<00:19,  1.17s/it] 50%|█████     | 16/32 [00:18<00:18,  1.17s/it] 53%|█████▎    | 17/32 [00:20<00:17,  1.16s/it] 56%|█████▋    | 18/32 [00:21<00:16,  1.16s/it] 59%|█████▉    | 19/32 [00:22<00:15,  1.18s/it] 62%|██████▎   | 20/32 [00:23<00:14,  1.21s/it] 66%|██████▌   | 21/32 [00:25<00:13,  1.22s/it] 69%|██████▉   | 22/32 [00:26<00:12,  1.23s/it] 72%|███████▏  | 23/32 [00:27<00:11,  1.24s/it] 75%|███████▌  | 24/32 [00:28<00:10,  1.26s/it] 78%|███████▊  | 25/32 [00:30<00:08,  1.27s/it] 81%|████████▏ | 26/32 [00:31<00:07,  1.26s/it] 84%|████████▍ | 27/32 [00:32<00:06,  1.27s/it] 88%|████████▊ | 28/32 [00:33<00:05,  1.27s/it] 91%|█████████ | 29/32 [00:35<00:03,  1.27s/it] 94%|█████████▍| 30/32 [00:36<00:02,  1.26s/it] 97%|█████████▋| 31/32 [00:37<00:01,  1.26s/it]100%|██████████| 32/32 [00:39<00:00,  1.31s/it]100%|██████████| 32/32 [00:39<00:00,  1.22s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
[[0.666 0.672 0.662 ... 0.668 0.662 0.67 ]
 [0.662 0.662 0.659 ... 0.677 0.666 0.663]
 [0.668 0.67  0.68  ... 0.661 0.665 0.671]
 ...
 [0.758 0.75  0.674 ... 0.716 0.694 0.677]
 [0.749 0.671 0.686 ... 0.674 0.762 0.76 ]
 [0.765 0.805 0.748 ... 0.743 0.787 0.775]]
Heads intervened:  [(5, 10), (8, 16), (11, 16), (11, 17), (12, 4), (12, 22), (13, 8), (13, 10), (13, 16), (13, 21), (14, 2), (15, 1), (15, 10), (15, 28), (16, 3), (16, 4), (16, 17), (16, 26), (16, 30), (17, 4), (17, 13), (17, 17), (17, 19), (17, 29), (18, 29), (19, 13), (19, 17), (19, 28), (19, 31), (20, 22), (20, 30), (21, 23), (22, 16), (23, 3), (23, 4), (23, 12), (23, 13), (23, 25), (26, 13), (27, 3), (27, 7), (30, 4), (30, 18), (30, 23), (31, 1), (31, 6), (31, 10), (31, 18)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 255.91it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-30ec7b2da7888791.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-4e53eea82b0ecfef.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  2%|▏         | 2/100 [00:00<00:06, 14.42it/s]  4%|▍         | 4/100 [00:00<00:06, 15.46it/s]  6%|▌         | 6/100 [00:00<00:05, 15.84it/s]  8%|▊         | 8/100 [00:00<00:05, 16.01it/s] 10%|█         | 10/100 [00:00<00:05, 16.12it/s] 12%|█▏        | 12/100 [00:00<00:05, 16.18it/s] 14%|█▍        | 14/100 [00:00<00:05, 16.22it/s] 16%|█▌        | 16/100 [00:00<00:05, 16.25it/s] 18%|█▊        | 18/100 [00:01<00:05, 16.27it/s] 20%|██        | 20/100 [00:01<00:04, 16.28it/s] 22%|██▏       | 22/100 [00:01<00:04, 16.29it/s] 24%|██▍       | 24/100 [00:01<00:04, 16.28it/s] 26%|██▌       | 26/100 [00:01<00:04, 16.26it/s] 28%|██▊       | 28/100 [00:01<00:04, 16.27it/s] 30%|███       | 30/100 [00:01<00:04, 16.28it/s] 32%|███▏      | 32/100 [00:01<00:04, 16.27it/s] 34%|███▍      | 34/100 [00:02<00:04, 16.28it/s] 36%|███▌      | 36/100 [00:02<00:03, 16.29it/s] 38%|███▊      | 38/100 [00:02<00:03, 16.29it/s] 40%|████      | 40/100 [00:02<00:03, 16.30it/s] 42%|████▏     | 42/100 [00:02<00:03, 16.30it/s] 44%|████▍     | 44/100 [00:02<00:03, 16.30it/s] 46%|████▌     | 46/100 [00:02<00:03, 16.31it/s] 48%|████▊     | 48/100 [00:02<00:03, 16.30it/s] 50%|█████     | 50/100 [00:03<00:03, 16.30it/s] 52%|█████▏    | 52/100 [00:03<00:02, 16.29it/s] 54%|█████▍    | 54/100 [00:03<00:02, 16.30it/s] 56%|█████▌    | 56/100 [00:03<00:02, 16.30it/s] 58%|█████▊    | 58/100 [00:03<00:02, 16.19it/s] 60%|██████    | 60/100 [00:03<00:02, 16.14it/s] 62%|██████▏   | 62/100 [00:03<00:02, 16.18it/s] 64%|██████▍   | 64/100 [00:03<00:02, 16.22it/s] 66%|██████▌   | 66/100 [00:04<00:02, 16.26it/s] 68%|██████▊   | 68/100 [00:04<00:01, 16.28it/s] 70%|███████   | 70/100 [00:04<00:01, 16.30it/s] 72%|███████▏  | 72/100 [00:04<00:01, 16.30it/s] 74%|███████▍  | 74/100 [00:04<00:01, 16.31it/s] 76%|███████▌  | 76/100 [00:04<00:01, 16.32it/s] 78%|███████▊  | 78/100 [00:04<00:01, 16.33it/s] 80%|████████  | 80/100 [00:04<00:01, 16.33it/s] 82%|████████▏ | 82/100 [00:05<00:01, 16.33it/s] 84%|████████▍ | 84/100 [00:05<00:00, 16.33it/s] 86%|████████▌ | 86/100 [00:05<00:00, 16.33it/s] 88%|████████▊ | 88/100 [00:05<00:00, 16.33it/s] 90%|█████████ | 90/100 [00:05<00:00, 16.34it/s] 92%|█████████▏| 92/100 [00:05<00:00, 16.17it/s] 94%|█████████▍| 94/100 [00:05<00:00, 16.15it/s] 96%|█████████▌| 96/100 [00:05<00:00, 16.18it/s] 98%|█████████▊| 98/100 [00:06<00:00, 16.22it/s]100%|██████████| 100/100 [00:06<00:00, 16.23it/s]100%|██████████| 100/100 [00:06<00:00, 16.23it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 353.74it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-14295f39edd20556.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-10ca04ba0c7bb427.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:18,  5.43it/s]  2%|▏         | 2/100 [00:00<00:16,  5.81it/s]  3%|▎         | 3/100 [00:00<00:15,  6.29it/s]  4%|▍         | 4/100 [00:00<00:14,  6.60it/s]  5%|▌         | 5/100 [00:00<00:14,  6.73it/s]  6%|▌         | 6/100 [00:00<00:13,  6.81it/s]  7%|▋         | 7/100 [00:01<00:13,  6.97it/s]  8%|▊         | 8/100 [00:01<00:12,  7.10it/s]  9%|▉         | 9/100 [00:01<00:13,  6.98it/s] 10%|█         | 10/100 [00:01<00:12,  7.02it/s] 11%|█         | 11/100 [00:01<00:12,  6.86it/s] 12%|█▏        | 12/100 [00:01<00:12,  6.78it/s] 13%|█▎        | 13/100 [00:01<00:12,  6.83it/s] 14%|█▍        | 14/100 [00:02<00:12,  6.83it/s] 15%|█▌        | 15/100 [00:02<00:12,  6.75it/s] 16%|█▌        | 16/100 [00:02<00:12,  6.66it/s] 17%|█▋        | 17/100 [00:02<00:12,  6.64it/s] 18%|█▊        | 18/100 [00:02<00:12,  6.74it/s] 19%|█▉        | 19/100 [00:02<00:12,  6.70it/s] 20%|██        | 20/100 [00:02<00:11,  6.77it/s] 21%|██        | 21/100 [00:03<00:11,  6.63it/s] 22%|██▏       | 22/100 [00:03<00:11,  6.75it/s] 23%|██▎       | 23/100 [00:03<00:11,  6.68it/s] 24%|██▍       | 24/100 [00:03<00:11,  6.63it/s] 25%|██▌       | 25/100 [00:03<00:11,  6.75it/s] 26%|██▌       | 26/100 [00:03<00:10,  6.90it/s] 27%|██▋       | 27/100 [00:03<00:10,  7.03it/s] 28%|██▊       | 28/100 [00:04<00:10,  7.14it/s] 29%|██▉       | 29/100 [00:04<00:10,  7.03it/s] 30%|███       | 30/100 [00:04<00:09,  7.06it/s] 31%|███       | 31/100 [00:04<00:09,  7.03it/s] 32%|███▏      | 32/100 [00:04<00:09,  7.06it/s] 33%|███▎      | 33/100 [00:04<00:09,  7.08it/s] 34%|███▍      | 34/100 [00:04<00:09,  7.05it/s] 35%|███▌      | 35/100 [00:05<00:09,  7.08it/s] 36%|███▌      | 36/100 [00:05<00:09,  7.06it/s] 37%|███▋      | 37/100 [00:05<00:09,  6.98it/s] 38%|███▊      | 38/100 [00:05<00:08,  7.06it/s] 39%|███▉      | 39/100 [00:05<00:08,  7.15it/s] 40%|████      | 40/100 [00:05<00:08,  7.22it/s] 41%|████      | 41/100 [00:05<00:08,  7.00it/s] 42%|████▏     | 42/100 [00:06<00:08,  6.96it/s] 43%|████▎     | 43/100 [00:06<00:08,  6.84it/s] 44%|████▍     | 44/100 [00:06<00:08,  6.84it/s] 45%|████▌     | 45/100 [00:06<00:07,  6.95it/s] 46%|████▌     | 46/100 [00:06<00:07,  7.01it/s] 47%|████▋     | 47/100 [00:06<00:07,  6.82it/s] 48%|████▊     | 48/100 [00:06<00:07,  6.88it/s] 49%|████▉     | 49/100 [00:07<00:07,  6.67it/s] 50%|█████     | 50/100 [00:07<00:07,  6.62it/s] 51%|█████     | 51/100 [00:07<00:07,  6.62it/s] 52%|█████▏    | 52/100 [00:07<00:07,  6.69it/s] 53%|█████▎    | 53/100 [00:07<00:07,  6.71it/s] 54%|█████▍    | 54/100 [00:07<00:06,  6.83it/s] 55%|█████▌    | 55/100 [00:08<00:06,  6.65it/s] 56%|█████▌    | 56/100 [00:08<00:06,  6.55it/s] 57%|█████▋    | 57/100 [00:08<00:06,  6.57it/s] 58%|█████▊    | 58/100 [00:08<00:06,  6.63it/s] 59%|█████▉    | 59/100 [00:08<00:06,  6.83it/s] 60%|██████    | 60/100 [00:08<00:05,  6.95it/s] 61%|██████    | 61/100 [00:08<00:05,  7.06it/s] 62%|██████▏   | 62/100 [00:09<00:05,  7.01it/s] 63%|██████▎   | 63/100 [00:09<00:05,  6.95it/s] 64%|██████▍   | 64/100 [00:09<00:05,  6.84it/s] 65%|██████▌   | 65/100 [00:09<00:05,  6.80it/s] 66%|██████▌   | 66/100 [00:09<00:04,  6.97it/s] 67%|██████▋   | 67/100 [00:09<00:04,  6.83it/s] 68%|██████▊   | 68/100 [00:09<00:04,  6.89it/s] 69%|██████▉   | 69/100 [00:10<00:04,  6.81it/s] 70%|███████   | 70/100 [00:10<00:04,  6.75it/s] 71%|███████   | 71/100 [00:10<00:04,  6.78it/s] 72%|███████▏  | 72/100 [00:10<00:04,  6.80it/s] 73%|███████▎  | 73/100 [00:10<00:03,  6.79it/s] 74%|███████▍  | 74/100 [00:10<00:03,  6.86it/s] 75%|███████▌  | 75/100 [00:10<00:03,  6.88it/s] 76%|███████▌  | 76/100 [00:11<00:03,  6.92it/s] 77%|███████▋  | 77/100 [00:11<00:03,  7.06it/s] 78%|███████▊  | 78/100 [00:11<00:03,  7.07it/s] 79%|███████▉  | 79/100 [00:11<00:02,  7.02it/s] 80%|████████  | 80/100 [00:11<00:02,  7.00it/s] 81%|████████  | 81/100 [00:11<00:02,  7.12it/s] 82%|████████▏ | 82/100 [00:11<00:02,  7.20it/s] 83%|████████▎ | 83/100 [00:12<00:02,  7.26it/s] 84%|████████▍ | 84/100 [00:12<00:02,  7.11it/s] 85%|████████▌ | 85/100 [00:12<00:02,  7.02it/s] 86%|████████▌ | 86/100 [00:12<00:02,  6.86it/s] 87%|████████▋ | 87/100 [00:12<00:01,  7.01it/s] 88%|████████▊ | 88/100 [00:12<00:01,  7.01it/s] 89%|████████▉ | 89/100 [00:12<00:01,  6.93it/s] 90%|█████████ | 90/100 [00:13<00:01,  7.01it/s] 91%|█████████ | 91/100 [00:13<00:01,  6.93it/s] 92%|█████████▏| 92/100 [00:13<00:01,  6.88it/s] 93%|█████████▎| 93/100 [00:13<00:01,  6.93it/s] 94%|█████████▍| 94/100 [00:13<00:00,  7.06it/s] 95%|█████████▌| 95/100 [00:13<00:00,  7.16it/s] 96%|█████████▌| 96/100 [00:13<00:00,  7.23it/s] 97%|█████████▋| 97/100 [00:14<00:00,  7.28it/s] 98%|█████████▊| 98/100 [00:14<00:00,  7.30it/s] 99%|█████████▉| 99/100 [00:14<00:00,  7.28it/s]100%|██████████| 100/100 [00:14<00:00,  7.30it/s]100%|██████████| 100/100 [00:14<00:00,  6.90it/s]
FOLD 1
Metric      CE Loss  KL wrt Orig
Model                           
llama_7B  14.934219     12.66209
[10.51294922  8.33604775]
2023-12-04 01:19:33.260591: I tensorflow/core/util/port.cc:110] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2023-12-04 01:19:33.309935: I tensorflow/core/platform/cpu_feature_guard.cc:182] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-12-04 01:19:34.057304: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Could not find TensorRT
Found cached dataset truthful_qa (/home/elicer/.cache/huggingface/datasets/truthful_qa/multiple_choice/1.1.0/63502f6bc6ee493830ce0843991b028d0ab568d221896b2ee3b8a5dfdaa9d7f4)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 381.13it/s]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:00<00:00,  5.34it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  6.16it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  6.02it/s]
head_wise_activation_length:(11012, 32, 4096)
labels_shape:(11012,)
seperated_head_activation shape:11013
Running fold 0
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:28,  1.10it/s]  6%|▋         | 2/32 [00:01<00:27,  1.08it/s]  9%|▉         | 3/32 [00:02<00:26,  1.11it/s] 12%|█▎        | 4/32 [00:03<00:24,  1.13it/s] 16%|█▌        | 5/32 [00:04<00:23,  1.13it/s] 19%|█▉        | 6/32 [00:05<00:23,  1.11it/s] 22%|██▏       | 7/32 [00:06<00:22,  1.10it/s] 25%|██▌       | 8/32 [00:07<00:22,  1.07it/s] 28%|██▊       | 9/32 [00:08<00:21,  1.05it/s] 31%|███▏      | 10/32 [00:09<00:21,  1.02it/s] 34%|███▍      | 11/32 [00:10<00:21,  1.01s/it] 38%|███▊      | 12/32 [00:11<00:20,  1.01s/it] 41%|████      | 13/32 [00:12<00:19,  1.02s/it] 44%|████▍     | 14/32 [00:13<00:18,  1.05s/it] 47%|████▋     | 15/32 [00:14<00:17,  1.04s/it] 50%|█████     | 16/32 [00:15<00:16,  1.05s/it] 53%|█████▎    | 17/32 [00:16<00:15,  1.05s/it] 56%|█████▋    | 18/32 [00:17<00:14,  1.06s/it] 59%|█████▉    | 19/32 [00:18<00:14,  1.09s/it] 62%|██████▎   | 20/32 [00:20<00:13,  1.11s/it] 66%|██████▌   | 21/32 [00:21<00:12,  1.12s/it] 69%|██████▉   | 22/32 [00:22<00:11,  1.10s/it] 72%|███████▏  | 23/32 [00:23<00:10,  1.13s/it] 75%|███████▌  | 24/32 [00:24<00:09,  1.18s/it] 78%|███████▊  | 25/32 [00:25<00:08,  1.16s/it] 81%|████████▏ | 26/32 [00:27<00:06,  1.15s/it] 84%|████████▍ | 27/32 [00:28<00:05,  1.18s/it] 88%|████████▊ | 28/32 [00:29<00:04,  1.13s/it] 91%|█████████ | 29/32 [00:30<00:03,  1.14s/it] 94%|█████████▍| 30/32 [00:31<00:02,  1.12s/it] 97%|█████████▋| 31/32 [00:32<00:01,  1.13s/it]100%|██████████| 32/32 [00:34<00:00,  1.22s/it]100%|██████████| 32/32 [00:34<00:00,  1.07s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
/home/elicer/honest_llama/validation/../TruthfulQA/truthfulqa/metrics.py:284: FutureWarning: load_metric is deprecated and will be removed in the next major version of datasets. Use 'evaluate.load' instead, from the new library 🤗 Evaluate: https://huggingface.co/docs/evaluate
  bleurt = load_metric("bleurt", cache_dir=cache_dir)
[[0.651 0.665 0.645 ... 0.646 0.647 0.652]
 [0.659 0.644 0.645 ... 0.648 0.658 0.656]
 [0.651 0.657 0.685 ... 0.637 0.648 0.667]
 ...
 [0.765 0.762 0.657 ... 0.73  0.704 0.674]
 [0.748 0.678 0.696 ... 0.663 0.769 0.786]
 [0.775 0.815 0.74  ... 0.697 0.809 0.79 ]]
Heads intervened:  [(8, 16), (12, 4), (13, 8), (13, 16), (16, 30), (17, 29), (18, 29), (19, 17), (20, 30), (22, 16), (23, 3), (31, 6)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
2023-12-04 01:20:23.927232: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1635] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 24961 MB memory:  -> device: 0, name: NVIDIA A100 80GB PCIe MIG 3g.40gb, pci bus id: 0000:65:00.0, compute capability: 8.0
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 299.44it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-ec0cf83741fdb3e8.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-d31e6c0c76fafb4d.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:01<01:41,  1.02s/it]  3%|▎         | 3/100 [00:01<00:29,  3.27it/s]  5%|▌         | 5/100 [00:01<00:16,  5.68it/s]  7%|▋         | 7/100 [00:01<00:11,  8.05it/s]  9%|▉         | 9/100 [00:01<00:08, 10.24it/s] 11%|█         | 11/100 [00:01<00:07, 11.96it/s] 13%|█▎        | 13/100 [00:01<00:06, 13.57it/s] 15%|█▌        | 15/100 [00:01<00:05, 14.87it/s] 17%|█▋        | 17/100 [00:01<00:05, 15.89it/s] 19%|█▉        | 19/100 [00:01<00:04, 16.65it/s] 21%|██        | 21/100 [00:02<00:04, 17.21it/s] 23%|██▎       | 23/100 [00:02<00:04, 17.62it/s] 25%|██▌       | 25/100 [00:02<00:04, 17.89it/s] 27%|██▋       | 27/100 [00:02<00:04, 18.11it/s] 29%|██▉       | 29/100 [00:02<00:03, 18.27it/s] 31%|███       | 31/100 [00:02<00:03, 18.37it/s] 33%|███▎      | 33/100 [00:02<00:03, 18.45it/s] 35%|███▌      | 35/100 [00:02<00:03, 18.52it/s] 37%|███▋      | 37/100 [00:02<00:03, 18.56it/s] 39%|███▉      | 39/100 [00:03<00:03, 18.58it/s] 41%|████      | 41/100 [00:03<00:03, 18.60it/s] 43%|████▎     | 43/100 [00:03<00:03, 18.62it/s] 45%|████▌     | 45/100 [00:03<00:02, 18.63it/s] 47%|████▋     | 47/100 [00:03<00:02, 18.64it/s] 49%|████▉     | 49/100 [00:03<00:02, 18.57it/s] 51%|█████     | 51/100 [00:03<00:02, 18.29it/s] 53%|█████▎    | 53/100 [00:03<00:02, 18.36it/s] 55%|█████▌    | 55/100 [00:03<00:02, 18.40it/s] 57%|█████▋    | 57/100 [00:04<00:02, 18.43it/s] 59%|█████▉    | 59/100 [00:04<00:02, 17.77it/s] 61%|██████    | 61/100 [00:04<00:02, 17.84it/s] 63%|██████▎   | 63/100 [00:04<00:02, 17.98it/s] 65%|██████▌   | 65/100 [00:04<00:01, 18.07it/s] 67%|██████▋   | 67/100 [00:04<00:01, 18.24it/s] 69%|██████▉   | 69/100 [00:04<00:01, 18.34it/s] 71%|███████   | 71/100 [00:04<00:01, 18.38it/s] 73%|███████▎  | 73/100 [00:04<00:01, 18.38it/s] 75%|███████▌  | 75/100 [00:05<00:01, 18.42it/s] 77%|███████▋  | 77/100 [00:05<00:01, 18.45it/s] 79%|███████▉  | 79/100 [00:05<00:01, 18.47it/s] 81%|████████  | 81/100 [00:05<00:01, 18.27it/s] 83%|████████▎ | 83/100 [00:05<00:00, 18.23it/s] 85%|████████▌ | 85/100 [00:05<00:00, 18.33it/s] 87%|████████▋ | 87/100 [00:05<00:00, 18.34it/s] 89%|████████▉ | 89/100 [00:05<00:00, 17.80it/s] 91%|█████████ | 91/100 [00:05<00:00, 17.94it/s] 93%|█████████▎| 93/100 [00:06<00:00, 17.95it/s] 95%|█████████▌| 95/100 [00:06<00:00, 17.92it/s] 97%|█████████▋| 97/100 [00:06<00:00, 18.05it/s] 99%|█████████▉| 99/100 [00:06<00:00, 18.23it/s]100%|██████████| 100/100 [00:06<00:00, 15.58it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 317.27it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-1939fcc1eeebdaa7.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-785bb4b6f2089589.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:17,  5.66it/s]  2%|▏         | 2/100 [00:00<00:15,  6.24it/s]  3%|▎         | 3/100 [00:00<00:14,  6.84it/s]  4%|▍         | 4/100 [00:00<00:13,  6.99it/s]  5%|▌         | 5/100 [00:00<00:13,  7.06it/s]  6%|▌         | 6/100 [00:00<00:13,  6.99it/s]  7%|▋         | 7/100 [00:01<00:12,  7.17it/s]  8%|▊         | 8/100 [00:01<00:12,  7.15it/s]  9%|▉         | 9/100 [00:01<00:12,  7.33it/s] 10%|█         | 10/100 [00:01<00:12,  7.46it/s] 11%|█         | 11/100 [00:01<00:12,  7.21it/s] 12%|█▏        | 12/100 [00:01<00:11,  7.37it/s] 13%|█▎        | 13/100 [00:01<00:11,  7.34it/s] 14%|█▍        | 14/100 [00:01<00:11,  7.46it/s] 15%|█▌        | 15/100 [00:02<00:11,  7.47it/s] 16%|█▌        | 16/100 [00:02<00:11,  7.36it/s] 17%|█▋        | 17/100 [00:02<00:11,  7.47it/s] 18%|█▊        | 18/100 [00:02<00:10,  7.50it/s] 19%|█▉        | 19/100 [00:02<00:11,  7.35it/s] 20%|██        | 20/100 [00:02<00:10,  7.46it/s] 21%|██        | 21/100 [00:02<00:10,  7.55it/s] 22%|██▏       | 22/100 [00:03<00:10,  7.43it/s] 23%|██▎       | 23/100 [00:03<00:10,  7.31it/s] 24%|██▍       | 24/100 [00:03<00:10,  7.26it/s] 25%|██▌       | 25/100 [00:03<00:10,  7.40it/s] 26%|██▌       | 26/100 [00:03<00:09,  7.48it/s] 27%|██▋       | 27/100 [00:03<00:09,  7.42it/s] 28%|██▊       | 28/100 [00:03<00:09,  7.33it/s] 29%|██▉       | 29/100 [00:03<00:09,  7.24it/s] 30%|███       | 30/100 [00:04<00:09,  7.38it/s] 31%|███       | 31/100 [00:04<00:09,  7.49it/s] 32%|███▏      | 32/100 [00:04<00:09,  7.38it/s] 33%|███▎      | 33/100 [00:04<00:09,  7.36it/s] 34%|███▍      | 34/100 [00:04<00:08,  7.41it/s] 35%|███▌      | 35/100 [00:04<00:08,  7.38it/s] 36%|███▌      | 36/100 [00:04<00:08,  7.48it/s] 37%|███▋      | 37/100 [00:05<00:08,  7.58it/s] 38%|███▊      | 38/100 [00:05<00:08,  7.59it/s] 39%|███▉      | 39/100 [00:05<00:07,  7.65it/s] 40%|████      | 40/100 [00:05<00:08,  7.45it/s] 41%|████      | 41/100 [00:05<00:07,  7.51it/s] 42%|████▏     | 42/100 [00:05<00:07,  7.36it/s] 43%|████▎     | 43/100 [00:05<00:07,  7.19it/s] 44%|████▍     | 44/100 [00:06<00:07,  7.35it/s] 45%|████▌     | 45/100 [00:06<00:07,  7.47it/s] 46%|████▌     | 46/100 [00:06<00:07,  7.26it/s] 47%|████▋     | 47/100 [00:06<00:07,  7.25it/s] 48%|████▊     | 48/100 [00:06<00:07,  7.20it/s] 49%|████▉     | 49/100 [00:06<00:07,  7.17it/s] 50%|█████     | 50/100 [00:06<00:06,  7.21it/s] 51%|█████     | 51/100 [00:06<00:06,  7.23it/s] 52%|█████▏    | 52/100 [00:07<00:06,  7.38it/s] 53%|█████▎    | 53/100 [00:07<00:06,  7.27it/s] 54%|█████▍    | 54/100 [00:07<00:06,  7.14it/s] 55%|█████▌    | 55/100 [00:07<00:06,  7.28it/s] 56%|█████▌    | 56/100 [00:07<00:06,  7.19it/s] 57%|█████▋    | 57/100 [00:07<00:06,  7.06it/s] 58%|█████▊    | 58/100 [00:07<00:05,  7.18it/s] 59%|█████▉    | 59/100 [00:08<00:05,  7.15it/s] 60%|██████    | 60/100 [00:08<00:05,  7.24it/s] 61%|██████    | 61/100 [00:08<00:05,  7.39it/s] 62%|██████▏   | 62/100 [00:08<00:05,  7.42it/s] 63%|██████▎   | 63/100 [00:08<00:05,  7.38it/s] 64%|██████▍   | 64/100 [00:08<00:04,  7.28it/s] 65%|██████▌   | 65/100 [00:08<00:04,  7.34it/s] 66%|██████▌   | 66/100 [00:09<00:04,  7.38it/s] 67%|██████▋   | 67/100 [00:09<00:04,  7.23it/s] 68%|██████▊   | 68/100 [00:09<00:04,  7.05it/s] 69%|██████▉   | 69/100 [00:09<00:04,  7.24it/s] 70%|███████   | 70/100 [00:09<00:04,  7.20it/s] 71%|███████   | 71/100 [00:09<00:03,  7.34it/s] 72%|███████▏  | 72/100 [00:09<00:03,  7.17it/s] 73%|███████▎  | 73/100 [00:10<00:03,  7.08it/s] 74%|███████▍  | 74/100 [00:10<00:03,  7.07it/s] 75%|███████▌  | 75/100 [00:10<00:03,  7.19it/s] 76%|███████▌  | 76/100 [00:10<00:03,  7.02it/s] 77%|███████▋  | 77/100 [00:10<00:03,  7.23it/s] 78%|███████▊  | 78/100 [00:10<00:03,  7.25it/s] 79%|███████▉  | 79/100 [00:10<00:02,  7.24it/s] 80%|████████  | 80/100 [00:10<00:02,  7.31it/s] 81%|████████  | 81/100 [00:11<00:02,  7.44it/s] 82%|████████▏ | 82/100 [00:11<00:02,  7.40it/s] 83%|████████▎ | 83/100 [00:11<00:02,  7.43it/s] 84%|████████▍ | 84/100 [00:11<00:02,  7.53it/s] 85%|████████▌ | 85/100 [00:11<00:01,  7.60it/s] 86%|████████▌ | 86/100 [00:11<00:01,  7.17it/s] 87%|████████▋ | 87/100 [00:11<00:01,  7.14it/s] 88%|████████▊ | 88/100 [00:12<00:01,  7.32it/s] 89%|████████▉ | 89/100 [00:12<00:01,  7.45it/s] 90%|█████████ | 90/100 [00:12<00:01,  7.53it/s] 91%|█████████ | 91/100 [00:12<00:01,  7.45it/s] 92%|█████████▏| 92/100 [00:12<00:01,  7.45it/s] 93%|█████████▎| 93/100 [00:12<00:00,  7.54it/s] 94%|█████████▍| 94/100 [00:12<00:00,  7.45it/s] 95%|█████████▌| 95/100 [00:12<00:00,  7.54it/s] 96%|█████████▌| 96/100 [00:13<00:00,  7.60it/s] 97%|█████████▋| 97/100 [00:13<00:00,  7.37it/s] 98%|█████████▊| 98/100 [00:13<00:00,  7.23it/s] 99%|█████████▉| 99/100 [00:13<00:00,  7.31it/s]100%|██████████| 100/100 [00:13<00:00,  7.30it/s]100%|██████████| 100/100 [00:13<00:00,  7.31it/s]
FOLD 0
Metric     CE Loss  KL wrt Orig
Model                          
llama_7B  2.411748     0.260849
Running fold 1
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:28,  1.09it/s]  6%|▋         | 2/32 [00:02<00:31,  1.06s/it]  9%|▉         | 3/32 [00:03<00:32,  1.14s/it] 12%|█▎        | 4/32 [00:04<00:32,  1.15s/it] 16%|█▌        | 5/32 [00:05<00:31,  1.18s/it] 19%|█▉        | 6/32 [00:06<00:31,  1.21s/it] 22%|██▏       | 7/32 [00:08<00:30,  1.21s/it] 25%|██▌       | 8/32 [00:09<00:28,  1.21s/it] 28%|██▊       | 9/32 [00:10<00:27,  1.21s/it] 31%|███▏      | 10/32 [00:11<00:26,  1.21s/it] 34%|███▍      | 11/32 [00:12<00:24,  1.19s/it] 38%|███▊      | 12/32 [00:14<00:23,  1.17s/it] 41%|████      | 13/32 [00:15<00:22,  1.16s/it] 44%|████▍     | 14/32 [00:16<00:20,  1.15s/it] 47%|████▋     | 15/32 [00:17<00:19,  1.15s/it] 50%|█████     | 16/32 [00:18<00:18,  1.16s/it] 53%|█████▎    | 17/32 [00:19<00:17,  1.15s/it] 56%|█████▋    | 18/32 [00:20<00:16,  1.16s/it] 59%|█████▉    | 19/32 [00:22<00:15,  1.18s/it] 62%|██████▎   | 20/32 [00:23<00:14,  1.22s/it] 66%|██████▌   | 21/32 [00:24<00:13,  1.22s/it] 69%|██████▉   | 22/32 [00:25<00:12,  1.22s/it] 72%|███████▏  | 23/32 [00:27<00:11,  1.23s/it] 75%|███████▌  | 24/32 [00:28<00:10,  1.25s/it] 78%|███████▊  | 25/32 [00:29<00:08,  1.25s/it] 81%|████████▏ | 26/32 [00:30<00:07,  1.25s/it] 84%|████████▍ | 27/32 [00:32<00:06,  1.26s/it] 88%|████████▊ | 28/32 [00:33<00:05,  1.25s/it] 91%|█████████ | 29/32 [00:34<00:03,  1.26s/it] 94%|█████████▍| 30/32 [00:36<00:02,  1.25s/it] 97%|█████████▋| 31/32 [00:37<00:01,  1.25s/it]100%|██████████| 32/32 [00:38<00:00,  1.31s/it]100%|██████████| 32/32 [00:38<00:00,  1.21s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
[[0.666 0.672 0.662 ... 0.668 0.662 0.67 ]
 [0.662 0.662 0.659 ... 0.677 0.666 0.663]
 [0.668 0.67  0.68  ... 0.661 0.665 0.671]
 ...
 [0.758 0.75  0.674 ... 0.716 0.694 0.677]
 [0.749 0.671 0.686 ... 0.674 0.762 0.76 ]
 [0.765 0.805 0.748 ... 0.743 0.787 0.775]]
Heads intervened:  [(8, 16), (11, 17), (12, 4), (13, 8), (13, 16), (16, 17), (17, 13), (17, 29), (18, 29), (19, 17), (20, 30), (23, 3)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 256.97it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-30ec7b2da7888791.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-4e53eea82b0ecfef.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  2%|▏         | 2/100 [00:00<00:05, 16.91it/s]  4%|▍         | 4/100 [00:00<00:05, 18.02it/s]  6%|▌         | 6/100 [00:00<00:05, 18.14it/s]  8%|▊         | 8/100 [00:00<00:05, 18.34it/s] 10%|█         | 10/100 [00:00<00:04, 18.52it/s] 12%|█▏        | 12/100 [00:00<00:04, 18.63it/s] 14%|█▍        | 14/100 [00:00<00:04, 18.71it/s] 16%|█▌        | 16/100 [00:00<00:04, 18.76it/s] 18%|█▊        | 18/100 [00:00<00:04, 18.80it/s] 20%|██        | 20/100 [00:01<00:04, 18.82it/s] 22%|██▏       | 22/100 [00:01<00:04, 18.83it/s] 24%|██▍       | 24/100 [00:01<00:04, 18.84it/s] 26%|██▌       | 26/100 [00:01<00:03, 18.86it/s] 28%|██▊       | 28/100 [00:01<00:03, 18.85it/s] 30%|███       | 30/100 [00:01<00:03, 18.85it/s] 32%|███▏      | 32/100 [00:01<00:03, 18.87it/s] 34%|███▍      | 34/100 [00:01<00:03, 18.87it/s] 36%|███▌      | 36/100 [00:01<00:03, 18.87it/s] 38%|███▊      | 38/100 [00:02<00:03, 18.87it/s] 40%|████      | 40/100 [00:02<00:03, 18.87it/s] 42%|████▏     | 42/100 [00:02<00:03, 18.90it/s] 44%|████▍     | 44/100 [00:02<00:02, 18.90it/s] 46%|████▌     | 46/100 [00:02<00:02, 18.68it/s] 48%|████▊     | 48/100 [00:02<00:02, 18.74it/s] 50%|█████     | 50/100 [00:02<00:02, 18.78it/s] 52%|█████▏    | 52/100 [00:02<00:02, 18.83it/s] 54%|█████▍    | 54/100 [00:02<00:02, 18.85it/s] 56%|█████▌    | 56/100 [00:02<00:02, 18.87it/s] 58%|█████▊    | 58/100 [00:03<00:02, 18.89it/s] 60%|██████    | 60/100 [00:03<00:02, 18.90it/s] 62%|██████▏   | 62/100 [00:03<00:02, 18.90it/s] 64%|██████▍   | 64/100 [00:03<00:01, 18.91it/s] 66%|██████▌   | 66/100 [00:03<00:01, 18.90it/s] 68%|██████▊   | 68/100 [00:03<00:01, 18.91it/s] 70%|███████   | 70/100 [00:03<00:01, 18.92it/s] 72%|███████▏  | 72/100 [00:03<00:01, 18.92it/s] 74%|███████▍  | 74/100 [00:03<00:01, 18.93it/s] 76%|███████▌  | 76/100 [00:04<00:01, 18.93it/s] 78%|███████▊  | 78/100 [00:04<00:01, 18.93it/s] 80%|████████  | 80/100 [00:04<00:01, 18.93it/s] 82%|████████▏ | 82/100 [00:04<00:00, 18.92it/s] 84%|████████▍ | 84/100 [00:04<00:00, 18.76it/s] 86%|████████▌ | 86/100 [00:04<00:00, 18.74it/s] 88%|████████▊ | 88/100 [00:04<00:00, 18.78it/s] 90%|█████████ | 90/100 [00:04<00:00, 18.81it/s] 92%|█████████▏| 92/100 [00:04<00:00, 18.85it/s] 94%|█████████▍| 94/100 [00:04<00:00, 18.88it/s] 96%|█████████▌| 96/100 [00:05<00:00, 18.88it/s] 98%|█████████▊| 98/100 [00:05<00:00, 18.90it/s]100%|██████████| 100/100 [00:05<00:00, 18.90it/s]100%|██████████| 100/100 [00:05<00:00, 18.81it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 350.02it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-14295f39edd20556.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-10ca04ba0c7bb427.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:15,  6.22it/s]  2%|▏         | 2/100 [00:00<00:15,  6.23it/s]  3%|▎         | 3/100 [00:00<00:14,  6.72it/s]  4%|▍         | 4/100 [00:00<00:14,  6.77it/s]  5%|▌         | 5/100 [00:00<00:13,  7.12it/s]  6%|▌         | 6/100 [00:00<00:13,  6.92it/s]  7%|▋         | 7/100 [00:01<00:13,  6.91it/s]  8%|▊         | 8/100 [00:01<00:13,  7.05it/s]  9%|▉         | 9/100 [00:01<00:12,  7.27it/s] 10%|█         | 10/100 [00:01<00:12,  7.23it/s] 11%|█         | 11/100 [00:01<00:12,  7.14it/s] 12%|█▏        | 12/100 [00:01<00:12,  6.99it/s] 13%|█▎        | 13/100 [00:01<00:12,  7.11it/s] 14%|█▍        | 14/100 [00:01<00:11,  7.26it/s] 15%|█▌        | 15/100 [00:02<00:11,  7.35it/s] 16%|█▌        | 16/100 [00:02<00:11,  7.27it/s] 17%|█▋        | 17/100 [00:02<00:11,  7.25it/s] 18%|█▊        | 18/100 [00:02<00:11,  7.10it/s] 19%|█▉        | 19/100 [00:02<00:11,  7.19it/s] 20%|██        | 20/100 [00:02<00:11,  7.21it/s] 21%|██        | 21/100 [00:02<00:10,  7.27it/s] 22%|██▏       | 22/100 [00:03<00:10,  7.38it/s] 23%|██▎       | 23/100 [00:03<00:10,  7.31it/s] 24%|██▍       | 24/100 [00:03<00:10,  7.44it/s] 25%|██▌       | 25/100 [00:03<00:09,  7.55it/s] 26%|██▌       | 26/100 [00:03<00:10,  7.39it/s] 27%|██▋       | 27/100 [00:03<00:10,  7.14it/s] 28%|██▊       | 28/100 [00:03<00:10,  7.06it/s] 29%|██▉       | 29/100 [00:04<00:10,  6.97it/s] 30%|███       | 30/100 [00:04<00:10,  6.90it/s] 31%|███       | 31/100 [00:04<00:10,  6.77it/s] 32%|███▏      | 32/100 [00:04<00:09,  6.88it/s] 33%|███▎      | 33/100 [00:04<00:09,  6.94it/s] 34%|███▍      | 34/100 [00:04<00:09,  7.18it/s] 35%|███▌      | 35/100 [00:04<00:09,  6.98it/s] 36%|███▌      | 36/100 [00:05<00:09,  6.95it/s] 37%|███▋      | 37/100 [00:05<00:08,  7.18it/s] 38%|███▊      | 38/100 [00:05<00:08,  7.23it/s] 39%|███▉      | 39/100 [00:05<00:08,  7.36it/s] 40%|████      | 40/100 [00:05<00:08,  7.22it/s] 41%|████      | 41/100 [00:05<00:08,  7.11it/s] 42%|████▏     | 42/100 [00:05<00:07,  7.31it/s] 43%|████▎     | 43/100 [00:06<00:07,  7.37it/s] 44%|████▍     | 44/100 [00:06<00:07,  7.23it/s] 45%|████▌     | 45/100 [00:06<00:07,  7.21it/s] 46%|████▌     | 46/100 [00:06<00:07,  7.27it/s] 47%|████▋     | 47/100 [00:06<00:07,  7.23it/s] 48%|████▊     | 48/100 [00:06<00:07,  7.26it/s] 49%|████▉     | 49/100 [00:06<00:07,  7.28it/s] 50%|█████     | 50/100 [00:07<00:06,  7.17it/s] 51%|█████     | 51/100 [00:07<00:06,  7.09it/s] 52%|█████▏    | 52/100 [00:07<00:06,  7.15it/s] 53%|█████▎    | 53/100 [00:07<00:06,  7.11it/s] 54%|█████▍    | 54/100 [00:07<00:06,  7.07it/s] 55%|█████▌    | 55/100 [00:07<00:06,  6.95it/s] 56%|█████▌    | 56/100 [00:07<00:06,  7.11it/s] 57%|█████▋    | 57/100 [00:07<00:05,  7.20it/s] 58%|█████▊    | 58/100 [00:08<00:05,  7.10it/s] 59%|█████▉    | 59/100 [00:08<00:05,  7.20it/s] 60%|██████    | 60/100 [00:08<00:05,  7.28it/s] 61%|██████    | 61/100 [00:08<00:05,  7.39it/s] 62%|██████▏   | 62/100 [00:08<00:05,  7.29it/s] 63%|██████▎   | 63/100 [00:08<00:05,  7.24it/s] 64%|██████▍   | 64/100 [00:08<00:05,  7.19it/s] 65%|██████▌   | 65/100 [00:09<00:04,  7.28it/s] 66%|██████▌   | 66/100 [00:09<00:04,  7.23it/s] 67%|██████▋   | 67/100 [00:09<00:04,  7.08it/s] 68%|██████▊   | 68/100 [00:09<00:04,  7.04it/s] 69%|██████▉   | 69/100 [00:09<00:04,  7.24it/s] 70%|███████   | 70/100 [00:09<00:04,  7.39it/s] 71%|███████   | 71/100 [00:09<00:03,  7.29it/s] 72%|███████▏  | 72/100 [00:10<00:03,  7.43it/s] 73%|███████▎  | 73/100 [00:10<00:03,  7.49it/s] 74%|███████▍  | 74/100 [00:10<00:03,  7.50it/s] 75%|███████▌  | 75/100 [00:10<00:03,  7.37it/s] 76%|███████▌  | 76/100 [00:10<00:03,  7.33it/s] 77%|███████▋  | 77/100 [00:10<00:03,  7.28it/s] 78%|███████▊  | 78/100 [00:10<00:02,  7.40it/s] 79%|███████▉  | 79/100 [00:10<00:02,  7.49it/s] 80%|████████  | 80/100 [00:11<00:02,  7.46it/s] 81%|████████  | 81/100 [00:11<00:02,  7.28it/s] 82%|████████▏ | 82/100 [00:11<00:02,  7.31it/s] 83%|████████▎ | 83/100 [00:11<00:02,  7.44it/s] 84%|████████▍ | 84/100 [00:11<00:02,  7.47it/s] 85%|████████▌ | 85/100 [00:11<00:02,  7.41it/s] 86%|████████▌ | 86/100 [00:11<00:01,  7.05it/s] 87%|████████▋ | 87/100 [00:12<00:01,  6.96it/s] 88%|████████▊ | 88/100 [00:12<00:01,  7.13it/s] 89%|████████▉ | 89/100 [00:12<00:01,  6.96it/s] 90%|█████████ | 90/100 [00:12<00:01,  7.03it/s] 91%|█████████ | 91/100 [00:12<00:01,  6.83it/s] 92%|█████████▏| 92/100 [00:12<00:01,  6.92it/s] 93%|█████████▎| 93/100 [00:12<00:00,  7.15it/s] 94%|█████████▍| 94/100 [00:13<00:00,  6.99it/s] 95%|█████████▌| 95/100 [00:13<00:00,  7.03it/s] 96%|█████████▌| 96/100 [00:13<00:00,  6.92it/s] 97%|█████████▋| 97/100 [00:13<00:00,  6.99it/s] 98%|█████████▊| 98/100 [00:13<00:00,  7.20it/s] 99%|█████████▉| 99/100 [00:13<00:00,  7.19it/s]100%|██████████| 100/100 [00:13<00:00,  7.19it/s]100%|██████████| 100/100 [00:13<00:00,  7.17it/s]
FOLD 1
Metric    CE Loss  KL wrt Orig
Model                         
llama_7B  2.36959     0.302468
[2.39066895 0.28165831]
2023-12-04 01:22:00.322372: I tensorflow/core/util/port.cc:110] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2023-12-04 01:22:00.372489: I tensorflow/core/platform/cpu_feature_guard.cc:182] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-12-04 01:22:01.121108: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Could not find TensorRT
Found cached dataset truthful_qa (/home/elicer/.cache/huggingface/datasets/truthful_qa/multiple_choice/1.1.0/63502f6bc6ee493830ce0843991b028d0ab568d221896b2ee3b8a5dfdaa9d7f4)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 354.34it/s]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:00<00:00,  5.31it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  6.22it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  6.06it/s]
head_wise_activation_length:(11012, 32, 4096)
labels_shape:(11012,)
seperated_head_activation shape:11013
Running fold 0
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:27,  1.11it/s]  6%|▋         | 2/32 [00:01<00:27,  1.08it/s]  9%|▉         | 3/32 [00:02<00:26,  1.11it/s] 12%|█▎        | 4/32 [00:03<00:24,  1.13it/s] 16%|█▌        | 5/32 [00:04<00:24,  1.12it/s] 19%|█▉        | 6/32 [00:05<00:23,  1.11it/s] 22%|██▏       | 7/32 [00:06<00:22,  1.10it/s] 25%|██▌       | 8/32 [00:07<00:22,  1.07it/s] 28%|██▊       | 9/32 [00:08<00:22,  1.04it/s] 31%|███▏      | 10/32 [00:09<00:21,  1.02it/s] 34%|███▍      | 11/32 [00:10<00:21,  1.01s/it] 38%|███▊      | 12/32 [00:11<00:20,  1.01s/it] 41%|████      | 13/32 [00:12<00:19,  1.03s/it] 44%|████▍     | 14/32 [00:13<00:18,  1.05s/it] 47%|████▋     | 15/32 [00:14<00:17,  1.05s/it] 50%|█████     | 16/32 [00:15<00:16,  1.05s/it] 53%|█████▎    | 17/32 [00:16<00:15,  1.06s/it] 56%|█████▋    | 18/32 [00:17<00:14,  1.07s/it] 59%|█████▉    | 19/32 [00:19<00:14,  1.10s/it] 62%|██████▎   | 20/32 [00:20<00:13,  1.11s/it] 66%|██████▌   | 21/32 [00:21<00:12,  1.13s/it] 69%|██████▉   | 22/32 [00:22<00:11,  1.11s/it] 72%|███████▏  | 23/32 [00:23<00:10,  1.14s/it] 75%|███████▌  | 24/32 [00:24<00:09,  1.18s/it] 78%|███████▊  | 25/32 [00:26<00:08,  1.17s/it] 81%|████████▏ | 26/32 [00:27<00:06,  1.15s/it] 84%|████████▍ | 27/32 [00:28<00:05,  1.18s/it] 88%|████████▊ | 28/32 [00:29<00:04,  1.14s/it] 91%|█████████ | 29/32 [00:30<00:03,  1.14s/it] 94%|█████████▍| 30/32 [00:31<00:02,  1.12s/it] 97%|█████████▋| 31/32 [00:32<00:01,  1.13s/it]100%|██████████| 32/32 [00:34<00:00,  1.22s/it]100%|██████████| 32/32 [00:34<00:00,  1.07s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
/home/elicer/honest_llama/validation/../TruthfulQA/truthfulqa/metrics.py:284: FutureWarning: load_metric is deprecated and will be removed in the next major version of datasets. Use 'evaluate.load' instead, from the new library 🤗 Evaluate: https://huggingface.co/docs/evaluate
  bleurt = load_metric("bleurt", cache_dir=cache_dir)
[[0.651 0.665 0.645 ... 0.646 0.647 0.652]
 [0.659 0.644 0.645 ... 0.648 0.658 0.656]
 [0.651 0.657 0.685 ... 0.637 0.648 0.667]
 ...
 [0.765 0.762 0.657 ... 0.73  0.704 0.674]
 [0.748 0.678 0.696 ... 0.663 0.769 0.786]
 [0.775 0.815 0.74  ... 0.697 0.809 0.79 ]]
Heads intervened:  [(8, 16), (12, 4), (12, 15), (13, 8), (13, 16), (15, 28), (16, 30), (17, 13), (17, 17), (17, 29), (18, 29), (19, 13), (19, 17), (20, 22), (20, 30), (22, 16), (22, 30), (23, 3), (23, 7), (23, 13), (25, 15), (31, 1), (31, 6), (31, 30)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
2023-12-04 01:22:52.836133: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1635] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 24961 MB memory:  -> device: 0, name: NVIDIA A100 80GB PCIe MIG 3g.40gb, pci bus id: 0000:65:00.0, compute capability: 8.0
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 277.29it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-ec0cf83741fdb3e8.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-d31e6c0c76fafb4d.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:01<01:41,  1.03s/it]  3%|▎         | 3/100 [00:01<00:29,  3.24it/s]  5%|▌         | 5/100 [00:01<00:16,  5.61it/s]  7%|▋         | 7/100 [00:01<00:11,  7.92it/s]  9%|▉         | 9/100 [00:01<00:09, 10.03it/s] 11%|█         | 11/100 [00:01<00:07, 11.86it/s] 13%|█▎        | 13/100 [00:01<00:06, 13.39it/s] 15%|█▌        | 15/100 [00:01<00:05, 14.59it/s] 17%|█▋        | 17/100 [00:01<00:05, 15.49it/s] 19%|█▉        | 19/100 [00:02<00:05, 16.17it/s] 21%|██        | 21/100 [00:02<00:04, 16.68it/s] 23%|██▎       | 23/100 [00:02<00:04, 17.06it/s] 25%|██▌       | 25/100 [00:02<00:04, 17.33it/s] 27%|██▋       | 27/100 [00:02<00:04, 17.53it/s] 29%|██▉       | 29/100 [00:02<00:04, 17.67it/s] 31%|███       | 31/100 [00:02<00:03, 17.76it/s] 33%|███▎      | 33/100 [00:02<00:03, 17.83it/s] 35%|███▌      | 35/100 [00:02<00:03, 17.88it/s] 37%|███▋      | 37/100 [00:03<00:03, 17.91it/s] 39%|███▉      | 39/100 [00:03<00:03, 17.94it/s] 41%|████      | 41/100 [00:03<00:03, 17.96it/s] 43%|████▎     | 43/100 [00:03<00:03, 17.97it/s] 45%|████▌     | 45/100 [00:03<00:03, 17.97it/s] 47%|████▋     | 47/100 [00:03<00:02, 17.98it/s] 49%|████▉     | 49/100 [00:03<00:02, 17.98it/s] 51%|█████     | 51/100 [00:03<00:02, 17.99it/s] 53%|█████▎    | 53/100 [00:03<00:02, 17.97it/s] 55%|█████▌    | 55/100 [00:04<00:02, 17.95it/s] 57%|█████▋    | 57/100 [00:04<00:02, 17.96it/s] 59%|█████▉    | 59/100 [00:04<00:02, 17.96it/s] 61%|██████    | 61/100 [00:04<00:02, 17.98it/s] 63%|██████▎   | 63/100 [00:04<00:02, 17.99it/s] 65%|██████▌   | 65/100 [00:04<00:01, 18.00it/s] 67%|██████▋   | 67/100 [00:04<00:01, 17.98it/s] 69%|██████▉   | 69/100 [00:04<00:01, 17.99it/s] 71%|███████   | 71/100 [00:04<00:01, 17.99it/s] 73%|███████▎  | 73/100 [00:05<00:01, 17.99it/s] 75%|███████▌  | 75/100 [00:05<00:01, 17.99it/s] 77%|███████▋  | 77/100 [00:05<00:01, 18.00it/s] 79%|███████▉  | 79/100 [00:05<00:01, 17.99it/s] 81%|████████  | 81/100 [00:05<00:01, 17.97it/s] 83%|████████▎ | 83/100 [00:05<00:00, 17.98it/s] 85%|████████▌ | 85/100 [00:05<00:00, 17.99it/s] 87%|████████▋ | 87/100 [00:05<00:00, 17.99it/s] 89%|████████▉ | 89/100 [00:05<00:00, 18.00it/s] 91%|█████████ | 91/100 [00:06<00:00, 17.69it/s] 93%|█████████▎| 93/100 [00:06<00:00, 17.76it/s] 95%|█████████▌| 95/100 [00:06<00:00, 17.84it/s] 97%|█████████▋| 97/100 [00:06<00:00, 17.83it/s] 99%|█████████▉| 99/100 [00:06<00:00, 17.89it/s]100%|██████████| 100/100 [00:06<00:00, 15.29it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 338.50it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-1939fcc1eeebdaa7.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-785bb4b6f2089589.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:17,  5.66it/s]  2%|▏         | 2/100 [00:00<00:15,  6.20it/s]  3%|▎         | 3/100 [00:00<00:14,  6.57it/s]  4%|▍         | 4/100 [00:00<00:13,  6.97it/s]  5%|▌         | 5/100 [00:00<00:13,  7.07it/s]  6%|▌         | 6/100 [00:00<00:13,  7.19it/s]  7%|▋         | 7/100 [00:01<00:12,  7.36it/s]  8%|▊         | 8/100 [00:01<00:12,  7.29it/s]  9%|▉         | 9/100 [00:01<00:12,  7.41it/s] 10%|█         | 10/100 [00:01<00:12,  7.39it/s] 11%|█         | 11/100 [00:01<00:12,  7.40it/s] 12%|█▏        | 12/100 [00:01<00:11,  7.50it/s] 13%|█▎        | 13/100 [00:01<00:11,  7.42it/s] 14%|█▍        | 14/100 [00:01<00:11,  7.42it/s] 15%|█▌        | 15/100 [00:02<00:11,  7.51it/s] 16%|█▌        | 16/100 [00:02<00:11,  7.48it/s] 17%|█▋        | 17/100 [00:02<00:11,  7.48it/s] 18%|█▊        | 18/100 [00:02<00:10,  7.49it/s] 19%|█▉        | 19/100 [00:02<00:11,  7.29it/s] 20%|██        | 20/100 [00:02<00:11,  7.15it/s] 21%|██        | 21/100 [00:02<00:11,  7.15it/s] 22%|██▏       | 22/100 [00:03<00:11,  7.06it/s] 23%|██▎       | 23/100 [00:03<00:10,  7.06it/s] 24%|██▍       | 24/100 [00:03<00:10,  6.99it/s] 25%|██▌       | 25/100 [00:03<00:10,  6.97it/s] 26%|██▌       | 26/100 [00:03<00:10,  6.90it/s] 27%|██▋       | 27/100 [00:03<00:10,  6.83it/s] 28%|██▊       | 28/100 [00:03<00:10,  6.72it/s] 29%|██▉       | 29/100 [00:04<00:10,  6.86it/s] 30%|███       | 30/100 [00:04<00:09,  7.03it/s] 31%|███       | 31/100 [00:04<00:09,  7.06it/s] 32%|███▏      | 32/100 [00:04<00:09,  6.85it/s] 33%|███▎      | 33/100 [00:04<00:09,  6.92it/s] 34%|███▍      | 34/100 [00:04<00:09,  7.15it/s] 35%|███▌      | 35/100 [00:04<00:08,  7.31it/s] 36%|███▌      | 36/100 [00:05<00:08,  7.15it/s] 37%|███▋      | 37/100 [00:05<00:09,  6.97it/s] 38%|███▊      | 38/100 [00:05<00:08,  7.06it/s] 39%|███▉      | 39/100 [00:05<00:09,  6.77it/s] 40%|████      | 40/100 [00:05<00:08,  6.90it/s] 41%|████      | 41/100 [00:05<00:08,  6.64it/s] 42%|████▏     | 42/100 [00:05<00:08,  6.71it/s] 43%|████▎     | 43/100 [00:06<00:08,  6.87it/s] 44%|████▍     | 44/100 [00:06<00:08,  6.85it/s] 45%|████▌     | 45/100 [00:06<00:07,  6.97it/s] 46%|████▌     | 46/100 [00:06<00:07,  7.18it/s] 47%|████▋     | 47/100 [00:06<00:07,  7.08it/s] 48%|████▊     | 48/100 [00:06<00:07,  7.08it/s] 49%|████▉     | 49/100 [00:06<00:07,  7.01it/s] 50%|█████     | 50/100 [00:07<00:06,  7.21it/s] 51%|█████     | 51/100 [00:07<00:06,  7.35it/s] 52%|█████▏    | 52/100 [00:07<00:06,  7.46it/s] 53%|█████▎    | 53/100 [00:07<00:06,  7.39it/s] 54%|█████▍    | 54/100 [00:07<00:06,  7.38it/s] 55%|█████▌    | 55/100 [00:07<00:06,  7.26it/s] 56%|█████▌    | 56/100 [00:07<00:06,  7.29it/s] 57%|█████▋    | 57/100 [00:08<00:05,  7.19it/s] 58%|█████▊    | 58/100 [00:08<00:05,  7.28it/s] 59%|█████▉    | 59/100 [00:08<00:05,  7.19it/s] 60%|██████    | 60/100 [00:08<00:05,  7.35it/s] 61%|██████    | 61/100 [00:08<00:05,  7.45it/s] 62%|██████▏   | 62/100 [00:08<00:05,  7.44it/s] 63%|██████▎   | 63/100 [00:08<00:05,  7.17it/s] 64%|██████▍   | 64/100 [00:08<00:05,  7.01it/s] 65%|██████▌   | 65/100 [00:09<00:05,  6.91it/s] 66%|██████▌   | 66/100 [00:09<00:04,  6.96it/s] 67%|██████▋   | 67/100 [00:09<00:04,  6.98it/s] 68%|██████▊   | 68/100 [00:09<00:04,  6.96it/s] 69%|██████▉   | 69/100 [00:09<00:04,  7.02it/s] 70%|███████   | 70/100 [00:09<00:04,  7.20it/s] 71%|███████   | 71/100 [00:09<00:04,  7.20it/s] 72%|███████▏  | 72/100 [00:10<00:03,  7.27it/s] 73%|███████▎  | 73/100 [00:10<00:03,  7.06it/s] 74%|███████▍  | 74/100 [00:10<00:03,  7.13it/s] 75%|███████▌  | 75/100 [00:10<00:03,  7.21it/s] 76%|███████▌  | 76/100 [00:10<00:03,  7.28it/s] 77%|███████▋  | 77/100 [00:10<00:03,  7.22it/s] 78%|███████▊  | 78/100 [00:10<00:03,  7.15it/s] 79%|███████▉  | 79/100 [00:11<00:02,  7.19it/s] 80%|████████  | 80/100 [00:11<00:02,  7.07it/s] 81%|████████  | 81/100 [00:11<00:02,  7.18it/s] 82%|████████▏ | 82/100 [00:11<00:02,  7.34it/s] 83%|████████▎ | 83/100 [00:11<00:02,  7.22it/s] 84%|████████▍ | 84/100 [00:11<00:02,  7.23it/s] 85%|████████▌ | 85/100 [00:11<00:02,  7.17it/s] 86%|████████▌ | 86/100 [00:12<00:01,  7.21it/s] 87%|████████▋ | 87/100 [00:12<00:01,  7.20it/s] 88%|████████▊ | 88/100 [00:12<00:01,  7.10it/s] 89%|████████▉ | 89/100 [00:12<00:01,  7.15it/s] 90%|█████████ | 90/100 [00:12<00:01,  6.85it/s] 91%|█████████ | 91/100 [00:12<00:01,  6.98it/s] 92%|█████████▏| 92/100 [00:12<00:01,  7.12it/s] 93%|█████████▎| 93/100 [00:13<00:00,  7.11it/s] 94%|█████████▍| 94/100 [00:13<00:00,  6.96it/s] 95%|█████████▌| 95/100 [00:13<00:00,  7.07it/s] 96%|█████████▌| 96/100 [00:13<00:00,  7.10it/s] 97%|█████████▋| 97/100 [00:13<00:00,  7.18it/s] 98%|█████████▊| 98/100 [00:13<00:00,  7.00it/s] 99%|█████████▉| 99/100 [00:13<00:00,  7.02it/s]100%|██████████| 100/100 [00:14<00:00,  7.11it/s]100%|██████████| 100/100 [00:14<00:00,  7.12it/s]
FOLD 0
Metric     CE Loss  KL wrt Orig
Model                          
llama_7B  2.407891     0.263149
Running fold 1
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:29,  1.06it/s]  6%|▋         | 2/32 [00:02<00:32,  1.08s/it]  9%|▉         | 3/32 [00:03<00:33,  1.16s/it] 12%|█▎        | 4/32 [00:04<00:32,  1.17s/it] 16%|█▌        | 5/32 [00:05<00:32,  1.20s/it] 19%|█▉        | 6/32 [00:07<00:32,  1.24s/it] 22%|██▏       | 7/32 [00:08<00:31,  1.25s/it] 25%|██▌       | 8/32 [00:09<00:29,  1.24s/it] 28%|██▊       | 9/32 [00:10<00:28,  1.24s/it] 31%|███▏      | 10/32 [00:12<00:27,  1.24s/it] 34%|███▍      | 11/32 [00:13<00:25,  1.23s/it] 38%|███▊      | 12/32 [00:14<00:24,  1.21s/it] 41%|████      | 13/32 [00:15<00:22,  1.21s/it] 44%|████▍     | 14/32 [00:16<00:21,  1.20s/it] 47%|████▋     | 15/32 [00:18<00:20,  1.20s/it] 50%|█████     | 16/32 [00:19<00:19,  1.20s/it] 53%|█████▎    | 17/32 [00:20<00:17,  1.20s/it] 56%|█████▋    | 18/32 [00:21<00:16,  1.20s/it] 59%|█████▉    | 19/32 [00:22<00:15,  1.22s/it] 62%|██████▎   | 20/32 [00:24<00:15,  1.26s/it] 66%|██████▌   | 21/32 [00:25<00:13,  1.26s/it] 69%|██████▉   | 22/32 [00:26<00:12,  1.26s/it] 72%|███████▏  | 23/32 [00:28<00:11,  1.27s/it] 75%|███████▌  | 24/32 [00:29<00:10,  1.29s/it] 78%|███████▊  | 25/32 [00:30<00:09,  1.29s/it] 81%|████████▏ | 26/32 [00:31<00:07,  1.28s/it] 84%|████████▍ | 27/32 [00:33<00:06,  1.29s/it] 88%|████████▊ | 28/32 [00:34<00:05,  1.28s/it] 91%|█████████ | 29/32 [00:35<00:03,  1.29s/it] 94%|█████████▍| 30/32 [00:37<00:02,  1.29s/it] 97%|█████████▋| 31/32 [00:38<00:01,  1.28s/it]100%|██████████| 32/32 [00:39<00:00,  1.34s/it]100%|██████████| 32/32 [00:39<00:00,  1.25s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
[[0.666 0.672 0.662 ... 0.668 0.662 0.67 ]
 [0.662 0.662 0.659 ... 0.677 0.666 0.663]
 [0.668 0.67  0.68  ... 0.661 0.665 0.671]
 ...
 [0.758 0.75  0.674 ... 0.716 0.694 0.677]
 [0.749 0.671 0.686 ... 0.674 0.762 0.76 ]
 [0.765 0.805 0.748 ... 0.743 0.787 0.775]]
Heads intervened:  [(8, 16), (11, 16), (11, 17), (12, 4), (13, 8), (13, 10), (13, 16), (13, 21), (16, 17), (16, 26), (16, 30), (17, 13), (17, 19), (17, 29), (18, 29), (19, 13), (19, 17), (19, 31), (20, 22), (20, 30), (22, 16), (23, 3), (23, 12), (31, 6)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 258.62it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-30ec7b2da7888791.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-4e53eea82b0ecfef.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  2%|▏         | 2/100 [00:00<00:06, 16.22it/s]  4%|▍         | 4/100 [00:00<00:05, 16.74it/s]  6%|▌         | 6/100 [00:00<00:05, 17.32it/s]  8%|▊         | 8/100 [00:00<00:05, 17.61it/s] 10%|█         | 10/100 [00:00<00:05, 17.79it/s] 12%|█▏        | 12/100 [00:00<00:04, 17.90it/s] 14%|█▍        | 14/100 [00:00<00:04, 17.96it/s] 16%|█▌        | 16/100 [00:00<00:04, 18.01it/s] 18%|█▊        | 18/100 [00:01<00:04, 18.04it/s] 20%|██        | 20/100 [00:01<00:04, 18.05it/s] 22%|██▏       | 22/100 [00:01<00:04, 18.07it/s] 24%|██▍       | 24/100 [00:01<00:04, 18.08it/s] 26%|██▌       | 26/100 [00:01<00:04, 18.09it/s] 28%|██▊       | 28/100 [00:01<00:03, 18.10it/s] 30%|███       | 30/100 [00:01<00:03, 18.10it/s] 32%|███▏      | 32/100 [00:01<00:03, 18.11it/s] 34%|███▍      | 34/100 [00:01<00:03, 18.09it/s] 36%|███▌      | 36/100 [00:02<00:03, 18.09it/s] 38%|███▊      | 38/100 [00:02<00:03, 18.09it/s] 40%|████      | 40/100 [00:02<00:03, 18.07it/s] 42%|████▏     | 42/100 [00:02<00:03, 18.05it/s] 44%|████▍     | 44/100 [00:02<00:03, 18.06it/s] 46%|████▌     | 46/100 [00:02<00:02, 18.07it/s] 48%|████▊     | 48/100 [00:02<00:02, 18.08it/s] 50%|█████     | 50/100 [00:02<00:02, 18.09it/s] 52%|█████▏    | 52/100 [00:02<00:02, 18.09it/s] 54%|█████▍    | 54/100 [00:03<00:02, 18.09it/s] 56%|█████▌    | 56/100 [00:03<00:02, 18.09it/s] 58%|█████▊    | 58/100 [00:03<00:02, 18.10it/s] 60%|██████    | 60/100 [00:03<00:02, 18.09it/s] 62%|██████▏   | 62/100 [00:03<00:02, 18.08it/s] 64%|██████▍   | 64/100 [00:03<00:01, 18.08it/s] 66%|██████▌   | 66/100 [00:03<00:01, 18.10it/s] 68%|██████▊   | 68/100 [00:03<00:01, 18.11it/s] 70%|███████   | 70/100 [00:03<00:01, 18.11it/s] 72%|███████▏  | 72/100 [00:03<00:01, 18.10it/s] 74%|███████▍  | 74/100 [00:04<00:01, 18.10it/s] 76%|███████▌  | 76/100 [00:04<00:01, 18.11it/s] 78%|███████▊  | 78/100 [00:04<00:01, 18.03it/s] 80%|████████  | 80/100 [00:04<00:01, 18.05it/s] 82%|████████▏ | 82/100 [00:04<00:00, 18.06it/s] 84%|████████▍ | 84/100 [00:04<00:00, 18.08it/s] 86%|████████▌ | 86/100 [00:04<00:00, 18.10it/s] 88%|████████▊ | 88/100 [00:04<00:00, 18.11it/s] 90%|█████████ | 90/100 [00:04<00:00, 18.10it/s] 92%|█████████▏| 92/100 [00:05<00:00, 18.10it/s] 94%|█████████▍| 94/100 [00:05<00:00, 18.11it/s] 96%|█████████▌| 96/100 [00:05<00:00, 18.11it/s] 98%|█████████▊| 98/100 [00:05<00:00, 18.11it/s]100%|██████████| 100/100 [00:05<00:00, 18.12it/s]100%|██████████| 100/100 [00:05<00:00, 18.03it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 343.65it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-14295f39edd20556.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-10ca04ba0c7bb427.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:16,  5.89it/s]  2%|▏         | 2/100 [00:00<00:15,  6.25it/s]  3%|▎         | 3/100 [00:00<00:14,  6.61it/s]  4%|▍         | 4/100 [00:00<00:14,  6.77it/s]  5%|▌         | 5/100 [00:00<00:13,  7.00it/s]  6%|▌         | 6/100 [00:00<00:13,  7.22it/s]  7%|▋         | 7/100 [00:01<00:13,  7.15it/s]  8%|▊         | 8/100 [00:01<00:12,  7.17it/s]  9%|▉         | 9/100 [00:01<00:12,  7.20it/s] 10%|█         | 10/100 [00:01<00:12,  7.27it/s] 11%|█         | 11/100 [00:01<00:12,  7.29it/s] 12%|█▏        | 12/100 [00:01<00:12,  7.03it/s] 13%|█▎        | 13/100 [00:01<00:12,  7.16it/s] 14%|█▍        | 14/100 [00:01<00:12,  7.14it/s] 15%|█▌        | 15/100 [00:02<00:12,  6.97it/s] 16%|█▌        | 16/100 [00:02<00:11,  7.14it/s] 17%|█▋        | 17/100 [00:02<00:11,  7.08it/s] 18%|█▊        | 18/100 [00:02<00:11,  7.26it/s] 19%|█▉        | 19/100 [00:02<00:10,  7.40it/s] 20%|██        | 20/100 [00:02<00:10,  7.40it/s] 21%|██        | 21/100 [00:02<00:10,  7.29it/s] 22%|██▏       | 22/100 [00:03<00:10,  7.43it/s] 23%|██▎       | 23/100 [00:03<00:10,  7.31it/s] 24%|██▍       | 24/100 [00:03<00:10,  7.36it/s] 25%|██▌       | 25/100 [00:03<00:10,  7.46it/s] 26%|██▌       | 26/100 [00:03<00:09,  7.54it/s] 27%|██▋       | 27/100 [00:03<00:10,  7.27it/s] 28%|██▊       | 28/100 [00:03<00:10,  7.18it/s] 29%|██▉       | 29/100 [00:04<00:09,  7.20it/s] 30%|███       | 30/100 [00:04<00:09,  7.35it/s] 31%|███       | 31/100 [00:04<00:09,  7.34it/s] 32%|███▏      | 32/100 [00:04<00:09,  7.28it/s] 33%|███▎      | 33/100 [00:04<00:09,  7.39it/s] 34%|███▍      | 34/100 [00:04<00:08,  7.48it/s] 35%|███▌      | 35/100 [00:04<00:09,  7.21it/s] 36%|███▌      | 36/100 [00:05<00:08,  7.13it/s] 37%|███▋      | 37/100 [00:05<00:08,  7.12it/s] 38%|███▊      | 38/100 [00:05<00:08,  7.07it/s] 39%|███▉      | 39/100 [00:05<00:08,  7.17it/s] 40%|████      | 40/100 [00:05<00:08,  7.21it/s] 41%|████      | 41/100 [00:05<00:08,  7.18it/s] 42%|████▏     | 42/100 [00:05<00:08,  7.25it/s] 43%|████▎     | 43/100 [00:05<00:08,  7.12it/s] 44%|████▍     | 44/100 [00:06<00:07,  7.12it/s] 45%|████▌     | 45/100 [00:06<00:07,  7.25it/s] 46%|████▌     | 46/100 [00:06<00:07,  7.23it/s] 47%|████▋     | 47/100 [00:06<00:07,  7.12it/s] 48%|████▊     | 48/100 [00:06<00:07,  7.03it/s] 49%|████▉     | 49/100 [00:06<00:07,  7.03it/s] 50%|█████     | 50/100 [00:06<00:07,  7.07it/s] 51%|█████     | 51/100 [00:07<00:07,  6.95it/s] 52%|█████▏    | 52/100 [00:07<00:06,  7.05it/s] 53%|█████▎    | 53/100 [00:07<00:06,  7.06it/s] 54%|█████▍    | 54/100 [00:07<00:06,  6.99it/s] 55%|█████▌    | 55/100 [00:07<00:06,  7.04it/s] 56%|█████▌    | 56/100 [00:07<00:06,  6.99it/s] 57%|█████▋    | 57/100 [00:07<00:06,  6.86it/s] 58%|█████▊    | 58/100 [00:08<00:06,  6.91it/s] 59%|█████▉    | 59/100 [00:08<00:05,  7.11it/s] 60%|██████    | 60/100 [00:08<00:05,  7.21it/s] 61%|██████    | 61/100 [00:08<00:05,  7.08it/s] 62%|██████▏   | 62/100 [00:08<00:05,  7.02it/s] 63%|██████▎   | 63/100 [00:08<00:05,  7.11it/s] 64%|██████▍   | 64/100 [00:08<00:05,  7.05it/s] 65%|██████▌   | 65/100 [00:09<00:04,  7.12it/s] 66%|██████▌   | 66/100 [00:09<00:04,  7.24it/s] 67%|██████▋   | 67/100 [00:09<00:04,  7.16it/s] 68%|██████▊   | 68/100 [00:09<00:04,  6.94it/s] 69%|██████▉   | 69/100 [00:09<00:04,  7.04it/s] 70%|███████   | 70/100 [00:09<00:04,  7.01it/s] 71%|███████   | 71/100 [00:09<00:04,  7.13it/s] 72%|███████▏  | 72/100 [00:10<00:03,  7.30it/s] 73%|███████▎  | 73/100 [00:10<00:03,  7.09it/s] 74%|███████▍  | 74/100 [00:10<00:03,  6.96it/s] 75%|███████▌  | 75/100 [00:10<00:03,  7.01it/s] 76%|███████▌  | 76/100 [00:10<00:03,  7.21it/s] 77%|███████▋  | 77/100 [00:10<00:03,  7.27it/s] 78%|███████▊  | 78/100 [00:10<00:02,  7.40it/s] 79%|███████▉  | 79/100 [00:11<00:02,  7.47it/s] 80%|████████  | 80/100 [00:11<00:02,  7.31it/s] 81%|████████  | 81/100 [00:11<00:02,  7.35it/s] 82%|████████▏ | 82/100 [00:11<00:02,  7.42it/s] 83%|████████▎ | 83/100 [00:11<00:02,  7.37it/s] 84%|████████▍ | 84/100 [00:11<00:02,  7.27it/s] 85%|████████▌ | 85/100 [00:11<00:02,  7.29it/s] 86%|████████▌ | 86/100 [00:11<00:01,  7.42it/s] 87%|████████▋ | 87/100 [00:12<00:01,  7.43it/s] 88%|████████▊ | 88/100 [00:12<00:01,  7.14it/s] 89%|████████▉ | 89/100 [00:12<00:01,  6.99it/s] 90%|█████████ | 90/100 [00:12<00:01,  7.11it/s] 91%|█████████ | 91/100 [00:12<00:01,  7.07it/s] 92%|█████████▏| 92/100 [00:12<00:01,  7.01it/s] 93%|█████████▎| 93/100 [00:13<00:01,  6.96it/s] 94%|█████████▍| 94/100 [00:13<00:00,  6.99it/s] 95%|█████████▌| 95/100 [00:13<00:00,  7.19it/s] 96%|█████████▌| 96/100 [00:13<00:00,  7.28it/s] 97%|█████████▋| 97/100 [00:13<00:00,  7.23it/s] 98%|█████████▊| 98/100 [00:13<00:00,  7.08it/s] 99%|█████████▉| 99/100 [00:13<00:00,  7.11it/s]100%|██████████| 100/100 [00:13<00:00,  7.03it/s]100%|██████████| 100/100 [00:13<00:00,  7.15it/s]
FOLD 1
Metric     CE Loss  KL wrt Orig
Model                          
llama_7B  2.433779     0.367466
[2.42083496 0.31530717]
2023-12-04 01:24:32.163288: I tensorflow/core/util/port.cc:110] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2023-12-04 01:24:32.213670: I tensorflow/core/platform/cpu_feature_guard.cc:182] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-12-04 01:24:32.961416: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Could not find TensorRT
Found cached dataset truthful_qa (/home/elicer/.cache/huggingface/datasets/truthful_qa/multiple_choice/1.1.0/63502f6bc6ee493830ce0843991b028d0ab568d221896b2ee3b8a5dfdaa9d7f4)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 443.89it/s]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:00<00:00,  5.20it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  6.16it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  5.99it/s]
head_wise_activation_length:(11012, 32, 4096)
labels_shape:(11012,)
seperated_head_activation shape:11013
Running fold 0
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:28,  1.09it/s]  6%|▋         | 2/32 [00:01<00:28,  1.06it/s]  9%|▉         | 3/32 [00:02<00:26,  1.09it/s] 12%|█▎        | 4/32 [00:03<00:25,  1.11it/s] 16%|█▌        | 5/32 [00:04<00:24,  1.11it/s] 19%|█▉        | 6/32 [00:05<00:23,  1.09it/s] 22%|██▏       | 7/32 [00:06<00:23,  1.08it/s] 25%|██▌       | 8/32 [00:07<00:22,  1.05it/s] 28%|██▊       | 9/32 [00:08<00:22,  1.02it/s] 31%|███▏      | 10/32 [00:09<00:22,  1.01s/it] 34%|███▍      | 11/32 [00:10<00:21,  1.03s/it] 38%|███▊      | 12/32 [00:11<00:20,  1.03s/it] 41%|████      | 13/32 [00:12<00:19,  1.04s/it] 44%|████▍     | 14/32 [00:13<00:19,  1.06s/it] 47%|████▋     | 15/32 [00:14<00:17,  1.05s/it] 50%|█████     | 16/32 [00:15<00:16,  1.06s/it] 53%|█████▎    | 17/32 [00:17<00:15,  1.06s/it] 56%|█████▋    | 18/32 [00:18<00:15,  1.08s/it] 59%|█████▉    | 19/32 [00:19<00:14,  1.11s/it] 62%|██████▎   | 20/32 [00:20<00:13,  1.12s/it] 66%|██████▌   | 21/32 [00:21<00:12,  1.13s/it] 69%|██████▉   | 22/32 [00:22<00:11,  1.12s/it] 72%|███████▏  | 23/32 [00:23<00:10,  1.15s/it] 75%|███████▌  | 24/32 [00:25<00:09,  1.20s/it] 78%|███████▊  | 25/32 [00:26<00:08,  1.18s/it] 81%|████████▏ | 26/32 [00:27<00:07,  1.17s/it] 84%|████████▍ | 27/32 [00:28<00:05,  1.20s/it] 88%|████████▊ | 28/32 [00:29<00:04,  1.15s/it] 91%|█████████ | 29/32 [00:31<00:03,  1.16s/it] 94%|█████████▍| 30/32 [00:32<00:02,  1.15s/it] 97%|█████████▋| 31/32 [00:33<00:01,  1.16s/it]100%|██████████| 32/32 [00:34<00:00,  1.26s/it]100%|██████████| 32/32 [00:34<00:00,  1.09s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
/home/elicer/honest_llama/validation/../TruthfulQA/truthfulqa/metrics.py:284: FutureWarning: load_metric is deprecated and will be removed in the next major version of datasets. Use 'evaluate.load' instead, from the new library 🤗 Evaluate: https://huggingface.co/docs/evaluate
  bleurt = load_metric("bleurt", cache_dir=cache_dir)
[[0.651 0.665 0.645 ... 0.646 0.647 0.652]
 [0.659 0.644 0.645 ... 0.648 0.658 0.656]
 [0.651 0.657 0.685 ... 0.637 0.648 0.667]
 ...
 [0.765 0.762 0.657 ... 0.73  0.704 0.674]
 [0.748 0.678 0.696 ... 0.663 0.769 0.786]
 [0.775 0.815 0.74  ... 0.697 0.809 0.79 ]]
Heads intervened:  [(8, 16), (12, 4), (12, 15), (13, 8), (13, 16), (14, 2), (14, 20), (15, 28), (16, 17), (16, 26), (16, 30), (17, 4), (17, 9), (17, 13), (17, 17), (17, 29), (18, 29), (19, 13), (19, 17), (19, 31), (20, 22), (20, 30), (21, 18), (22, 16), (22, 23), (22, 30), (23, 3), (23, 4), (23, 7), (23, 13), (25, 15), (31, 1), (31, 3), (31, 6), (31, 25), (31, 30)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
2023-12-04 01:25:24.786469: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1635] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 24961 MB memory:  -> device: 0, name: NVIDIA A100 80GB PCIe MIG 3g.40gb, pci bus id: 0000:65:00.0, compute capability: 8.0
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 263.86it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-ec0cf83741fdb3e8.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-d31e6c0c76fafb4d.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:01<01:42,  1.03s/it]  3%|▎         | 3/100 [00:01<00:30,  3.22it/s]  5%|▌         | 5/100 [00:01<00:17,  5.54it/s]  7%|▋         | 7/100 [00:01<00:12,  7.73it/s]  9%|▉         | 9/100 [00:01<00:09,  9.77it/s] 11%|█         | 11/100 [00:01<00:07, 11.52it/s] 13%|█▎        | 13/100 [00:01<00:06, 12.97it/s] 15%|█▌        | 15/100 [00:01<00:06, 14.11it/s] 17%|█▋        | 17/100 [00:01<00:05, 14.98it/s] 19%|█▉        | 19/100 [00:02<00:05, 15.64it/s] 21%|██        | 21/100 [00:02<00:04, 16.11it/s] 23%|██▎       | 23/100 [00:02<00:04, 16.47it/s] 25%|██▌       | 25/100 [00:02<00:04, 16.74it/s] 27%|██▋       | 27/100 [00:02<00:04, 16.91it/s] 29%|██▉       | 29/100 [00:02<00:04, 17.03it/s] 31%|███       | 31/100 [00:02<00:04, 17.12it/s] 33%|███▎      | 33/100 [00:02<00:03, 17.18it/s] 35%|███▌      | 35/100 [00:03<00:03, 16.97it/s] 37%|███▋      | 37/100 [00:03<00:03, 17.07it/s] 39%|███▉      | 39/100 [00:03<00:03, 17.15it/s] 41%|████      | 41/100 [00:03<00:03, 17.22it/s] 43%|████▎     | 43/100 [00:03<00:03, 17.26it/s] 45%|████▌     | 45/100 [00:03<00:03, 17.27it/s] 47%|████▋     | 47/100 [00:03<00:03, 17.29it/s] 49%|████▉     | 49/100 [00:03<00:02, 17.29it/s] 51%|█████     | 51/100 [00:03<00:02, 17.31it/s] 53%|█████▎    | 53/100 [00:04<00:02, 17.31it/s] 55%|█████▌    | 55/100 [00:04<00:02, 17.32it/s] 57%|█████▋    | 57/100 [00:04<00:02, 17.34it/s] 59%|█████▉    | 59/100 [00:04<00:02, 17.34it/s] 61%|██████    | 61/100 [00:04<00:02, 17.35it/s] 63%|██████▎   | 63/100 [00:04<00:02, 17.36it/s] 65%|██████▌   | 65/100 [00:04<00:02, 17.37it/s] 67%|██████▋   | 67/100 [00:04<00:01, 17.38it/s] 69%|██████▉   | 69/100 [00:04<00:01, 17.39it/s] 71%|███████   | 71/100 [00:05<00:01, 17.39it/s] 73%|███████▎  | 73/100 [00:05<00:01, 17.37it/s] 75%|███████▌  | 75/100 [00:05<00:01, 17.38it/s] 77%|███████▋  | 77/100 [00:05<00:01, 17.38it/s] 79%|███████▉  | 79/100 [00:05<00:01, 17.38it/s] 81%|████████  | 81/100 [00:05<00:01, 17.36it/s] 83%|████████▎ | 83/100 [00:05<00:00, 17.36it/s] 85%|████████▌ | 85/100 [00:05<00:00, 17.30it/s] 87%|████████▋ | 87/100 [00:06<00:00, 17.31it/s] 89%|████████▉ | 89/100 [00:06<00:00, 17.32it/s] 91%|█████████ | 91/100 [00:06<00:00, 17.30it/s] 93%|█████████▎| 93/100 [00:06<00:00, 17.32it/s] 95%|█████████▌| 95/100 [00:06<00:00, 17.32it/s] 97%|█████████▋| 97/100 [00:06<00:00, 17.32it/s] 99%|█████████▉| 99/100 [00:06<00:00, 17.32it/s]100%|██████████| 100/100 [00:06<00:00, 14.81it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 336.59it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-1939fcc1eeebdaa7.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-785bb4b6f2089589.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:17,  5.58it/s]  2%|▏         | 2/100 [00:00<00:15,  6.14it/s]  3%|▎         | 3/100 [00:00<00:14,  6.52it/s]  4%|▍         | 4/100 [00:00<00:14,  6.78it/s]  5%|▌         | 5/100 [00:00<00:13,  6.90it/s]  6%|▌         | 6/100 [00:00<00:13,  6.94it/s]  7%|▋         | 7/100 [00:01<00:13,  7.11it/s]  8%|▊         | 8/100 [00:01<00:13,  7.00it/s]  9%|▉         | 9/100 [00:01<00:13,  6.99it/s] 10%|█         | 10/100 [00:01<00:12,  7.01it/s] 11%|█         | 11/100 [00:01<00:12,  6.92it/s] 12%|█▏        | 12/100 [00:01<00:12,  7.12it/s] 13%|█▎        | 13/100 [00:01<00:12,  7.10it/s] 14%|█▍        | 14/100 [00:02<00:12,  7.09it/s] 15%|█▌        | 15/100 [00:02<00:12,  7.06it/s] 16%|█▌        | 16/100 [00:02<00:12,  6.91it/s] 17%|█▋        | 17/100 [00:02<00:11,  6.95it/s] 18%|█▊        | 18/100 [00:02<00:11,  6.97it/s] 19%|█▉        | 19/100 [00:02<00:11,  7.07it/s] 20%|██        | 20/100 [00:02<00:11,  6.93it/s] 21%|██        | 21/100 [00:03<00:11,  6.92it/s] 22%|██▏       | 22/100 [00:03<00:11,  7.03it/s] 23%|██▎       | 23/100 [00:03<00:10,  7.04it/s] 24%|██▍       | 24/100 [00:03<00:10,  7.12it/s] 25%|██▌       | 25/100 [00:03<00:10,  7.06it/s] 26%|██▌       | 26/100 [00:03<00:10,  7.01it/s] 27%|██▋       | 27/100 [00:03<00:10,  7.07it/s] 28%|██▊       | 28/100 [00:04<00:09,  7.23it/s] 29%|██▉       | 29/100 [00:04<00:09,  7.33it/s] 30%|███       | 30/100 [00:04<00:09,  7.33it/s] 31%|███       | 31/100 [00:04<00:09,  7.23it/s] 32%|███▏      | 32/100 [00:04<00:09,  7.24it/s] 33%|███▎      | 33/100 [00:04<00:09,  7.30it/s] 34%|███▍      | 34/100 [00:04<00:09,  6.89it/s] 35%|███▌      | 35/100 [00:05<00:09,  6.75it/s] 36%|███▌      | 36/100 [00:05<00:09,  6.80it/s] 37%|███▋      | 37/100 [00:05<00:09,  6.96it/s] 38%|███▊      | 38/100 [00:05<00:09,  6.83it/s] 39%|███▉      | 39/100 [00:05<00:08,  6.96it/s] 40%|████      | 40/100 [00:05<00:08,  7.14it/s] 41%|████      | 41/100 [00:05<00:08,  7.27it/s] 42%|████▏     | 42/100 [00:05<00:08,  7.14it/s] 43%|████▎     | 43/100 [00:06<00:08,  6.87it/s] 44%|████▍     | 44/100 [00:06<00:08,  6.78it/s] 45%|████▌     | 45/100 [00:06<00:08,  6.84it/s] 46%|████▌     | 46/100 [00:06<00:07,  6.95it/s] 47%|████▋     | 47/100 [00:06<00:07,  6.77it/s] 48%|████▊     | 48/100 [00:06<00:07,  6.83it/s] 49%|████▉     | 49/100 [00:07<00:07,  6.98it/s] 50%|█████     | 50/100 [00:07<00:07,  6.89it/s] 51%|█████     | 51/100 [00:07<00:07,  6.94it/s] 52%|█████▏    | 52/100 [00:07<00:06,  6.93it/s] 53%|█████▎    | 53/100 [00:07<00:06,  7.07it/s] 54%|█████▍    | 54/100 [00:07<00:06,  7.02it/s] 55%|█████▌    | 55/100 [00:07<00:06,  7.00it/s] 56%|█████▌    | 56/100 [00:08<00:06,  7.10it/s] 57%|█████▋    | 57/100 [00:08<00:05,  7.24it/s] 58%|█████▊    | 58/100 [00:08<00:05,  7.21it/s] 59%|█████▉    | 59/100 [00:08<00:05,  7.11it/s] 60%|██████    | 60/100 [00:08<00:05,  7.15it/s] 61%|██████    | 61/100 [00:08<00:05,  7.27it/s] 62%|██████▏   | 62/100 [00:08<00:05,  7.21it/s] 63%|██████▎   | 63/100 [00:08<00:05,  7.21it/s] 64%|██████▍   | 64/100 [00:09<00:04,  7.32it/s] 65%|██████▌   | 65/100 [00:09<00:04,  7.10it/s] 66%|██████▌   | 66/100 [00:09<00:04,  7.12it/s] 67%|██████▋   | 67/100 [00:09<00:04,  7.04it/s] 68%|██████▊   | 68/100 [00:09<00:04,  7.03it/s] 69%|██████▉   | 69/100 [00:09<00:04,  7.18it/s] 70%|███████   | 70/100 [00:09<00:04,  7.17it/s] 71%|███████   | 71/100 [00:10<00:04,  7.08it/s] 72%|███████▏  | 72/100 [00:10<00:03,  7.06it/s] 73%|███████▎  | 73/100 [00:10<00:03,  7.01it/s] 74%|███████▍  | 74/100 [00:10<00:03,  7.11it/s] 75%|███████▌  | 75/100 [00:10<00:03,  7.00it/s] 76%|███████▌  | 76/100 [00:10<00:03,  7.16it/s] 77%|███████▋  | 77/100 [00:10<00:03,  7.29it/s] 78%|███████▊  | 78/100 [00:11<00:03,  7.23it/s] 79%|███████▉  | 79/100 [00:11<00:02,  7.14it/s] 80%|████████  | 80/100 [00:11<00:02,  7.05it/s] 81%|████████  | 81/100 [00:11<00:02,  7.14it/s] 82%|████████▏ | 82/100 [00:11<00:02,  6.82it/s] 83%|████████▎ | 83/100 [00:11<00:02,  6.87it/s] 84%|████████▍ | 84/100 [00:11<00:02,  6.95it/s] 85%|████████▌ | 85/100 [00:12<00:02,  6.86it/s] 86%|████████▌ | 86/100 [00:12<00:02,  6.97it/s] 87%|████████▋ | 87/100 [00:12<00:01,  7.14it/s] 88%|████████▊ | 88/100 [00:12<00:01,  7.26it/s] 89%|████████▉ | 89/100 [00:12<00:01,  7.37it/s] 90%|█████████ | 90/100 [00:12<00:01,  7.20it/s] 91%|█████████ | 91/100 [00:12<00:01,  7.03it/s] 92%|█████████▏| 92/100 [00:13<00:01,  7.03it/s] 93%|█████████▎| 93/100 [00:13<00:01,  6.92it/s] 94%|█████████▍| 94/100 [00:13<00:00,  6.90it/s] 95%|█████████▌| 95/100 [00:13<00:00,  6.90it/s] 96%|█████████▌| 96/100 [00:13<00:00,  6.93it/s] 97%|█████████▋| 97/100 [00:13<00:00,  7.11it/s] 98%|█████████▊| 98/100 [00:13<00:00,  6.92it/s] 99%|█████████▉| 99/100 [00:14<00:00,  6.92it/s]100%|██████████| 100/100 [00:14<00:00,  6.81it/s]100%|██████████| 100/100 [00:14<00:00,  7.02it/s]
FOLD 0
Metric     CE Loss  KL wrt Orig
Model                          
llama_7B  2.456816     0.311388
Running fold 1
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:28,  1.08it/s]  6%|▋         | 2/32 [00:02<00:32,  1.07s/it]  9%|▉         | 3/32 [00:03<00:33,  1.15s/it] 12%|█▎        | 4/32 [00:04<00:32,  1.17s/it] 16%|█▌        | 5/32 [00:05<00:32,  1.20s/it] 19%|█▉        | 6/32 [00:07<00:32,  1.24s/it] 22%|██▏       | 7/32 [00:08<00:31,  1.25s/it] 25%|██▌       | 8/32 [00:09<00:29,  1.24s/it] 28%|██▊       | 9/32 [00:10<00:28,  1.24s/it] 31%|███▏      | 10/32 [00:12<00:27,  1.24s/it] 34%|███▍      | 11/32 [00:13<00:25,  1.22s/it] 38%|███▊      | 12/32 [00:14<00:23,  1.20s/it] 41%|████      | 13/32 [00:15<00:22,  1.20s/it] 44%|████▍     | 14/32 [00:16<00:21,  1.19s/it] 47%|████▋     | 15/32 [00:17<00:20,  1.19s/it] 50%|█████     | 16/32 [00:19<00:19,  1.19s/it] 53%|█████▎    | 17/32 [00:20<00:17,  1.19s/it] 56%|█████▋    | 18/32 [00:21<00:16,  1.19s/it] 59%|█████▉    | 19/32 [00:22<00:15,  1.21s/it] 62%|██████▎   | 20/32 [00:24<00:15,  1.25s/it] 66%|██████▌   | 21/32 [00:25<00:13,  1.26s/it] 69%|██████▉   | 22/32 [00:26<00:12,  1.26s/it] 72%|███████▏  | 23/32 [00:27<00:11,  1.27s/it] 75%|███████▌  | 24/32 [00:29<00:10,  1.30s/it] 78%|███████▊  | 25/32 [00:30<00:09,  1.30s/it] 81%|████████▏ | 26/32 [00:31<00:07,  1.29s/it] 84%|████████▍ | 27/32 [00:33<00:06,  1.30s/it] 88%|████████▊ | 28/32 [00:34<00:05,  1.29s/it] 91%|█████████ | 29/32 [00:35<00:03,  1.30s/it] 94%|█████████▍| 30/32 [00:37<00:02,  1.29s/it] 97%|█████████▋| 31/32 [00:38<00:01,  1.29s/it]100%|██████████| 32/32 [00:39<00:00,  1.34s/it]100%|██████████| 32/32 [00:39<00:00,  1.24s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
[[0.666 0.672 0.662 ... 0.668 0.662 0.67 ]
 [0.662 0.662 0.659 ... 0.677 0.666 0.663]
 [0.668 0.67  0.68  ... 0.661 0.665 0.671]
 ...
 [0.758 0.75  0.674 ... 0.716 0.694 0.677]
 [0.749 0.671 0.686 ... 0.674 0.762 0.76 ]
 [0.765 0.805 0.748 ... 0.743 0.787 0.775]]
Heads intervened:  [(8, 16), (11, 16), (11, 17), (12, 4), (12, 22), (13, 8), (13, 10), (13, 16), (13, 21), (14, 2), (15, 28), (16, 4), (16, 17), (16, 26), (16, 30), (17, 4), (17, 13), (17, 19), (17, 29), (18, 29), (19, 13), (19, 17), (19, 31), (20, 22), (20, 30), (22, 16), (23, 3), (23, 12), (23, 25), (26, 13), (27, 3), (27, 7), (30, 4), (30, 18), (31, 1), (31, 6)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 256.99it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-30ec7b2da7888791.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-4e53eea82b0ecfef.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  2%|▏         | 2/100 [00:00<00:06, 15.16it/s]  4%|▍         | 4/100 [00:00<00:05, 16.13it/s]  6%|▌         | 6/100 [00:00<00:05, 16.46it/s]  8%|▊         | 8/100 [00:00<00:05, 16.62it/s] 10%|█         | 10/100 [00:00<00:05, 16.71it/s] 12%|█▏        | 12/100 [00:00<00:05, 16.77it/s] 14%|█▍        | 14/100 [00:00<00:05, 16.82it/s] 16%|█▌        | 16/100 [00:00<00:04, 16.82it/s] 18%|█▊        | 18/100 [00:01<00:04, 16.86it/s] 20%|██        | 20/100 [00:01<00:04, 16.87it/s] 22%|██▏       | 22/100 [00:01<00:04, 16.87it/s] 24%|██▍       | 24/100 [00:01<00:04, 16.88it/s] 26%|██▌       | 26/100 [00:01<00:04, 16.78it/s] 28%|██▊       | 28/100 [00:01<00:04, 16.51it/s] 30%|███       | 30/100 [00:01<00:04, 16.61it/s] 32%|███▏      | 32/100 [00:01<00:04, 16.71it/s] 34%|███▍      | 34/100 [00:02<00:03, 16.77it/s] 36%|███▌      | 36/100 [00:02<00:03, 16.83it/s] 38%|███▊      | 38/100 [00:02<00:03, 16.86it/s] 40%|████      | 40/100 [00:02<00:03, 16.88it/s] 42%|████▏     | 42/100 [00:02<00:03, 16.89it/s] 44%|████▍     | 44/100 [00:02<00:03, 16.90it/s] 46%|████▌     | 46/100 [00:02<00:03, 16.91it/s] 48%|████▊     | 48/100 [00:02<00:03, 16.92it/s] 50%|█████     | 50/100 [00:02<00:02, 16.93it/s] 52%|█████▏    | 52/100 [00:03<00:02, 16.93it/s] 54%|█████▍    | 54/100 [00:03<00:02, 16.93it/s] 56%|█████▌    | 56/100 [00:03<00:02, 16.93it/s] 58%|█████▊    | 58/100 [00:03<00:02, 16.93it/s] 60%|██████    | 60/100 [00:03<00:02, 16.92it/s] 62%|██████▏   | 62/100 [00:03<00:02, 16.82it/s] 64%|██████▍   | 64/100 [00:03<00:02, 16.84it/s] 66%|██████▌   | 66/100 [00:03<00:02, 16.87it/s] 68%|██████▊   | 68/100 [00:04<00:01, 16.88it/s] 70%|███████   | 70/100 [00:04<00:01, 16.89it/s] 72%|███████▏  | 72/100 [00:04<00:01, 16.91it/s] 74%|███████▍  | 74/100 [00:04<00:01, 16.93it/s] 76%|███████▌  | 76/100 [00:04<00:01, 16.92it/s] 78%|███████▊  | 78/100 [00:04<00:01, 16.92it/s] 80%|████████  | 80/100 [00:04<00:01, 16.92it/s] 82%|████████▏ | 82/100 [00:04<00:01, 16.93it/s] 84%|████████▍ | 84/100 [00:04<00:00, 16.93it/s] 86%|████████▌ | 86/100 [00:05<00:00, 16.94it/s] 88%|████████▊ | 88/100 [00:05<00:00, 16.93it/s] 90%|█████████ | 90/100 [00:05<00:00, 16.94it/s] 92%|█████████▏| 92/100 [00:05<00:00, 16.94it/s] 94%|█████████▍| 94/100 [00:05<00:00, 16.94it/s] 96%|█████████▌| 96/100 [00:05<00:00, 16.87it/s] 98%|█████████▊| 98/100 [00:05<00:00, 16.87it/s]100%|██████████| 100/100 [00:05<00:00, 16.88it/s]100%|██████████| 100/100 [00:05<00:00, 16.84it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 786.92it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-14295f39edd20556.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-10ca04ba0c7bb427.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:16,  6.09it/s]  2%|▏         | 2/100 [00:00<00:15,  6.42it/s]  3%|▎         | 3/100 [00:00<00:14,  6.59it/s]  4%|▍         | 4/100 [00:00<00:14,  6.85it/s]  5%|▌         | 5/100 [00:00<00:13,  6.99it/s]  6%|▌         | 6/100 [00:00<00:13,  7.06it/s]  7%|▋         | 7/100 [00:01<00:13,  7.04it/s]  8%|▊         | 8/100 [00:01<00:13,  6.92it/s]  9%|▉         | 9/100 [00:01<00:13,  6.95it/s] 10%|█         | 10/100 [00:01<00:13,  6.85it/s] 11%|█         | 11/100 [00:01<00:13,  6.72it/s] 12%|█▏        | 12/100 [00:01<00:12,  6.93it/s] 13%|█▎        | 13/100 [00:01<00:12,  6.90it/s] 14%|█▍        | 14/100 [00:02<00:12,  6.97it/s] 15%|█▌        | 15/100 [00:02<00:12,  6.96it/s] 16%|█▌        | 16/100 [00:02<00:12,  6.93it/s] 17%|█▋        | 17/100 [00:02<00:12,  6.84it/s] 18%|█▊        | 18/100 [00:02<00:12,  6.83it/s] 19%|█▉        | 19/100 [00:02<00:11,  6.95it/s] 20%|██        | 20/100 [00:02<00:11,  6.87it/s] 21%|██        | 21/100 [00:03<00:11,  6.71it/s] 22%|██▏       | 22/100 [00:03<00:11,  6.75it/s] 23%|██▎       | 23/100 [00:03<00:11,  6.79it/s] 24%|██▍       | 24/100 [00:03<00:11,  6.76it/s] 25%|██▌       | 25/100 [00:03<00:11,  6.68it/s] 26%|██▌       | 26/100 [00:03<00:11,  6.67it/s] 27%|██▋       | 27/100 [00:03<00:10,  6.67it/s] 28%|██▊       | 28/100 [00:04<00:10,  6.80it/s] 29%|██▉       | 29/100 [00:04<00:10,  6.81it/s] 30%|███       | 30/100 [00:04<00:10,  6.68it/s] 31%|███       | 31/100 [00:04<00:10,  6.67it/s] 32%|███▏      | 32/100 [00:04<00:10,  6.58it/s] 33%|███▎      | 33/100 [00:04<00:10,  6.67it/s] 34%|███▍      | 34/100 [00:04<00:09,  6.89it/s] 35%|███▌      | 35/100 [00:05<00:09,  6.94it/s] 36%|███▌      | 36/100 [00:05<00:09,  6.81it/s] 37%|███▋      | 37/100 [00:05<00:09,  6.83it/s] 38%|███▊      | 38/100 [00:05<00:08,  7.03it/s] 39%|███▉      | 39/100 [00:05<00:08,  7.09it/s] 40%|████      | 40/100 [00:05<00:08,  7.02it/s] 41%|████      | 41/100 [00:06<00:08,  6.71it/s] 42%|████▏     | 42/100 [00:06<00:08,  6.82it/s] 43%|████▎     | 43/100 [00:06<00:08,  6.78it/s] 44%|████▍     | 44/100 [00:06<00:08,  6.66it/s] 45%|████▌     | 45/100 [00:06<00:08,  6.62it/s] 46%|████▌     | 46/100 [00:06<00:08,  6.69it/s] 47%|████▋     | 47/100 [00:06<00:07,  6.65it/s] 48%|████▊     | 48/100 [00:07<00:07,  6.60it/s] 49%|████▉     | 49/100 [00:07<00:07,  6.68it/s] 50%|█████     | 50/100 [00:07<00:07,  6.90it/s] 51%|█████     | 51/100 [00:07<00:07,  6.84it/s] 52%|█████▏    | 52/100 [00:07<00:07,  6.74it/s] 53%|█████▎    | 53/100 [00:07<00:06,  6.79it/s] 54%|█████▍    | 54/100 [00:07<00:06,  6.69it/s] 55%|█████▌    | 55/100 [00:08<00:06,  6.75it/s] 56%|█████▌    | 56/100 [00:08<00:06,  6.76it/s] 57%|█████▋    | 57/100 [00:08<00:06,  6.71it/s] 58%|█████▊    | 58/100 [00:08<00:06,  6.57it/s] 59%|█████▉    | 59/100 [00:08<00:06,  6.51it/s] 60%|██████    | 60/100 [00:08<00:05,  6.67it/s] 61%|██████    | 61/100 [00:09<00:05,  6.60it/s] 62%|██████▏   | 62/100 [00:09<00:05,  6.61it/s] 63%|██████▎   | 63/100 [00:09<00:05,  6.63it/s] 64%|██████▍   | 64/100 [00:09<00:05,  6.81it/s] 65%|██████▌   | 65/100 [00:09<00:05,  6.84it/s] 66%|██████▌   | 66/100 [00:09<00:05,  6.78it/s] 67%|██████▋   | 67/100 [00:09<00:04,  6.69it/s] 68%|██████▊   | 68/100 [00:10<00:04,  6.58it/s] 69%|██████▉   | 69/100 [00:10<00:04,  6.61it/s] 70%|███████   | 70/100 [00:10<00:04,  6.46it/s] 71%|███████   | 71/100 [00:10<00:04,  6.63it/s] 72%|███████▏  | 72/100 [00:10<00:04,  6.88it/s] 73%|███████▎  | 73/100 [00:10<00:03,  6.98it/s] 74%|███████▍  | 74/100 [00:10<00:03,  6.79it/s] 75%|███████▌  | 75/100 [00:11<00:03,  6.81it/s] 76%|███████▌  | 76/100 [00:11<00:03,  6.68it/s] 77%|███████▋  | 77/100 [00:11<00:03,  6.75it/s] 78%|███████▊  | 78/100 [00:11<00:03,  6.72it/s] 79%|███████▉  | 79/100 [00:11<00:03,  6.94it/s] 80%|████████  | 80/100 [00:11<00:02,  7.11it/s] 81%|████████  | 81/100 [00:11<00:02,  6.90it/s] 82%|████████▏ | 82/100 [00:12<00:02,  6.84it/s] 83%|████████▎ | 83/100 [00:12<00:02,  6.79it/s] 84%|████████▍ | 84/100 [00:12<00:02,  6.68it/s] 85%|████████▌ | 85/100 [00:12<00:02,  6.58it/s] 86%|████████▌ | 86/100 [00:12<00:02,  6.54it/s] 87%|████████▋ | 87/100 [00:12<00:01,  6.57it/s] 88%|████████▊ | 88/100 [00:13<00:01,  6.56it/s] 89%|████████▉ | 89/100 [00:13<00:01,  6.65it/s] 90%|█████████ | 90/100 [00:13<00:01,  6.60it/s] 91%|█████████ | 91/100 [00:13<00:01,  6.70it/s] 92%|█████████▏| 92/100 [00:13<00:01,  6.56it/s] 93%|█████████▎| 93/100 [00:13<00:01,  6.66it/s] 94%|█████████▍| 94/100 [00:13<00:00,  6.64it/s] 95%|█████████▌| 95/100 [00:14<00:00,  6.66it/s] 96%|█████████▌| 96/100 [00:14<00:00,  6.73it/s] 97%|█████████▋| 97/100 [00:14<00:00,  6.65it/s] 98%|█████████▊| 98/100 [00:14<00:00,  6.60it/s] 99%|█████████▉| 99/100 [00:14<00:00,  6.58it/s]100%|██████████| 100/100 [00:14<00:00,  6.67it/s]100%|██████████| 100/100 [00:14<00:00,  6.75it/s]
FOLD 1
Metric     CE Loss  KL wrt Orig
Model                          
llama_7B  2.391299      0.33358
[2.42405762 0.32248426]
2023-12-04 01:27:05.526408: I tensorflow/core/util/port.cc:110] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2023-12-04 01:27:05.577919: I tensorflow/core/platform/cpu_feature_guard.cc:182] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-12-04 01:27:06.323408: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Could not find TensorRT
Found cached dataset truthful_qa (/home/elicer/.cache/huggingface/datasets/truthful_qa/multiple_choice/1.1.0/63502f6bc6ee493830ce0843991b028d0ab568d221896b2ee3b8a5dfdaa9d7f4)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 367.92it/s]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:00<00:00,  5.25it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  6.20it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  6.03it/s]
head_wise_activation_length:(11012, 32, 4096)
labels_shape:(11012,)
seperated_head_activation shape:11013
Running fold 0
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:28,  1.10it/s]  6%|▋         | 2/32 [00:01<00:27,  1.07it/s]  9%|▉         | 3/32 [00:02<00:26,  1.11it/s] 12%|█▎        | 4/32 [00:03<00:24,  1.13it/s] 16%|█▌        | 5/32 [00:04<00:24,  1.12it/s] 19%|█▉        | 6/32 [00:05<00:23,  1.10it/s] 22%|██▏       | 7/32 [00:06<00:22,  1.09it/s] 25%|██▌       | 8/32 [00:07<00:22,  1.06it/s] 28%|██▊       | 9/32 [00:08<00:22,  1.04it/s] 31%|███▏      | 10/32 [00:09<00:21,  1.01it/s] 34%|███▍      | 11/32 [00:10<00:21,  1.02s/it] 38%|███▊      | 12/32 [00:11<00:20,  1.02s/it] 41%|████      | 13/32 [00:12<00:19,  1.03s/it] 44%|████▍     | 14/32 [00:13<00:19,  1.06s/it] 47%|████▋     | 15/32 [00:14<00:17,  1.05s/it] 50%|█████     | 16/32 [00:15<00:16,  1.05s/it] 53%|█████▎    | 17/32 [00:16<00:15,  1.06s/it] 56%|█████▋    | 18/32 [00:17<00:15,  1.07s/it] 59%|█████▉    | 19/32 [00:19<00:14,  1.10s/it] 62%|██████▎   | 20/32 [00:20<00:13,  1.12s/it] 66%|██████▌   | 21/32 [00:21<00:12,  1.12s/it] 69%|██████▉   | 22/32 [00:22<00:11,  1.10s/it] 72%|███████▏  | 23/32 [00:23<00:10,  1.13s/it] 75%|███████▌  | 24/32 [00:24<00:09,  1.17s/it] 78%|███████▊  | 25/32 [00:26<00:08,  1.16s/it] 81%|████████▏ | 26/32 [00:27<00:06,  1.14s/it] 84%|████████▍ | 27/32 [00:28<00:05,  1.17s/it] 88%|████████▊ | 28/32 [00:29<00:04,  1.12s/it] 91%|█████████ | 29/32 [00:30<00:03,  1.13s/it] 94%|█████████▍| 30/32 [00:31<00:02,  1.12s/it] 97%|█████████▋| 31/32 [00:32<00:01,  1.14s/it]100%|██████████| 32/32 [00:34<00:00,  1.23s/it]100%|██████████| 32/32 [00:34<00:00,  1.07s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
/home/elicer/honest_llama/validation/../TruthfulQA/truthfulqa/metrics.py:284: FutureWarning: load_metric is deprecated and will be removed in the next major version of datasets. Use 'evaluate.load' instead, from the new library 🤗 Evaluate: https://huggingface.co/docs/evaluate
  bleurt = load_metric("bleurt", cache_dir=cache_dir)
[[0.651 0.665 0.645 ... 0.646 0.647 0.652]
 [0.659 0.644 0.645 ... 0.648 0.658 0.656]
 [0.651 0.657 0.685 ... 0.637 0.648 0.667]
 ...
 [0.765 0.762 0.657 ... 0.73  0.704 0.674]
 [0.748 0.678 0.696 ... 0.663 0.769 0.786]
 [0.775 0.815 0.74  ... 0.697 0.809 0.79 ]]
Heads intervened:  [(8, 16), (8, 19), (10, 18), (11, 16), (11, 17), (12, 4), (12, 15), (12, 22), (13, 8), (13, 16), (14, 2), (14, 20), (15, 28), (16, 17), (16, 26), (16, 30), (17, 4), (17, 9), (17, 13), (17, 17), (17, 29), (18, 29), (19, 13), (19, 17), (19, 31), (20, 22), (20, 30), (21, 18), (22, 2), (22, 8), (22, 16), (22, 23), (22, 30), (23, 3), (23, 4), (23, 7), (23, 12), (23, 13), (23, 25), (25, 15), (30, 14), (30, 23), (31, 1), (31, 3), (31, 6), (31, 11), (31, 25), (31, 30)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
2023-12-04 01:27:57.616004: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1635] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 24961 MB memory:  -> device: 0, name: NVIDIA A100 80GB PCIe MIG 3g.40gb, pci bus id: 0000:65:00.0, compute capability: 8.0
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 294.92it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-ec0cf83741fdb3e8.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-d31e6c0c76fafb4d.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:01<01:42,  1.03s/it]  3%|▎         | 3/100 [00:01<00:30,  3.19it/s]  5%|▌         | 5/100 [00:01<00:17,  5.46it/s]  7%|▋         | 7/100 [00:01<00:12,  7.62it/s]  9%|▉         | 9/100 [00:01<00:09,  9.57it/s] 11%|█         | 11/100 [00:01<00:07, 11.22it/s] 13%|█▎        | 13/100 [00:01<00:06, 12.57it/s] 15%|█▌        | 15/100 [00:01<00:06, 13.63it/s] 17%|█▋        | 17/100 [00:02<00:05, 14.29it/s] 19%|█▉        | 19/100 [00:02<00:05, 14.91it/s] 21%|██        | 21/100 [00:02<00:05, 15.37it/s] 23%|██▎       | 23/100 [00:02<00:04, 15.69it/s] 25%|██▌       | 25/100 [00:02<00:04, 15.96it/s] 27%|██▋       | 27/100 [00:02<00:04, 16.12it/s] 29%|██▉       | 29/100 [00:02<00:04, 16.25it/s] 31%|███       | 31/100 [00:02<00:04, 16.35it/s] 33%|███▎      | 33/100 [00:02<00:04, 16.42it/s] 35%|███▌      | 35/100 [00:03<00:03, 16.46it/s] 37%|███▋      | 37/100 [00:03<00:03, 16.50it/s] 39%|███▉      | 39/100 [00:03<00:03, 16.50it/s] 41%|████      | 41/100 [00:03<00:03, 16.53it/s] 43%|████▎     | 43/100 [00:03<00:03, 16.52it/s] 45%|████▌     | 45/100 [00:03<00:03, 16.52it/s] 47%|████▋     | 47/100 [00:03<00:03, 16.53it/s] 49%|████▉     | 49/100 [00:03<00:03, 16.55it/s] 51%|█████     | 51/100 [00:04<00:03, 16.32it/s] 53%|█████▎    | 53/100 [00:04<00:02, 16.38it/s] 55%|█████▌    | 55/100 [00:04<00:02, 16.42it/s] 57%|█████▋    | 57/100 [00:04<00:02, 16.46it/s] 59%|█████▉    | 59/100 [00:04<00:02, 16.51it/s] 61%|██████    | 61/100 [00:04<00:02, 16.54it/s] 63%|██████▎   | 63/100 [00:04<00:02, 16.52it/s] 65%|██████▌   | 65/100 [00:04<00:02, 16.55it/s] 67%|██████▋   | 67/100 [00:05<00:01, 16.56it/s] 69%|██████▉   | 69/100 [00:05<00:01, 16.56it/s] 71%|███████   | 71/100 [00:05<00:01, 16.57it/s] 73%|███████▎  | 73/100 [00:05<00:01, 16.57it/s] 75%|███████▌  | 75/100 [00:05<00:01, 16.58it/s] 77%|███████▋  | 77/100 [00:05<00:01, 16.59it/s] 79%|███████▉  | 79/100 [00:05<00:01, 16.58it/s] 81%|████████  | 81/100 [00:05<00:01, 16.58it/s] 83%|████████▎ | 83/100 [00:05<00:01, 16.58it/s] 85%|████████▌ | 85/100 [00:06<00:00, 16.35it/s] 87%|████████▋ | 87/100 [00:06<00:00, 16.36it/s] 89%|████████▉ | 89/100 [00:06<00:00, 16.42it/s] 91%|█████████ | 91/100 [00:06<00:00, 16.47it/s] 93%|█████████▎| 93/100 [00:06<00:00, 16.52it/s] 95%|█████████▌| 95/100 [00:06<00:00, 16.07it/s] 97%|█████████▋| 97/100 [00:06<00:00, 16.21it/s] 99%|█████████▉| 99/100 [00:06<00:00, 16.32it/s]100%|██████████| 100/100 [00:07<00:00, 14.20it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 335.62it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-1939fcc1eeebdaa7.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-785bb4b6f2089589.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:17,  5.50it/s]  2%|▏         | 2/100 [00:00<00:16,  6.05it/s]  3%|▎         | 3/100 [00:00<00:15,  6.32it/s]  4%|▍         | 4/100 [00:00<00:14,  6.65it/s]  5%|▌         | 5/100 [00:00<00:13,  6.83it/s]  6%|▌         | 6/100 [00:00<00:13,  6.94it/s]  7%|▋         | 7/100 [00:01<00:13,  7.09it/s]  8%|▊         | 8/100 [00:01<00:12,  7.19it/s]  9%|▉         | 9/100 [00:01<00:13,  6.91it/s] 10%|█         | 10/100 [00:01<00:12,  7.01it/s] 11%|█         | 11/100 [00:01<00:12,  7.03it/s] 12%|█▏        | 12/100 [00:01<00:12,  6.89it/s] 13%|█▎        | 13/100 [00:01<00:12,  6.78it/s] 14%|█▍        | 14/100 [00:02<00:12,  6.79it/s] 15%|█▌        | 15/100 [00:02<00:12,  6.91it/s] 16%|█▌        | 16/100 [00:02<00:12,  6.83it/s] 17%|█▋        | 17/100 [00:02<00:12,  6.71it/s] 18%|█▊        | 18/100 [00:02<00:12,  6.68it/s] 19%|█▉        | 19/100 [00:02<00:12,  6.66it/s] 20%|██        | 20/100 [00:02<00:11,  6.81it/s] 21%|██        | 21/100 [00:03<00:11,  6.87it/s] 22%|██▏       | 22/100 [00:03<00:11,  6.75it/s] 23%|██▎       | 23/100 [00:03<00:11,  6.73it/s] 24%|██▍       | 24/100 [00:03<00:10,  6.93it/s] 25%|██▌       | 25/100 [00:03<00:11,  6.81it/s] 26%|██▌       | 26/100 [00:03<00:10,  6.88it/s] 27%|██▋       | 27/100 [00:03<00:10,  6.93it/s] 28%|██▊       | 28/100 [00:04<00:10,  6.77it/s] 29%|██▉       | 29/100 [00:04<00:10,  6.68it/s] 30%|███       | 30/100 [00:04<00:10,  6.80it/s] 31%|███       | 31/100 [00:04<00:09,  6.97it/s] 32%|███▏      | 32/100 [00:04<00:09,  6.92it/s] 33%|███▎      | 33/100 [00:04<00:10,  6.66it/s] 34%|███▍      | 34/100 [00:05<00:10,  6.56it/s] 35%|███▌      | 35/100 [00:05<00:09,  6.59it/s] 36%|███▌      | 36/100 [00:05<00:09,  6.74it/s] 37%|███▋      | 37/100 [00:05<00:09,  6.70it/s] 38%|███▊      | 38/100 [00:05<00:09,  6.65it/s] 39%|███▉      | 39/100 [00:05<00:08,  6.88it/s] 40%|████      | 40/100 [00:05<00:08,  6.85it/s] 41%|████      | 41/100 [00:06<00:08,  6.85it/s] 42%|████▏     | 42/100 [00:06<00:08,  6.74it/s] 43%|████▎     | 43/100 [00:06<00:08,  6.82it/s] 44%|████▍     | 44/100 [00:06<00:08,  6.98it/s] 45%|████▌     | 45/100 [00:06<00:08,  6.86it/s] 46%|████▌     | 46/100 [00:06<00:07,  6.84it/s] 47%|████▋     | 47/100 [00:06<00:07,  6.94it/s] 48%|████▊     | 48/100 [00:07<00:07,  6.92it/s] 49%|████▉     | 49/100 [00:07<00:07,  6.93it/s] 50%|█████     | 50/100 [00:07<00:07,  6.74it/s] 51%|█████     | 51/100 [00:07<00:07,  6.83it/s] 52%|█████▏    | 52/100 [00:07<00:06,  7.00it/s] 53%|█████▎    | 53/100 [00:07<00:06,  7.00it/s] 54%|█████▍    | 54/100 [00:07<00:06,  6.99it/s] 55%|█████▌    | 55/100 [00:08<00:06,  6.94it/s] 56%|█████▌    | 56/100 [00:08<00:06,  6.90it/s] 57%|█████▋    | 57/100 [00:08<00:06,  6.92it/s] 58%|█████▊    | 58/100 [00:08<00:06,  6.86it/s] 59%|█████▉    | 59/100 [00:08<00:05,  6.96it/s] 60%|██████    | 60/100 [00:08<00:05,  6.92it/s] 61%|██████    | 61/100 [00:08<00:05,  6.92it/s] 62%|██████▏   | 62/100 [00:09<00:05,  6.75it/s] 63%|██████▎   | 63/100 [00:09<00:05,  6.77it/s] 64%|██████▍   | 64/100 [00:09<00:05,  6.65it/s] 65%|██████▌   | 65/100 [00:09<00:05,  6.62it/s] 66%|██████▌   | 66/100 [00:09<00:05,  6.78it/s] 67%|██████▋   | 67/100 [00:09<00:04,  6.90it/s] 68%|██████▊   | 68/100 [00:09<00:04,  6.80it/s] 69%|██████▉   | 69/100 [00:10<00:04,  6.91it/s] 70%|███████   | 70/100 [00:10<00:04,  6.90it/s] 71%|███████   | 71/100 [00:10<00:04,  6.86it/s] 72%|███████▏  | 72/100 [00:10<00:04,  6.82it/s] 73%|███████▎  | 73/100 [00:10<00:03,  6.77it/s] 74%|███████▍  | 74/100 [00:10<00:03,  6.83it/s] 75%|███████▌  | 75/100 [00:10<00:03,  6.97it/s] 76%|███████▌  | 76/100 [00:11<00:03,  6.85it/s] 77%|███████▋  | 77/100 [00:11<00:03,  6.78it/s] 78%|███████▊  | 78/100 [00:11<00:03,  6.74it/s] 79%|███████▉  | 79/100 [00:11<00:03,  6.92it/s] 80%|████████  | 80/100 [00:11<00:02,  6.73it/s] 81%|████████  | 81/100 [00:11<00:02,  6.76it/s] 82%|████████▏ | 82/100 [00:12<00:02,  6.77it/s] 83%|████████▎ | 83/100 [00:12<00:02,  6.81it/s] 84%|████████▍ | 84/100 [00:12<00:02,  6.82it/s] 85%|████████▌ | 85/100 [00:12<00:02,  6.99it/s] 86%|████████▌ | 86/100 [00:12<00:02,  6.93it/s] 87%|████████▋ | 87/100 [00:12<00:01,  6.95it/s] 88%|████████▊ | 88/100 [00:12<00:01,  7.09it/s] 89%|████████▉ | 89/100 [00:13<00:01,  7.19it/s] 90%|█████████ | 90/100 [00:13<00:01,  7.05it/s] 91%|█████████ | 91/100 [00:13<00:01,  7.15it/s] 92%|█████████▏| 92/100 [00:13<00:01,  7.09it/s] 93%|█████████▎| 93/100 [00:13<00:01,  6.94it/s] 94%|█████████▍| 94/100 [00:13<00:00,  6.84it/s] 95%|█████████▌| 95/100 [00:13<00:00,  6.76it/s] 96%|█████████▌| 96/100 [00:14<00:00,  6.85it/s] 97%|█████████▋| 97/100 [00:14<00:00,  6.90it/s] 98%|█████████▊| 98/100 [00:14<00:00,  6.86it/s] 99%|█████████▉| 99/100 [00:14<00:00,  6.73it/s]100%|██████████| 100/100 [00:14<00:00,  6.74it/s]100%|██████████| 100/100 [00:14<00:00,  6.84it/s]
FOLD 0
Metric     CE Loss  KL wrt Orig
Model                          
llama_7B  2.625869     0.487603
Running fold 1
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:29,  1.06it/s]  6%|▋         | 2/32 [00:02<00:32,  1.09s/it]  9%|▉         | 3/32 [00:03<00:34,  1.17s/it] 12%|█▎        | 4/32 [00:04<00:33,  1.18s/it] 16%|█▌        | 5/32 [00:05<00:32,  1.21s/it] 19%|█▉        | 6/32 [00:07<00:32,  1.24s/it] 22%|██▏       | 7/32 [00:08<00:31,  1.25s/it] 25%|██▌       | 8/32 [00:09<00:29,  1.25s/it] 28%|██▊       | 9/32 [00:10<00:28,  1.24s/it] 31%|███▏      | 10/32 [00:12<00:27,  1.24s/it] 34%|███▍      | 11/32 [00:13<00:25,  1.23s/it] 38%|███▊      | 12/32 [00:14<00:24,  1.21s/it] 41%|████      | 13/32 [00:15<00:22,  1.20s/it] 44%|████▍     | 14/32 [00:16<00:21,  1.20s/it] 47%|████▋     | 15/32 [00:18<00:20,  1.20s/it] 50%|█████     | 16/32 [00:19<00:19,  1.21s/it] 53%|█████▎    | 17/32 [00:20<00:18,  1.21s/it] 56%|█████▋    | 18/32 [00:21<00:16,  1.21s/it] 59%|█████▉    | 19/32 [00:23<00:16,  1.23s/it] 62%|██████▎   | 20/32 [00:24<00:15,  1.27s/it] 66%|██████▌   | 21/32 [00:25<00:14,  1.28s/it] 69%|██████▉   | 22/32 [00:26<00:12,  1.28s/it] 72%|███████▏  | 23/32 [00:28<00:11,  1.28s/it] 75%|███████▌  | 24/32 [00:29<00:10,  1.31s/it] 78%|███████▊  | 25/32 [00:30<00:09,  1.31s/it] 81%|████████▏ | 26/32 [00:32<00:07,  1.30s/it] 84%|████████▍ | 27/32 [00:33<00:06,  1.32s/it] 88%|████████▊ | 28/32 [00:34<00:05,  1.31s/it] 91%|█████████ | 29/32 [00:36<00:03,  1.32s/it] 94%|█████████▍| 30/32 [00:37<00:02,  1.30s/it] 97%|█████████▋| 31/32 [00:38<00:01,  1.30s/it]100%|██████████| 32/32 [00:40<00:00,  1.35s/it]100%|██████████| 32/32 [00:40<00:00,  1.26s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
[[0.666 0.672 0.662 ... 0.668 0.662 0.67 ]
 [0.662 0.662 0.659 ... 0.677 0.666 0.663]
 [0.668 0.67  0.68  ... 0.661 0.665 0.671]
 ...
 [0.758 0.75  0.674 ... 0.716 0.694 0.677]
 [0.749 0.671 0.686 ... 0.674 0.762 0.76 ]
 [0.765 0.805 0.748 ... 0.743 0.787 0.775]]
Heads intervened:  [(5, 10), (8, 16), (11, 16), (11, 17), (12, 4), (12, 22), (13, 8), (13, 10), (13, 16), (13, 21), (14, 2), (15, 1), (15, 10), (15, 28), (16, 3), (16, 4), (16, 17), (16, 26), (16, 30), (17, 4), (17, 13), (17, 17), (17, 19), (17, 29), (18, 29), (19, 13), (19, 17), (19, 28), (19, 31), (20, 22), (20, 30), (21, 23), (22, 16), (23, 3), (23, 4), (23, 12), (23, 13), (23, 25), (26, 13), (27, 3), (27, 7), (30, 4), (30, 18), (30, 23), (31, 1), (31, 6), (31, 10), (31, 18)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 255.70it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-30ec7b2da7888791.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-4e53eea82b0ecfef.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  2%|▏         | 2/100 [00:00<00:06, 14.20it/s]  4%|▍         | 4/100 [00:00<00:06, 15.38it/s]  6%|▌         | 6/100 [00:00<00:05, 15.80it/s]  8%|▊         | 8/100 [00:00<00:05, 16.01it/s] 10%|█         | 10/100 [00:00<00:05, 16.13it/s] 12%|█▏        | 12/100 [00:00<00:05, 16.21it/s] 14%|█▍        | 14/100 [00:00<00:05, 16.26it/s] 16%|█▌        | 16/100 [00:00<00:05, 16.29it/s] 18%|█▊        | 18/100 [00:01<00:05, 16.31it/s] 20%|██        | 20/100 [00:01<00:04, 16.33it/s] 22%|██▏       | 22/100 [00:01<00:04, 16.33it/s] 24%|██▍       | 24/100 [00:01<00:04, 16.31it/s] 26%|██▌       | 26/100 [00:01<00:04, 16.32it/s] 28%|██▊       | 28/100 [00:01<00:04, 16.33it/s] 30%|███       | 30/100 [00:01<00:04, 16.32it/s] 32%|███▏      | 32/100 [00:01<00:04, 16.32it/s] 34%|███▍      | 34/100 [00:02<00:04, 16.34it/s] 36%|███▌      | 36/100 [00:02<00:03, 16.36it/s] 38%|███▊      | 38/100 [00:02<00:03, 16.35it/s] 40%|████      | 40/100 [00:02<00:03, 16.35it/s] 42%|████▏     | 42/100 [00:02<00:03, 16.36it/s] 44%|████▍     | 44/100 [00:02<00:03, 16.36it/s] 46%|████▌     | 46/100 [00:02<00:03, 16.37it/s] 48%|████▊     | 48/100 [00:02<00:03, 16.36it/s] 50%|█████     | 50/100 [00:03<00:03, 16.36it/s] 52%|█████▏    | 52/100 [00:03<00:02, 16.35it/s] 54%|█████▍    | 54/100 [00:03<00:02, 16.36it/s] 56%|█████▌    | 56/100 [00:03<00:02, 16.36it/s] 58%|█████▊    | 58/100 [00:03<00:02, 16.31it/s] 60%|██████    | 60/100 [00:03<00:02, 16.32it/s] 62%|██████▏   | 62/100 [00:03<00:02, 16.34it/s] 64%|██████▍   | 64/100 [00:03<00:02, 16.35it/s] 66%|██████▌   | 66/100 [00:04<00:02, 16.36it/s] 68%|██████▊   | 68/100 [00:04<00:01, 16.36it/s] 70%|███████   | 70/100 [00:04<00:01, 16.37it/s] 72%|███████▏  | 72/100 [00:04<00:01, 16.36it/s] 74%|███████▍  | 74/100 [00:04<00:01, 16.37it/s] 76%|███████▌  | 76/100 [00:04<00:01, 16.36it/s] 78%|███████▊  | 78/100 [00:04<00:01, 16.37it/s] 80%|████████  | 80/100 [00:04<00:01, 16.36it/s] 82%|████████▏ | 82/100 [00:05<00:01, 16.37it/s] 84%|████████▍ | 84/100 [00:05<00:00, 16.38it/s] 86%|████████▌ | 86/100 [00:05<00:00, 16.37it/s] 88%|████████▊ | 88/100 [00:05<00:00, 16.37it/s] 90%|█████████ | 90/100 [00:05<00:00, 16.36it/s] 92%|█████████▏| 92/100 [00:05<00:00, 16.15it/s] 94%|█████████▍| 94/100 [00:05<00:00, 16.21it/s] 96%|█████████▌| 96/100 [00:05<00:00, 16.25it/s] 98%|█████████▊| 98/100 [00:06<00:00, 16.28it/s]100%|██████████| 100/100 [00:06<00:00, 16.30it/s]100%|██████████| 100/100 [00:06<00:00, 16.29it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 352.43it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-14295f39edd20556.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-10ca04ba0c7bb427.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:17,  5.63it/s]  2%|▏         | 2/100 [00:00<00:15,  6.26it/s]  3%|▎         | 3/100 [00:00<00:14,  6.63it/s]  4%|▍         | 4/100 [00:00<00:14,  6.74it/s]  5%|▌         | 5/100 [00:00<00:13,  6.97it/s]  6%|▌         | 6/100 [00:00<00:14,  6.69it/s]  7%|▋         | 7/100 [00:01<00:13,  6.89it/s]  8%|▊         | 8/100 [00:01<00:13,  6.82it/s]  9%|▉         | 9/100 [00:01<00:13,  6.99it/s] 10%|█         | 10/100 [00:01<00:12,  7.10it/s] 11%|█         | 11/100 [00:01<00:12,  7.03it/s] 12%|█▏        | 12/100 [00:01<00:12,  7.04it/s] 13%|█▎        | 13/100 [00:01<00:12,  7.12it/s] 14%|█▍        | 14/100 [00:02<00:12,  7.07it/s] 15%|█▌        | 15/100 [00:02<00:11,  7.16it/s] 16%|█▌        | 16/100 [00:02<00:12,  6.90it/s] 17%|█▋        | 17/100 [00:02<00:11,  7.04it/s] 18%|█▊        | 18/100 [00:02<00:11,  7.14it/s] 19%|█▉        | 19/100 [00:02<00:11,  7.21it/s] 20%|██        | 20/100 [00:02<00:11,  7.26it/s] 21%|██        | 21/100 [00:03<00:10,  7.29it/s] 22%|██▏       | 22/100 [00:03<00:10,  7.32it/s] 23%|██▎       | 23/100 [00:03<00:10,  7.14it/s] 24%|██▍       | 24/100 [00:03<00:10,  7.01it/s] 25%|██▌       | 25/100 [00:03<00:10,  7.11it/s] 26%|██▌       | 26/100 [00:03<00:10,  6.89it/s] 27%|██▋       | 27/100 [00:03<00:10,  6.86it/s] 28%|██▊       | 28/100 [00:04<00:10,  7.01it/s] 29%|██▉       | 29/100 [00:04<00:09,  7.12it/s] 30%|███       | 30/100 [00:04<00:10,  6.90it/s] 31%|███       | 31/100 [00:04<00:10,  6.89it/s] 32%|███▏      | 32/100 [00:04<00:09,  7.03it/s] 33%|███▎      | 33/100 [00:04<00:09,  7.14it/s] 34%|███▍      | 34/100 [00:04<00:09,  7.08it/s] 35%|███▌      | 35/100 [00:05<00:09,  7.02it/s] 36%|███▌      | 36/100 [00:05<00:08,  7.11it/s] 37%|███▋      | 37/100 [00:05<00:08,  7.19it/s] 38%|███▊      | 38/100 [00:05<00:08,  7.12it/s] 39%|███▉      | 39/100 [00:05<00:08,  7.02it/s] 40%|████      | 40/100 [00:05<00:08,  7.13it/s] 41%|████      | 41/100 [00:05<00:08,  6.98it/s] 42%|████▏     | 42/100 [00:05<00:08,  7.04it/s] 43%|████▎     | 43/100 [00:06<00:08,  7.10it/s] 44%|████▍     | 44/100 [00:06<00:07,  7.18it/s] 45%|████▌     | 45/100 [00:06<00:07,  7.24it/s] 46%|████▌     | 46/100 [00:06<00:07,  7.10it/s] 47%|████▋     | 47/100 [00:06<00:07,  7.17it/s] 48%|████▊     | 48/100 [00:06<00:07,  7.08it/s] 49%|████▉     | 49/100 [00:06<00:07,  7.13it/s] 50%|█████     | 50/100 [00:07<00:07,  7.11it/s] 51%|█████     | 51/100 [00:07<00:06,  7.12it/s] 52%|█████▏    | 52/100 [00:07<00:06,  7.09it/s] 53%|█████▎    | 53/100 [00:07<00:06,  7.18it/s] 54%|█████▍    | 54/100 [00:07<00:06,  7.24it/s] 55%|█████▌    | 55/100 [00:07<00:06,  7.25it/s] 56%|█████▌    | 56/100 [00:07<00:06,  7.10it/s] 57%|█████▋    | 57/100 [00:08<00:05,  7.17it/s] 58%|█████▊    | 58/100 [00:08<00:06,  6.93it/s] 59%|█████▉    | 59/100 [00:08<00:05,  6.90it/s] 60%|██████    | 60/100 [00:08<00:05,  7.04it/s] 61%|██████    | 61/100 [00:08<00:05,  7.15it/s] 62%|██████▏   | 62/100 [00:08<00:05,  7.00it/s] 63%|██████▎   | 63/100 [00:08<00:05,  7.07it/s] 64%|██████▍   | 64/100 [00:09<00:05,  6.95it/s] 65%|██████▌   | 65/100 [00:09<00:04,  7.06it/s] 66%|██████▌   | 66/100 [00:09<00:04,  7.02it/s] 67%|██████▋   | 67/100 [00:09<00:04,  6.86it/s] 68%|██████▊   | 68/100 [00:09<00:04,  7.00it/s] 69%|██████▉   | 69/100 [00:09<00:04,  6.88it/s] 70%|███████   | 70/100 [00:09<00:04,  6.88it/s] 71%|███████   | 71/100 [00:10<00:04,  7.01it/s] 72%|███████▏  | 72/100 [00:10<00:03,  7.11it/s] 73%|███████▎  | 73/100 [00:10<00:03,  7.07it/s] 74%|███████▍  | 74/100 [00:10<00:03,  7.14it/s] 75%|███████▌  | 75/100 [00:10<00:03,  6.97it/s] 76%|███████▌  | 76/100 [00:10<00:03,  6.87it/s] 77%|███████▋  | 77/100 [00:10<00:03,  6.86it/s] 78%|███████▊  | 78/100 [00:11<00:03,  7.00it/s] 79%|███████▉  | 79/100 [00:11<00:03,  6.99it/s] 80%|████████  | 80/100 [00:11<00:02,  6.96it/s] 81%|████████  | 81/100 [00:11<00:02,  7.01it/s] 82%|████████▏ | 82/100 [00:11<00:02,  7.10it/s] 83%|████████▎ | 83/100 [00:11<00:02,  7.05it/s] 84%|████████▍ | 84/100 [00:11<00:02,  7.15it/s] 85%|████████▌ | 85/100 [00:12<00:02,  7.18it/s] 86%|████████▌ | 86/100 [00:12<00:01,  7.08it/s] 87%|████████▋ | 87/100 [00:12<00:01,  7.15it/s] 88%|████████▊ | 88/100 [00:12<00:01,  7.08it/s] 89%|████████▉ | 89/100 [00:12<00:01,  7.17it/s] 90%|█████████ | 90/100 [00:12<00:01,  7.23it/s] 91%|█████████ | 91/100 [00:12<00:01,  7.27it/s] 92%|█████████▏| 92/100 [00:13<00:01,  7.31it/s] 93%|█████████▎| 93/100 [00:13<00:01,  6.99it/s] 94%|█████████▍| 94/100 [00:13<00:00,  7.03it/s] 95%|█████████▌| 95/100 [00:13<00:00,  7.13it/s] 96%|█████████▌| 96/100 [00:13<00:00,  7.09it/s] 97%|█████████▋| 97/100 [00:13<00:00,  7.18it/s] 98%|█████████▊| 98/100 [00:13<00:00,  7.04it/s] 99%|█████████▉| 99/100 [00:14<00:00,  7.13it/s]100%|██████████| 100/100 [00:14<00:00,  6.89it/s]100%|██████████| 100/100 [00:14<00:00,  7.04it/s]
FOLD 1
Metric     CE Loss  KL wrt Orig
Model                          
llama_7B  2.457861     0.401175
[2.54186523 0.44438868]
2023-12-04 01:29:38.838082: I tensorflow/core/util/port.cc:110] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2023-12-04 01:29:38.888668: I tensorflow/core/platform/cpu_feature_guard.cc:182] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-12-04 01:29:39.634162: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Could not find TensorRT
Found cached dataset truthful_qa (/home/elicer/.cache/huggingface/datasets/truthful_qa/multiple_choice/1.1.0/63502f6bc6ee493830ce0843991b028d0ab568d221896b2ee3b8a5dfdaa9d7f4)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 439.79it/s]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:00<00:00,  5.02it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  5.95it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  5.79it/s]
head_wise_activation_length:(11012, 32, 4096)
labels_shape:(11012,)
seperated_head_activation shape:11013
Running fold 0
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:28,  1.07it/s]  6%|▋         | 2/32 [00:01<00:28,  1.05it/s]  9%|▉         | 3/32 [00:02<00:26,  1.08it/s] 12%|█▎        | 4/32 [00:03<00:25,  1.10it/s] 16%|█▌        | 5/32 [00:04<00:24,  1.10it/s] 19%|█▉        | 6/32 [00:05<00:24,  1.08it/s] 22%|██▏       | 7/32 [00:06<00:23,  1.07it/s] 25%|██▌       | 8/32 [00:07<00:23,  1.04it/s] 28%|██▊       | 9/32 [00:08<00:22,  1.01it/s] 31%|███▏      | 10/32 [00:09<00:22,  1.02s/it] 34%|███▍      | 11/32 [00:10<00:21,  1.04s/it] 38%|███▊      | 12/32 [00:11<00:20,  1.04s/it] 41%|████      | 13/32 [00:12<00:19,  1.05s/it] 44%|████▍     | 14/32 [00:13<00:19,  1.07s/it] 47%|████▋     | 15/32 [00:15<00:18,  1.06s/it] 50%|█████     | 16/32 [00:16<00:17,  1.06s/it] 53%|█████▎    | 17/32 [00:17<00:16,  1.07s/it] 56%|█████▋    | 18/32 [00:18<00:15,  1.08s/it] 59%|█████▉    | 19/32 [00:19<00:14,  1.11s/it] 62%|██████▎   | 20/32 [00:20<00:13,  1.12s/it] 66%|██████▌   | 21/32 [00:21<00:12,  1.13s/it] 69%|██████▉   | 22/32 [00:22<00:11,  1.12s/it] 72%|███████▏  | 23/32 [00:24<00:10,  1.15s/it] 75%|███████▌  | 24/32 [00:25<00:09,  1.19s/it] 78%|███████▊  | 25/32 [00:26<00:08,  1.18s/it] 81%|████████▏ | 26/32 [00:27<00:06,  1.17s/it] 84%|████████▍ | 27/32 [00:28<00:05,  1.19s/it] 88%|████████▊ | 28/32 [00:29<00:04,  1.15s/it] 91%|█████████ | 29/32 [00:31<00:03,  1.15s/it] 94%|█████████▍| 30/32 [00:32<00:02,  1.14s/it] 97%|█████████▋| 31/32 [00:33<00:01,  1.15s/it]100%|██████████| 32/32 [00:34<00:00,  1.25s/it]100%|██████████| 32/32 [00:34<00:00,  1.09s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
/home/elicer/honest_llama/validation/../TruthfulQA/truthfulqa/metrics.py:284: FutureWarning: load_metric is deprecated and will be removed in the next major version of datasets. Use 'evaluate.load' instead, from the new library 🤗 Evaluate: https://huggingface.co/docs/evaluate
  bleurt = load_metric("bleurt", cache_dir=cache_dir)
[[0.651 0.665 0.645 ... 0.646 0.647 0.652]
 [0.659 0.644 0.645 ... 0.648 0.658 0.656]
 [0.651 0.657 0.685 ... 0.637 0.648 0.667]
 ...
 [0.765 0.762 0.657 ... 0.73  0.704 0.674]
 [0.748 0.678 0.696 ... 0.663 0.769 0.786]
 [0.775 0.815 0.74  ... 0.697 0.809 0.79 ]]
Heads intervened:  [(8, 16), (12, 4), (13, 8), (13, 16), (16, 30), (17, 29), (18, 29), (19, 17), (20, 30), (22, 16), (23, 3), (31, 6)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
2023-12-04 01:30:30.154904: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1635] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 24961 MB memory:  -> device: 0, name: NVIDIA A100 80GB PCIe MIG 3g.40gb, pci bus id: 0000:65:00.0, compute capability: 8.0
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 282.01it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-ec0cf83741fdb3e8.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-d31e6c0c76fafb4d.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:01<01:42,  1.03s/it]  3%|▎         | 3/100 [00:01<00:29,  3.25it/s]  5%|▌         | 5/100 [00:01<00:16,  5.65it/s]  7%|▋         | 7/100 [00:01<00:11,  8.02it/s]  9%|▉         | 9/100 [00:01<00:08, 10.22it/s] 11%|█         | 11/100 [00:01<00:07, 12.14it/s] 13%|█▎        | 13/100 [00:01<00:06, 13.74it/s] 15%|█▌        | 15/100 [00:01<00:05, 15.02it/s] 17%|█▋        | 17/100 [00:01<00:05, 16.01it/s] 19%|█▉        | 19/100 [00:01<00:04, 16.75it/s] 21%|██        | 21/100 [00:02<00:04, 17.30it/s] 23%|██▎       | 23/100 [00:02<00:04, 17.68it/s] 25%|██▌       | 25/100 [00:02<00:04, 17.92it/s] 27%|██▋       | 27/100 [00:02<00:04, 18.13it/s] 29%|██▉       | 29/100 [00:02<00:03, 18.30it/s] 31%|███       | 31/100 [00:02<00:03, 18.39it/s] 33%|███▎      | 33/100 [00:02<00:03, 18.47it/s] 35%|███▌      | 35/100 [00:02<00:03, 18.53it/s] 37%|███▋      | 37/100 [00:02<00:03, 18.25it/s] 39%|███▉      | 39/100 [00:03<00:03, 18.33it/s] 41%|████      | 41/100 [00:03<00:03, 18.41it/s] 43%|████▎     | 43/100 [00:03<00:03, 18.47it/s] 45%|████▌     | 45/100 [00:03<00:02, 18.53it/s] 47%|████▋     | 47/100 [00:03<00:02, 18.57it/s] 49%|████▉     | 49/100 [00:03<00:02, 18.61it/s] 51%|█████     | 51/100 [00:03<00:02, 18.62it/s] 53%|█████▎    | 53/100 [00:03<00:02, 18.64it/s] 55%|█████▌    | 55/100 [00:03<00:02, 18.65it/s] 57%|█████▋    | 57/100 [00:04<00:02, 18.66it/s] 59%|█████▉    | 59/100 [00:04<00:02, 18.67it/s] 61%|██████    | 61/100 [00:04<00:02, 18.68it/s] 63%|██████▎   | 63/100 [00:04<00:01, 18.69it/s] 65%|██████▌   | 65/100 [00:04<00:01, 18.68it/s] 67%|██████▋   | 67/100 [00:04<00:01, 18.67it/s] 69%|██████▉   | 69/100 [00:04<00:01, 18.68it/s] 71%|███████   | 71/100 [00:04<00:01, 18.66it/s] 73%|███████▎  | 73/100 [00:04<00:01, 18.67it/s] 75%|███████▌  | 75/100 [00:05<00:01, 18.65it/s] 77%|███████▋  | 77/100 [00:05<00:01, 18.61it/s] 79%|███████▉  | 79/100 [00:05<00:01, 18.63it/s] 81%|████████  | 81/100 [00:05<00:01, 18.62it/s] 83%|████████▎ | 83/100 [00:05<00:00, 18.64it/s] 85%|████████▌ | 85/100 [00:05<00:00, 18.66it/s] 87%|████████▋ | 87/100 [00:05<00:00, 18.64it/s] 89%|████████▉ | 89/100 [00:05<00:00, 18.63it/s] 91%|█████████ | 91/100 [00:05<00:00, 18.64it/s] 93%|█████████▎| 93/100 [00:05<00:00, 18.65it/s] 95%|█████████▌| 95/100 [00:06<00:00, 18.67it/s] 97%|█████████▋| 97/100 [00:06<00:00, 18.68it/s] 99%|█████████▉| 99/100 [00:06<00:00, 18.69it/s]100%|██████████| 100/100 [00:06<00:00, 15.76it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 357.97it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-1939fcc1eeebdaa7.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-785bb4b6f2089589.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:17,  5.65it/s]  2%|▏         | 2/100 [00:00<00:15,  6.24it/s]  3%|▎         | 3/100 [00:00<00:14,  6.78it/s]  4%|▍         | 4/100 [00:00<00:14,  6.84it/s]  5%|▌         | 5/100 [00:00<00:13,  6.86it/s]  6%|▌         | 6/100 [00:00<00:13,  7.04it/s]  7%|▋         | 7/100 [00:01<00:12,  7.24it/s]  8%|▊         | 8/100 [00:01<00:12,  7.38it/s]  9%|▉         | 9/100 [00:01<00:12,  7.19it/s] 10%|█         | 10/100 [00:01<00:12,  7.28it/s] 11%|█         | 11/100 [00:01<00:12,  7.24it/s] 12%|█▏        | 12/100 [00:01<00:11,  7.39it/s] 13%|█▎        | 13/100 [00:01<00:11,  7.28it/s] 14%|█▍        | 14/100 [00:01<00:11,  7.22it/s] 15%|█▌        | 15/100 [00:02<00:11,  7.38it/s] 16%|█▌        | 16/100 [00:02<00:11,  7.21it/s] 17%|█▋        | 17/100 [00:02<00:11,  7.37it/s] 18%|█▊        | 18/100 [00:02<00:11,  7.44it/s] 19%|█▉        | 19/100 [00:02<00:11,  7.23it/s] 20%|██        | 20/100 [00:02<00:11,  7.26it/s] 21%|██        | 21/100 [00:02<00:11,  7.11it/s] 22%|██▏       | 22/100 [00:03<00:10,  7.29it/s] 23%|██▎       | 23/100 [00:03<00:10,  7.21it/s] 24%|██▍       | 24/100 [00:03<00:10,  7.17it/s] 25%|██▌       | 25/100 [00:03<00:10,  7.34it/s] 26%|██▌       | 26/100 [00:03<00:10,  7.38it/s] 27%|██▋       | 27/100 [00:03<00:10,  7.01it/s] 28%|██▊       | 28/100 [00:03<00:10,  7.16it/s] 29%|██▉       | 29/100 [00:04<00:10,  7.07it/s] 30%|███       | 30/100 [00:04<00:09,  7.09it/s] 31%|███       | 31/100 [00:04<00:09,  7.03it/s] 32%|███▏      | 32/100 [00:04<00:09,  7.02it/s] 33%|███▎      | 33/100 [00:04<00:09,  7.03it/s] 34%|███▍      | 34/100 [00:04<00:09,  6.99it/s] 35%|███▌      | 35/100 [00:04<00:09,  7.07it/s] 36%|███▌      | 36/100 [00:05<00:08,  7.12it/s] 37%|███▋      | 37/100 [00:05<00:08,  7.27it/s] 38%|███▊      | 38/100 [00:05<00:08,  7.41it/s] 39%|███▉      | 39/100 [00:05<00:08,  7.28it/s] 40%|████      | 40/100 [00:05<00:08,  7.17it/s] 41%|████      | 41/100 [00:05<00:08,  7.09it/s] 42%|████▏     | 42/100 [00:05<00:08,  6.84it/s] 43%|████▎     | 43/100 [00:06<00:08,  6.88it/s] 44%|████▍     | 44/100 [00:06<00:08,  6.85it/s] 45%|████▌     | 45/100 [00:06<00:08,  6.85it/s] 46%|████▌     | 46/100 [00:06<00:07,  7.09it/s] 47%|████▋     | 47/100 [00:06<00:07,  7.27it/s] 48%|████▊     | 48/100 [00:06<00:07,  7.20it/s] 49%|████▉     | 49/100 [00:06<00:06,  7.29it/s] 50%|█████     | 50/100 [00:07<00:06,  7.16it/s] 51%|█████     | 51/100 [00:07<00:07,  6.84it/s] 52%|█████▏    | 52/100 [00:07<00:06,  6.89it/s] 53%|█████▎    | 53/100 [00:07<00:06,  6.88it/s] 54%|█████▍    | 54/100 [00:07<00:06,  6.76it/s] 55%|█████▌    | 55/100 [00:07<00:06,  6.92it/s] 56%|█████▌    | 56/100 [00:07<00:06,  7.15it/s] 57%|█████▋    | 57/100 [00:08<00:06,  7.12it/s] 58%|█████▊    | 58/100 [00:08<00:05,  7.29it/s] 59%|█████▉    | 59/100 [00:08<00:05,  7.12it/s] 60%|██████    | 60/100 [00:08<00:05,  7.11it/s] 61%|██████    | 61/100 [00:08<00:05,  6.93it/s] 62%|██████▏   | 62/100 [00:08<00:05,  6.98it/s] 63%|██████▎   | 63/100 [00:08<00:05,  6.81it/s] 64%|██████▍   | 64/100 [00:09<00:05,  6.87it/s] 65%|██████▌   | 65/100 [00:09<00:05,  6.86it/s] 66%|██████▌   | 66/100 [00:09<00:04,  6.84it/s] 67%|██████▋   | 67/100 [00:09<00:04,  7.09it/s] 68%|██████▊   | 68/100 [00:09<00:04,  7.06it/s] 69%|██████▉   | 69/100 [00:09<00:04,  7.15it/s] 70%|███████   | 70/100 [00:09<00:04,  7.32it/s] 71%|███████   | 71/100 [00:10<00:04,  7.16it/s] 72%|███████▏  | 72/100 [00:10<00:03,  7.31it/s] 73%|███████▎  | 73/100 [00:10<00:03,  7.18it/s] 74%|███████▍  | 74/100 [00:10<00:03,  7.10it/s] 75%|███████▌  | 75/100 [00:10<00:03,  7.28it/s] 76%|███████▌  | 76/100 [00:10<00:03,  7.26it/s] 77%|███████▋  | 77/100 [00:10<00:03,  7.10it/s] 78%|███████▊  | 78/100 [00:10<00:03,  7.04it/s] 79%|███████▉  | 79/100 [00:11<00:02,  7.09it/s] 80%|████████  | 80/100 [00:11<00:02,  7.09it/s] 81%|████████  | 81/100 [00:11<00:02,  6.98it/s] 82%|████████▏ | 82/100 [00:11<00:02,  6.99it/s] 83%|████████▎ | 83/100 [00:11<00:02,  7.12it/s] 84%|████████▍ | 84/100 [00:11<00:02,  7.08it/s] 85%|████████▌ | 85/100 [00:11<00:02,  7.15it/s] 86%|████████▌ | 86/100 [00:12<00:01,  7.19it/s] 87%|████████▋ | 87/100 [00:12<00:01,  7.20it/s] 88%|████████▊ | 88/100 [00:12<00:01,  7.04it/s] 89%|████████▉ | 89/100 [00:12<00:01,  7.13it/s] 90%|█████████ | 90/100 [00:12<00:01,  7.15it/s] 91%|█████████ | 91/100 [00:12<00:01,  7.21it/s] 92%|█████████▏| 92/100 [00:12<00:01,  7.35it/s] 93%|█████████▎| 93/100 [00:13<00:00,  7.05it/s] 94%|█████████▍| 94/100 [00:13<00:00,  7.05it/s] 95%|█████████▌| 95/100 [00:13<00:00,  7.12it/s] 96%|█████████▌| 96/100 [00:13<00:00,  7.08it/s] 97%|█████████▋| 97/100 [00:13<00:00,  7.08it/s] 98%|█████████▊| 98/100 [00:13<00:00,  7.07it/s] 99%|█████████▉| 99/100 [00:13<00:00,  7.01it/s]100%|██████████| 100/100 [00:14<00:00,  7.00it/s]100%|██████████| 100/100 [00:14<00:00,  7.10it/s]
FOLD 0
Metric     CE Loss  KL wrt Orig
Model                          
llama_7B  3.134248     0.993342
Running fold 1
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:29,  1.04it/s]  6%|▋         | 2/32 [00:02<00:33,  1.11s/it]  9%|▉         | 3/32 [00:03<00:34,  1.19s/it] 12%|█▎        | 4/32 [00:04<00:33,  1.21s/it] 16%|█▌        | 5/32 [00:06<00:33,  1.25s/it] 19%|█▉        | 6/32 [00:07<00:33,  1.28s/it] 22%|██▏       | 7/32 [00:08<00:32,  1.29s/it] 25%|██▌       | 8/32 [00:09<00:30,  1.28s/it] 28%|██▊       | 9/32 [00:11<00:29,  1.28s/it] 31%|███▏      | 10/32 [00:12<00:28,  1.28s/it] 34%|███▍      | 11/32 [00:13<00:26,  1.26s/it] 38%|███▊      | 12/32 [00:14<00:24,  1.24s/it] 41%|████      | 13/32 [00:16<00:23,  1.24s/it] 44%|████▍     | 14/32 [00:17<00:22,  1.23s/it] 47%|████▋     | 15/32 [00:18<00:20,  1.22s/it] 50%|█████     | 16/32 [00:19<00:19,  1.23s/it] 53%|█████▎    | 17/32 [00:21<00:18,  1.23s/it] 56%|█████▋    | 18/32 [00:22<00:17,  1.23s/it] 59%|█████▉    | 19/32 [00:23<00:16,  1.25s/it] 62%|██████▎   | 20/32 [00:24<00:15,  1.29s/it] 66%|██████▌   | 21/32 [00:26<00:14,  1.30s/it] 69%|██████▉   | 22/32 [00:27<00:12,  1.30s/it] 72%|███████▏  | 23/32 [00:28<00:11,  1.31s/it] 75%|███████▌  | 24/32 [00:30<00:10,  1.34s/it] 78%|███████▊  | 25/32 [00:31<00:09,  1.34s/it] 81%|████████▏ | 26/32 [00:32<00:07,  1.33s/it] 84%|████████▍ | 27/32 [00:34<00:06,  1.34s/it] 88%|████████▊ | 28/32 [00:35<00:05,  1.33s/it] 91%|█████████ | 29/32 [00:36<00:04,  1.34s/it] 94%|█████████▍| 30/32 [00:38<00:02,  1.32s/it] 97%|█████████▋| 31/32 [00:39<00:01,  1.32s/it]100%|██████████| 32/32 [00:41<00:00,  1.37s/it]100%|██████████| 32/32 [00:41<00:00,  1.28s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
[[0.666 0.672 0.662 ... 0.668 0.662 0.67 ]
 [0.662 0.662 0.659 ... 0.677 0.666 0.663]
 [0.668 0.67  0.68  ... 0.661 0.665 0.671]
 ...
 [0.758 0.75  0.674 ... 0.716 0.694 0.677]
 [0.749 0.671 0.686 ... 0.674 0.762 0.76 ]
 [0.765 0.805 0.748 ... 0.743 0.787 0.775]]
Heads intervened:  [(8, 16), (11, 17), (12, 4), (13, 8), (13, 16), (16, 17), (17, 13), (17, 29), (18, 29), (19, 17), (20, 30), (23, 3)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 255.52it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-30ec7b2da7888791.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-4e53eea82b0ecfef.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  2%|▏         | 2/100 [00:00<00:05, 16.40it/s]  4%|▍         | 4/100 [00:00<00:05, 17.79it/s]  6%|▌         | 6/100 [00:00<00:05, 18.28it/s]  8%|▊         | 8/100 [00:00<00:04, 18.52it/s] 10%|█         | 10/100 [00:00<00:04, 18.64it/s] 12%|█▏        | 12/100 [00:00<00:04, 18.74it/s] 14%|█▍        | 14/100 [00:00<00:04, 18.79it/s] 16%|█▌        | 16/100 [00:00<00:04, 18.82it/s] 18%|█▊        | 18/100 [00:00<00:04, 18.84it/s] 20%|██        | 20/100 [00:01<00:04, 18.86it/s] 22%|██▏       | 22/100 [00:01<00:04, 18.87it/s] 24%|██▍       | 24/100 [00:01<00:04, 18.85it/s] 26%|██▌       | 26/100 [00:01<00:03, 18.85it/s] 28%|██▊       | 28/100 [00:01<00:03, 18.86it/s] 30%|███       | 30/100 [00:01<00:03, 18.87it/s] 32%|███▏      | 32/100 [00:01<00:03, 18.88it/s] 34%|███▍      | 34/100 [00:01<00:03, 18.88it/s] 36%|███▌      | 36/100 [00:01<00:03, 18.89it/s] 38%|███▊      | 38/100 [00:02<00:03, 18.90it/s] 40%|████      | 40/100 [00:02<00:03, 18.90it/s] 42%|████▏     | 42/100 [00:02<00:03, 18.90it/s] 44%|████▍     | 44/100 [00:02<00:02, 18.89it/s] 46%|████▌     | 46/100 [00:02<00:02, 18.90it/s] 48%|████▊     | 48/100 [00:02<00:02, 18.91it/s] 50%|█████     | 50/100 [00:02<00:02, 18.91it/s] 52%|█████▏    | 52/100 [00:02<00:02, 18.91it/s] 54%|█████▍    | 54/100 [00:02<00:02, 18.92it/s] 56%|█████▌    | 56/100 [00:02<00:02, 18.91it/s] 58%|█████▊    | 58/100 [00:03<00:02, 18.92it/s] 60%|██████    | 60/100 [00:03<00:02, 18.90it/s] 62%|██████▏   | 62/100 [00:03<00:02, 18.90it/s] 64%|██████▍   | 64/100 [00:03<00:01, 18.59it/s] 66%|██████▌   | 66/100 [00:03<00:01, 18.66it/s] 68%|██████▊   | 68/100 [00:03<00:01, 18.73it/s] 70%|███████   | 70/100 [00:03<00:01, 18.79it/s] 72%|███████▏  | 72/100 [00:03<00:01, 18.82it/s] 74%|███████▍  | 74/100 [00:03<00:01, 18.84it/s] 76%|███████▌  | 76/100 [00:04<00:01, 18.87it/s] 78%|███████▊  | 78/100 [00:04<00:01, 18.88it/s] 80%|████████  | 80/100 [00:04<00:01, 18.90it/s] 82%|████████▏ | 82/100 [00:04<00:00, 18.90it/s] 84%|████████▍ | 84/100 [00:04<00:00, 18.91it/s] 86%|████████▌ | 86/100 [00:04<00:00, 18.91it/s] 88%|████████▊ | 88/100 [00:04<00:00, 18.92it/s] 90%|█████████ | 90/100 [00:04<00:00, 18.92it/s] 92%|█████████▏| 92/100 [00:04<00:00, 18.92it/s] 94%|█████████▍| 94/100 [00:04<00:00, 18.92it/s] 96%|█████████▌| 96/100 [00:05<00:00, 18.93it/s] 98%|█████████▊| 98/100 [00:05<00:00, 18.93it/s]100%|██████████| 100/100 [00:05<00:00, 18.93it/s]100%|██████████| 100/100 [00:05<00:00, 18.82it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 346.84it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-14295f39edd20556.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-10ca04ba0c7bb427.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:16,  5.92it/s]  2%|▏         | 2/100 [00:00<00:15,  6.36it/s]  3%|▎         | 3/100 [00:00<00:14,  6.70it/s]  4%|▍         | 4/100 [00:00<00:13,  7.08it/s]  5%|▌         | 5/100 [00:00<00:13,  7.06it/s]  6%|▌         | 6/100 [00:00<00:12,  7.29it/s]  7%|▋         | 7/100 [00:01<00:13,  7.11it/s]  8%|▊         | 8/100 [00:01<00:12,  7.23it/s]  9%|▉         | 9/100 [00:01<00:12,  7.27it/s] 10%|█         | 10/100 [00:01<00:12,  6.99it/s] 11%|█         | 11/100 [00:01<00:12,  7.02it/s] 12%|█▏        | 12/100 [00:01<00:12,  7.01it/s] 13%|█▎        | 13/100 [00:01<00:12,  6.95it/s] 14%|█▍        | 14/100 [00:02<00:12,  6.97it/s] 15%|█▌        | 15/100 [00:02<00:11,  7.09it/s] 16%|█▌        | 16/100 [00:02<00:11,  7.27it/s] 17%|█▋        | 17/100 [00:02<00:11,  7.41it/s] 18%|█▊        | 18/100 [00:02<00:11,  7.27it/s] 19%|█▉        | 19/100 [00:02<00:11,  7.10it/s] 20%|██        | 20/100 [00:02<00:11,  7.08it/s] 21%|██        | 21/100 [00:02<00:11,  6.98it/s] 22%|██▏       | 22/100 [00:03<00:10,  7.12it/s] 23%|██▎       | 23/100 [00:03<00:10,  7.31it/s] 24%|██▍       | 24/100 [00:03<00:10,  7.36it/s] 25%|██▌       | 25/100 [00:03<00:10,  7.21it/s] 26%|██▌       | 26/100 [00:03<00:10,  7.19it/s] 27%|██▋       | 27/100 [00:03<00:10,  7.28it/s] 28%|██▊       | 28/100 [00:03<00:10,  7.19it/s] 29%|██▉       | 29/100 [00:04<00:09,  7.20it/s] 30%|███       | 30/100 [00:04<00:09,  7.28it/s] 31%|███       | 31/100 [00:04<00:09,  7.43it/s] 32%|███▏      | 32/100 [00:04<00:09,  7.20it/s] 33%|███▎      | 33/100 [00:04<00:09,  7.30it/s] 34%|███▍      | 34/100 [00:04<00:09,  7.22it/s] 35%|███▌      | 35/100 [00:04<00:08,  7.32it/s] 36%|███▌      | 36/100 [00:05<00:08,  7.45it/s] 37%|███▋      | 37/100 [00:05<00:08,  7.04it/s] 38%|███▊      | 38/100 [00:05<00:08,  7.05it/s] 39%|███▉      | 39/100 [00:05<00:08,  6.98it/s] 40%|████      | 40/100 [00:05<00:08,  6.95it/s] 41%|████      | 41/100 [00:05<00:08,  6.98it/s] 42%|████▏     | 42/100 [00:05<00:08,  6.90it/s] 43%|████▎     | 43/100 [00:06<00:08,  6.96it/s] 44%|████▍     | 44/100 [00:06<00:08,  6.91it/s] 45%|████▌     | 45/100 [00:06<00:07,  7.07it/s] 46%|████▌     | 46/100 [00:06<00:07,  7.27it/s] 47%|████▋     | 47/100 [00:06<00:07,  7.33it/s] 48%|████▊     | 48/100 [00:06<00:07,  7.17it/s] 49%|████▉     | 49/100 [00:06<00:07,  6.97it/s] 50%|█████     | 50/100 [00:07<00:07,  6.96it/s] 51%|█████     | 51/100 [00:07<00:06,  7.19it/s] 52%|█████▏    | 52/100 [00:07<00:06,  7.36it/s] 53%|█████▎    | 53/100 [00:07<00:06,  7.26it/s] 54%|█████▍    | 54/100 [00:07<00:06,  7.34it/s] 55%|█████▌    | 55/100 [00:07<00:06,  7.19it/s] 56%|█████▌    | 56/100 [00:07<00:06,  6.98it/s] 57%|█████▋    | 57/100 [00:08<00:06,  7.03it/s] 58%|█████▊    | 58/100 [00:08<00:06,  6.98it/s] 59%|█████▉    | 59/100 [00:08<00:05,  6.95it/s] 60%|██████    | 60/100 [00:08<00:05,  7.11it/s] 61%|██████    | 61/100 [00:08<00:05,  7.10it/s] 62%|██████▏   | 62/100 [00:08<00:05,  7.10it/s] 63%|██████▎   | 63/100 [00:08<00:05,  7.30it/s] 64%|██████▍   | 64/100 [00:08<00:04,  7.37it/s] 65%|██████▌   | 65/100 [00:09<00:04,  7.19it/s] 66%|██████▌   | 66/100 [00:09<00:04,  7.09it/s] 67%|██████▋   | 67/100 [00:09<00:04,  6.88it/s] 68%|██████▊   | 68/100 [00:09<00:04,  7.02it/s] 69%|██████▉   | 69/100 [00:09<00:04,  7.03it/s] 70%|███████   | 70/100 [00:09<00:04,  6.95it/s] 71%|███████   | 71/100 [00:09<00:04,  6.91it/s] 72%|███████▏  | 72/100 [00:10<00:04,  6.97it/s] 73%|███████▎  | 73/100 [00:10<00:03,  7.13it/s] 74%|███████▍  | 74/100 [00:10<00:03,  7.24it/s] 75%|███████▌  | 75/100 [00:10<00:03,  7.12it/s] 76%|███████▌  | 76/100 [00:10<00:03,  7.10it/s] 77%|███████▋  | 77/100 [00:10<00:03,  7.21it/s] 78%|███████▊  | 78/100 [00:10<00:03,  7.24it/s] 79%|███████▉  | 79/100 [00:11<00:02,  7.32it/s] 80%|████████  | 80/100 [00:11<00:02,  7.18it/s] 81%|████████  | 81/100 [00:11<00:02,  7.17it/s] 82%|████████▏ | 82/100 [00:11<00:02,  7.26it/s] 83%|████████▎ | 83/100 [00:11<00:02,  7.33it/s] 84%|████████▍ | 84/100 [00:11<00:02,  7.18it/s] 85%|████████▌ | 85/100 [00:11<00:02,  7.08it/s] 86%|████████▌ | 86/100 [00:12<00:01,  7.19it/s] 87%|████████▋ | 87/100 [00:12<00:01,  7.05it/s] 88%|████████▊ | 88/100 [00:12<00:01,  6.93it/s] 89%|████████▉ | 89/100 [00:12<00:01,  7.15it/s] 90%|█████████ | 90/100 [00:12<00:01,  7.33it/s] 91%|█████████ | 91/100 [00:12<00:01,  7.40it/s] 92%|█████████▏| 92/100 [00:12<00:01,  7.21it/s] 93%|█████████▎| 93/100 [00:13<00:00,  7.05it/s] 94%|█████████▍| 94/100 [00:13<00:00,  7.07it/s] 95%|█████████▌| 95/100 [00:13<00:00,  7.06it/s] 96%|█████████▌| 96/100 [00:13<00:00,  7.09it/s] 97%|█████████▋| 97/100 [00:13<00:00,  7.17it/s] 98%|█████████▊| 98/100 [00:13<00:00,  7.12it/s] 99%|█████████▉| 99/100 [00:13<00:00,  7.09it/s]100%|██████████| 100/100 [00:14<00:00,  7.28it/s]100%|██████████| 100/100 [00:14<00:00,  7.13it/s]
FOLD 1
Metric     CE Loss  KL wrt Orig
Model                          
llama_7B  3.289746     1.217297
[3.21199707 1.10531991]
2023-12-04 01:32:09.364905: I tensorflow/core/util/port.cc:110] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2023-12-04 01:32:09.414207: I tensorflow/core/platform/cpu_feature_guard.cc:182] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-12-04 01:32:10.160728: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Could not find TensorRT
Found cached dataset truthful_qa (/home/elicer/.cache/huggingface/datasets/truthful_qa/multiple_choice/1.1.0/63502f6bc6ee493830ce0843991b028d0ab568d221896b2ee3b8a5dfdaa9d7f4)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 353.71it/s]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:00<00:00,  5.27it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  6.11it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  5.96it/s]
head_wise_activation_length:(11012, 32, 4096)
labels_shape:(11012,)
seperated_head_activation shape:11013
Running fold 0
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:28,  1.10it/s]  6%|▋         | 2/32 [00:01<00:28,  1.07it/s]  9%|▉         | 3/32 [00:02<00:26,  1.10it/s] 12%|█▎        | 4/32 [00:03<00:24,  1.13it/s] 16%|█▌        | 5/32 [00:04<00:24,  1.12it/s] 19%|█▉        | 6/32 [00:05<00:23,  1.11it/s] 22%|██▏       | 7/32 [00:06<00:22,  1.10it/s] 25%|██▌       | 8/32 [00:07<00:22,  1.06it/s] 28%|██▊       | 9/32 [00:08<00:22,  1.04it/s] 31%|███▏      | 10/32 [00:09<00:21,  1.01it/s] 34%|███▍      | 11/32 [00:10<00:21,  1.02s/it] 38%|███▊      | 12/32 [00:11<00:20,  1.01s/it] 41%|████      | 13/32 [00:12<00:19,  1.02s/it] 44%|████▍     | 14/32 [00:13<00:18,  1.04s/it] 47%|████▋     | 15/32 [00:14<00:17,  1.04s/it] 50%|█████     | 16/32 [00:15<00:16,  1.04s/it] 53%|█████▎    | 17/32 [00:16<00:15,  1.05s/it] 56%|█████▋    | 18/32 [00:17<00:14,  1.06s/it] 59%|█████▉    | 19/32 [00:18<00:14,  1.09s/it] 62%|██████▎   | 20/32 [00:20<00:13,  1.10s/it] 66%|██████▌   | 21/32 [00:21<00:12,  1.12s/it] 69%|██████▉   | 22/32 [00:22<00:11,  1.11s/it] 72%|███████▏  | 23/32 [00:23<00:10,  1.14s/it] 75%|███████▌  | 24/32 [00:24<00:09,  1.19s/it] 78%|███████▊  | 25/32 [00:26<00:08,  1.18s/it] 81%|████████▏ | 26/32 [00:27<00:07,  1.17s/it] 84%|████████▍ | 27/32 [00:28<00:05,  1.20s/it] 88%|████████▊ | 28/32 [00:29<00:04,  1.15s/it] 91%|█████████ | 29/32 [00:30<00:03,  1.15s/it] 94%|█████████▍| 30/32 [00:31<00:02,  1.13s/it] 97%|█████████▋| 31/32 [00:32<00:01,  1.15s/it]100%|██████████| 32/32 [00:34<00:00,  1.24s/it]100%|██████████| 32/32 [00:34<00:00,  1.07s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
/home/elicer/honest_llama/validation/../TruthfulQA/truthfulqa/metrics.py:284: FutureWarning: load_metric is deprecated and will be removed in the next major version of datasets. Use 'evaluate.load' instead, from the new library 🤗 Evaluate: https://huggingface.co/docs/evaluate
  bleurt = load_metric("bleurt", cache_dir=cache_dir)
[[0.651 0.665 0.645 ... 0.646 0.647 0.652]
 [0.659 0.644 0.645 ... 0.648 0.658 0.656]
 [0.651 0.657 0.685 ... 0.637 0.648 0.667]
 ...
 [0.765 0.762 0.657 ... 0.73  0.704 0.674]
 [0.748 0.678 0.696 ... 0.663 0.769 0.786]
 [0.775 0.815 0.74  ... 0.697 0.809 0.79 ]]
Heads intervened:  [(8, 16), (12, 4), (12, 15), (13, 8), (13, 16), (15, 28), (16, 30), (17, 13), (17, 17), (17, 29), (18, 29), (19, 13), (19, 17), (20, 22), (20, 30), (22, 16), (22, 30), (23, 3), (23, 7), (23, 13), (25, 15), (31, 1), (31, 6), (31, 30)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
2023-12-04 01:33:00.865924: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1635] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 24961 MB memory:  -> device: 0, name: NVIDIA A100 80GB PCIe MIG 3g.40gb, pci bus id: 0000:65:00.0, compute capability: 8.0
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 296.02it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-ec0cf83741fdb3e8.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-d31e6c0c76fafb4d.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:01<01:42,  1.03s/it]  3%|▎         | 3/100 [00:01<00:30,  3.23it/s]  5%|▌         | 5/100 [00:01<00:17,  5.58it/s]  7%|▋         | 7/100 [00:01<00:11,  7.87it/s]  9%|▉         | 9/100 [00:01<00:09,  9.99it/s] 11%|█         | 11/100 [00:01<00:07, 11.80it/s] 13%|█▎        | 13/100 [00:01<00:06, 13.31it/s] 15%|█▌        | 15/100 [00:01<00:05, 14.52it/s] 17%|█▋        | 17/100 [00:01<00:05, 15.45it/s] 19%|█▉        | 19/100 [00:02<00:05, 16.14it/s] 21%|██        | 21/100 [00:02<00:04, 16.65it/s] 23%|██▎       | 23/100 [00:02<00:04, 17.02it/s] 25%|██▌       | 25/100 [00:02<00:04, 17.29it/s] 27%|██▋       | 27/100 [00:02<00:04, 17.48it/s] 29%|██▉       | 29/100 [00:02<00:04, 17.61it/s] 31%|███       | 31/100 [00:02<00:03, 17.69it/s] 33%|███▎      | 33/100 [00:02<00:03, 17.76it/s] 35%|███▌      | 35/100 [00:02<00:03, 17.82it/s] 37%|███▋      | 37/100 [00:03<00:03, 17.85it/s] 39%|███▉      | 39/100 [00:03<00:03, 17.88it/s] 41%|████      | 41/100 [00:03<00:03, 17.89it/s] 43%|████▎     | 43/100 [00:03<00:03, 17.90it/s] 45%|████▌     | 45/100 [00:03<00:03, 17.91it/s] 47%|████▋     | 47/100 [00:03<00:02, 17.92it/s] 49%|████▉     | 49/100 [00:03<00:02, 17.54it/s] 51%|█████     | 51/100 [00:03<00:02, 17.63it/s] 53%|█████▎    | 53/100 [00:03<00:02, 17.72it/s] 55%|█████▌    | 55/100 [00:04<00:02, 17.79it/s] 57%|█████▋    | 57/100 [00:04<00:02, 17.84it/s] 59%|█████▉    | 59/100 [00:04<00:02, 17.88it/s] 61%|██████    | 61/100 [00:04<00:02, 17.90it/s] 63%|██████▎   | 63/100 [00:04<00:02, 17.93it/s] 65%|██████▌   | 65/100 [00:04<00:01, 17.94it/s] 67%|██████▋   | 67/100 [00:04<00:01, 17.94it/s] 69%|██████▉   | 69/100 [00:04<00:01, 17.95it/s] 71%|███████   | 71/100 [00:04<00:01, 17.95it/s] 73%|███████▎  | 73/100 [00:05<00:01, 17.94it/s] 75%|███████▌  | 75/100 [00:05<00:01, 17.94it/s] 77%|███████▋  | 77/100 [00:05<00:01, 17.95it/s] 79%|███████▉  | 79/100 [00:05<00:01, 17.95it/s] 81%|████████  | 81/100 [00:05<00:01, 17.93it/s] 83%|████████▎ | 83/100 [00:05<00:00, 17.96it/s] 85%|████████▌ | 85/100 [00:05<00:00, 17.96it/s] 87%|████████▋ | 87/100 [00:05<00:00, 17.93it/s] 89%|████████▉ | 89/100 [00:05<00:00, 17.94it/s] 91%|█████████ | 91/100 [00:06<00:00, 17.95it/s] 93%|█████████▎| 93/100 [00:06<00:00, 17.96it/s] 95%|█████████▌| 95/100 [00:06<00:00, 17.96it/s] 97%|█████████▋| 97/100 [00:06<00:00, 17.97it/s] 99%|█████████▉| 99/100 [00:06<00:00, 17.92it/s]100%|██████████| 100/100 [00:06<00:00, 15.23it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 355.06it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-1939fcc1eeebdaa7.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-785bb4b6f2089589.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:17,  5.64it/s]  2%|▏         | 2/100 [00:00<00:15,  6.40it/s]  3%|▎         | 3/100 [00:00<00:14,  6.58it/s]  4%|▍         | 4/100 [00:00<00:14,  6.56it/s]  5%|▌         | 5/100 [00:00<00:13,  6.93it/s]  6%|▌         | 6/100 [00:00<00:13,  7.17it/s]  7%|▋         | 7/100 [00:01<00:12,  7.19it/s]  8%|▊         | 8/100 [00:01<00:12,  7.22it/s]  9%|▉         | 9/100 [00:01<00:12,  7.13it/s] 10%|█         | 10/100 [00:01<00:12,  7.29it/s] 11%|█         | 11/100 [00:01<00:12,  7.27it/s] 12%|█▏        | 12/100 [00:01<00:12,  7.32it/s] 13%|█▎        | 13/100 [00:01<00:12,  7.15it/s] 14%|█▍        | 14/100 [00:02<00:12,  6.98it/s] 15%|█▌        | 15/100 [00:02<00:12,  6.94it/s] 16%|█▌        | 16/100 [00:02<00:12,  6.84it/s] 17%|█▋        | 17/100 [00:02<00:11,  6.97it/s] 18%|█▊        | 18/100 [00:02<00:11,  7.18it/s] 19%|█▉        | 19/100 [00:02<00:11,  7.20it/s] 20%|██        | 20/100 [00:02<00:11,  7.22it/s] 21%|██        | 21/100 [00:02<00:10,  7.28it/s] 22%|██▏       | 22/100 [00:03<00:10,  7.31it/s] 23%|██▎       | 23/100 [00:03<00:10,  7.43it/s] 24%|██▍       | 24/100 [00:03<00:10,  7.44it/s] 25%|██▌       | 25/100 [00:03<00:09,  7.51it/s] 26%|██▌       | 26/100 [00:03<00:09,  7.46it/s] 27%|██▋       | 27/100 [00:03<00:10,  7.27it/s] 28%|██▊       | 28/100 [00:03<00:09,  7.29it/s] 29%|██▉       | 29/100 [00:04<00:10,  7.08it/s] 30%|███       | 30/100 [00:04<00:09,  7.04it/s] 31%|███       | 31/100 [00:04<00:09,  7.03it/s] 32%|███▏      | 32/100 [00:04<00:09,  7.02it/s] 33%|███▎      | 33/100 [00:04<00:09,  7.05it/s] 34%|███▍      | 34/100 [00:04<00:09,  6.97it/s] 35%|███▌      | 35/100 [00:04<00:09,  7.10it/s] 36%|███▌      | 36/100 [00:05<00:08,  7.23it/s] 37%|███▋      | 37/100 [00:05<00:08,  7.21it/s] 38%|███▊      | 38/100 [00:05<00:08,  7.10it/s] 39%|███▉      | 39/100 [00:05<00:08,  7.10it/s] 40%|████      | 40/100 [00:05<00:08,  6.97it/s] 41%|████      | 41/100 [00:05<00:08,  7.07it/s] 42%|████▏     | 42/100 [00:05<00:08,  6.90it/s] 43%|████▎     | 43/100 [00:06<00:08,  6.97it/s] 44%|████▍     | 44/100 [00:06<00:07,  7.18it/s] 45%|████▌     | 45/100 [00:06<00:07,  7.00it/s] 46%|████▌     | 46/100 [00:06<00:07,  6.90it/s] 47%|████▋     | 47/100 [00:06<00:07,  7.03it/s] 48%|████▊     | 48/100 [00:06<00:07,  7.21it/s] 49%|████▉     | 49/100 [00:06<00:07,  7.23it/s] 50%|█████     | 50/100 [00:07<00:07,  7.07it/s] 51%|█████     | 51/100 [00:07<00:06,  7.25it/s] 52%|█████▏    | 52/100 [00:07<00:06,  7.37it/s] 53%|█████▎    | 53/100 [00:07<00:06,  7.16it/s] 54%|█████▍    | 54/100 [00:07<00:06,  7.03it/s] 55%|█████▌    | 55/100 [00:07<00:06,  7.20it/s] 56%|█████▌    | 56/100 [00:07<00:06,  7.30it/s] 57%|█████▋    | 57/100 [00:08<00:05,  7.21it/s] 58%|█████▊    | 58/100 [00:08<00:05,  7.14it/s] 59%|█████▉    | 59/100 [00:08<00:05,  7.12it/s] 60%|██████    | 60/100 [00:08<00:05,  7.29it/s] 61%|██████    | 61/100 [00:08<00:05,  7.15it/s] 62%|██████▏   | 62/100 [00:08<00:05,  7.06it/s] 63%|██████▎   | 63/100 [00:08<00:05,  6.99it/s] 64%|██████▍   | 64/100 [00:08<00:05,  7.19it/s] 65%|██████▌   | 65/100 [00:09<00:04,  7.23it/s] 66%|██████▌   | 66/100 [00:09<00:04,  7.18it/s] 67%|██████▋   | 67/100 [00:09<00:04,  7.34it/s] 68%|██████▊   | 68/100 [00:09<00:04,  7.45it/s] 69%|██████▉   | 69/100 [00:09<00:04,  7.48it/s] 70%|███████   | 70/100 [00:09<00:03,  7.53it/s] 71%|███████   | 71/100 [00:09<00:03,  7.58it/s] 72%|███████▏  | 72/100 [00:10<00:03,  7.62it/s] 73%|███████▎  | 73/100 [00:10<00:03,  7.44it/s] 74%|███████▍  | 74/100 [00:10<00:03,  7.47it/s] 75%|███████▌  | 75/100 [00:10<00:03,  7.54it/s] 76%|███████▌  | 76/100 [00:10<00:03,  7.32it/s] 77%|███████▋  | 77/100 [00:10<00:03,  7.43it/s] 78%|███████▊  | 78/100 [00:10<00:02,  7.49it/s] 79%|███████▉  | 79/100 [00:10<00:02,  7.51it/s] 80%|████████  | 80/100 [00:11<00:02,  7.56it/s] 81%|████████  | 81/100 [00:11<00:02,  7.61it/s] 82%|████████▏ | 82/100 [00:11<00:02,  7.35it/s] 83%|████████▎ | 83/100 [00:11<00:02,  7.18it/s] 84%|████████▍ | 84/100 [00:11<00:02,  7.15it/s] 85%|████████▌ | 85/100 [00:11<00:02,  7.10it/s] 86%|████████▌ | 86/100 [00:11<00:01,  7.17it/s] 87%|████████▋ | 87/100 [00:12<00:01,  7.32it/s] 88%|████████▊ | 88/100 [00:12<00:01,  7.09it/s] 89%|████████▉ | 89/100 [00:12<00:01,  7.10it/s] 90%|█████████ | 90/100 [00:12<00:01,  7.10it/s] 91%|█████████ | 91/100 [00:12<00:01,  7.11it/s] 92%|█████████▏| 92/100 [00:12<00:01,  7.03it/s] 93%|█████████▎| 93/100 [00:12<00:01,  6.85it/s] 94%|█████████▍| 94/100 [00:13<00:00,  6.92it/s] 95%|█████████▌| 95/100 [00:13<00:00,  7.14it/s] 96%|█████████▌| 96/100 [00:13<00:00,  7.31it/s] 97%|█████████▋| 97/100 [00:13<00:00,  7.16it/s] 98%|█████████▊| 98/100 [00:13<00:00,  6.98it/s] 99%|█████████▉| 99/100 [00:13<00:00,  6.94it/s]100%|██████████| 100/100 [00:13<00:00,  6.91it/s]100%|██████████| 100/100 [00:13<00:00,  7.16it/s]
FOLD 0
Metric     CE Loss  KL wrt Orig
Model                          
llama_7B  3.088516     0.954201
Running fold 1
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:29,  1.07it/s]  6%|▋         | 2/32 [00:02<00:32,  1.08s/it]  9%|▉         | 3/32 [00:03<00:33,  1.16s/it] 12%|█▎        | 4/32 [00:04<00:32,  1.18s/it] 16%|█▌        | 5/32 [00:05<00:33,  1.22s/it] 19%|█▉        | 6/32 [00:07<00:32,  1.26s/it] 22%|██▏       | 7/32 [00:08<00:31,  1.27s/it] 25%|██▌       | 8/32 [00:09<00:30,  1.27s/it] 28%|██▊       | 9/32 [00:11<00:29,  1.27s/it] 31%|███▏      | 10/32 [00:12<00:27,  1.27s/it] 34%|███▍      | 11/32 [00:13<00:26,  1.26s/it] 38%|███▊      | 12/32 [00:14<00:24,  1.23s/it] 41%|████      | 13/32 [00:15<00:23,  1.23s/it] 44%|████▍     | 14/32 [00:17<00:22,  1.23s/it] 47%|████▋     | 15/32 [00:18<00:20,  1.22s/it] 50%|█████     | 16/32 [00:19<00:19,  1.23s/it] 53%|█████▎    | 17/32 [00:20<00:18,  1.22s/it] 56%|█████▋    | 18/32 [00:22<00:17,  1.22s/it] 59%|█████▉    | 19/32 [00:23<00:16,  1.25s/it] 62%|██████▎   | 20/32 [00:24<00:15,  1.28s/it] 66%|██████▌   | 21/32 [00:26<00:14,  1.29s/it] 69%|██████▉   | 22/32 [00:27<00:12,  1.29s/it] 72%|███████▏  | 23/32 [00:28<00:11,  1.29s/it] 75%|███████▌  | 24/32 [00:29<00:10,  1.32s/it] 78%|███████▊  | 25/32 [00:31<00:09,  1.32s/it] 81%|████████▏ | 26/32 [00:32<00:07,  1.31s/it] 84%|████████▍ | 27/32 [00:33<00:06,  1.33s/it] 88%|████████▊ | 28/32 [00:35<00:05,  1.32s/it] 91%|█████████ | 29/32 [00:36<00:03,  1.33s/it] 94%|█████████▍| 30/32 [00:37<00:02,  1.31s/it] 97%|█████████▋| 31/32 [00:39<00:01,  1.31s/it]100%|██████████| 32/32 [00:40<00:00,  1.37s/it]100%|██████████| 32/32 [00:40<00:00,  1.27s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
[[0.666 0.672 0.662 ... 0.668 0.662 0.67 ]
 [0.662 0.662 0.659 ... 0.677 0.666 0.663]
 [0.668 0.67  0.68  ... 0.661 0.665 0.671]
 ...
 [0.758 0.75  0.674 ... 0.716 0.694 0.677]
 [0.749 0.671 0.686 ... 0.674 0.762 0.76 ]
 [0.765 0.805 0.748 ... 0.743 0.787 0.775]]
Heads intervened:  [(8, 16), (11, 16), (11, 17), (12, 4), (13, 8), (13, 10), (13, 16), (13, 21), (16, 17), (16, 26), (16, 30), (17, 13), (17, 19), (17, 29), (18, 29), (19, 13), (19, 17), (19, 31), (20, 22), (20, 30), (22, 16), (23, 3), (23, 12), (31, 6)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 254.03it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-30ec7b2da7888791.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-4e53eea82b0ecfef.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  2%|▏         | 2/100 [00:00<00:06, 15.96it/s]  4%|▍         | 4/100 [00:00<00:05, 17.13it/s]  6%|▌         | 6/100 [00:00<00:05, 17.56it/s]  8%|▊         | 8/100 [00:00<00:05, 17.78it/s] 10%|█         | 10/100 [00:00<00:05, 17.91it/s] 12%|█▏        | 12/100 [00:00<00:04, 17.98it/s] 14%|█▍        | 14/100 [00:00<00:04, 18.02it/s] 16%|█▌        | 16/100 [00:00<00:04, 18.05it/s] 18%|█▊        | 18/100 [00:01<00:04, 18.07it/s] 20%|██        | 20/100 [00:01<00:04, 18.08it/s] 22%|██▏       | 22/100 [00:01<00:04, 18.10it/s] 24%|██▍       | 24/100 [00:01<00:04, 18.10it/s] 26%|██▌       | 26/100 [00:01<00:04, 18.11it/s] 28%|██▊       | 28/100 [00:01<00:03, 18.12it/s] 30%|███       | 30/100 [00:01<00:03, 18.12it/s] 32%|███▏      | 32/100 [00:01<00:03, 18.12it/s] 34%|███▍      | 34/100 [00:01<00:03, 18.12it/s] 36%|███▌      | 36/100 [00:02<00:03, 18.12it/s] 38%|███▊      | 38/100 [00:02<00:03, 18.12it/s] 40%|████      | 40/100 [00:02<00:03, 17.75it/s] 42%|████▏     | 42/100 [00:02<00:03, 17.84it/s] 44%|████▍     | 44/100 [00:02<00:03, 17.92it/s] 46%|████▌     | 46/100 [00:02<00:03, 17.98it/s] 48%|████▊     | 48/100 [00:02<00:02, 18.03it/s] 50%|█████     | 50/100 [00:02<00:02, 18.06it/s] 52%|█████▏    | 52/100 [00:02<00:02, 18.08it/s] 54%|█████▍    | 54/100 [00:03<00:02, 18.09it/s] 56%|█████▌    | 56/100 [00:03<00:02, 18.10it/s] 58%|█████▊    | 58/100 [00:03<00:02, 18.11it/s] 60%|██████    | 60/100 [00:03<00:02, 18.11it/s] 62%|██████▏   | 62/100 [00:03<00:02, 18.11it/s] 64%|██████▍   | 64/100 [00:03<00:01, 18.12it/s] 66%|██████▌   | 66/100 [00:03<00:01, 18.12it/s] 68%|██████▊   | 68/100 [00:03<00:01, 18.13it/s] 70%|███████   | 70/100 [00:03<00:01, 18.12it/s] 72%|███████▏  | 72/100 [00:03<00:01, 18.12it/s] 74%|███████▍  | 74/100 [00:04<00:01, 18.13it/s] 76%|███████▌  | 76/100 [00:04<00:01, 18.12it/s] 78%|███████▊  | 78/100 [00:04<00:01, 18.12it/s] 80%|████████  | 80/100 [00:04<00:01, 18.11it/s] 82%|████████▏ | 82/100 [00:04<00:00, 18.11it/s] 84%|████████▍ | 84/100 [00:04<00:00, 18.10it/s] 86%|████████▌ | 86/100 [00:04<00:00, 18.11it/s] 88%|████████▊ | 88/100 [00:04<00:00, 18.11it/s] 90%|█████████ | 90/100 [00:04<00:00, 18.11it/s] 92%|█████████▏| 92/100 [00:05<00:00, 18.11it/s] 94%|█████████▍| 94/100 [00:05<00:00, 18.11it/s] 96%|█████████▌| 96/100 [00:05<00:00, 18.11it/s] 98%|█████████▊| 98/100 [00:05<00:00, 18.11it/s]100%|██████████| 100/100 [00:05<00:00, 18.11it/s]100%|██████████| 100/100 [00:05<00:00, 18.04it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 360.18it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-14295f39edd20556.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-10ca04ba0c7bb427.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:15,  6.22it/s]  2%|▏         | 2/100 [00:00<00:14,  6.63it/s]  3%|▎         | 3/100 [00:00<00:14,  6.80it/s]  4%|▍         | 4/100 [00:00<00:13,  7.08it/s]  5%|▌         | 5/100 [00:00<00:13,  7.22it/s]  6%|▌         | 6/100 [00:00<00:13,  7.19it/s]  7%|▋         | 7/100 [00:00<00:13,  7.08it/s]  8%|▊         | 8/100 [00:01<00:12,  7.08it/s]  9%|▉         | 9/100 [00:01<00:12,  7.26it/s] 10%|█         | 10/100 [00:01<00:12,  7.13it/s] 11%|█         | 11/100 [00:01<00:12,  6.98it/s] 12%|█▏        | 12/100 [00:01<00:12,  7.02it/s] 13%|█▎        | 13/100 [00:01<00:12,  6.90it/s] 14%|█▍        | 14/100 [00:01<00:12,  6.96it/s] 15%|█▌        | 15/100 [00:02<00:12,  6.79it/s] 16%|█▌        | 16/100 [00:02<00:12,  6.87it/s] 17%|█▋        | 17/100 [00:02<00:12,  6.73it/s] 18%|█▊        | 18/100 [00:02<00:11,  6.89it/s] 19%|█▉        | 19/100 [00:02<00:11,  6.82it/s] 20%|██        | 20/100 [00:02<00:11,  6.89it/s] 21%|██        | 21/100 [00:03<00:11,  6.83it/s] 22%|██▏       | 22/100 [00:03<00:11,  6.90it/s] 23%|██▎       | 23/100 [00:03<00:11,  6.73it/s] 24%|██▍       | 24/100 [00:03<00:11,  6.83it/s] 25%|██▌       | 25/100 [00:03<00:11,  6.71it/s] 26%|██▌       | 26/100 [00:03<00:10,  6.83it/s] 27%|██▋       | 27/100 [00:03<00:10,  6.80it/s] 28%|██▊       | 28/100 [00:04<00:10,  6.82it/s] 29%|██▉       | 29/100 [00:04<00:10,  6.84it/s] 30%|███       | 30/100 [00:04<00:10,  6.76it/s] 31%|███       | 31/100 [00:04<00:10,  6.74it/s] 32%|███▏      | 32/100 [00:04<00:09,  6.83it/s] 33%|███▎      | 33/100 [00:04<00:09,  6.78it/s] 34%|███▍      | 34/100 [00:04<00:09,  6.87it/s] 35%|███▌      | 35/100 [00:05<00:09,  6.80it/s] 36%|███▌      | 36/100 [00:05<00:09,  6.89it/s] 37%|███▋      | 37/100 [00:05<00:09,  6.74it/s] 38%|███▊      | 38/100 [00:05<00:09,  6.82it/s] 39%|███▉      | 39/100 [00:05<00:08,  6.99it/s] 40%|████      | 40/100 [00:05<00:08,  7.01it/s] 41%|████      | 41/100 [00:05<00:08,  6.87it/s] 42%|████▏     | 42/100 [00:06<00:08,  6.88it/s] 43%|████▎     | 43/100 [00:06<00:08,  6.82it/s] 44%|████▍     | 44/100 [00:06<00:08,  6.95it/s] 45%|████▌     | 45/100 [00:06<00:08,  6.84it/s] 46%|████▌     | 46/100 [00:06<00:07,  6.84it/s] 47%|████▋     | 47/100 [00:06<00:07,  6.73it/s] 48%|████▊     | 48/100 [00:06<00:07,  6.83it/s] 49%|████▉     | 49/100 [00:07<00:07,  6.89it/s] 50%|█████     | 50/100 [00:07<00:07,  6.82it/s] 51%|█████     | 51/100 [00:07<00:07,  6.87it/s] 52%|█████▏    | 52/100 [00:07<00:07,  6.80it/s] 53%|█████▎    | 53/100 [00:07<00:06,  6.87it/s] 54%|█████▍    | 54/100 [00:07<00:06,  6.80it/s] 55%|█████▌    | 55/100 [00:08<00:06,  6.87it/s] 56%|█████▌    | 56/100 [00:08<00:06,  6.88it/s] 57%|█████▋    | 57/100 [00:08<00:06,  6.82it/s] 58%|█████▊    | 58/100 [00:08<00:06,  6.82it/s] 59%|█████▉    | 59/100 [00:08<00:05,  6.84it/s] 60%|██████    | 60/100 [00:08<00:05,  6.89it/s] 61%|██████    | 61/100 [00:08<00:05,  6.98it/s] 62%|██████▏   | 62/100 [00:09<00:05,  6.94it/s] 63%|██████▎   | 63/100 [00:09<00:05,  6.97it/s] 64%|██████▍   | 64/100 [00:09<00:05,  7.18it/s] 65%|██████▌   | 65/100 [00:09<00:05,  6.91it/s] 66%|██████▌   | 66/100 [00:09<00:04,  6.97it/s] 67%|██████▋   | 67/100 [00:09<00:04,  6.94it/s] 68%|██████▊   | 68/100 [00:09<00:04,  7.01it/s] 69%|██████▉   | 69/100 [00:10<00:04,  7.09it/s] 70%|███████   | 70/100 [00:10<00:04,  6.79it/s] 71%|███████   | 71/100 [00:10<00:04,  6.92it/s] 72%|███████▏  | 72/100 [00:10<00:03,  7.11it/s] 73%|███████▎  | 73/100 [00:10<00:03,  6.95it/s] 74%|███████▍  | 74/100 [00:10<00:03,  6.99it/s] 75%|███████▌  | 75/100 [00:10<00:03,  6.96it/s] 76%|███████▌  | 76/100 [00:11<00:03,  7.00it/s] 77%|███████▋  | 77/100 [00:11<00:03,  6.96it/s] 78%|███████▊  | 78/100 [00:11<00:03,  6.87it/s] 79%|███████▉  | 79/100 [00:11<00:03,  6.98it/s] 80%|████████  | 80/100 [00:11<00:02,  6.91it/s] 81%|████████  | 81/100 [00:11<00:02,  6.88it/s] 82%|████████▏ | 82/100 [00:11<00:02,  6.87it/s] 83%|████████▎ | 83/100 [00:12<00:02,  7.02it/s] 84%|████████▍ | 84/100 [00:12<00:02,  7.04it/s] 85%|████████▌ | 85/100 [00:12<00:02,  6.89it/s] 86%|████████▌ | 86/100 [00:12<00:02,  6.89it/s] 87%|████████▋ | 87/100 [00:12<00:01,  6.81it/s] 88%|████████▊ | 88/100 [00:12<00:01,  6.96it/s] 89%|████████▉ | 89/100 [00:12<00:01,  6.98it/s] 90%|█████████ | 90/100 [00:13<00:01,  6.99it/s] 91%|█████████ | 91/100 [00:13<00:01,  6.90it/s] 92%|█████████▏| 92/100 [00:13<00:01,  6.98it/s] 93%|█████████▎| 93/100 [00:13<00:00,  7.04it/s] 94%|█████████▍| 94/100 [00:13<00:00,  7.23it/s] 95%|█████████▌| 95/100 [00:13<00:00,  7.02it/s] 96%|█████████▌| 96/100 [00:13<00:00,  6.86it/s] 97%|█████████▋| 97/100 [00:14<00:00,  6.95it/s] 98%|█████████▊| 98/100 [00:14<00:00,  6.88it/s] 99%|█████████▉| 99/100 [00:14<00:00,  6.88it/s]100%|██████████| 100/100 [00:14<00:00,  7.12it/s]100%|██████████| 100/100 [00:14<00:00,  6.91it/s]
FOLD 1
Metric     CE Loss  KL wrt Orig
Model                          
llama_7B  3.462715     1.394138
[3.27561523 1.17416942]
2023-12-04 01:34:40.804714: I tensorflow/core/util/port.cc:110] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2023-12-04 01:34:40.854828: I tensorflow/core/platform/cpu_feature_guard.cc:182] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-12-04 01:34:41.599461: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Could not find TensorRT
Found cached dataset truthful_qa (/home/elicer/.cache/huggingface/datasets/truthful_qa/multiple_choice/1.1.0/63502f6bc6ee493830ce0843991b028d0ab568d221896b2ee3b8a5dfdaa9d7f4)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 352.08it/s]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:00<00:00,  5.26it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  6.29it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  6.10it/s]
head_wise_activation_length:(11012, 32, 4096)
labels_shape:(11012,)
seperated_head_activation shape:11013
Running fold 0
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:28,  1.08it/s]  6%|▋         | 2/32 [00:01<00:28,  1.05it/s]  9%|▉         | 3/32 [00:02<00:26,  1.09it/s] 12%|█▎        | 4/32 [00:03<00:25,  1.11it/s] 16%|█▌        | 5/32 [00:04<00:24,  1.10it/s] 19%|█▉        | 6/32 [00:05<00:24,  1.08it/s] 22%|██▏       | 7/32 [00:06<00:23,  1.07it/s] 25%|██▌       | 8/32 [00:07<00:22,  1.05it/s] 28%|██▊       | 9/32 [00:08<00:22,  1.02it/s] 31%|███▏      | 10/32 [00:09<00:22,  1.00s/it] 34%|███▍      | 11/32 [00:10<00:21,  1.03s/it] 38%|███▊      | 12/32 [00:11<00:20,  1.02s/it] 41%|████      | 13/32 [00:12<00:19,  1.04s/it] 44%|████▍     | 14/32 [00:13<00:19,  1.06s/it] 47%|████▋     | 15/32 [00:14<00:17,  1.05s/it] 50%|█████     | 16/32 [00:15<00:16,  1.05s/it] 53%|█████▎    | 17/32 [00:16<00:15,  1.06s/it] 56%|█████▋    | 18/32 [00:18<00:14,  1.07s/it] 59%|█████▉    | 19/32 [00:19<00:14,  1.10s/it] 62%|██████▎   | 20/32 [00:20<00:13,  1.11s/it] 66%|██████▌   | 21/32 [00:21<00:12,  1.12s/it] 69%|██████▉   | 22/32 [00:22<00:11,  1.11s/it] 72%|███████▏  | 23/32 [00:23<00:10,  1.14s/it] 75%|███████▌  | 24/32 [00:25<00:09,  1.19s/it] 78%|███████▊  | 25/32 [00:26<00:08,  1.17s/it] 81%|████████▏ | 26/32 [00:27<00:06,  1.16s/it] 84%|████████▍ | 27/32 [00:28<00:05,  1.18s/it] 88%|████████▊ | 28/32 [00:29<00:04,  1.14s/it] 91%|█████████ | 29/32 [00:30<00:03,  1.15s/it] 94%|█████████▍| 30/32 [00:31<00:02,  1.13s/it] 97%|█████████▋| 31/32 [00:33<00:01,  1.14s/it]100%|██████████| 32/32 [00:34<00:00,  1.24s/it]100%|██████████| 32/32 [00:34<00:00,  1.08s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
/home/elicer/honest_llama/validation/../TruthfulQA/truthfulqa/metrics.py:284: FutureWarning: load_metric is deprecated and will be removed in the next major version of datasets. Use 'evaluate.load' instead, from the new library 🤗 Evaluate: https://huggingface.co/docs/evaluate
  bleurt = load_metric("bleurt", cache_dir=cache_dir)
[[0.651 0.665 0.645 ... 0.646 0.647 0.652]
 [0.659 0.644 0.645 ... 0.648 0.658 0.656]
 [0.651 0.657 0.685 ... 0.637 0.648 0.667]
 ...
 [0.765 0.762 0.657 ... 0.73  0.704 0.674]
 [0.748 0.678 0.696 ... 0.663 0.769 0.786]
 [0.775 0.815 0.74  ... 0.697 0.809 0.79 ]]
Heads intervened:  [(8, 16), (12, 4), (12, 15), (13, 8), (13, 16), (14, 2), (14, 20), (15, 28), (16, 17), (16, 26), (16, 30), (17, 4), (17, 9), (17, 13), (17, 17), (17, 29), (18, 29), (19, 13), (19, 17), (19, 31), (20, 22), (20, 30), (21, 18), (22, 16), (22, 23), (22, 30), (23, 3), (23, 4), (23, 7), (23, 13), (25, 15), (31, 1), (31, 3), (31, 6), (31, 25), (31, 30)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
2023-12-04 01:35:32.218887: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1635] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 24961 MB memory:  -> device: 0, name: NVIDIA A100 80GB PCIe MIG 3g.40gb, pci bus id: 0000:65:00.0, compute capability: 8.0
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 590.41it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-ec0cf83741fdb3e8.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-d31e6c0c76fafb4d.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:01<01:42,  1.03s/it]  3%|▎         | 3/100 [00:01<00:30,  3.22it/s]  5%|▌         | 5/100 [00:01<00:17,  5.53it/s]  7%|▋         | 7/100 [00:01<00:11,  7.76it/s]  9%|▉         | 9/100 [00:01<00:09,  9.79it/s] 11%|█         | 11/100 [00:01<00:07, 11.54it/s] 13%|█▎        | 13/100 [00:01<00:06, 12.97it/s] 15%|█▌        | 15/100 [00:01<00:06, 14.10it/s] 17%|█▋        | 17/100 [00:01<00:05, 14.97it/s] 19%|█▉        | 19/100 [00:02<00:05, 15.61it/s] 21%|██        | 21/100 [00:02<00:04, 16.10it/s] 23%|██▎       | 23/100 [00:02<00:04, 16.44it/s] 25%|██▌       | 25/100 [00:02<00:04, 16.68it/s] 27%|██▋       | 27/100 [00:02<00:04, 16.86it/s] 29%|██▉       | 29/100 [00:02<00:04, 16.98it/s] 31%|███       | 31/100 [00:02<00:04, 17.07it/s] 33%|███▎      | 33/100 [00:02<00:03, 17.13it/s] 35%|███▌      | 35/100 [00:03<00:03, 17.18it/s] 37%|███▋      | 37/100 [00:03<00:03, 17.20it/s] 39%|███▉      | 39/100 [00:03<00:03, 17.23it/s] 41%|████      | 41/100 [00:03<00:03, 17.26it/s] 43%|████▎     | 43/100 [00:03<00:03, 17.26it/s] 45%|████▌     | 45/100 [00:03<00:03, 17.27it/s] 47%|████▋     | 47/100 [00:03<00:03, 17.28it/s] 49%|████▉     | 49/100 [00:03<00:02, 17.28it/s] 51%|█████     | 51/100 [00:03<00:02, 17.28it/s] 53%|█████▎    | 53/100 [00:04<00:02, 17.29it/s] 55%|█████▌    | 55/100 [00:04<00:02, 16.86it/s] 57%|█████▋    | 57/100 [00:04<00:02, 16.95it/s] 59%|█████▉    | 59/100 [00:04<00:02, 17.05it/s] 61%|██████    | 61/100 [00:04<00:02, 17.12it/s] 63%|██████▎   | 63/100 [00:04<00:02, 17.17it/s] 65%|██████▌   | 65/100 [00:04<00:02, 17.20it/s] 67%|██████▋   | 67/100 [00:04<00:01, 17.22it/s] 69%|██████▉   | 69/100 [00:04<00:01, 17.24it/s] 71%|███████   | 71/100 [00:05<00:01, 17.26it/s] 73%|███████▎  | 73/100 [00:05<00:01, 17.25it/s] 75%|███████▌  | 75/100 [00:05<00:01, 17.27it/s] 77%|███████▋  | 77/100 [00:05<00:01, 17.29it/s] 79%|███████▉  | 79/100 [00:05<00:01, 17.30it/s] 81%|████████  | 81/100 [00:05<00:01, 17.32it/s] 83%|████████▎ | 83/100 [00:05<00:00, 17.32it/s] 85%|████████▌ | 85/100 [00:05<00:00, 17.32it/s] 87%|████████▋ | 87/100 [00:06<00:00, 17.27it/s] 89%|████████▉ | 89/100 [00:06<00:00, 17.29it/s] 91%|█████████ | 91/100 [00:06<00:00, 17.28it/s] 93%|█████████▎| 93/100 [00:06<00:00, 17.28it/s] 95%|█████████▌| 95/100 [00:06<00:00, 17.29it/s] 97%|█████████▋| 97/100 [00:06<00:00, 17.29it/s] 99%|█████████▉| 99/100 [00:06<00:00, 17.29it/s]100%|██████████| 100/100 [00:06<00:00, 14.77it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 343.77it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-1939fcc1eeebdaa7.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-785bb4b6f2089589.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:16,  5.86it/s]  2%|▏         | 2/100 [00:00<00:15,  6.47it/s]  3%|▎         | 3/100 [00:00<00:14,  6.54it/s]  4%|▍         | 4/100 [00:00<00:14,  6.57it/s]  5%|▌         | 5/100 [00:00<00:14,  6.64it/s]  6%|▌         | 6/100 [00:00<00:14,  6.69it/s]  7%|▋         | 7/100 [00:01<00:13,  6.79it/s]  8%|▊         | 8/100 [00:01<00:13,  6.64it/s]  9%|▉         | 9/100 [00:01<00:13,  6.82it/s] 10%|█         | 10/100 [00:01<00:13,  6.66it/s] 11%|█         | 11/100 [00:01<00:13,  6.76it/s] 12%|█▏        | 12/100 [00:01<00:12,  6.94it/s] 13%|█▎        | 13/100 [00:01<00:12,  6.79it/s] 14%|█▍        | 14/100 [00:02<00:12,  6.84it/s] 15%|█▌        | 15/100 [00:02<00:12,  7.05it/s] 16%|█▌        | 16/100 [00:02<00:11,  7.04it/s] 17%|█▋        | 17/100 [00:02<00:11,  7.12it/s] 18%|█▊        | 18/100 [00:02<00:11,  6.96it/s] 19%|█▉        | 19/100 [00:02<00:11,  6.83it/s] 20%|██        | 20/100 [00:02<00:11,  6.88it/s] 21%|██        | 21/100 [00:03<00:11,  6.76it/s] 22%|██▏       | 22/100 [00:03<00:11,  6.74it/s] 23%|██▎       | 23/100 [00:03<00:11,  6.72it/s] 24%|██▍       | 24/100 [00:03<00:10,  6.96it/s] 25%|██▌       | 25/100 [00:03<00:10,  7.08it/s] 26%|██▌       | 26/100 [00:03<00:10,  7.03it/s] 27%|██▋       | 27/100 [00:03<00:10,  6.94it/s] 28%|██▊       | 28/100 [00:04<00:10,  6.91it/s] 29%|██▉       | 29/100 [00:04<00:09,  7.10it/s] 30%|███       | 30/100 [00:04<00:09,  7.18it/s] 31%|███       | 31/100 [00:04<00:09,  7.00it/s] 32%|███▏      | 32/100 [00:04<00:09,  7.10it/s] 33%|███▎      | 33/100 [00:04<00:09,  6.83it/s] 34%|███▍      | 34/100 [00:04<00:09,  6.87it/s] 35%|███▌      | 35/100 [00:05<00:09,  7.07it/s] 36%|███▌      | 36/100 [00:05<00:08,  7.22it/s] 37%|███▋      | 37/100 [00:05<00:08,  7.16it/s] 38%|███▊      | 38/100 [00:05<00:08,  7.09it/s] 39%|███▉      | 39/100 [00:05<00:08,  7.18it/s] 40%|████      | 40/100 [00:05<00:08,  7.31it/s] 41%|████      | 41/100 [00:05<00:07,  7.39it/s] 42%|████▏     | 42/100 [00:06<00:08,  7.16it/s] 43%|████▎     | 43/100 [00:06<00:07,  7.22it/s] 44%|████▍     | 44/100 [00:06<00:07,  7.22it/s] 45%|████▌     | 45/100 [00:06<00:07,  7.22it/s] 46%|████▌     | 46/100 [00:06<00:07,  7.09it/s] 47%|████▋     | 47/100 [00:06<00:07,  7.16it/s] 48%|████▊     | 48/100 [00:06<00:07,  7.21it/s] 49%|████▉     | 49/100 [00:07<00:07,  7.28it/s] 50%|█████     | 50/100 [00:07<00:07,  6.99it/s] 51%|█████     | 51/100 [00:07<00:07,  6.97it/s] 52%|█████▏    | 52/100 [00:07<00:06,  6.98it/s] 53%|█████▎    | 53/100 [00:07<00:06,  6.80it/s] 54%|█████▍    | 54/100 [00:07<00:06,  6.84it/s] 55%|█████▌    | 55/100 [00:07<00:06,  6.88it/s] 56%|█████▌    | 56/100 [00:08<00:06,  6.73it/s] 57%|█████▋    | 57/100 [00:08<00:06,  6.81it/s] 58%|█████▊    | 58/100 [00:08<00:05,  7.03it/s] 59%|█████▉    | 59/100 [00:08<00:05,  6.90it/s] 60%|██████    | 60/100 [00:08<00:05,  6.87it/s] 61%|██████    | 61/100 [00:08<00:05,  6.78it/s] 62%|██████▏   | 62/100 [00:08<00:05,  6.66it/s] 63%|██████▎   | 63/100 [00:09<00:05,  6.82it/s] 64%|██████▍   | 64/100 [00:09<00:05,  7.05it/s] 65%|██████▌   | 65/100 [00:09<00:05,  6.88it/s] 66%|██████▌   | 66/100 [00:09<00:04,  6.85it/s] 67%|██████▋   | 67/100 [00:09<00:04,  6.84it/s] 68%|██████▊   | 68/100 [00:09<00:04,  6.88it/s] 69%|██████▉   | 69/100 [00:09<00:04,  6.80it/s] 70%|███████   | 70/100 [00:10<00:04,  6.73it/s] 71%|███████   | 71/100 [00:10<00:04,  6.82it/s] 72%|███████▏  | 72/100 [00:10<00:04,  6.87it/s] 73%|███████▎  | 73/100 [00:10<00:03,  7.00it/s] 74%|███████▍  | 74/100 [00:10<00:03,  7.00it/s] 75%|███████▌  | 75/100 [00:10<00:03,  7.12it/s] 76%|███████▌  | 76/100 [00:10<00:03,  7.14it/s] 77%|███████▋  | 77/100 [00:11<00:03,  6.94it/s] 78%|███████▊  | 78/100 [00:11<00:03,  6.89it/s] 79%|███████▉  | 79/100 [00:11<00:03,  6.73it/s] 80%|████████  | 80/100 [00:11<00:02,  6.88it/s] 81%|████████  | 81/100 [00:11<00:02,  7.09it/s] 82%|████████▏ | 82/100 [00:11<00:02,  6.93it/s] 83%|████████▎ | 83/100 [00:11<00:02,  7.02it/s] 84%|████████▍ | 84/100 [00:12<00:02,  6.90it/s] 85%|████████▌ | 85/100 [00:12<00:02,  6.93it/s] 86%|████████▌ | 86/100 [00:12<00:01,  7.13it/s] 87%|████████▋ | 87/100 [00:12<00:01,  7.06it/s] 88%|████████▊ | 88/100 [00:12<00:01,  7.04it/s] 89%|████████▉ | 89/100 [00:12<00:01,  6.88it/s] 90%|█████████ | 90/100 [00:12<00:01,  6.86it/s] 91%|█████████ | 91/100 [00:13<00:01,  7.07it/s] 92%|█████████▏| 92/100 [00:13<00:01,  7.16it/s] 93%|█████████▎| 93/100 [00:13<00:00,  7.03it/s] 94%|█████████▍| 94/100 [00:13<00:00,  6.96it/s] 95%|█████████▌| 95/100 [00:13<00:00,  6.91it/s] 96%|█████████▌| 96/100 [00:13<00:00,  7.11it/s] 97%|█████████▋| 97/100 [00:13<00:00,  7.19it/s] 98%|█████████▊| 98/100 [00:14<00:00,  6.99it/s] 99%|█████████▉| 99/100 [00:14<00:00,  6.95it/s]100%|██████████| 100/100 [00:14<00:00,  7.03it/s]100%|██████████| 100/100 [00:14<00:00,  6.95it/s]
FOLD 0
Metric     CE Loss  KL wrt Orig
Model                          
llama_7B  3.315078     1.196443
Running fold 1
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:28,  1.09it/s]  6%|▋         | 2/32 [00:02<00:31,  1.06s/it]  9%|▉         | 3/32 [00:03<00:33,  1.14s/it] 12%|█▎        | 4/32 [00:04<00:32,  1.15s/it] 16%|█▌        | 5/32 [00:05<00:32,  1.19s/it] 19%|█▉        | 6/32 [00:07<00:31,  1.23s/it] 22%|██▏       | 7/32 [00:08<00:31,  1.24s/it] 25%|██▌       | 8/32 [00:09<00:29,  1.24s/it] 28%|██▊       | 9/32 [00:10<00:28,  1.24s/it] 31%|███▏      | 10/32 [00:12<00:27,  1.24s/it] 34%|███▍      | 11/32 [00:13<00:25,  1.23s/it] 38%|███▊      | 12/32 [00:14<00:24,  1.21s/it] 41%|████      | 13/32 [00:15<00:22,  1.20s/it] 44%|████▍     | 14/32 [00:16<00:21,  1.19s/it] 47%|████▋     | 15/32 [00:17<00:20,  1.19s/it] 50%|█████     | 16/32 [00:19<00:19,  1.20s/it] 53%|█████▎    | 17/32 [00:20<00:17,  1.19s/it] 56%|█████▋    | 18/32 [00:21<00:16,  1.19s/it] 59%|█████▉    | 19/32 [00:22<00:15,  1.22s/it] 62%|██████▎   | 20/32 [00:24<00:15,  1.25s/it] 66%|██████▌   | 21/32 [00:25<00:13,  1.25s/it] 69%|██████▉   | 22/32 [00:26<00:12,  1.25s/it] 72%|███████▏  | 23/32 [00:27<00:11,  1.26s/it] 75%|███████▌  | 24/32 [00:29<00:10,  1.28s/it] 78%|███████▊  | 25/32 [00:30<00:08,  1.28s/it] 81%|████████▏ | 26/32 [00:31<00:07,  1.27s/it] 84%|████████▍ | 27/32 [00:33<00:06,  1.28s/it] 88%|████████▊ | 28/32 [00:34<00:05,  1.28s/it] 91%|█████████ | 29/32 [00:35<00:03,  1.28s/it] 94%|█████████▍| 30/32 [00:36<00:02,  1.27s/it] 97%|█████████▋| 31/32 [00:38<00:01,  1.27s/it]100%|██████████| 32/32 [00:39<00:00,  1.32s/it]100%|██████████| 32/32 [00:39<00:00,  1.24s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
[[0.666 0.672 0.662 ... 0.668 0.662 0.67 ]
 [0.662 0.662 0.659 ... 0.677 0.666 0.663]
 [0.668 0.67  0.68  ... 0.661 0.665 0.671]
 ...
 [0.758 0.75  0.674 ... 0.716 0.694 0.677]
 [0.749 0.671 0.686 ... 0.674 0.762 0.76 ]
 [0.765 0.805 0.748 ... 0.743 0.787 0.775]]
Heads intervened:  [(8, 16), (11, 16), (11, 17), (12, 4), (12, 22), (13, 8), (13, 10), (13, 16), (13, 21), (14, 2), (15, 28), (16, 4), (16, 17), (16, 26), (16, 30), (17, 4), (17, 13), (17, 19), (17, 29), (18, 29), (19, 13), (19, 17), (19, 31), (20, 22), (20, 30), (22, 16), (23, 3), (23, 12), (23, 25), (26, 13), (27, 3), (27, 7), (30, 4), (30, 18), (31, 1), (31, 6)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 256.66it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-30ec7b2da7888791.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-4e53eea82b0ecfef.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  2%|▏         | 2/100 [00:00<00:06, 15.16it/s]  4%|▍         | 4/100 [00:00<00:05, 16.17it/s]  6%|▌         | 6/100 [00:00<00:05, 16.52it/s]  8%|▊         | 8/100 [00:00<00:05, 16.69it/s] 10%|█         | 10/100 [00:00<00:05, 16.80it/s] 12%|█▏        | 12/100 [00:00<00:05, 16.86it/s] 14%|█▍        | 14/100 [00:00<00:05, 16.89it/s] 16%|█▌        | 16/100 [00:00<00:04, 16.82it/s] 18%|█▊        | 18/100 [00:01<00:04, 16.83it/s] 20%|██        | 20/100 [00:01<00:04, 16.87it/s] 22%|██▏       | 22/100 [00:01<00:04, 16.88it/s] 24%|██▍       | 24/100 [00:01<00:04, 16.90it/s] 26%|██▌       | 26/100 [00:01<00:04, 16.93it/s] 28%|██▊       | 28/100 [00:01<00:04, 16.93it/s] 30%|███       | 30/100 [00:01<00:04, 16.95it/s] 32%|███▏      | 32/100 [00:01<00:04, 16.95it/s] 34%|███▍      | 34/100 [00:02<00:03, 16.95it/s] 36%|███▌      | 36/100 [00:02<00:03, 16.96it/s] 38%|███▊      | 38/100 [00:02<00:03, 16.95it/s] 40%|████      | 40/100 [00:02<00:03, 16.96it/s] 42%|████▏     | 42/100 [00:02<00:03, 16.97it/s] 44%|████▍     | 44/100 [00:02<00:03, 16.99it/s] 46%|████▌     | 46/100 [00:02<00:03, 16.99it/s] 48%|████▊     | 48/100 [00:02<00:03, 16.98it/s] 50%|█████     | 50/100 [00:02<00:02, 16.98it/s] 52%|█████▏    | 52/100 [00:03<00:02, 16.89it/s] 54%|█████▍    | 54/100 [00:03<00:02, 16.92it/s] 56%|█████▌    | 56/100 [00:03<00:02, 16.94it/s] 58%|█████▊    | 58/100 [00:03<00:02, 16.95it/s] 60%|██████    | 60/100 [00:03<00:02, 16.96it/s] 62%|██████▏   | 62/100 [00:03<00:02, 16.97it/s] 64%|██████▍   | 64/100 [00:03<00:02, 16.95it/s] 66%|██████▌   | 66/100 [00:03<00:02, 16.96it/s] 68%|██████▊   | 68/100 [00:04<00:01, 16.97it/s] 70%|███████   | 70/100 [00:04<00:01, 16.99it/s] 72%|███████▏  | 72/100 [00:04<00:01, 16.99it/s] 74%|███████▍  | 74/100 [00:04<00:01, 17.00it/s] 76%|███████▌  | 76/100 [00:04<00:01, 17.00it/s] 78%|███████▊  | 78/100 [00:04<00:01, 17.00it/s] 80%|████████  | 80/100 [00:04<00:01, 16.99it/s] 82%|████████▏ | 82/100 [00:04<00:01, 16.99it/s] 84%|████████▍ | 84/100 [00:04<00:00, 16.99it/s] 86%|████████▌ | 86/100 [00:05<00:00, 16.96it/s] 88%|████████▊ | 88/100 [00:05<00:00, 16.95it/s] 90%|█████████ | 90/100 [00:05<00:00, 16.96it/s] 92%|█████████▏| 92/100 [00:05<00:00, 16.98it/s] 94%|█████████▍| 94/100 [00:05<00:00, 16.98it/s] 96%|█████████▌| 96/100 [00:05<00:00, 16.98it/s] 98%|█████████▊| 98/100 [00:05<00:00, 16.99it/s]100%|██████████| 100/100 [00:05<00:00, 17.00it/s]100%|██████████| 100/100 [00:05<00:00, 16.92it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 346.15it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-14295f39edd20556.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-10ca04ba0c7bb427.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:16,  6.14it/s]  2%|▏         | 2/100 [00:00<00:15,  6.36it/s]  3%|▎         | 3/100 [00:00<00:14,  6.67it/s]  4%|▍         | 4/100 [00:00<00:14,  6.78it/s]  5%|▌         | 5/100 [00:00<00:13,  7.02it/s]  6%|▌         | 6/100 [00:00<00:13,  7.10it/s]  7%|▋         | 7/100 [00:01<00:13,  6.90it/s]  8%|▊         | 8/100 [00:01<00:13,  6.76it/s]  9%|▉         | 9/100 [00:01<00:13,  6.74it/s] 10%|█         | 10/100 [00:01<00:13,  6.73it/s] 11%|█         | 11/100 [00:01<00:13,  6.73it/s] 12%|█▏        | 12/100 [00:01<00:12,  6.87it/s] 13%|█▎        | 13/100 [00:01<00:12,  7.05it/s] 14%|█▍        | 14/100 [00:02<00:12,  7.11it/s] 15%|█▌        | 15/100 [00:02<00:12,  7.07it/s] 16%|█▌        | 16/100 [00:02<00:12,  6.95it/s] 17%|█▋        | 17/100 [00:02<00:11,  7.01it/s] 18%|█▊        | 18/100 [00:02<00:11,  7.11it/s] 19%|█▉        | 19/100 [00:02<00:11,  7.03it/s] 20%|██        | 20/100 [00:02<00:11,  6.97it/s] 21%|██        | 21/100 [00:03<00:11,  6.94it/s] 22%|██▏       | 22/100 [00:03<00:11,  6.95it/s] 23%|██▎       | 23/100 [00:03<00:11,  6.74it/s] 24%|██▍       | 24/100 [00:03<00:11,  6.79it/s] 25%|██▌       | 25/100 [00:03<00:11,  6.74it/s] 26%|██▌       | 26/100 [00:03<00:10,  6.76it/s] 27%|██▋       | 27/100 [00:03<00:10,  6.92it/s] 28%|██▊       | 28/100 [00:04<00:10,  6.94it/s] 29%|██▉       | 29/100 [00:04<00:10,  7.09it/s] 30%|███       | 30/100 [00:04<00:10,  6.89it/s] 31%|███       | 31/100 [00:04<00:10,  6.79it/s] 32%|███▏      | 32/100 [00:04<00:10,  6.70it/s] 33%|███▎      | 33/100 [00:04<00:09,  6.93it/s] 34%|███▍      | 34/100 [00:04<00:09,  6.97it/s] 35%|███▌      | 35/100 [00:05<00:09,  6.88it/s] 36%|███▌      | 36/100 [00:05<00:09,  6.93it/s] 37%|███▋      | 37/100 [00:05<00:08,  7.10it/s] 38%|███▊      | 38/100 [00:05<00:08,  7.23it/s] 39%|███▉      | 39/100 [00:05<00:08,  6.95it/s] 40%|████      | 40/100 [00:05<00:08,  6.84it/s] 41%|████      | 41/100 [00:05<00:08,  6.91it/s] 42%|████▏     | 42/100 [00:06<00:08,  6.93it/s] 43%|████▎     | 43/100 [00:06<00:08,  7.02it/s] 44%|████▍     | 44/100 [00:06<00:07,  7.06it/s] 45%|████▌     | 45/100 [00:06<00:08,  6.80it/s] 46%|████▌     | 46/100 [00:06<00:07,  6.90it/s] 47%|████▋     | 47/100 [00:06<00:07,  6.93it/s] 48%|████▊     | 48/100 [00:06<00:07,  7.00it/s] 49%|████▉     | 49/100 [00:07<00:07,  6.94it/s] 50%|█████     | 50/100 [00:07<00:07,  7.05it/s] 51%|█████     | 51/100 [00:07<00:07,  6.99it/s] 52%|█████▏    | 52/100 [00:07<00:06,  7.03it/s] 53%|█████▎    | 53/100 [00:07<00:06,  7.09it/s] 54%|█████▍    | 54/100 [00:07<00:06,  7.08it/s] 55%|█████▌    | 55/100 [00:07<00:06,  7.03it/s] 56%|█████▌    | 56/100 [00:08<00:06,  6.88it/s] 57%|█████▋    | 57/100 [00:08<00:06,  6.78it/s] 58%|█████▊    | 58/100 [00:08<00:06,  6.67it/s] 59%|█████▉    | 59/100 [00:08<00:06,  6.63it/s] 60%|██████    | 60/100 [00:08<00:05,  6.69it/s] 61%|██████    | 61/100 [00:08<00:05,  6.85it/s] 62%|██████▏   | 62/100 [00:08<00:05,  6.79it/s] 63%|██████▎   | 63/100 [00:09<00:05,  6.99it/s] 64%|██████▍   | 64/100 [00:09<00:05,  7.13it/s] 65%|██████▌   | 65/100 [00:09<00:04,  7.21it/s] 66%|██████▌   | 66/100 [00:09<00:04,  7.11it/s] 67%|██████▋   | 67/100 [00:09<00:04,  7.11it/s] 68%|██████▊   | 68/100 [00:09<00:04,  7.01it/s] 69%|██████▉   | 69/100 [00:09<00:04,  7.07it/s] 70%|███████   | 70/100 [00:10<00:04,  6.87it/s] 71%|███████   | 71/100 [00:10<00:04,  6.83it/s] 72%|███████▏  | 72/100 [00:10<00:04,  6.81it/s] 73%|███████▎  | 73/100 [00:10<00:03,  6.80it/s] 74%|███████▍  | 74/100 [00:10<00:03,  6.88it/s] 75%|███████▌  | 75/100 [00:10<00:03,  6.92it/s] 76%|███████▌  | 76/100 [00:10<00:03,  6.98it/s] 77%|███████▋  | 77/100 [00:11<00:03,  6.83it/s] 78%|███████▊  | 78/100 [00:11<00:03,  6.78it/s] 79%|███████▉  | 79/100 [00:11<00:03,  6.78it/s] 80%|████████  | 80/100 [00:11<00:02,  6.68it/s] 81%|████████  | 81/100 [00:11<00:02,  6.81it/s] 82%|████████▏ | 82/100 [00:11<00:02,  6.80it/s] 83%|████████▎ | 83/100 [00:12<00:02,  6.77it/s] 84%|████████▍ | 84/100 [00:12<00:02,  6.73it/s] 85%|████████▌ | 85/100 [00:12<00:02,  6.72it/s] 86%|████████▌ | 86/100 [00:12<00:02,  6.66it/s] 87%|████████▋ | 87/100 [00:12<00:01,  6.74it/s] 88%|████████▊ | 88/100 [00:12<00:01,  6.88it/s] 89%|████████▉ | 89/100 [00:12<00:01,  6.81it/s] 90%|█████████ | 90/100 [00:13<00:01,  6.77it/s] 91%|█████████ | 91/100 [00:13<00:01,  6.90it/s] 92%|█████████▏| 92/100 [00:13<00:01,  6.78it/s] 93%|█████████▎| 93/100 [00:13<00:01,  6.69it/s] 94%|█████████▍| 94/100 [00:13<00:00,  6.68it/s] 95%|█████████▌| 95/100 [00:13<00:00,  6.69it/s] 96%|█████████▌| 96/100 [00:13<00:00,  6.68it/s] 97%|█████████▋| 97/100 [00:14<00:00,  6.56it/s] 98%|█████████▊| 98/100 [00:14<00:00,  6.67it/s] 99%|█████████▉| 99/100 [00:14<00:00,  6.83it/s]100%|██████████| 100/100 [00:14<00:00,  6.77it/s]100%|██████████| 100/100 [00:14<00:00,  6.87it/s]
FOLD 1
Metric     CE Loss  KL wrt Orig
Model                          
llama_7B  3.339277     1.275637
[3.32717773 1.23603963]
2023-12-04 01:37:12.095398: I tensorflow/core/util/port.cc:110] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2023-12-04 01:37:12.144837: I tensorflow/core/platform/cpu_feature_guard.cc:182] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-12-04 01:37:12.889398: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Could not find TensorRT
Found cached dataset truthful_qa (/home/elicer/.cache/huggingface/datasets/truthful_qa/multiple_choice/1.1.0/63502f6bc6ee493830ce0843991b028d0ab568d221896b2ee3b8a5dfdaa9d7f4)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 353.47it/s]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:00<00:00,  5.19it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  6.21it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  6.03it/s]
head_wise_activation_length:(11012, 32, 4096)
labels_shape:(11012,)
seperated_head_activation shape:11013
Running fold 0
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:28,  1.07it/s]  6%|▋         | 2/32 [00:01<00:28,  1.05it/s]  9%|▉         | 3/32 [00:02<00:26,  1.08it/s] 12%|█▎        | 4/32 [00:03<00:25,  1.10it/s] 16%|█▌        | 5/32 [00:04<00:24,  1.09it/s] 19%|█▉        | 6/32 [00:05<00:24,  1.07it/s] 22%|██▏       | 7/32 [00:06<00:23,  1.06it/s] 25%|██▌       | 8/32 [00:07<00:23,  1.04it/s] 28%|██▊       | 9/32 [00:08<00:22,  1.01it/s] 31%|███▏      | 10/32 [00:09<00:22,  1.01s/it] 34%|███▍      | 11/32 [00:10<00:21,  1.04s/it] 38%|███▊      | 12/32 [00:11<00:20,  1.03s/it] 41%|████      | 13/32 [00:12<00:19,  1.05s/it] 44%|████▍     | 14/32 [00:13<00:19,  1.07s/it] 47%|████▋     | 15/32 [00:15<00:18,  1.06s/it] 50%|█████     | 16/32 [00:16<00:17,  1.07s/it] 53%|█████▎    | 17/32 [00:17<00:16,  1.07s/it] 56%|█████▋    | 18/32 [00:18<00:15,  1.09s/it] 59%|█████▉    | 19/32 [00:19<00:14,  1.11s/it] 62%|██████▎   | 20/32 [00:20<00:13,  1.13s/it] 66%|██████▌   | 21/32 [00:21<00:12,  1.14s/it] 69%|██████▉   | 22/32 [00:22<00:11,  1.12s/it] 72%|███████▏  | 23/32 [00:24<00:10,  1.15s/it] 75%|███████▌  | 24/32 [00:25<00:09,  1.20s/it] 78%|███████▊  | 25/32 [00:26<00:08,  1.18s/it] 81%|████████▏ | 26/32 [00:27<00:07,  1.17s/it] 84%|████████▍ | 27/32 [00:28<00:05,  1.20s/it] 88%|████████▊ | 28/32 [00:30<00:04,  1.15s/it] 91%|█████████ | 29/32 [00:31<00:03,  1.16s/it] 94%|█████████▍| 30/32 [00:32<00:02,  1.14s/it] 97%|█████████▋| 31/32 [00:33<00:01,  1.15s/it]100%|██████████| 32/32 [00:34<00:00,  1.26s/it]100%|██████████| 32/32 [00:34<00:00,  1.09s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
/home/elicer/honest_llama/validation/../TruthfulQA/truthfulqa/metrics.py:284: FutureWarning: load_metric is deprecated and will be removed in the next major version of datasets. Use 'evaluate.load' instead, from the new library 🤗 Evaluate: https://huggingface.co/docs/evaluate
  bleurt = load_metric("bleurt", cache_dir=cache_dir)
[[0.651 0.665 0.645 ... 0.646 0.647 0.652]
 [0.659 0.644 0.645 ... 0.648 0.658 0.656]
 [0.651 0.657 0.685 ... 0.637 0.648 0.667]
 ...
 [0.765 0.762 0.657 ... 0.73  0.704 0.674]
 [0.748 0.678 0.696 ... 0.663 0.769 0.786]
 [0.775 0.815 0.74  ... 0.697 0.809 0.79 ]]
Heads intervened:  [(8, 16), (8, 19), (10, 18), (11, 16), (11, 17), (12, 4), (12, 15), (12, 22), (13, 8), (13, 16), (14, 2), (14, 20), (15, 28), (16, 17), (16, 26), (16, 30), (17, 4), (17, 9), (17, 13), (17, 17), (17, 29), (18, 29), (19, 13), (19, 17), (19, 31), (20, 22), (20, 30), (21, 18), (22, 2), (22, 8), (22, 16), (22, 23), (22, 30), (23, 3), (23, 4), (23, 7), (23, 12), (23, 13), (23, 25), (25, 15), (30, 14), (30, 23), (31, 1), (31, 3), (31, 6), (31, 11), (31, 25), (31, 30)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
2023-12-04 01:38:04.801483: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1635] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 24961 MB memory:  -> device: 0, name: NVIDIA A100 80GB PCIe MIG 3g.40gb, pci bus id: 0000:65:00.0, compute capability: 8.0
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 274.93it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-ec0cf83741fdb3e8.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-d31e6c0c76fafb4d.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:01<01:43,  1.05s/it]  3%|▎         | 3/100 [00:01<00:30,  3.15it/s]  5%|▌         | 5/100 [00:01<00:17,  5.40it/s]  7%|▋         | 7/100 [00:01<00:12,  7.56it/s]  9%|▉         | 9/100 [00:01<00:09,  9.52it/s] 11%|█         | 11/100 [00:01<00:07, 11.19it/s] 13%|█▎        | 13/100 [00:01<00:06, 12.55it/s] 15%|█▌        | 15/100 [00:01<00:06, 13.61it/s] 17%|█▋        | 17/100 [00:02<00:05, 14.44it/s] 19%|█▉        | 19/100 [00:02<00:05, 15.03it/s] 21%|██        | 21/100 [00:02<00:05, 15.48it/s] 23%|██▎       | 23/100 [00:02<00:04, 15.79it/s] 25%|██▌       | 25/100 [00:02<00:04, 16.02it/s] 27%|██▋       | 27/100 [00:02<00:04, 16.19it/s] 29%|██▉       | 29/100 [00:02<00:04, 16.32it/s] 31%|███       | 31/100 [00:02<00:04, 16.41it/s] 33%|███▎      | 33/100 [00:02<00:04, 16.48it/s] 35%|███▌      | 35/100 [00:03<00:03, 16.36it/s] 37%|███▋      | 37/100 [00:03<00:03, 16.37it/s] 39%|███▉      | 39/100 [00:03<00:03, 16.43it/s] 41%|████      | 41/100 [00:03<00:03, 16.48it/s] 43%|████▎     | 43/100 [00:03<00:03, 16.51it/s] 45%|████▌     | 45/100 [00:03<00:03, 16.55it/s] 47%|████▋     | 47/100 [00:03<00:03, 16.56it/s] 49%|████▉     | 49/100 [00:03<00:03, 16.59it/s] 51%|█████     | 51/100 [00:04<00:02, 16.60it/s] 53%|█████▎    | 53/100 [00:04<00:02, 16.61it/s] 55%|█████▌    | 55/100 [00:04<00:02, 16.62it/s] 57%|█████▋    | 57/100 [00:04<00:02, 16.60it/s] 59%|█████▉    | 59/100 [00:04<00:02, 16.62it/s] 61%|██████    | 61/100 [00:04<00:02, 16.63it/s] 63%|██████▎   | 63/100 [00:04<00:02, 16.60it/s] 65%|██████▌   | 65/100 [00:04<00:02, 16.60it/s] 67%|██████▋   | 67/100 [00:05<00:01, 16.63it/s] 69%|██████▉   | 69/100 [00:05<00:01, 16.58it/s] 71%|███████   | 71/100 [00:05<00:01, 16.39it/s] 73%|███████▎  | 73/100 [00:05<00:01, 16.45it/s] 75%|███████▌  | 75/100 [00:05<00:01, 16.50it/s] 77%|███████▋  | 77/100 [00:05<00:01, 16.53it/s] 79%|███████▉  | 79/100 [00:05<00:01, 16.54it/s] 81%|████████  | 81/100 [00:05<00:01, 16.56it/s] 83%|████████▎ | 83/100 [00:05<00:01, 16.58it/s] 85%|████████▌ | 85/100 [00:06<00:00, 16.60it/s] 87%|████████▋ | 87/100 [00:06<00:00, 16.62it/s] 89%|████████▉ | 89/100 [00:06<00:00, 16.62it/s] 91%|█████████ | 91/100 [00:06<00:00, 16.61it/s] 93%|█████████▎| 93/100 [00:06<00:00, 16.60it/s] 95%|█████████▌| 95/100 [00:06<00:00, 16.48it/s] 97%|█████████▋| 97/100 [00:06<00:00, 16.52it/s] 99%|█████████▉| 99/100 [00:06<00:00, 16.56it/s]100%|██████████| 100/100 [00:07<00:00, 14.23it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 352.52it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-1939fcc1eeebdaa7.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-785bb4b6f2089589.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:18,  5.32it/s]  2%|▏         | 2/100 [00:00<00:16,  5.95it/s]  3%|▎         | 3/100 [00:00<00:15,  6.40it/s]  4%|▍         | 4/100 [00:00<00:14,  6.63it/s]  5%|▌         | 5/100 [00:00<00:14,  6.68it/s]  6%|▌         | 6/100 [00:00<00:13,  6.77it/s]  7%|▋         | 7/100 [00:01<00:13,  6.83it/s]  8%|▊         | 8/100 [00:01<00:13,  6.88it/s]  9%|▉         | 9/100 [00:01<00:13,  6.81it/s] 10%|█         | 10/100 [00:01<00:13,  6.69it/s] 11%|█         | 11/100 [00:01<00:12,  6.89it/s] 12%|█▏        | 12/100 [00:01<00:12,  6.98it/s] 13%|█▎        | 13/100 [00:01<00:12,  6.79it/s] 14%|█▍        | 14/100 [00:02<00:12,  6.88it/s] 15%|█▌        | 15/100 [00:02<00:12,  6.83it/s] 16%|█▌        | 16/100 [00:02<00:12,  6.67it/s] 17%|█▋        | 17/100 [00:02<00:12,  6.71it/s] 18%|█▊        | 18/100 [00:02<00:12,  6.80it/s] 19%|█▉        | 19/100 [00:02<00:11,  6.78it/s] 20%|██        | 20/100 [00:02<00:11,  6.79it/s] 21%|██        | 21/100 [00:03<00:11,  6.69it/s] 22%|██▏       | 22/100 [00:03<00:11,  6.74it/s] 23%|██▎       | 23/100 [00:03<00:11,  6.77it/s] 24%|██▍       | 24/100 [00:03<00:11,  6.89it/s] 25%|██▌       | 25/100 [00:03<00:10,  6.98it/s] 26%|██▌       | 26/100 [00:03<00:11,  6.69it/s] 27%|██▋       | 27/100 [00:04<00:11,  6.62it/s] 28%|██▊       | 28/100 [00:04<00:10,  6.61it/s] 29%|██▉       | 29/100 [00:04<00:10,  6.76it/s] 30%|███       | 30/100 [00:04<00:10,  6.60it/s] 31%|███       | 31/100 [00:04<00:10,  6.72it/s] 32%|███▏      | 32/100 [00:04<00:10,  6.62it/s] 33%|███▎      | 33/100 [00:04<00:09,  6.83it/s] 34%|███▍      | 34/100 [00:05<00:09,  6.90it/s] 35%|███▌      | 35/100 [00:05<00:09,  6.97it/s] 36%|███▌      | 36/100 [00:05<00:09,  6.92it/s] 37%|███▋      | 37/100 [00:05<00:09,  6.92it/s] 38%|███▊      | 38/100 [00:05<00:09,  6.82it/s] 39%|███▉      | 39/100 [00:05<00:08,  7.00it/s] 40%|████      | 40/100 [00:05<00:08,  7.12it/s] 41%|████      | 41/100 [00:06<00:08,  7.08it/s] 42%|████▏     | 42/100 [00:06<00:08,  7.04it/s] 43%|████▎     | 43/100 [00:06<00:07,  7.15it/s] 44%|████▍     | 44/100 [00:06<00:07,  7.23it/s] 45%|████▌     | 45/100 [00:06<00:07,  7.08it/s] 46%|████▌     | 46/100 [00:06<00:07,  7.01it/s] 47%|████▋     | 47/100 [00:06<00:07,  7.01it/s] 48%|████▊     | 48/100 [00:07<00:07,  6.76it/s] 49%|████▉     | 49/100 [00:07<00:07,  6.85it/s] 50%|█████     | 50/100 [00:07<00:07,  7.01it/s] 51%|█████     | 51/100 [00:07<00:06,  7.13it/s] 52%|█████▏    | 52/100 [00:07<00:06,  7.09it/s] 53%|█████▎    | 53/100 [00:07<00:06,  7.15it/s] 54%|█████▍    | 54/100 [00:07<00:06,  7.13it/s] 55%|█████▌    | 55/100 [00:08<00:06,  7.15it/s] 56%|█████▌    | 56/100 [00:08<00:06,  6.99it/s] 57%|█████▋    | 57/100 [00:08<00:06,  6.92it/s] 58%|█████▊    | 58/100 [00:08<00:06,  6.86it/s] 59%|█████▉    | 59/100 [00:08<00:05,  6.92it/s] 60%|██████    | 60/100 [00:08<00:05,  7.00it/s] 61%|██████    | 61/100 [00:08<00:05,  7.00it/s] 62%|██████▏   | 62/100 [00:09<00:05,  7.13it/s] 63%|██████▎   | 63/100 [00:09<00:05,  7.02it/s] 64%|██████▍   | 64/100 [00:09<00:05,  7.03it/s] 65%|██████▌   | 65/100 [00:09<00:04,  7.14it/s] 66%|██████▌   | 66/100 [00:09<00:04,  7.08it/s] 67%|██████▋   | 67/100 [00:09<00:04,  7.13it/s] 68%|██████▊   | 68/100 [00:09<00:04,  7.08it/s] 69%|██████▉   | 69/100 [00:10<00:04,  7.18it/s] 70%|███████   | 70/100 [00:10<00:04,  7.02it/s] 71%|███████   | 71/100 [00:10<00:04,  7.07it/s] 72%|███████▏  | 72/100 [00:10<00:04,  6.91it/s] 73%|███████▎  | 73/100 [00:10<00:03,  6.75it/s] 74%|███████▍  | 74/100 [00:10<00:03,  6.78it/s] 75%|███████▌  | 75/100 [00:10<00:03,  6.73it/s] 76%|███████▌  | 76/100 [00:11<00:03,  6.69it/s] 77%|███████▋  | 77/100 [00:11<00:03,  6.90it/s] 78%|███████▊  | 78/100 [00:11<00:03,  6.85it/s] 79%|███████▉  | 79/100 [00:11<00:03,  6.94it/s] 80%|████████  | 80/100 [00:11<00:02,  6.76it/s] 81%|████████  | 81/100 [00:11<00:02,  6.74it/s] 82%|████████▏ | 82/100 [00:11<00:02,  6.82it/s] 83%|████████▎ | 83/100 [00:12<00:02,  6.98it/s] 84%|████████▍ | 84/100 [00:12<00:02,  7.02it/s] 85%|████████▌ | 85/100 [00:12<00:02,  7.05it/s] 86%|████████▌ | 86/100 [00:12<00:01,  7.04it/s] 87%|████████▋ | 87/100 [00:12<00:01,  6.96it/s] 88%|████████▊ | 88/100 [00:12<00:01,  6.91it/s] 89%|████████▉ | 89/100 [00:12<00:01,  6.86it/s] 90%|█████████ | 90/100 [00:13<00:01,  6.85it/s] 91%|█████████ | 91/100 [00:13<00:01,  6.84it/s] 92%|█████████▏| 92/100 [00:13<00:01,  7.00it/s] 93%|█████████▎| 93/100 [00:13<00:00,  7.12it/s] 94%|█████████▍| 94/100 [00:13<00:00,  7.00it/s] 95%|█████████▌| 95/100 [00:13<00:00,  6.93it/s] 96%|█████████▌| 96/100 [00:13<00:00,  6.91it/s] 97%|█████████▋| 97/100 [00:14<00:00,  6.89it/s] 98%|█████████▊| 98/100 [00:14<00:00,  6.82it/s] 99%|█████████▉| 99/100 [00:14<00:00,  6.98it/s]100%|██████████| 100/100 [00:14<00:00,  6.98it/s]100%|██████████| 100/100 [00:14<00:00,  6.89it/s]
FOLD 0
Metric    CE Loss  KL wrt Orig
Model                         
llama_7B  3.77668     1.679494
Running fold 1
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:28,  1.08it/s]  6%|▋         | 2/32 [00:02<00:32,  1.07s/it]  9%|▉         | 3/32 [00:03<00:33,  1.16s/it] 12%|█▎        | 4/32 [00:04<00:32,  1.17s/it] 16%|█▌        | 5/32 [00:05<00:32,  1.20s/it] 19%|█▉        | 6/32 [00:07<00:32,  1.23s/it] 22%|██▏       | 7/32 [00:08<00:31,  1.24s/it] 25%|██▌       | 8/32 [00:09<00:29,  1.24s/it] 28%|██▊       | 9/32 [00:10<00:28,  1.24s/it] 31%|███▏      | 10/32 [00:12<00:27,  1.24s/it] 34%|███▍      | 11/32 [00:13<00:25,  1.23s/it] 38%|███▊      | 12/32 [00:14<00:24,  1.21s/it] 41%|████      | 13/32 [00:15<00:22,  1.20s/it] 44%|████▍     | 14/32 [00:16<00:21,  1.20s/it] 47%|████▋     | 15/32 [00:18<00:20,  1.20s/it] 50%|█████     | 16/32 [00:19<00:19,  1.20s/it] 53%|█████▎    | 17/32 [00:20<00:17,  1.20s/it] 56%|█████▋    | 18/32 [00:21<00:16,  1.20s/it] 59%|█████▉    | 19/32 [00:22<00:15,  1.22s/it] 62%|██████▎   | 20/32 [00:24<00:15,  1.26s/it] 66%|██████▌   | 21/32 [00:25<00:13,  1.26s/it] 69%|██████▉   | 22/32 [00:26<00:12,  1.26s/it] 72%|███████▏  | 23/32 [00:28<00:11,  1.27s/it] 75%|███████▌  | 24/32 [00:29<00:10,  1.30s/it] 78%|███████▊  | 25/32 [00:30<00:09,  1.30s/it] 81%|████████▏ | 26/32 [00:31<00:07,  1.29s/it] 84%|████████▍ | 27/32 [00:33<00:06,  1.30s/it] 88%|████████▊ | 28/32 [00:34<00:05,  1.29s/it] 91%|█████████ | 29/32 [00:35<00:03,  1.30s/it] 94%|█████████▍| 30/32 [00:37<00:02,  1.28s/it] 97%|█████████▋| 31/32 [00:38<00:01,  1.28s/it]100%|██████████| 32/32 [00:39<00:00,  1.34s/it]100%|██████████| 32/32 [00:39<00:00,  1.25s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
[[0.666 0.672 0.662 ... 0.668 0.662 0.67 ]
 [0.662 0.662 0.659 ... 0.677 0.666 0.663]
 [0.668 0.67  0.68  ... 0.661 0.665 0.671]
 ...
 [0.758 0.75  0.674 ... 0.716 0.694 0.677]
 [0.749 0.671 0.686 ... 0.674 0.762 0.76 ]
 [0.765 0.805 0.748 ... 0.743 0.787 0.775]]
Heads intervened:  [(5, 10), (8, 16), (11, 16), (11, 17), (12, 4), (12, 22), (13, 8), (13, 10), (13, 16), (13, 21), (14, 2), (15, 1), (15, 10), (15, 28), (16, 3), (16, 4), (16, 17), (16, 26), (16, 30), (17, 4), (17, 13), (17, 17), (17, 19), (17, 29), (18, 29), (19, 13), (19, 17), (19, 28), (19, 31), (20, 22), (20, 30), (21, 23), (22, 16), (23, 3), (23, 4), (23, 12), (23, 13), (23, 25), (26, 13), (27, 3), (27, 7), (30, 4), (30, 18), (30, 23), (31, 1), (31, 6), (31, 10), (31, 18)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 258.81it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-30ec7b2da7888791.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-4e53eea82b0ecfef.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  2%|▏         | 2/100 [00:00<00:06, 14.60it/s]  4%|▍         | 4/100 [00:00<00:06, 15.57it/s]  6%|▌         | 6/100 [00:00<00:05, 15.91it/s]  8%|▊         | 8/100 [00:00<00:05, 16.05it/s] 10%|█         | 10/100 [00:00<00:05, 16.18it/s] 12%|█▏        | 12/100 [00:00<00:05, 16.24it/s] 14%|█▍        | 14/100 [00:00<00:05, 16.29it/s] 16%|█▌        | 16/100 [00:00<00:05, 16.24it/s] 18%|█▊        | 18/100 [00:01<00:05, 16.27it/s] 20%|██        | 20/100 [00:01<00:04, 16.29it/s] 22%|██▏       | 22/100 [00:01<00:04, 16.30it/s] 24%|██▍       | 24/100 [00:01<00:04, 16.32it/s] 26%|██▌       | 26/100 [00:01<00:04, 16.33it/s] 28%|██▊       | 28/100 [00:01<00:04, 16.34it/s] 30%|███       | 30/100 [00:01<00:04, 16.34it/s] 32%|███▏      | 32/100 [00:01<00:04, 16.34it/s] 34%|███▍      | 34/100 [00:02<00:04, 16.36it/s] 36%|███▌      | 36/100 [00:02<00:03, 16.37it/s] 38%|███▊      | 38/100 [00:02<00:03, 16.37it/s] 40%|████      | 40/100 [00:02<00:03, 16.36it/s] 42%|████▏     | 42/100 [00:02<00:03, 16.35it/s] 44%|████▍     | 44/100 [00:02<00:03, 16.37it/s] 46%|████▌     | 46/100 [00:02<00:03, 16.37it/s] 48%|████▊     | 48/100 [00:02<00:03, 16.31it/s] 50%|█████     | 50/100 [00:03<00:03, 16.15it/s] 52%|█████▏    | 52/100 [00:03<00:02, 16.21it/s] 54%|█████▍    | 54/100 [00:03<00:02, 16.26it/s] 56%|█████▌    | 56/100 [00:03<00:02, 16.29it/s] 58%|█████▊    | 58/100 [00:03<00:02, 16.29it/s] 60%|██████    | 60/100 [00:03<00:02, 16.33it/s] 62%|██████▏   | 62/100 [00:03<00:02, 16.35it/s] 64%|██████▍   | 64/100 [00:03<00:02, 15.94it/s] 66%|██████▌   | 66/100 [00:04<00:02, 16.03it/s] 68%|██████▊   | 68/100 [00:04<00:01, 16.13it/s] 70%|███████   | 70/100 [00:04<00:01, 16.22it/s] 72%|███████▏  | 72/100 [00:04<00:01, 16.27it/s] 74%|███████▍  | 74/100 [00:04<00:01, 16.32it/s] 76%|███████▌  | 76/100 [00:04<00:01, 16.35it/s] 78%|███████▊  | 78/100 [00:04<00:01, 16.37it/s] 80%|████████  | 80/100 [00:04<00:01, 16.38it/s] 82%|████████▏ | 82/100 [00:05<00:01, 16.35it/s] 84%|████████▍ | 84/100 [00:05<00:00, 16.32it/s] 86%|████████▌ | 86/100 [00:05<00:00, 16.30it/s] 88%|████████▊ | 88/100 [00:05<00:00, 16.29it/s] 90%|█████████ | 90/100 [00:05<00:00, 16.28it/s] 92%|█████████▏| 92/100 [00:05<00:00, 16.26it/s] 94%|█████████▍| 94/100 [00:05<00:00, 16.28it/s] 96%|█████████▌| 96/100 [00:05<00:00, 16.29it/s] 98%|█████████▊| 98/100 [00:06<00:00, 16.30it/s]100%|██████████| 100/100 [00:06<00:00, 16.30it/s]100%|██████████| 100/100 [00:06<00:00, 16.26it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 351.28it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-14295f39edd20556.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-10ca04ba0c7bb427.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:16,  5.86it/s]  2%|▏         | 2/100 [00:00<00:15,  6.17it/s]  3%|▎         | 3/100 [00:00<00:15,  6.39it/s]  4%|▍         | 4/100 [00:00<00:14,  6.45it/s]  5%|▌         | 5/100 [00:00<00:14,  6.49it/s]  6%|▌         | 6/100 [00:00<00:14,  6.64it/s]  7%|▋         | 7/100 [00:01<00:13,  6.67it/s]  8%|▊         | 8/100 [00:01<00:13,  6.61it/s]  9%|▉         | 9/100 [00:01<00:13,  6.71it/s] 10%|█         | 10/100 [00:01<00:13,  6.59it/s] 11%|█         | 11/100 [00:01<00:13,  6.65it/s] 12%|█▏        | 12/100 [00:01<00:13,  6.55it/s] 13%|█▎        | 13/100 [00:01<00:12,  6.70it/s] 14%|█▍        | 14/100 [00:02<00:12,  6.82it/s] 15%|█▌        | 15/100 [00:02<00:12,  6.97it/s] 16%|█▌        | 16/100 [00:02<00:12,  6.83it/s] 17%|█▋        | 17/100 [00:02<00:12,  6.71it/s] 18%|█▊        | 18/100 [00:02<00:12,  6.69it/s] 19%|█▉        | 19/100 [00:02<00:12,  6.62it/s] 20%|██        | 20/100 [00:03<00:11,  6.73it/s] 21%|██        | 21/100 [00:03<00:11,  6.91it/s] 22%|██▏       | 22/100 [00:03<00:11,  7.02it/s] 23%|██▎       | 23/100 [00:03<00:10,  7.03it/s] 24%|██▍       | 24/100 [00:03<00:10,  6.94it/s] 25%|██▌       | 25/100 [00:03<00:10,  6.84it/s] 26%|██▌       | 26/100 [00:03<00:11,  6.71it/s] 27%|██▋       | 27/100 [00:04<00:10,  6.66it/s] 28%|██▊       | 28/100 [00:04<00:10,  6.60it/s] 29%|██▉       | 29/100 [00:04<00:10,  6.72it/s] 30%|███       | 30/100 [00:04<00:10,  6.69it/s] 31%|███       | 31/100 [00:04<00:10,  6.52it/s] 32%|███▏      | 32/100 [00:04<00:10,  6.49it/s] 33%|███▎      | 33/100 [00:04<00:10,  6.51it/s] 34%|███▍      | 34/100 [00:05<00:09,  6.75it/s] 35%|███▌      | 35/100 [00:05<00:09,  6.84it/s] 36%|███▌      | 36/100 [00:05<00:09,  6.75it/s] 37%|███▋      | 37/100 [00:05<00:09,  6.69it/s] 38%|███▊      | 38/100 [00:05<00:09,  6.56it/s] 39%|███▉      | 39/100 [00:05<00:09,  6.42it/s] 40%|████      | 40/100 [00:05<00:09,  6.63it/s] 41%|████      | 41/100 [00:06<00:09,  6.45it/s] 42%|████▏     | 42/100 [00:06<00:09,  6.34it/s] 43%|████▎     | 43/100 [00:06<00:08,  6.46it/s] 44%|████▍     | 44/100 [00:06<00:08,  6.54it/s] 45%|████▌     | 45/100 [00:06<00:08,  6.45it/s] 46%|████▌     | 46/100 [00:06<00:08,  6.48it/s] 47%|████▋     | 47/100 [00:07<00:08,  6.55it/s] 48%|████▊     | 48/100 [00:07<00:07,  6.59it/s] 49%|████▉     | 49/100 [00:07<00:07,  6.64it/s] 50%|█████     | 50/100 [00:07<00:07,  6.80it/s] 51%|█████     | 51/100 [00:07<00:07,  6.90it/s] 52%|█████▏    | 52/100 [00:07<00:06,  7.03it/s] 53%|█████▎    | 53/100 [00:07<00:06,  6.96it/s] 54%|█████▍    | 54/100 [00:08<00:06,  6.77it/s] 55%|█████▌    | 55/100 [00:08<00:06,  6.59it/s] 56%|█████▌    | 56/100 [00:08<00:06,  6.58it/s] 57%|█████▋    | 57/100 [00:08<00:06,  6.68it/s] 58%|█████▊    | 58/100 [00:08<00:06,  6.62it/s] 59%|█████▉    | 59/100 [00:08<00:06,  6.71it/s] 60%|██████    | 60/100 [00:09<00:05,  6.70it/s] 61%|██████    | 61/100 [00:09<00:05,  6.55it/s] 62%|██████▏   | 62/100 [00:09<00:05,  6.59it/s] 63%|██████▎   | 63/100 [00:09<00:05,  6.78it/s] 64%|██████▍   | 64/100 [00:09<00:05,  6.70it/s] 65%|██████▌   | 65/100 [00:09<00:05,  6.67it/s] 66%|██████▌   | 66/100 [00:09<00:05,  6.65it/s] 67%|██████▋   | 67/100 [00:10<00:05,  6.58it/s] 68%|██████▊   | 68/100 [00:10<00:04,  6.58it/s] 69%|██████▉   | 69/100 [00:10<00:04,  6.71it/s] 70%|███████   | 70/100 [00:10<00:04,  6.88it/s] 71%|███████   | 71/100 [00:10<00:04,  6.87it/s] 72%|███████▏  | 72/100 [00:10<00:04,  6.80it/s] 73%|███████▎  | 73/100 [00:10<00:04,  6.65it/s] 74%|███████▍  | 74/100 [00:11<00:03,  6.62it/s] 75%|███████▌  | 75/100 [00:11<00:03,  6.71it/s] 76%|███████▌  | 76/100 [00:11<00:03,  6.63it/s] 77%|███████▋  | 77/100 [00:11<00:03,  6.72it/s] 78%|███████▊  | 78/100 [00:11<00:03,  6.71it/s] 79%|███████▉  | 79/100 [00:11<00:03,  6.66it/s] 80%|████████  | 80/100 [00:12<00:03,  6.59it/s] 81%|████████  | 81/100 [00:12<00:02,  6.71it/s] 82%|████████▏ | 82/100 [00:12<00:02,  6.90it/s] 83%|████████▎ | 83/100 [00:12<00:02,  7.02it/s] 84%|████████▍ | 84/100 [00:12<00:02,  7.11it/s] 85%|████████▌ | 85/100 [00:12<00:02,  7.06it/s] 86%|████████▌ | 86/100 [00:12<00:01,  7.06it/s] 87%|████████▋ | 87/100 [00:12<00:01,  7.03it/s] 88%|████████▊ | 88/100 [00:13<00:01,  6.89it/s] 89%|████████▉ | 89/100 [00:13<00:01,  6.84it/s] 90%|█████████ | 90/100 [00:13<00:01,  6.75it/s] 91%|█████████ | 91/100 [00:13<00:01,  6.89it/s] 92%|█████████▏| 92/100 [00:13<00:01,  6.78it/s] 93%|█████████▎| 93/100 [00:13<00:01,  6.78it/s] 94%|█████████▍| 94/100 [00:14<00:00,  6.89it/s] 95%|█████████▌| 95/100 [00:14<00:00,  6.80it/s] 96%|█████████▌| 96/100 [00:14<00:00,  6.76it/s] 97%|█████████▋| 97/100 [00:14<00:00,  6.74it/s] 98%|█████████▊| 98/100 [00:14<00:00,  6.75it/s] 99%|█████████▉| 99/100 [00:14<00:00,  6.87it/s]100%|██████████| 100/100 [00:14<00:00,  6.84it/s]100%|██████████| 100/100 [00:14<00:00,  6.71it/s]
FOLD 1
Metric     CE Loss  KL wrt Orig
Model                          
llama_7B  3.592754     1.540055
[3.6847168  1.60977455]
2023-12-04 01:39:46.633761: I tensorflow/core/util/port.cc:110] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2023-12-04 01:39:46.684664: I tensorflow/core/platform/cpu_feature_guard.cc:182] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-12-04 01:39:47.453459: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Could not find TensorRT
Found cached dataset truthful_qa (/home/elicer/.cache/huggingface/datasets/truthful_qa/multiple_choice/1.1.0/63502f6bc6ee493830ce0843991b028d0ab568d221896b2ee3b8a5dfdaa9d7f4)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 368.34it/s]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:00<00:00,  5.06it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  6.06it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  5.88it/s]
head_wise_activation_length:(11012, 32, 4096)
labels_shape:(11012,)
seperated_head_activation shape:11013
Running fold 0
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:29,  1.06it/s]  6%|▋         | 2/32 [00:01<00:28,  1.05it/s]  9%|▉         | 3/32 [00:02<00:26,  1.08it/s] 12%|█▎        | 4/32 [00:03<00:25,  1.11it/s] 16%|█▌        | 5/32 [00:04<00:24,  1.10it/s] 19%|█▉        | 6/32 [00:05<00:24,  1.08it/s] 22%|██▏       | 7/32 [00:06<00:23,  1.07it/s] 25%|██▌       | 8/32 [00:07<00:23,  1.04it/s] 28%|██▊       | 9/32 [00:08<00:22,  1.01it/s] 31%|███▏      | 10/32 [00:09<00:22,  1.01s/it] 34%|███▍      | 11/32 [00:10<00:21,  1.04s/it] 38%|███▊      | 12/32 [00:11<00:20,  1.04s/it] 41%|████      | 13/32 [00:12<00:19,  1.05s/it] 44%|████▍     | 14/32 [00:13<00:19,  1.08s/it] 47%|████▋     | 15/32 [00:15<00:18,  1.07s/it] 50%|█████     | 16/32 [00:16<00:17,  1.07s/it] 53%|█████▎    | 17/32 [00:17<00:16,  1.08s/it] 56%|█████▋    | 18/32 [00:18<00:15,  1.09s/it] 59%|█████▉    | 19/32 [00:19<00:14,  1.12s/it] 62%|██████▎   | 20/32 [00:20<00:13,  1.13s/it] 66%|██████▌   | 21/32 [00:21<00:12,  1.14s/it] 69%|██████▉   | 22/32 [00:22<00:11,  1.13s/it] 72%|███████▏  | 23/32 [00:24<00:10,  1.15s/it] 75%|███████▌  | 24/32 [00:25<00:09,  1.20s/it] 78%|███████▊  | 25/32 [00:26<00:08,  1.19s/it] 81%|████████▏ | 26/32 [00:27<00:07,  1.18s/it] 84%|████████▍ | 27/32 [00:29<00:06,  1.21s/it] 88%|████████▊ | 28/32 [00:30<00:04,  1.16s/it] 91%|█████████ | 29/32 [00:31<00:03,  1.16s/it] 94%|█████████▍| 30/32 [00:32<00:02,  1.15s/it] 97%|█████████▋| 31/32 [00:33<00:01,  1.16s/it]100%|██████████| 32/32 [00:35<00:00,  1.26s/it]100%|██████████| 32/32 [00:35<00:00,  1.10s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
/home/elicer/honest_llama/validation/../TruthfulQA/truthfulqa/metrics.py:284: FutureWarning: load_metric is deprecated and will be removed in the next major version of datasets. Use 'evaluate.load' instead, from the new library 🤗 Evaluate: https://huggingface.co/docs/evaluate
  bleurt = load_metric("bleurt", cache_dir=cache_dir)
[[0.651 0.665 0.645 ... 0.646 0.647 0.652]
 [0.659 0.644 0.645 ... 0.648 0.658 0.656]
 [0.651 0.657 0.685 ... 0.637 0.648 0.667]
 ...
 [0.765 0.762 0.657 ... 0.73  0.704 0.674]
 [0.748 0.678 0.696 ... 0.663 0.769 0.786]
 [0.775 0.815 0.74  ... 0.697 0.809 0.79 ]]
Heads intervened:  [(8, 16), (12, 4), (13, 8), (13, 16), (16, 30), (17, 29), (18, 29), (19, 17), (20, 30), (22, 16), (23, 3), (31, 6)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
2023-12-04 01:40:38.478473: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1635] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 24961 MB memory:  -> device: 0, name: NVIDIA A100 80GB PCIe MIG 3g.40gb, pci bus id: 0000:65:00.0, compute capability: 8.0
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 284.96it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-ec0cf83741fdb3e8.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-d31e6c0c76fafb4d.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:01<01:42,  1.04s/it]  3%|▎         | 3/100 [00:01<00:30,  3.23it/s]  5%|▌         | 5/100 [00:01<00:16,  5.61it/s]  7%|▋         | 7/100 [00:01<00:11,  7.97it/s]  9%|▉         | 9/100 [00:01<00:08, 10.15it/s] 11%|█         | 11/100 [00:01<00:07, 12.07it/s] 13%|█▎        | 13/100 [00:01<00:06, 13.67it/s] 15%|█▌        | 15/100 [00:01<00:05, 14.95it/s] 17%|█▋        | 17/100 [00:01<00:05, 15.94it/s] 19%|█▉        | 19/100 [00:02<00:04, 16.68it/s] 21%|██        | 21/100 [00:02<00:04, 17.22it/s] 23%|██▎       | 23/100 [00:02<00:04, 17.61it/s] 25%|██▌       | 25/100 [00:02<00:04, 17.89it/s] 27%|██▋       | 27/100 [00:02<00:04, 18.09it/s] 29%|██▉       | 29/100 [00:02<00:03, 18.24it/s] 31%|███       | 31/100 [00:02<00:03, 18.34it/s] 33%|███▎      | 33/100 [00:02<00:03, 18.31it/s] 35%|███▌      | 35/100 [00:02<00:03, 18.34it/s] 37%|███▋      | 37/100 [00:02<00:03, 18.43it/s] 39%|███▉      | 39/100 [00:03<00:03, 18.50it/s] 41%|████      | 41/100 [00:03<00:03, 18.54it/s] 43%|████▎     | 43/100 [00:03<00:03, 18.58it/s] 45%|████▌     | 45/100 [00:03<00:02, 18.59it/s] 47%|████▋     | 47/100 [00:03<00:02, 18.61it/s] 49%|████▉     | 49/100 [00:03<00:02, 18.62it/s] 51%|█████     | 51/100 [00:03<00:02, 18.63it/s] 53%|█████▎    | 53/100 [00:03<00:02, 18.64it/s] 55%|█████▌    | 55/100 [00:03<00:02, 18.64it/s] 57%|█████▋    | 57/100 [00:04<00:02, 18.64it/s] 59%|█████▉    | 59/100 [00:04<00:02, 18.63it/s] 61%|██████    | 61/100 [00:04<00:02, 18.63it/s] 63%|██████▎   | 63/100 [00:04<00:01, 18.63it/s] 65%|██████▌   | 65/100 [00:04<00:01, 18.60it/s] 67%|██████▋   | 67/100 [00:04<00:01, 18.61it/s] 69%|██████▉   | 69/100 [00:04<00:01, 18.62it/s] 71%|███████   | 71/100 [00:04<00:01, 18.56it/s] 73%|███████▎  | 73/100 [00:04<00:01, 18.53it/s] 75%|███████▌  | 75/100 [00:05<00:01, 18.56it/s] 77%|███████▋  | 77/100 [00:05<00:01, 18.59it/s] 79%|███████▉  | 79/100 [00:05<00:01, 18.60it/s] 81%|████████  | 81/100 [00:05<00:01, 18.62it/s] 83%|████████▎ | 83/100 [00:05<00:00, 18.63it/s] 85%|████████▌ | 85/100 [00:05<00:00, 18.64it/s] 87%|████████▋ | 87/100 [00:05<00:00, 18.61it/s] 89%|████████▉ | 89/100 [00:05<00:00, 18.61it/s] 91%|█████████ | 91/100 [00:05<00:00, 18.62it/s] 93%|█████████▎| 93/100 [00:05<00:00, 18.64it/s] 95%|█████████▌| 95/100 [00:06<00:00, 18.64it/s] 97%|█████████▋| 97/100 [00:06<00:00, 18.64it/s] 99%|█████████▉| 99/100 [00:06<00:00, 18.65it/s]100%|██████████| 100/100 [00:06<00:00, 15.71it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 331.85it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-1939fcc1eeebdaa7.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-785bb4b6f2089589.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:17,  5.65it/s]  2%|▏         | 2/100 [00:00<00:15,  6.23it/s]  3%|▎         | 3/100 [00:00<00:14,  6.70it/s]  4%|▍         | 4/100 [00:00<00:13,  7.10it/s]  5%|▌         | 5/100 [00:00<00:12,  7.34it/s]  6%|▌         | 6/100 [00:00<00:12,  7.50it/s]  7%|▋         | 7/100 [00:00<00:12,  7.21it/s]  8%|▊         | 8/100 [00:01<00:12,  7.28it/s]  9%|▉         | 9/100 [00:01<00:12,  7.44it/s] 10%|█         | 10/100 [00:01<00:12,  7.29it/s] 11%|█         | 11/100 [00:01<00:12,  7.17it/s] 12%|█▏        | 12/100 [00:01<00:12,  7.16it/s] 13%|█▎        | 13/100 [00:01<00:12,  7.13it/s] 14%|█▍        | 14/100 [00:01<00:12,  7.11it/s] 15%|█▌        | 15/100 [00:02<00:11,  7.18it/s] 16%|█▌        | 16/100 [00:02<00:11,  7.35it/s] 17%|█▋        | 17/100 [00:02<00:11,  7.11it/s] 18%|█▊        | 18/100 [00:02<00:11,  7.20it/s] 19%|█▉        | 19/100 [00:02<00:11,  7.29it/s] 20%|██        | 20/100 [00:02<00:11,  7.26it/s] 21%|██        | 21/100 [00:02<00:10,  7.20it/s] 22%|██▏       | 22/100 [00:03<00:11,  7.03it/s] 23%|██▎       | 23/100 [00:03<00:10,  7.06it/s] 24%|██▍       | 24/100 [00:03<00:10,  7.26it/s] 25%|██▌       | 25/100 [00:03<00:10,  7.06it/s] 26%|██▌       | 26/100 [00:03<00:10,  7.17it/s] 27%|██▋       | 27/100 [00:03<00:09,  7.35it/s] 28%|██▊       | 28/100 [00:03<00:09,  7.48it/s] 29%|██▉       | 29/100 [00:04<00:09,  7.53it/s] 30%|███       | 30/100 [00:04<00:09,  7.61it/s] 31%|███       | 31/100 [00:04<00:09,  7.61it/s] 32%|███▏      | 32/100 [00:04<00:09,  7.49it/s] 33%|███▎      | 33/100 [00:04<00:09,  7.37it/s] 34%|███▍      | 34/100 [00:04<00:09,  7.28it/s] 35%|███▌      | 35/100 [00:04<00:08,  7.36it/s] 36%|███▌      | 36/100 [00:04<00:08,  7.35it/s] 37%|███▋      | 37/100 [00:05<00:08,  7.48it/s] 38%|███▊      | 38/100 [00:05<00:08,  7.58it/s] 39%|███▉      | 39/100 [00:05<00:07,  7.65it/s] 40%|████      | 40/100 [00:05<00:07,  7.59it/s] 41%|████      | 41/100 [00:05<00:07,  7.64it/s] 42%|████▏     | 42/100 [00:05<00:07,  7.64it/s] 43%|████▎     | 43/100 [00:05<00:07,  7.70it/s] 44%|████▍     | 44/100 [00:06<00:07,  7.49it/s] 45%|████▌     | 45/100 [00:06<00:07,  7.40it/s] 46%|████▌     | 46/100 [00:06<00:07,  7.51it/s] 47%|████▋     | 47/100 [00:06<00:07,  7.35it/s] 48%|████▊     | 48/100 [00:06<00:06,  7.47it/s] 49%|████▉     | 49/100 [00:06<00:06,  7.58it/s] 50%|█████     | 50/100 [00:06<00:06,  7.42it/s] 51%|█████     | 51/100 [00:06<00:06,  7.46it/s] 52%|█████▏    | 52/100 [00:07<00:06,  7.04it/s] 53%|█████▎    | 53/100 [00:07<00:06,  7.01it/s] 54%|█████▍    | 54/100 [00:07<00:06,  7.05it/s] 55%|█████▌    | 55/100 [00:07<00:06,  7.13it/s] 56%|█████▌    | 56/100 [00:07<00:06,  7.24it/s] 57%|█████▋    | 57/100 [00:07<00:05,  7.21it/s] 58%|█████▊    | 58/100 [00:07<00:05,  7.30it/s] 59%|█████▉    | 59/100 [00:08<00:05,  7.30it/s] 60%|██████    | 60/100 [00:08<00:05,  7.14it/s] 61%|██████    | 61/100 [00:08<00:05,  7.14it/s] 62%|██████▏   | 62/100 [00:08<00:05,  7.20it/s] 63%|██████▎   | 63/100 [00:08<00:05,  7.15it/s] 64%|██████▍   | 64/100 [00:08<00:04,  7.22it/s] 65%|██████▌   | 65/100 [00:08<00:04,  7.21it/s] 66%|██████▌   | 66/100 [00:09<00:04,  7.30it/s] 67%|██████▋   | 67/100 [00:09<00:04,  7.19it/s] 68%|██████▊   | 68/100 [00:09<00:04,  7.18it/s] 69%|██████▉   | 69/100 [00:09<00:04,  7.20it/s] 70%|███████   | 70/100 [00:09<00:04,  7.23it/s] 71%|███████   | 71/100 [00:09<00:03,  7.31it/s] 72%|███████▏  | 72/100 [00:09<00:03,  7.30it/s] 73%|███████▎  | 73/100 [00:10<00:03,  7.25it/s] 74%|███████▍  | 74/100 [00:10<00:03,  7.14it/s] 75%|███████▌  | 75/100 [00:10<00:03,  7.25it/s] 76%|███████▌  | 76/100 [00:10<00:03,  7.16it/s] 77%|███████▋  | 77/100 [00:10<00:03,  7.20it/s] 78%|███████▊  | 78/100 [00:10<00:02,  7.38it/s] 79%|███████▉  | 79/100 [00:10<00:02,  7.50it/s] 80%|████████  | 80/100 [00:10<00:02,  7.50it/s] 81%|████████  | 81/100 [00:11<00:02,  7.49it/s] 82%|████████▏ | 82/100 [00:11<00:02,  7.27it/s] 83%|████████▎ | 83/100 [00:11<00:02,  7.30it/s] 84%|████████▍ | 84/100 [00:11<00:02,  7.45it/s] 85%|████████▌ | 85/100 [00:11<00:01,  7.55it/s] 86%|████████▌ | 86/100 [00:11<00:01,  7.45it/s] 87%|████████▋ | 87/100 [00:11<00:01,  7.30it/s] 88%|████████▊ | 88/100 [00:12<00:01,  7.13it/s] 89%|████████▉ | 89/100 [00:12<00:01,  7.08it/s] 90%|█████████ | 90/100 [00:12<00:01,  6.99it/s] 91%|█████████ | 91/100 [00:12<00:01,  7.15it/s] 92%|█████████▏| 92/100 [00:12<00:01,  7.14it/s] 93%|█████████▎| 93/100 [00:12<00:00,  7.15it/s] 94%|█████████▍| 94/100 [00:12<00:00,  7.15it/s] 95%|█████████▌| 95/100 [00:13<00:00,  7.18it/s] 96%|█████████▌| 96/100 [00:13<00:00,  6.97it/s] 97%|█████████▋| 97/100 [00:13<00:00,  7.15it/s] 98%|█████████▊| 98/100 [00:13<00:00,  7.13it/s] 99%|█████████▉| 99/100 [00:13<00:00,  7.14it/s]100%|██████████| 100/100 [00:13<00:00,  7.32it/s]100%|██████████| 100/100 [00:13<00:00,  7.27it/s]
FOLD 0
Metric     CE Loss  KL wrt Orig
Model                          
llama_7B  4.245977     2.124324
Running fold 1
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:28,  1.07it/s]  6%|▋         | 2/32 [00:02<00:32,  1.08s/it]  9%|▉         | 3/32 [00:03<00:33,  1.16s/it] 12%|█▎        | 4/32 [00:04<00:32,  1.17s/it] 16%|█▌        | 5/32 [00:05<00:32,  1.21s/it] 19%|█▉        | 6/32 [00:07<00:32,  1.24s/it] 22%|██▏       | 7/32 [00:08<00:31,  1.25s/it] 25%|██▌       | 8/32 [00:09<00:29,  1.24s/it] 28%|██▊       | 9/32 [00:10<00:28,  1.24s/it] 31%|███▏      | 10/32 [00:12<00:27,  1.24s/it] 34%|███▍      | 11/32 [00:13<00:25,  1.23s/it] 38%|███▊      | 12/32 [00:14<00:24,  1.21s/it] 41%|████      | 13/32 [00:15<00:22,  1.20s/it] 44%|████▍     | 14/32 [00:16<00:21,  1.20s/it] 47%|████▋     | 15/32 [00:18<00:20,  1.19s/it] 50%|█████     | 16/32 [00:19<00:19,  1.20s/it] 53%|█████▎    | 17/32 [00:20<00:17,  1.19s/it] 56%|█████▋    | 18/32 [00:21<00:16,  1.19s/it] 59%|█████▉    | 19/32 [00:22<00:15,  1.22s/it] 62%|██████▎   | 20/32 [00:24<00:15,  1.25s/it] 66%|██████▌   | 21/32 [00:25<00:13,  1.26s/it] 69%|██████▉   | 22/32 [00:26<00:12,  1.26s/it] 72%|███████▏  | 23/32 [00:28<00:11,  1.27s/it] 75%|███████▌  | 24/32 [00:29<00:10,  1.29s/it] 78%|███████▊  | 25/32 [00:30<00:09,  1.30s/it] 81%|████████▏ | 26/32 [00:31<00:07,  1.29s/it] 84%|████████▍ | 27/32 [00:33<00:06,  1.30s/it] 88%|████████▊ | 28/32 [00:34<00:05,  1.29s/it] 91%|█████████ | 29/32 [00:35<00:03,  1.30s/it] 94%|█████████▍| 30/32 [00:37<00:02,  1.28s/it] 97%|█████████▋| 31/32 [00:38<00:01,  1.28s/it]100%|██████████| 32/32 [00:39<00:00,  1.34s/it]100%|██████████| 32/32 [00:39<00:00,  1.25s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
[[0.666 0.672 0.662 ... 0.668 0.662 0.67 ]
 [0.662 0.662 0.659 ... 0.677 0.666 0.663]
 [0.668 0.67  0.68  ... 0.661 0.665 0.671]
 ...
 [0.758 0.75  0.674 ... 0.716 0.694 0.677]
 [0.749 0.671 0.686 ... 0.674 0.762 0.76 ]
 [0.765 0.805 0.748 ... 0.743 0.787 0.775]]
Heads intervened:  [(8, 16), (11, 17), (12, 4), (13, 8), (13, 16), (16, 17), (17, 13), (17, 29), (18, 29), (19, 17), (20, 30), (23, 3)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 630.06it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-30ec7b2da7888791.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-4e53eea82b0ecfef.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  2%|▏         | 2/100 [00:00<00:05, 18.04it/s]  4%|▍         | 4/100 [00:00<00:05, 18.52it/s]  6%|▌         | 6/100 [00:00<00:05, 18.61it/s]  8%|▊         | 8/100 [00:00<00:04, 18.70it/s] 10%|█         | 10/100 [00:00<00:04, 18.76it/s] 12%|█▏        | 12/100 [00:00<00:04, 18.80it/s] 14%|█▍        | 14/100 [00:00<00:04, 18.38it/s] 16%|█▌        | 16/100 [00:00<00:04, 18.51it/s] 18%|█▊        | 18/100 [00:00<00:04, 18.61it/s] 20%|██        | 20/100 [00:01<00:04, 18.68it/s] 22%|██▏       | 22/100 [00:01<00:04, 18.72it/s] 24%|██▍       | 24/100 [00:01<00:04, 18.76it/s] 26%|██▌       | 26/100 [00:01<00:03, 18.80it/s] 28%|██▊       | 28/100 [00:01<00:03, 18.81it/s] 30%|███       | 30/100 [00:01<00:03, 18.82it/s] 32%|███▏      | 32/100 [00:01<00:03, 18.82it/s] 34%|███▍      | 34/100 [00:01<00:03, 18.82it/s] 36%|███▌      | 36/100 [00:01<00:03, 18.82it/s] 38%|███▊      | 38/100 [00:02<00:03, 18.74it/s] 40%|████      | 40/100 [00:02<00:03, 18.74it/s] 42%|████▏     | 42/100 [00:02<00:03, 18.78it/s] 44%|████▍     | 44/100 [00:02<00:02, 18.81it/s] 46%|████▌     | 46/100 [00:02<00:02, 18.83it/s] 48%|████▊     | 48/100 [00:02<00:02, 18.83it/s] 50%|█████     | 50/100 [00:02<00:02, 18.84it/s] 52%|█████▏    | 52/100 [00:02<00:02, 18.83it/s] 54%|█████▍    | 54/100 [00:02<00:02, 18.84it/s] 56%|█████▌    | 56/100 [00:02<00:02, 18.84it/s] 58%|█████▊    | 58/100 [00:03<00:02, 18.85it/s] 60%|██████    | 60/100 [00:03<00:02, 18.85it/s] 62%|██████▏   | 62/100 [00:03<00:02, 18.87it/s] 64%|██████▍   | 64/100 [00:03<00:01, 18.87it/s] 66%|██████▌   | 66/100 [00:03<00:01, 18.88it/s] 68%|██████▊   | 68/100 [00:03<00:01, 18.88it/s] 70%|███████   | 70/100 [00:03<00:01, 18.89it/s] 72%|███████▏  | 72/100 [00:03<00:01, 18.90it/s] 74%|███████▍  | 74/100 [00:03<00:01, 18.89it/s] 76%|███████▌  | 76/100 [00:04<00:01, 18.90it/s] 78%|███████▊  | 78/100 [00:04<00:01, 18.82it/s] 80%|████████  | 80/100 [00:04<00:01, 18.83it/s] 82%|████████▏ | 82/100 [00:04<00:00, 18.83it/s] 84%|████████▍ | 84/100 [00:04<00:00, 18.84it/s] 86%|████████▌ | 86/100 [00:04<00:00, 18.85it/s] 88%|████████▊ | 88/100 [00:04<00:00, 18.85it/s] 90%|█████████ | 90/100 [00:04<00:00, 18.86it/s] 92%|█████████▏| 92/100 [00:04<00:00, 18.86it/s] 94%|█████████▍| 94/100 [00:05<00:00, 18.87it/s] 96%|█████████▌| 96/100 [00:05<00:00, 18.88it/s] 98%|█████████▊| 98/100 [00:05<00:00, 18.87it/s]100%|██████████| 100/100 [00:05<00:00, 18.86it/s]100%|██████████| 100/100 [00:05<00:00, 18.80it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 358.37it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-14295f39edd20556.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-10ca04ba0c7bb427.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:16,  5.99it/s]  2%|▏         | 2/100 [00:00<00:14,  6.59it/s]  3%|▎         | 3/100 [00:00<00:14,  6.69it/s]  4%|▍         | 4/100 [00:00<00:14,  6.72it/s]  5%|▌         | 5/100 [00:00<00:13,  7.00it/s]  6%|▌         | 6/100 [00:00<00:13,  7.20it/s]  7%|▋         | 7/100 [00:01<00:12,  7.23it/s]  8%|▊         | 8/100 [00:01<00:12,  7.12it/s]  9%|▉         | 9/100 [00:01<00:12,  7.20it/s] 10%|█         | 10/100 [00:01<00:12,  7.25it/s] 11%|█         | 11/100 [00:01<00:12,  7.08it/s] 12%|█▏        | 12/100 [00:01<00:12,  7.29it/s] 13%|█▎        | 13/100 [00:01<00:12,  7.09it/s] 14%|█▍        | 14/100 [00:01<00:11,  7.30it/s] 15%|█▌        | 15/100 [00:02<00:11,  7.11it/s] 16%|█▌        | 16/100 [00:02<00:11,  7.32it/s] 17%|█▋        | 17/100 [00:02<00:11,  7.06it/s] 18%|█▊        | 18/100 [00:02<00:11,  7.03it/s] 19%|█▉        | 19/100 [00:02<00:11,  7.08it/s] 20%|██        | 20/100 [00:02<00:10,  7.29it/s] 21%|██        | 21/100 [00:02<00:10,  7.40it/s] 22%|██▏       | 22/100 [00:03<00:10,  7.31it/s] 23%|██▎       | 23/100 [00:03<00:10,  7.47it/s] 24%|██▍       | 24/100 [00:03<00:10,  7.38it/s] 25%|██▌       | 25/100 [00:03<00:10,  7.33it/s] 26%|██▌       | 26/100 [00:03<00:10,  7.29it/s] 27%|██▋       | 27/100 [00:03<00:10,  7.16it/s] 28%|██▊       | 28/100 [00:03<00:09,  7.28it/s] 29%|██▉       | 29/100 [00:04<00:09,  7.26it/s] 30%|███       | 30/100 [00:04<00:09,  7.21it/s] 31%|███       | 31/100 [00:04<00:09,  7.38it/s] 32%|███▏      | 32/100 [00:04<00:09,  7.36it/s] 33%|███▎      | 33/100 [00:04<00:09,  7.26it/s] 34%|███▍      | 34/100 [00:04<00:08,  7.43it/s] 35%|███▌      | 35/100 [00:04<00:09,  7.19it/s] 36%|███▌      | 36/100 [00:05<00:08,  7.20it/s] 37%|███▋      | 37/100 [00:05<00:08,  7.16it/s] 38%|███▊      | 38/100 [00:05<00:08,  7.36it/s] 39%|███▉      | 39/100 [00:05<00:08,  7.42it/s] 40%|████      | 40/100 [00:05<00:07,  7.54it/s] 41%|████      | 41/100 [00:05<00:08,  7.25it/s] 42%|████▏     | 42/100 [00:05<00:07,  7.41it/s] 43%|████▎     | 43/100 [00:05<00:07,  7.22it/s] 44%|████▍     | 44/100 [00:06<00:07,  7.28it/s] 45%|████▌     | 45/100 [00:06<00:07,  7.07it/s] 46%|████▌     | 46/100 [00:06<00:07,  6.92it/s] 47%|████▋     | 47/100 [00:06<00:07,  6.82it/s] 48%|████▊     | 48/100 [00:06<00:07,  7.10it/s] 49%|████▉     | 49/100 [00:06<00:07,  7.11it/s] 50%|█████     | 50/100 [00:06<00:07,  7.07it/s] 51%|█████     | 51/100 [00:07<00:06,  7.13it/s] 52%|█████▏    | 52/100 [00:07<00:06,  7.30it/s] 53%|█████▎    | 53/100 [00:07<00:06,  7.09it/s] 54%|█████▍    | 54/100 [00:07<00:06,  7.13it/s] 55%|█████▌    | 55/100 [00:07<00:06,  7.34it/s] 56%|█████▌    | 56/100 [00:07<00:05,  7.49it/s] 57%|█████▋    | 57/100 [00:07<00:05,  7.56it/s] 58%|█████▊    | 58/100 [00:08<00:05,  7.46it/s] 59%|█████▉    | 59/100 [00:08<00:05,  7.21it/s] 60%|██████    | 60/100 [00:08<00:05,  7.39it/s] 61%|██████    | 61/100 [00:08<00:05,  7.46it/s] 62%|██████▏   | 62/100 [00:08<00:05,  7.59it/s] 63%|██████▎   | 63/100 [00:08<00:05,  7.39it/s] 64%|██████▍   | 64/100 [00:08<00:04,  7.33it/s] 65%|██████▌   | 65/100 [00:08<00:04,  7.29it/s] 66%|██████▌   | 66/100 [00:09<00:04,  7.23it/s] 67%|██████▋   | 67/100 [00:09<00:04,  7.01it/s] 68%|██████▊   | 68/100 [00:09<00:04,  7.00it/s] 69%|██████▉   | 69/100 [00:09<00:04,  7.14it/s] 70%|███████   | 70/100 [00:09<00:04,  7.16it/s] 71%|███████   | 71/100 [00:09<00:03,  7.35it/s] 72%|███████▏  | 72/100 [00:09<00:03,  7.16it/s] 73%|███████▎  | 73/100 [00:10<00:03,  7.18it/s] 74%|███████▍  | 74/100 [00:10<00:03,  7.25it/s] 75%|███████▌  | 75/100 [00:10<00:03,  7.07it/s] 76%|███████▌  | 76/100 [00:10<00:03,  7.20it/s] 77%|███████▋  | 77/100 [00:10<00:03,  7.27it/s] 78%|███████▊  | 78/100 [00:10<00:03,  7.01it/s] 79%|███████▉  | 79/100 [00:10<00:02,  7.23it/s] 80%|████████  | 80/100 [00:11<00:02,  7.11it/s] 81%|████████  | 81/100 [00:11<00:02,  7.32it/s] 82%|████████▏ | 82/100 [00:11<00:02,  7.28it/s] 83%|████████▎ | 83/100 [00:11<00:02,  7.43it/s] 84%|████████▍ | 84/100 [00:11<00:02,  7.36it/s] 85%|████████▌ | 85/100 [00:11<00:01,  7.50it/s] 86%|████████▌ | 86/100 [00:11<00:01,  7.39it/s] 87%|████████▋ | 87/100 [00:12<00:01,  7.40it/s] 88%|████████▊ | 88/100 [00:12<00:01,  7.52it/s] 89%|████████▉ | 89/100 [00:12<00:01,  7.29it/s] 90%|█████████ | 90/100 [00:12<00:01,  7.20it/s] 91%|█████████ | 91/100 [00:12<00:01,  7.39it/s] 92%|█████████▏| 92/100 [00:12<00:01,  7.02it/s] 93%|█████████▎| 93/100 [00:12<00:00,  7.06it/s] 94%|█████████▍| 94/100 [00:13<00:00,  7.08it/s] 95%|█████████▌| 95/100 [00:13<00:00,  7.22it/s] 96%|█████████▌| 96/100 [00:13<00:00,  7.40it/s] 97%|█████████▋| 97/100 [00:13<00:00,  7.52it/s] 98%|█████████▊| 98/100 [00:13<00:00,  7.32it/s] 99%|█████████▉| 99/100 [00:13<00:00,  7.46it/s]100%|██████████| 100/100 [00:13<00:00,  7.51it/s]100%|██████████| 100/100 [00:13<00:00,  7.24it/s]
FOLD 1
Metric     CE Loss  KL wrt Orig
Model                          
llama_7B  4.598984      2.51693
[4.42248047 2.32062736]
2023-12-04 01:42:17.218845: I tensorflow/core/util/port.cc:110] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2023-12-04 01:42:17.268141: I tensorflow/core/platform/cpu_feature_guard.cc:182] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-12-04 01:42:18.012534: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Could not find TensorRT
Found cached dataset truthful_qa (/home/elicer/.cache/huggingface/datasets/truthful_qa/multiple_choice/1.1.0/63502f6bc6ee493830ce0843991b028d0ab568d221896b2ee3b8a5dfdaa9d7f4)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 371.67it/s]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:00<00:00,  5.18it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  6.22it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  6.04it/s]
head_wise_activation_length:(11012, 32, 4096)
labels_shape:(11012,)
seperated_head_activation shape:11013
Running fold 0
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:28,  1.08it/s]  6%|▋         | 2/32 [00:01<00:28,  1.05it/s]  9%|▉         | 3/32 [00:02<00:26,  1.08it/s] 12%|█▎        | 4/32 [00:03<00:25,  1.10it/s] 16%|█▌        | 5/32 [00:04<00:24,  1.10it/s] 19%|█▉        | 6/32 [00:05<00:24,  1.08it/s] 22%|██▏       | 7/32 [00:06<00:23,  1.08it/s] 25%|██▌       | 8/32 [00:07<00:22,  1.05it/s] 28%|██▊       | 9/32 [00:08<00:22,  1.02it/s] 31%|███▏      | 10/32 [00:09<00:22,  1.01s/it] 34%|███▍      | 11/32 [00:10<00:21,  1.03s/it] 38%|███▊      | 12/32 [00:11<00:20,  1.03s/it] 41%|████      | 13/32 [00:12<00:19,  1.04s/it] 44%|████▍     | 14/32 [00:13<00:19,  1.06s/it] 47%|████▋     | 15/32 [00:14<00:17,  1.05s/it] 50%|█████     | 16/32 [00:15<00:16,  1.06s/it] 53%|█████▎    | 17/32 [00:17<00:15,  1.06s/it] 56%|█████▋    | 18/32 [00:18<00:15,  1.08s/it] 59%|█████▉    | 19/32 [00:19<00:14,  1.10s/it] 62%|██████▎   | 20/32 [00:20<00:13,  1.12s/it] 66%|██████▌   | 21/32 [00:21<00:12,  1.13s/it] 69%|██████▉   | 22/32 [00:22<00:11,  1.12s/it] 72%|███████▏  | 23/32 [00:23<00:10,  1.14s/it] 75%|███████▌  | 24/32 [00:25<00:09,  1.19s/it] 78%|███████▊  | 25/32 [00:26<00:08,  1.18s/it] 81%|████████▏ | 26/32 [00:27<00:06,  1.16s/it] 84%|████████▍ | 27/32 [00:28<00:05,  1.19s/it] 88%|████████▊ | 28/32 [00:29<00:04,  1.15s/it] 91%|█████████ | 29/32 [00:30<00:03,  1.15s/it] 94%|█████████▍| 30/32 [00:32<00:02,  1.13s/it] 97%|█████████▋| 31/32 [00:33<00:01,  1.15s/it]100%|██████████| 32/32 [00:34<00:00,  1.24s/it]100%|██████████| 32/32 [00:34<00:00,  1.08s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
/home/elicer/honest_llama/validation/../TruthfulQA/truthfulqa/metrics.py:284: FutureWarning: load_metric is deprecated and will be removed in the next major version of datasets. Use 'evaluate.load' instead, from the new library 🤗 Evaluate: https://huggingface.co/docs/evaluate
  bleurt = load_metric("bleurt", cache_dir=cache_dir)
[[0.651 0.665 0.645 ... 0.646 0.647 0.652]
 [0.659 0.644 0.645 ... 0.648 0.658 0.656]
 [0.651 0.657 0.685 ... 0.637 0.648 0.667]
 ...
 [0.765 0.762 0.657 ... 0.73  0.704 0.674]
 [0.748 0.678 0.696 ... 0.663 0.769 0.786]
 [0.775 0.815 0.74  ... 0.697 0.809 0.79 ]]
Heads intervened:  [(8, 16), (12, 4), (12, 15), (13, 8), (13, 16), (15, 28), (16, 30), (17, 13), (17, 17), (17, 29), (18, 29), (19, 13), (19, 17), (20, 22), (20, 30), (22, 16), (22, 30), (23, 3), (23, 7), (23, 13), (25, 15), (31, 1), (31, 6), (31, 30)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
2023-12-04 01:43:09.184726: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1635] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 24961 MB memory:  -> device: 0, name: NVIDIA A100 80GB PCIe MIG 3g.40gb, pci bus id: 0000:65:00.0, compute capability: 8.0
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 602.37it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-ec0cf83741fdb3e8.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-d31e6c0c76fafb4d.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:01<01:41,  1.02s/it]  3%|▎         | 3/100 [00:01<00:29,  3.25it/s]  5%|▌         | 5/100 [00:01<00:16,  5.62it/s]  7%|▋         | 7/100 [00:01<00:11,  7.91it/s]  9%|▉         | 9/100 [00:01<00:09, 10.02it/s] 11%|█         | 11/100 [00:01<00:07, 11.83it/s] 13%|█▎        | 13/100 [00:01<00:06, 13.34it/s] 15%|█▌        | 15/100 [00:01<00:05, 14.53it/s] 17%|█▋        | 17/100 [00:01<00:05, 15.45it/s] 19%|█▉        | 19/100 [00:02<00:05, 16.09it/s] 21%|██        | 21/100 [00:02<00:04, 16.58it/s] 23%|██▎       | 23/100 [00:02<00:04, 16.94it/s] 25%|██▌       | 25/100 [00:02<00:04, 17.21it/s] 27%|██▋       | 27/100 [00:02<00:04, 17.40it/s] 29%|██▉       | 29/100 [00:02<00:04, 17.54it/s] 31%|███       | 31/100 [00:02<00:03, 17.64it/s] 33%|███▎      | 33/100 [00:02<00:03, 17.71it/s] 35%|███▌      | 35/100 [00:02<00:03, 17.76it/s] 37%|███▋      | 37/100 [00:03<00:03, 17.79it/s] 39%|███▉      | 39/100 [00:03<00:03, 17.82it/s] 41%|████      | 41/100 [00:03<00:03, 17.84it/s] 43%|████▎     | 43/100 [00:03<00:03, 17.86it/s] 45%|████▌     | 45/100 [00:03<00:03, 17.86it/s] 47%|████▋     | 47/100 [00:03<00:02, 17.87it/s] 49%|████▉     | 49/100 [00:03<00:02, 17.87it/s] 51%|█████     | 51/100 [00:03<00:02, 17.88it/s] 53%|█████▎    | 53/100 [00:03<00:02, 17.88it/s] 55%|█████▌    | 55/100 [00:04<00:02, 17.87it/s] 57%|█████▋    | 57/100 [00:04<00:02, 17.88it/s] 59%|█████▉    | 59/100 [00:04<00:02, 17.87it/s] 61%|██████    | 61/100 [00:04<00:02, 17.87it/s] 63%|██████▎   | 63/100 [00:04<00:02, 17.88it/s] 65%|██████▌   | 65/100 [00:04<00:01, 17.88it/s] 67%|██████▋   | 67/100 [00:04<00:01, 17.88it/s] 69%|██████▉   | 69/100 [00:04<00:01, 17.35it/s] 71%|███████   | 71/100 [00:04<00:01, 17.51it/s] 73%|███████▎  | 73/100 [00:05<00:01, 17.63it/s] 75%|███████▌  | 75/100 [00:05<00:01, 17.71it/s] 77%|███████▋  | 77/100 [00:05<00:01, 17.76it/s] 79%|███████▉  | 79/100 [00:05<00:01, 17.81it/s] 81%|████████  | 81/100 [00:05<00:01, 17.82it/s] 83%|████████▎ | 83/100 [00:05<00:00, 17.85it/s] 85%|████████▌ | 85/100 [00:05<00:00, 17.87it/s] 87%|████████▋ | 87/100 [00:05<00:00, 17.89it/s] 89%|████████▉ | 89/100 [00:05<00:00, 17.90it/s] 91%|█████████ | 91/100 [00:06<00:00, 17.91it/s] 93%|█████████▎| 93/100 [00:06<00:00, 17.87it/s] 95%|█████████▌| 95/100 [00:06<00:00, 17.88it/s] 97%|█████████▋| 97/100 [00:06<00:00, 17.88it/s] 99%|█████████▉| 99/100 [00:06<00:00, 17.88it/s]100%|██████████| 100/100 [00:06<00:00, 15.21it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 326.81it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-1939fcc1eeebdaa7.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-785bb4b6f2089589.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:17,  5.65it/s]  2%|▏         | 2/100 [00:00<00:15,  6.20it/s]  3%|▎         | 3/100 [00:00<00:14,  6.64it/s]  4%|▍         | 4/100 [00:00<00:13,  6.94it/s]  5%|▌         | 5/100 [00:00<00:13,  6.84it/s]  6%|▌         | 6/100 [00:00<00:13,  6.99it/s]  7%|▋         | 7/100 [00:01<00:13,  7.08it/s]  8%|▊         | 8/100 [00:01<00:12,  7.25it/s]  9%|▉         | 9/100 [00:01<00:12,  7.38it/s] 10%|█         | 10/100 [00:01<00:12,  7.38it/s] 11%|█         | 11/100 [00:01<00:11,  7.46it/s] 12%|█▏        | 12/100 [00:01<00:11,  7.52it/s] 13%|█▎        | 13/100 [00:01<00:11,  7.55it/s] 14%|█▍        | 14/100 [00:01<00:11,  7.57it/s] 15%|█▌        | 15/100 [00:02<00:11,  7.55it/s] 16%|█▌        | 16/100 [00:02<00:11,  7.58it/s] 17%|█▋        | 17/100 [00:02<00:10,  7.60it/s] 18%|█▊        | 18/100 [00:02<00:10,  7.61it/s] 19%|█▉        | 19/100 [00:02<00:10,  7.63it/s] 20%|██        | 20/100 [00:02<00:10,  7.64it/s] 21%|██        | 21/100 [00:02<00:10,  7.65it/s] 22%|██▏       | 22/100 [00:02<00:10,  7.65it/s] 23%|██▎       | 23/100 [00:03<00:10,  7.65it/s] 24%|██▍       | 24/100 [00:03<00:09,  7.65it/s] 25%|██▌       | 25/100 [00:03<00:09,  7.66it/s] 26%|██▌       | 26/100 [00:03<00:09,  7.62it/s] 27%|██▋       | 27/100 [00:03<00:09,  7.63it/s] 28%|██▊       | 28/100 [00:03<00:09,  7.63it/s] 29%|██▉       | 29/100 [00:03<00:09,  7.65it/s] 30%|███       | 30/100 [00:04<00:09,  7.54it/s] 31%|███       | 31/100 [00:04<00:09,  7.58it/s] 32%|███▏      | 32/100 [00:04<00:08,  7.60it/s] 33%|███▎      | 33/100 [00:04<00:08,  7.61it/s] 34%|███▍      | 34/100 [00:04<00:08,  7.63it/s] 35%|███▌      | 35/100 [00:04<00:08,  7.65it/s] 36%|███▌      | 36/100 [00:04<00:08,  7.65it/s] 37%|███▋      | 37/100 [00:04<00:08,  7.60it/s] 38%|███▊      | 38/100 [00:05<00:08,  7.62it/s] 39%|███▉      | 39/100 [00:05<00:07,  7.64it/s] 40%|████      | 40/100 [00:05<00:07,  7.65it/s] 41%|████      | 41/100 [00:05<00:07,  7.65it/s] 42%|████▏     | 42/100 [00:05<00:07,  7.65it/s] 43%|████▎     | 43/100 [00:05<00:07,  7.65it/s] 44%|████▍     | 44/100 [00:05<00:07,  7.66it/s] 45%|████▌     | 45/100 [00:06<00:07,  7.66it/s] 46%|████▌     | 46/100 [00:06<00:07,  7.65it/s] 47%|████▋     | 47/100 [00:06<00:06,  7.66it/s] 48%|████▊     | 48/100 [00:06<00:07,  7.33it/s] 49%|████▉     | 49/100 [00:06<00:06,  7.38it/s] 50%|█████     | 50/100 [00:06<00:06,  7.47it/s] 51%|█████     | 51/100 [00:06<00:06,  7.52it/s] 52%|█████▏    | 52/100 [00:06<00:06,  7.56it/s] 53%|█████▎    | 53/100 [00:07<00:06,  7.59it/s] 54%|█████▍    | 54/100 [00:07<00:06,  7.62it/s] 55%|█████▌    | 55/100 [00:07<00:05,  7.64it/s] 56%|█████▌    | 56/100 [00:07<00:05,  7.65it/s] 57%|█████▋    | 57/100 [00:07<00:05,  7.65it/s] 58%|█████▊    | 58/100 [00:07<00:05,  7.65it/s] 59%|█████▉    | 59/100 [00:07<00:05,  7.66it/s] 60%|██████    | 60/100 [00:07<00:05,  7.67it/s] 61%|██████    | 61/100 [00:08<00:05,  7.63it/s] 62%|██████▏   | 62/100 [00:08<00:04,  7.64it/s] 63%|██████▎   | 63/100 [00:08<00:04,  7.64it/s] 64%|██████▍   | 64/100 [00:08<00:04,  7.66it/s] 65%|██████▌   | 65/100 [00:08<00:04,  7.66it/s] 66%|██████▌   | 66/100 [00:08<00:04,  7.67it/s] 67%|██████▋   | 67/100 [00:08<00:04,  7.67it/s] 68%|██████▊   | 68/100 [00:09<00:04,  7.66it/s] 69%|██████▉   | 69/100 [00:09<00:04,  7.67it/s] 70%|███████   | 70/100 [00:09<00:03,  7.68it/s] 71%|███████   | 71/100 [00:09<00:03,  7.67it/s] 72%|███████▏  | 72/100 [00:09<00:03,  7.67it/s] 73%|███████▎  | 73/100 [00:09<00:03,  7.66it/s] 74%|███████▍  | 74/100 [00:09<00:03,  7.66it/s] 75%|███████▌  | 75/100 [00:09<00:03,  7.67it/s] 76%|███████▌  | 76/100 [00:10<00:03,  7.67it/s] 77%|███████▋  | 77/100 [00:10<00:03,  7.64it/s] 78%|███████▊  | 78/100 [00:10<00:02,  7.64it/s] 79%|███████▉  | 79/100 [00:10<00:02,  7.65it/s] 80%|████████  | 80/100 [00:10<00:02,  7.66it/s] 81%|████████  | 81/100 [00:10<00:02,  7.66it/s] 82%|████████▏ | 82/100 [00:10<00:02,  7.66it/s] 83%|████████▎ | 83/100 [00:10<00:02,  7.66it/s] 84%|████████▍ | 84/100 [00:11<00:02,  7.67it/s] 85%|████████▌ | 85/100 [00:11<00:01,  7.67it/s] 86%|████████▌ | 86/100 [00:11<00:01,  7.67it/s] 87%|████████▋ | 87/100 [00:11<00:01,  7.67it/s] 88%|████████▊ | 88/100 [00:11<00:01,  7.66it/s] 89%|████████▉ | 89/100 [00:11<00:01,  7.67it/s] 90%|█████████ | 90/100 [00:11<00:01,  7.67it/s] 91%|█████████ | 91/100 [00:12<00:01,  7.67it/s] 92%|█████████▏| 92/100 [00:12<00:01,  7.67it/s] 93%|█████████▎| 93/100 [00:12<00:00,  7.62it/s] 94%|█████████▍| 94/100 [00:12<00:00,  7.64it/s] 95%|█████████▌| 95/100 [00:12<00:00,  7.65it/s] 96%|█████████▌| 96/100 [00:12<00:00,  7.65it/s] 97%|█████████▋| 97/100 [00:12<00:00,  7.66it/s] 98%|█████████▊| 98/100 [00:12<00:00,  7.65it/s] 99%|█████████▉| 99/100 [00:13<00:00,  7.67it/s]100%|██████████| 100/100 [00:13<00:00,  7.67it/s]100%|██████████| 100/100 [00:13<00:00,  7.57it/s]
FOLD 0
Metric     CE Loss  KL wrt Orig
Model                          
llama_7B  4.251328     2.137371
Running fold 1
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:29,  1.05it/s]  6%|▋         | 2/32 [00:02<00:32,  1.10s/it]  9%|▉         | 3/32 [00:03<00:34,  1.18s/it] 12%|█▎        | 4/32 [00:04<00:33,  1.19s/it] 16%|█▌        | 5/32 [00:05<00:33,  1.23s/it] 19%|█▉        | 6/32 [00:07<00:32,  1.26s/it] 22%|██▏       | 7/32 [00:08<00:31,  1.27s/it] 25%|██▌       | 8/32 [00:09<00:30,  1.26s/it] 28%|██▊       | 9/32 [00:11<00:28,  1.26s/it] 31%|███▏      | 10/32 [00:12<00:27,  1.26s/it] 34%|███▍      | 11/32 [00:13<00:26,  1.24s/it] 38%|███▊      | 12/32 [00:14<00:24,  1.22s/it] 41%|████      | 13/32 [00:15<00:23,  1.21s/it] 44%|████▍     | 14/32 [00:17<00:21,  1.21s/it] 47%|████▋     | 15/32 [00:18<00:20,  1.21s/it] 50%|█████     | 16/32 [00:19<00:19,  1.22s/it] 53%|█████▎    | 17/32 [00:20<00:18,  1.22s/it] 56%|█████▋    | 18/32 [00:21<00:17,  1.22s/it] 59%|█████▉    | 19/32 [00:23<00:16,  1.25s/it] 62%|██████▎   | 20/32 [00:24<00:15,  1.29s/it] 66%|██████▌   | 21/32 [00:25<00:14,  1.29s/it] 69%|██████▉   | 22/32 [00:27<00:12,  1.29s/it] 72%|███████▏  | 23/32 [00:28<00:11,  1.30s/it] 75%|███████▌  | 24/32 [00:29<00:10,  1.32s/it] 78%|███████▊  | 25/32 [00:31<00:09,  1.32s/it] 81%|████████▏ | 26/32 [00:32<00:07,  1.31s/it] 84%|████████▍ | 27/32 [00:33<00:06,  1.32s/it] 88%|████████▊ | 28/32 [00:35<00:05,  1.32s/it] 91%|█████████ | 29/32 [00:36<00:03,  1.32s/it] 94%|█████████▍| 30/32 [00:37<00:02,  1.31s/it] 97%|█████████▋| 31/32 [00:39<00:01,  1.31s/it]100%|██████████| 32/32 [00:40<00:00,  1.36s/it]100%|██████████| 32/32 [00:40<00:00,  1.27s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
[[0.666 0.672 0.662 ... 0.668 0.662 0.67 ]
 [0.662 0.662 0.659 ... 0.677 0.666 0.663]
 [0.668 0.67  0.68  ... 0.661 0.665 0.671]
 ...
 [0.758 0.75  0.674 ... 0.716 0.694 0.677]
 [0.749 0.671 0.686 ... 0.674 0.762 0.76 ]
 [0.765 0.805 0.748 ... 0.743 0.787 0.775]]
Heads intervened:  [(8, 16), (11, 16), (11, 17), (12, 4), (13, 8), (13, 10), (13, 16), (13, 21), (16, 17), (16, 26), (16, 30), (17, 13), (17, 19), (17, 29), (18, 29), (19, 13), (19, 17), (19, 31), (20, 22), (20, 30), (22, 16), (23, 3), (23, 12), (31, 6)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 257.94it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-30ec7b2da7888791.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-4e53eea82b0ecfef.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  2%|▏         | 2/100 [00:00<00:06, 16.11it/s]  4%|▍         | 4/100 [00:00<00:05, 17.23it/s]  6%|▌         | 6/100 [00:00<00:05, 17.63it/s]  8%|▊         | 8/100 [00:00<00:05, 17.82it/s] 10%|█         | 10/100 [00:00<00:05, 17.93it/s] 12%|█▏        | 12/100 [00:00<00:04, 17.99it/s] 14%|█▍        | 14/100 [00:00<00:04, 18.04it/s] 16%|█▌        | 16/100 [00:00<00:04, 18.07it/s] 18%|█▊        | 18/100 [00:01<00:04, 18.10it/s] 20%|██        | 20/100 [00:01<00:04, 18.10it/s] 22%|██▏       | 22/100 [00:01<00:04, 18.05it/s] 24%|██▍       | 24/100 [00:01<00:04, 17.93it/s] 26%|██▌       | 26/100 [00:01<00:04, 17.99it/s] 28%|██▊       | 28/100 [00:01<00:03, 18.03it/s] 30%|███       | 30/100 [00:01<00:03, 18.07it/s] 32%|███▏      | 32/100 [00:01<00:03, 18.09it/s] 34%|███▍      | 34/100 [00:01<00:03, 18.10it/s] 36%|███▌      | 36/100 [00:02<00:03, 18.12it/s] 38%|███▊      | 38/100 [00:02<00:03, 18.11it/s] 40%|████      | 40/100 [00:02<00:03, 18.12it/s] 42%|████▏     | 42/100 [00:02<00:03, 18.12it/s] 44%|████▍     | 44/100 [00:02<00:03, 18.12it/s] 46%|████▌     | 46/100 [00:02<00:02, 18.13it/s] 48%|████▊     | 48/100 [00:02<00:02, 18.13it/s] 50%|█████     | 50/100 [00:02<00:02, 18.14it/s] 52%|█████▏    | 52/100 [00:02<00:02, 18.14it/s] 54%|█████▍    | 54/100 [00:02<00:02, 18.14it/s] 56%|█████▌    | 56/100 [00:03<00:02, 18.13it/s] 58%|█████▊    | 58/100 [00:03<00:02, 18.13it/s] 60%|██████    | 60/100 [00:03<00:02, 17.98it/s] 62%|██████▏   | 62/100 [00:03<00:02, 17.96it/s] 64%|██████▍   | 64/100 [00:03<00:01, 18.01it/s] 66%|██████▌   | 66/100 [00:03<00:01, 18.06it/s] 68%|██████▊   | 68/100 [00:03<00:01, 18.08it/s] 70%|███████   | 70/100 [00:03<00:01, 18.10it/s] 72%|███████▏  | 72/100 [00:03<00:01, 18.11it/s] 74%|███████▍  | 74/100 [00:04<00:01, 18.11it/s] 76%|███████▌  | 76/100 [00:04<00:01, 18.12it/s] 78%|███████▊  | 78/100 [00:04<00:01, 18.12it/s] 80%|████████  | 80/100 [00:04<00:01, 18.13it/s] 82%|████████▏ | 82/100 [00:04<00:00, 18.13it/s] 84%|████████▍ | 84/100 [00:04<00:00, 18.13it/s] 86%|████████▌ | 86/100 [00:04<00:00, 18.14it/s] 88%|████████▊ | 88/100 [00:04<00:00, 18.13it/s] 90%|█████████ | 90/100 [00:04<00:00, 18.14it/s] 92%|█████████▏| 92/100 [00:05<00:00, 18.13it/s] 94%|█████████▍| 94/100 [00:05<00:00, 18.13it/s] 96%|█████████▌| 96/100 [00:05<00:00, 18.14it/s] 98%|█████████▊| 98/100 [00:05<00:00, 17.96it/s]100%|██████████| 100/100 [00:05<00:00, 18.01it/s]100%|██████████| 100/100 [00:05<00:00, 18.05it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 356.45it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-14295f39edd20556.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-10ca04ba0c7bb427.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:16,  6.00it/s]  2%|▏         | 2/100 [00:00<00:14,  6.91it/s]  3%|▎         | 3/100 [00:00<00:14,  6.79it/s]  4%|▍         | 4/100 [00:00<00:13,  6.92it/s]  5%|▌         | 5/100 [00:00<00:13,  6.99it/s]  6%|▌         | 6/100 [00:00<00:13,  6.94it/s]  7%|▋         | 7/100 [00:01<00:13,  6.78it/s]  8%|▊         | 8/100 [00:01<00:13,  6.74it/s]  9%|▉         | 9/100 [00:01<00:13,  6.98it/s] 10%|█         | 10/100 [00:01<00:12,  7.00it/s] 11%|█         | 11/100 [00:01<00:12,  7.11it/s] 12%|█▏        | 12/100 [00:01<00:12,  6.93it/s] 13%|█▎        | 13/100 [00:01<00:12,  6.98it/s] 14%|█▍        | 14/100 [00:02<00:12,  7.06it/s] 15%|█▌        | 15/100 [00:02<00:11,  7.15it/s] 16%|█▌        | 16/100 [00:02<00:11,  7.23it/s] 17%|█▋        | 17/100 [00:02<00:11,  7.12it/s] 18%|█▊        | 18/100 [00:02<00:11,  7.03it/s] 19%|█▉        | 19/100 [00:02<00:11,  7.07it/s] 20%|██        | 20/100 [00:02<00:11,  7.11it/s] 21%|██        | 21/100 [00:03<00:11,  7.03it/s] 22%|██▏       | 22/100 [00:03<00:10,  7.11it/s] 23%|██▎       | 23/100 [00:03<00:10,  7.22it/s] 24%|██▍       | 24/100 [00:03<00:10,  7.06it/s] 25%|██▌       | 25/100 [00:03<00:10,  7.13it/s] 26%|██▌       | 26/100 [00:03<00:10,  7.26it/s] 27%|██▋       | 27/100 [00:03<00:09,  7.39it/s] 28%|██▊       | 28/100 [00:03<00:09,  7.38it/s] 29%|██▉       | 29/100 [00:04<00:09,  7.40it/s] 30%|███       | 30/100 [00:04<00:09,  7.32it/s] 31%|███       | 31/100 [00:04<00:09,  7.19it/s] 32%|███▏      | 32/100 [00:04<00:09,  7.28it/s] 33%|███▎      | 33/100 [00:04<00:09,  7.10it/s] 34%|███▍      | 34/100 [00:04<00:09,  7.15it/s] 35%|███▌      | 35/100 [00:04<00:09,  7.12it/s] 36%|███▌      | 36/100 [00:05<00:08,  7.22it/s] 37%|███▋      | 37/100 [00:05<00:08,  7.37it/s] 38%|███▊      | 38/100 [00:05<00:08,  7.47it/s] 39%|███▉      | 39/100 [00:05<00:08,  7.46it/s] 40%|████      | 40/100 [00:05<00:08,  7.41it/s] 41%|████      | 41/100 [00:05<00:08,  7.16it/s] 42%|████▏     | 42/100 [00:05<00:08,  7.25it/s] 43%|████▎     | 43/100 [00:06<00:07,  7.18it/s] 44%|████▍     | 44/100 [00:06<00:07,  7.01it/s] 45%|████▌     | 45/100 [00:06<00:08,  6.86it/s] 46%|████▌     | 46/100 [00:06<00:07,  6.86it/s] 47%|████▋     | 47/100 [00:06<00:07,  7.11it/s] 48%|████▊     | 48/100 [00:06<00:07,  7.29it/s] 49%|████▉     | 49/100 [00:06<00:07,  7.12it/s] 50%|█████     | 50/100 [00:07<00:06,  7.22it/s] 51%|█████     | 51/100 [00:07<00:06,  7.25it/s] 52%|█████▏    | 52/100 [00:07<00:06,  7.35it/s] 53%|█████▎    | 53/100 [00:07<00:06,  7.39it/s] 54%|█████▍    | 54/100 [00:07<00:06,  7.29it/s] 55%|█████▌    | 55/100 [00:07<00:06,  7.08it/s] 56%|█████▌    | 56/100 [00:07<00:06,  7.19it/s] 57%|█████▋    | 57/100 [00:07<00:06,  7.10it/s] 58%|█████▊    | 58/100 [00:08<00:06,  6.94it/s] 59%|█████▉    | 59/100 [00:08<00:05,  6.88it/s] 60%|██████    | 60/100 [00:08<00:05,  6.82it/s] 61%|██████    | 61/100 [00:08<00:05,  6.84it/s] 62%|██████▏   | 62/100 [00:08<00:05,  6.92it/s] 63%|██████▎   | 63/100 [00:08<00:05,  7.03it/s] 64%|██████▍   | 64/100 [00:09<00:05,  7.13it/s] 65%|██████▌   | 65/100 [00:09<00:05,  7.00it/s] 66%|██████▌   | 66/100 [00:09<00:04,  7.13it/s] 67%|██████▋   | 67/100 [00:09<00:04,  7.09it/s] 68%|██████▊   | 68/100 [00:09<00:04,  7.10it/s] 69%|██████▉   | 69/100 [00:09<00:04,  6.89it/s] 70%|███████   | 70/100 [00:09<00:04,  7.05it/s] 71%|███████   | 71/100 [00:10<00:04,  6.86it/s] 72%|███████▏  | 72/100 [00:10<00:03,  7.01it/s] 73%|███████▎  | 73/100 [00:10<00:03,  7.15it/s] 74%|███████▍  | 74/100 [00:10<00:03,  7.04it/s] 75%|███████▌  | 75/100 [00:10<00:03,  7.22it/s] 76%|███████▌  | 76/100 [00:10<00:03,  7.03it/s] 77%|███████▋  | 77/100 [00:10<00:03,  7.05it/s] 78%|███████▊  | 78/100 [00:11<00:03,  6.87it/s] 79%|███████▉  | 79/100 [00:11<00:02,  7.04it/s] 80%|████████  | 80/100 [00:11<00:02,  7.05it/s] 81%|████████  | 81/100 [00:11<00:02,  7.04it/s] 82%|████████▏ | 82/100 [00:11<00:02,  6.98it/s] 83%|████████▎ | 83/100 [00:11<00:02,  7.14it/s] 84%|████████▍ | 84/100 [00:11<00:02,  7.14it/s] 85%|████████▌ | 85/100 [00:11<00:02,  7.20it/s] 86%|████████▌ | 86/100 [00:12<00:01,  7.29it/s] 87%|████████▋ | 87/100 [00:12<00:01,  7.30it/s] 88%|████████▊ | 88/100 [00:12<00:01,  7.26it/s] 89%|████████▉ | 89/100 [00:12<00:01,  7.16it/s] 90%|█████████ | 90/100 [00:12<00:01,  7.04it/s] 91%|█████████ | 91/100 [00:12<00:01,  7.08it/s] 92%|█████████▏| 92/100 [00:12<00:01,  7.03it/s] 93%|█████████▎| 93/100 [00:13<00:00,  7.11it/s] 94%|█████████▍| 94/100 [00:13<00:00,  6.99it/s] 95%|█████████▌| 95/100 [00:13<00:00,  6.91it/s] 96%|█████████▌| 96/100 [00:13<00:00,  6.97it/s] 97%|█████████▋| 97/100 [00:13<00:00,  6.92it/s] 98%|█████████▊| 98/100 [00:13<00:00,  6.90it/s] 99%|█████████▉| 99/100 [00:13<00:00,  6.90it/s]100%|██████████| 100/100 [00:14<00:00,  6.88it/s]100%|██████████| 100/100 [00:14<00:00,  7.08it/s]
FOLD 1
Metric     CE Loss  KL wrt Orig
Model                          
llama_7B  4.895254     2.819874
[4.57329102 2.47862272]
2023-12-04 01:44:47.811519: I tensorflow/core/util/port.cc:110] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2023-12-04 01:44:47.860715: I tensorflow/core/platform/cpu_feature_guard.cc:182] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-12-04 01:44:48.614355: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Could not find TensorRT
Found cached dataset truthful_qa (/home/elicer/.cache/huggingface/datasets/truthful_qa/multiple_choice/1.1.0/63502f6bc6ee493830ce0843991b028d0ab568d221896b2ee3b8a5dfdaa9d7f4)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 368.15it/s]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:00<00:00,  5.15it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  6.21it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  6.02it/s]
head_wise_activation_length:(11012, 32, 4096)
labels_shape:(11012,)
seperated_head_activation shape:11013
Running fold 0
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:28,  1.08it/s]  6%|▋         | 2/32 [00:01<00:28,  1.07it/s]  9%|▉         | 3/32 [00:02<00:26,  1.10it/s] 12%|█▎        | 4/32 [00:03<00:24,  1.12it/s] 16%|█▌        | 5/32 [00:04<00:24,  1.12it/s] 19%|█▉        | 6/32 [00:05<00:23,  1.10it/s] 22%|██▏       | 7/32 [00:06<00:22,  1.10it/s] 25%|██▌       | 8/32 [00:07<00:22,  1.07it/s] 28%|██▊       | 9/32 [00:08<00:22,  1.04it/s] 31%|███▏      | 10/32 [00:09<00:21,  1.01it/s] 34%|███▍      | 11/32 [00:10<00:21,  1.02s/it] 38%|███▊      | 12/32 [00:11<00:20,  1.02s/it] 41%|████      | 13/32 [00:12<00:19,  1.03s/it] 44%|████▍     | 14/32 [00:13<00:19,  1.06s/it] 47%|████▋     | 15/32 [00:14<00:17,  1.05s/it] 50%|█████     | 16/32 [00:15<00:16,  1.05s/it] 53%|█████▎    | 17/32 [00:16<00:15,  1.06s/it] 56%|█████▋    | 18/32 [00:17<00:15,  1.08s/it] 59%|█████▉    | 19/32 [00:19<00:14,  1.10s/it] 62%|██████▎   | 20/32 [00:20<00:13,  1.12s/it] 66%|██████▌   | 21/32 [00:21<00:12,  1.13s/it] 69%|██████▉   | 22/32 [00:22<00:11,  1.12s/it] 72%|███████▏  | 23/32 [00:23<00:10,  1.14s/it] 75%|███████▌  | 24/32 [00:25<00:09,  1.19s/it] 78%|███████▊  | 25/32 [00:26<00:08,  1.18s/it] 81%|████████▏ | 26/32 [00:27<00:07,  1.17s/it] 84%|████████▍ | 27/32 [00:28<00:05,  1.20s/it] 88%|████████▊ | 28/32 [00:29<00:04,  1.15s/it] 91%|█████████ | 29/32 [00:30<00:03,  1.15s/it] 94%|█████████▍| 30/32 [00:31<00:02,  1.14s/it] 97%|█████████▋| 31/32 [00:33<00:01,  1.15s/it]100%|██████████| 32/32 [00:34<00:00,  1.25s/it]100%|██████████| 32/32 [00:34<00:00,  1.08s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
/home/elicer/honest_llama/validation/../TruthfulQA/truthfulqa/metrics.py:284: FutureWarning: load_metric is deprecated and will be removed in the next major version of datasets. Use 'evaluate.load' instead, from the new library 🤗 Evaluate: https://huggingface.co/docs/evaluate
  bleurt = load_metric("bleurt", cache_dir=cache_dir)
[[0.651 0.665 0.645 ... 0.646 0.647 0.652]
 [0.659 0.644 0.645 ... 0.648 0.658 0.656]
 [0.651 0.657 0.685 ... 0.637 0.648 0.667]
 ...
 [0.765 0.762 0.657 ... 0.73  0.704 0.674]
 [0.748 0.678 0.696 ... 0.663 0.769 0.786]
 [0.775 0.815 0.74  ... 0.697 0.809 0.79 ]]
Heads intervened:  [(8, 16), (12, 4), (12, 15), (13, 8), (13, 16), (14, 2), (14, 20), (15, 28), (16, 17), (16, 26), (16, 30), (17, 4), (17, 9), (17, 13), (17, 17), (17, 29), (18, 29), (19, 13), (19, 17), (19, 31), (20, 22), (20, 30), (21, 18), (22, 16), (22, 23), (22, 30), (23, 3), (23, 4), (23, 7), (23, 13), (25, 15), (31, 1), (31, 3), (31, 6), (31, 25), (31, 30)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
2023-12-04 01:45:39.638733: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1635] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 24961 MB memory:  -> device: 0, name: NVIDIA A100 80GB PCIe MIG 3g.40gb, pci bus id: 0000:65:00.0, compute capability: 8.0
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 297.62it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-ec0cf83741fdb3e8.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-d31e6c0c76fafb4d.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:01<01:42,  1.04s/it]  3%|▎         | 3/100 [00:01<00:30,  3.20it/s]  5%|▌         | 5/100 [00:01<00:17,  5.51it/s]  7%|▋         | 7/100 [00:01<00:12,  7.74it/s]  9%|▉         | 9/100 [00:01<00:09,  9.78it/s] 11%|█         | 11/100 [00:01<00:07, 11.52it/s] 13%|█▎        | 13/100 [00:01<00:06, 12.96it/s] 15%|█▌        | 15/100 [00:01<00:06, 14.09it/s] 17%|█▋        | 17/100 [00:01<00:05, 14.95it/s] 19%|█▉        | 19/100 [00:02<00:05, 15.61it/s] 21%|██        | 21/100 [00:02<00:04, 16.09it/s] 23%|██▎       | 23/100 [00:02<00:04, 16.43it/s] 25%|██▌       | 25/100 [00:02<00:04, 16.68it/s] 27%|██▋       | 27/100 [00:02<00:04, 16.85it/s] 29%|██▉       | 29/100 [00:02<00:04, 16.98it/s] 31%|███       | 31/100 [00:02<00:04, 17.07it/s] 33%|███▎      | 33/100 [00:02<00:03, 17.13it/s] 35%|███▌      | 35/100 [00:03<00:03, 17.15it/s] 37%|███▋      | 37/100 [00:03<00:03, 17.20it/s] 39%|███▉      | 39/100 [00:03<00:03, 17.23it/s] 41%|████      | 41/100 [00:03<00:03, 17.25it/s] 43%|████▎     | 43/100 [00:03<00:03, 17.27it/s] 45%|████▌     | 45/100 [00:03<00:03, 17.27it/s] 47%|████▋     | 47/100 [00:03<00:03, 17.27it/s] 49%|████▉     | 49/100 [00:03<00:02, 17.28it/s] 51%|█████     | 51/100 [00:03<00:02, 17.28it/s] 53%|█████▎    | 53/100 [00:04<00:02, 17.30it/s] 55%|█████▌    | 55/100 [00:04<00:02, 17.30it/s] 57%|█████▋    | 57/100 [00:04<00:02, 17.31it/s] 59%|█████▉    | 59/100 [00:04<00:02, 17.30it/s] 61%|██████    | 61/100 [00:04<00:02, 17.31it/s] 63%|██████▎   | 63/100 [00:04<00:02, 17.31it/s] 65%|██████▌   | 65/100 [00:04<00:02, 17.30it/s] 67%|██████▋   | 67/100 [00:04<00:01, 17.30it/s] 69%|██████▉   | 69/100 [00:04<00:01, 17.30it/s] 71%|███████   | 71/100 [00:05<00:01, 17.31it/s] 73%|███████▎  | 73/100 [00:05<00:01, 17.27it/s] 75%|███████▌  | 75/100 [00:05<00:01, 17.29it/s] 77%|███████▋  | 77/100 [00:05<00:01, 17.29it/s] 79%|███████▉  | 79/100 [00:05<00:01, 17.30it/s] 81%|████████  | 81/100 [00:05<00:01, 17.30it/s] 83%|████████▎ | 83/100 [00:05<00:00, 17.30it/s] 85%|████████▌ | 85/100 [00:05<00:00, 17.21it/s] 87%|████████▋ | 87/100 [00:06<00:00, 17.23it/s] 89%|████████▉ | 89/100 [00:06<00:00, 17.25it/s] 91%|█████████ | 91/100 [00:06<00:00, 17.27it/s] 93%|█████████▎| 93/100 [00:06<00:00, 17.27it/s] 95%|█████████▌| 95/100 [00:06<00:00, 17.29it/s] 97%|█████████▋| 97/100 [00:06<00:00, 17.29it/s] 99%|█████████▉| 99/100 [00:06<00:00, 17.29it/s]100%|██████████| 100/100 [00:06<00:00, 14.78it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 330.31it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-1939fcc1eeebdaa7.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-785bb4b6f2089589.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:17,  5.58it/s]  2%|▏         | 2/100 [00:00<00:15,  6.14it/s]  3%|▎         | 3/100 [00:00<00:14,  6.70it/s]  4%|▍         | 4/100 [00:00<00:14,  6.76it/s]  5%|▌         | 5/100 [00:00<00:13,  7.03it/s]  6%|▌         | 6/100 [00:00<00:13,  7.07it/s]  7%|▋         | 7/100 [00:01<00:12,  7.16it/s]  8%|▊         | 8/100 [00:01<00:13,  7.03it/s]  9%|▉         | 9/100 [00:01<00:12,  7.12it/s] 10%|█         | 10/100 [00:01<00:12,  7.27it/s] 11%|█         | 11/100 [00:01<00:12,  7.37it/s] 12%|█▏        | 12/100 [00:01<00:11,  7.43it/s] 13%|█▎        | 13/100 [00:01<00:12,  7.07it/s] 14%|█▍        | 14/100 [00:01<00:11,  7.22it/s] 15%|█▌        | 15/100 [00:02<00:11,  7.11it/s] 16%|█▌        | 16/100 [00:02<00:11,  7.04it/s] 17%|█▋        | 17/100 [00:02<00:12,  6.82it/s] 18%|█▊        | 18/100 [00:02<00:11,  7.03it/s] 19%|█▉        | 19/100 [00:02<00:11,  7.03it/s] 20%|██        | 20/100 [00:02<00:11,  7.19it/s] 21%|██        | 21/100 [00:02<00:11,  7.10it/s] 22%|██▏       | 22/100 [00:03<00:10,  7.24it/s] 23%|██▎       | 23/100 [00:03<00:10,  7.04it/s] 24%|██▍       | 24/100 [00:03<00:10,  7.14it/s] 25%|██▌       | 25/100 [00:03<00:10,  7.26it/s] 26%|██▌       | 26/100 [00:03<00:10,  7.36it/s] 27%|██▋       | 27/100 [00:03<00:10,  7.20it/s] 28%|██▊       | 28/100 [00:03<00:09,  7.33it/s] 29%|██▉       | 29/100 [00:04<00:09,  7.34it/s] 30%|███       | 30/100 [00:04<00:09,  7.15it/s] 31%|███       | 31/100 [00:04<00:09,  7.20it/s] 32%|███▏      | 32/100 [00:04<00:09,  7.06it/s] 33%|███▎      | 33/100 [00:04<00:09,  7.07it/s] 34%|███▍      | 34/100 [00:04<00:09,  7.17it/s] 35%|███▌      | 35/100 [00:04<00:09,  7.07it/s] 36%|███▌      | 36/100 [00:05<00:09,  7.08it/s] 37%|███▋      | 37/100 [00:05<00:08,  7.22it/s] 38%|███▊      | 38/100 [00:05<00:08,  7.13it/s] 39%|███▉      | 39/100 [00:05<00:08,  7.16it/s] 40%|████      | 40/100 [00:05<00:08,  7.08it/s] 41%|████      | 41/100 [00:05<00:08,  7.22it/s] 42%|████▏     | 42/100 [00:05<00:07,  7.31it/s] 43%|████▎     | 43/100 [00:06<00:07,  7.39it/s] 44%|████▍     | 44/100 [00:06<00:07,  7.08it/s] 45%|████▌     | 45/100 [00:06<00:07,  6.93it/s] 46%|████▌     | 46/100 [00:06<00:07,  7.09it/s] 47%|████▋     | 47/100 [00:06<00:07,  6.90it/s] 48%|████▊     | 48/100 [00:06<00:07,  7.00it/s] 49%|████▉     | 49/100 [00:06<00:07,  7.05it/s] 50%|█████     | 50/100 [00:07<00:07,  6.95it/s] 51%|█████     | 51/100 [00:07<00:06,  7.12it/s] 52%|█████▏    | 52/100 [00:07<00:06,  7.00it/s] 53%|█████▎    | 53/100 [00:07<00:06,  7.17it/s] 54%|█████▍    | 54/100 [00:07<00:06,  7.16it/s] 55%|█████▌    | 55/100 [00:07<00:06,  7.29it/s] 56%|█████▌    | 56/100 [00:07<00:06,  7.05it/s] 57%|█████▋    | 57/100 [00:08<00:05,  7.21it/s] 58%|█████▊    | 58/100 [00:08<00:06,  7.00it/s] 59%|█████▉    | 59/100 [00:08<00:05,  7.04it/s] 60%|██████    | 60/100 [00:08<00:05,  7.09it/s] 61%|██████    | 61/100 [00:08<00:05,  6.89it/s] 62%|██████▏   | 62/100 [00:08<00:05,  7.09it/s] 63%|██████▎   | 63/100 [00:08<00:05,  7.13it/s] 64%|██████▍   | 64/100 [00:09<00:05,  7.16it/s] 65%|██████▌   | 65/100 [00:09<00:04,  7.28it/s] 66%|██████▌   | 66/100 [00:09<00:04,  7.36it/s] 67%|██████▋   | 67/100 [00:09<00:04,  7.30it/s] 68%|██████▊   | 68/100 [00:09<00:04,  7.39it/s] 69%|██████▉   | 69/100 [00:09<00:04,  7.46it/s] 70%|███████   | 70/100 [00:09<00:04,  7.47it/s] 71%|███████   | 71/100 [00:09<00:03,  7.44it/s] 72%|███████▏  | 72/100 [00:10<00:03,  7.44it/s] 73%|███████▎  | 73/100 [00:10<00:03,  7.28it/s] 74%|███████▍  | 74/100 [00:10<00:03,  7.31it/s] 75%|███████▌  | 75/100 [00:10<00:03,  7.21it/s] 76%|███████▌  | 76/100 [00:10<00:03,  7.32it/s] 77%|███████▋  | 77/100 [00:10<00:03,  7.29it/s] 78%|███████▊  | 78/100 [00:10<00:03,  7.22it/s] 79%|███████▉  | 79/100 [00:11<00:02,  7.31it/s] 80%|████████  | 80/100 [00:11<00:02,  7.31it/s] 81%|████████  | 81/100 [00:11<00:02,  7.25it/s] 82%|████████▏ | 82/100 [00:11<00:02,  7.08it/s] 83%|████████▎ | 83/100 [00:11<00:02,  7.18it/s] 84%|████████▍ | 84/100 [00:11<00:02,  6.97it/s] 85%|████████▌ | 85/100 [00:11<00:02,  7.14it/s] 86%|████████▌ | 86/100 [00:12<00:01,  7.06it/s] 87%|████████▋ | 87/100 [00:12<00:01,  6.92it/s] 88%|████████▊ | 88/100 [00:12<00:01,  7.11it/s] 89%|████████▉ | 89/100 [00:12<00:01,  6.90it/s] 90%|█████████ | 90/100 [00:12<00:01,  7.10it/s] 91%|█████████ | 91/100 [00:12<00:01,  7.24it/s] 92%|█████████▏| 92/100 [00:12<00:01,  7.11it/s] 93%|█████████▎| 93/100 [00:13<00:01,  6.96it/s] 94%|█████████▍| 94/100 [00:13<00:00,  7.12it/s] 95%|█████████▌| 95/100 [00:13<00:00,  7.21it/s] 96%|█████████▌| 96/100 [00:13<00:00,  7.32it/s] 97%|█████████▋| 97/100 [00:13<00:00,  7.00it/s] 98%|█████████▊| 98/100 [00:13<00:00,  7.17it/s] 99%|█████████▉| 99/100 [00:13<00:00,  7.29it/s]100%|██████████| 100/100 [00:13<00:00,  7.32it/s]100%|██████████| 100/100 [00:13<00:00,  7.14it/s]
FOLD 0
Metric     CE Loss  KL wrt Orig
Model                          
llama_7B  4.795723     2.708896
Running fold 1
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:28,  1.09it/s]  6%|▋         | 2/32 [00:02<00:31,  1.07s/it]  9%|▉         | 3/32 [00:03<00:33,  1.14s/it] 12%|█▎        | 4/32 [00:04<00:32,  1.16s/it] 16%|█▌        | 5/32 [00:05<00:32,  1.19s/it] 19%|█▉        | 6/32 [00:07<00:31,  1.22s/it] 22%|██▏       | 7/32 [00:08<00:30,  1.24s/it] 25%|██▌       | 8/32 [00:09<00:29,  1.23s/it] 28%|██▊       | 9/32 [00:10<00:28,  1.23s/it] 31%|███▏      | 10/32 [00:11<00:27,  1.23s/it] 34%|███▍      | 11/32 [00:13<00:25,  1.22s/it] 38%|███▊      | 12/32 [00:14<00:23,  1.19s/it] 41%|████      | 13/32 [00:15<00:22,  1.19s/it] 44%|████▍     | 14/32 [00:16<00:21,  1.18s/it] 47%|████▋     | 15/32 [00:17<00:20,  1.18s/it] 50%|█████     | 16/32 [00:19<00:19,  1.19s/it] 53%|█████▎    | 17/32 [00:20<00:17,  1.19s/it] 56%|█████▋    | 18/32 [00:21<00:16,  1.18s/it] 59%|█████▉    | 19/32 [00:22<00:15,  1.21s/it] 62%|██████▎   | 20/32 [00:23<00:14,  1.24s/it] 66%|██████▌   | 21/32 [00:25<00:13,  1.25s/it] 69%|██████▉   | 22/32 [00:26<00:12,  1.25s/it] 72%|███████▏  | 23/32 [00:27<00:11,  1.26s/it] 75%|███████▌  | 24/32 [00:29<00:10,  1.28s/it] 78%|███████▊  | 25/32 [00:30<00:08,  1.28s/it] 81%|████████▏ | 26/32 [00:31<00:07,  1.27s/it] 84%|████████▍ | 27/32 [00:32<00:06,  1.28s/it] 88%|████████▊ | 28/32 [00:34<00:05,  1.27s/it] 91%|█████████ | 29/32 [00:35<00:03,  1.29s/it] 94%|█████████▍| 30/32 [00:36<00:02,  1.28s/it] 97%|█████████▋| 31/32 [00:38<00:01,  1.28s/it]100%|██████████| 32/32 [00:39<00:00,  1.33s/it]100%|██████████| 32/32 [00:39<00:00,  1.23s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
[[0.666 0.672 0.662 ... 0.668 0.662 0.67 ]
 [0.662 0.662 0.659 ... 0.677 0.666 0.663]
 [0.668 0.67  0.68  ... 0.661 0.665 0.671]
 ...
 [0.758 0.75  0.674 ... 0.716 0.694 0.677]
 [0.749 0.671 0.686 ... 0.674 0.762 0.76 ]
 [0.765 0.805 0.748 ... 0.743 0.787 0.775]]
Heads intervened:  [(8, 16), (11, 16), (11, 17), (12, 4), (12, 22), (13, 8), (13, 10), (13, 16), (13, 21), (14, 2), (15, 28), (16, 4), (16, 17), (16, 26), (16, 30), (17, 4), (17, 13), (17, 19), (17, 29), (18, 29), (19, 13), (19, 17), (19, 31), (20, 22), (20, 30), (22, 16), (23, 3), (23, 12), (23, 25), (26, 13), (27, 3), (27, 7), (30, 4), (30, 18), (31, 1), (31, 6)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 252.08it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-30ec7b2da7888791.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-4e53eea82b0ecfef.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  2%|▏         | 2/100 [00:00<00:06, 15.22it/s]  4%|▍         | 4/100 [00:00<00:05, 16.18it/s]  6%|▌         | 6/100 [00:00<00:05, 16.48it/s]  8%|▊         | 8/100 [00:00<00:05, 16.64it/s] 10%|█         | 10/100 [00:00<00:05, 16.73it/s] 12%|█▏        | 12/100 [00:00<00:05, 16.79it/s] 14%|█▍        | 14/100 [00:00<00:05, 16.83it/s] 16%|█▌        | 16/100 [00:00<00:04, 16.84it/s] 18%|█▊        | 18/100 [00:01<00:04, 16.86it/s] 20%|██        | 20/100 [00:01<00:04, 16.87it/s] 22%|██▏       | 22/100 [00:01<00:04, 16.88it/s] 24%|██▍       | 24/100 [00:01<00:04, 16.89it/s] 26%|██▌       | 26/100 [00:01<00:04, 16.88it/s] 28%|██▊       | 28/100 [00:01<00:04, 16.88it/s] 30%|███       | 30/100 [00:01<00:04, 16.89it/s] 32%|███▏      | 32/100 [00:01<00:04, 16.89it/s] 34%|███▍      | 34/100 [00:02<00:03, 16.89it/s] 36%|███▌      | 36/100 [00:02<00:03, 16.90it/s] 38%|███▊      | 38/100 [00:02<00:03, 16.90it/s] 40%|████      | 40/100 [00:02<00:03, 16.65it/s] 42%|████▏     | 42/100 [00:02<00:03, 16.29it/s] 44%|████▍     | 44/100 [00:02<00:03, 16.45it/s] 46%|████▌     | 46/100 [00:02<00:03, 16.58it/s] 48%|████▊     | 48/100 [00:02<00:03, 16.68it/s] 50%|█████     | 50/100 [00:02<00:03, 16.64it/s] 52%|█████▏    | 52/100 [00:03<00:02, 16.71it/s] 54%|█████▍    | 54/100 [00:03<00:02, 16.77it/s] 56%|█████▌    | 56/100 [00:03<00:02, 16.80it/s] 58%|█████▊    | 58/100 [00:03<00:02, 16.84it/s] 60%|██████    | 60/100 [00:03<00:02, 16.86it/s] 62%|██████▏   | 62/100 [00:03<00:02, 16.87it/s] 64%|██████▍   | 64/100 [00:03<00:02, 16.89it/s] 66%|██████▌   | 66/100 [00:03<00:02, 16.90it/s] 68%|██████▊   | 68/100 [00:04<00:01, 16.90it/s] 70%|███████   | 70/100 [00:04<00:01, 16.90it/s] 72%|███████▏  | 72/100 [00:04<00:01, 16.91it/s] 74%|███████▍  | 74/100 [00:04<00:01, 16.91it/s] 76%|███████▌  | 76/100 [00:04<00:01, 16.86it/s] 78%|███████▊  | 78/100 [00:04<00:01, 16.87it/s] 80%|████████  | 80/100 [00:04<00:01, 16.88it/s] 82%|████████▏ | 82/100 [00:04<00:01, 16.90it/s] 84%|████████▍ | 84/100 [00:05<00:00, 16.90it/s] 86%|████████▌ | 86/100 [00:05<00:00, 16.90it/s] 88%|████████▊ | 88/100 [00:05<00:00, 16.90it/s] 90%|█████████ | 90/100 [00:05<00:00, 16.90it/s] 92%|█████████▏| 92/100 [00:05<00:00, 16.92it/s] 94%|█████████▍| 94/100 [00:05<00:00, 16.91it/s] 96%|█████████▌| 96/100 [00:05<00:00, 16.89it/s] 98%|█████████▊| 98/100 [00:05<00:00, 16.90it/s]100%|██████████| 100/100 [00:05<00:00, 16.90it/s]100%|██████████| 100/100 [00:05<00:00, 16.81it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 354.31it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-14295f39edd20556.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-10ca04ba0c7bb427.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:17,  5.75it/s]  2%|▏         | 2/100 [00:00<00:16,  6.06it/s]  3%|▎         | 3/100 [00:00<00:15,  6.39it/s]  4%|▍         | 4/100 [00:00<00:14,  6.58it/s]  5%|▌         | 5/100 [00:00<00:13,  6.80it/s]  6%|▌         | 6/100 [00:00<00:14,  6.68it/s]  7%|▋         | 7/100 [00:01<00:13,  6.69it/s]  8%|▊         | 8/100 [00:01<00:13,  6.78it/s]  9%|▉         | 9/100 [00:01<00:13,  6.98it/s] 10%|█         | 10/100 [00:01<00:12,  7.12it/s] 11%|█         | 11/100 [00:01<00:12,  6.87it/s] 12%|█▏        | 12/100 [00:01<00:12,  6.77it/s] 13%|█▎        | 13/100 [00:01<00:12,  6.81it/s] 14%|█▍        | 14/100 [00:02<00:12,  6.90it/s] 15%|█▌        | 15/100 [00:02<00:12,  6.96it/s] 16%|█▌        | 16/100 [00:02<00:12,  6.94it/s] 17%|█▋        | 17/100 [00:02<00:11,  7.11it/s] 18%|█▊        | 18/100 [00:02<00:11,  7.18it/s] 19%|█▉        | 19/100 [00:02<00:11,  7.08it/s] 20%|██        | 20/100 [00:02<00:11,  7.21it/s] 21%|██        | 21/100 [00:03<00:10,  7.22it/s] 22%|██▏       | 22/100 [00:03<00:10,  7.19it/s] 23%|██▎       | 23/100 [00:03<00:10,  7.03it/s] 24%|██▍       | 24/100 [00:03<00:11,  6.76it/s] 25%|██▌       | 25/100 [00:03<00:11,  6.73it/s] 26%|██▌       | 26/100 [00:03<00:10,  6.95it/s] 27%|██▋       | 27/100 [00:03<00:10,  6.80it/s] 28%|██▊       | 28/100 [00:04<00:10,  6.90it/s] 29%|██▉       | 29/100 [00:04<00:10,  6.86it/s] 30%|███       | 30/100 [00:04<00:10,  6.79it/s] 31%|███       | 31/100 [00:04<00:10,  6.89it/s] 32%|███▏      | 32/100 [00:04<00:09,  7.01it/s] 33%|███▎      | 33/100 [00:04<00:09,  7.03it/s] 34%|███▍      | 34/100 [00:04<00:09,  7.03it/s] 35%|███▌      | 35/100 [00:05<00:09,  6.98it/s] 36%|███▌      | 36/100 [00:05<00:09,  6.87it/s] 37%|███▋      | 37/100 [00:05<00:09,  6.91it/s] 38%|███▊      | 38/100 [00:05<00:09,  6.78it/s] 39%|███▉      | 39/100 [00:05<00:08,  6.87it/s] 40%|████      | 40/100 [00:05<00:08,  7.06it/s] 41%|████      | 41/100 [00:05<00:08,  7.19it/s] 42%|████▏     | 42/100 [00:06<00:08,  7.08it/s] 43%|████▎     | 43/100 [00:06<00:08,  7.00it/s] 44%|████▍     | 44/100 [00:06<00:08,  6.97it/s] 45%|████▌     | 45/100 [00:06<00:07,  6.93it/s] 46%|████▌     | 46/100 [00:06<00:07,  6.89it/s] 47%|████▋     | 47/100 [00:06<00:07,  6.83it/s] 48%|████▊     | 48/100 [00:06<00:07,  6.84it/s] 49%|████▉     | 49/100 [00:07<00:07,  6.78it/s] 50%|█████     | 50/100 [00:07<00:07,  6.74it/s] 51%|█████     | 51/100 [00:07<00:07,  6.65it/s] 52%|█████▏    | 52/100 [00:07<00:07,  6.69it/s] 53%|█████▎    | 53/100 [00:07<00:06,  6.87it/s] 54%|█████▍    | 54/100 [00:07<00:06,  6.92it/s] 55%|█████▌    | 55/100 [00:07<00:06,  6.91it/s] 56%|█████▌    | 56/100 [00:08<00:06,  7.07it/s] 57%|█████▋    | 57/100 [00:08<00:06,  6.99it/s] 58%|█████▊    | 58/100 [00:08<00:06,  6.94it/s] 59%|█████▉    | 59/100 [00:08<00:05,  6.86it/s] 60%|██████    | 60/100 [00:08<00:05,  6.79it/s] 61%|██████    | 61/100 [00:08<00:05,  6.80it/s] 62%|██████▏   | 62/100 [00:09<00:05,  6.69it/s] 63%|██████▎   | 63/100 [00:09<00:05,  6.74it/s] 64%|██████▍   | 64/100 [00:09<00:05,  6.53it/s] 65%|██████▌   | 65/100 [00:09<00:05,  6.65it/s] 66%|██████▌   | 66/100 [00:09<00:04,  6.85it/s] 67%|██████▋   | 67/100 [00:09<00:04,  7.03it/s] 68%|██████▊   | 68/100 [00:09<00:04,  7.10it/s] 69%|██████▉   | 69/100 [00:10<00:04,  7.17it/s] 70%|███████   | 70/100 [00:10<00:04,  7.09it/s] 71%|███████   | 71/100 [00:10<00:04,  6.89it/s] 72%|███████▏  | 72/100 [00:10<00:04,  6.81it/s] 73%|███████▎  | 73/100 [00:10<00:03,  6.79it/s] 74%|███████▍  | 74/100 [00:10<00:03,  6.83it/s] 75%|███████▌  | 75/100 [00:10<00:03,  6.74it/s] 76%|███████▌  | 76/100 [00:11<00:03,  6.86it/s] 77%|███████▋  | 77/100 [00:11<00:03,  7.04it/s] 78%|███████▊  | 78/100 [00:11<00:03,  6.90it/s] 79%|███████▉  | 79/100 [00:11<00:03,  6.76it/s] 80%|████████  | 80/100 [00:11<00:02,  6.79it/s] 81%|████████  | 81/100 [00:11<00:02,  6.82it/s] 82%|████████▏ | 82/100 [00:11<00:02,  6.86it/s] 83%|████████▎ | 83/100 [00:12<00:02,  6.97it/s] 84%|████████▍ | 84/100 [00:12<00:02,  6.93it/s] 85%|████████▌ | 85/100 [00:12<00:02,  7.03it/s] 86%|████████▌ | 86/100 [00:12<00:01,  7.16it/s] 87%|████████▋ | 87/100 [00:12<00:01,  7.05it/s] 88%|████████▊ | 88/100 [00:12<00:01,  7.04it/s] 89%|████████▉ | 89/100 [00:12<00:01,  6.98it/s] 90%|█████████ | 90/100 [00:13<00:01,  7.12it/s] 91%|█████████ | 91/100 [00:13<00:01,  7.05it/s] 92%|█████████▏| 92/100 [00:13<00:01,  7.00it/s] 93%|█████████▎| 93/100 [00:13<00:01,  6.82it/s] 94%|█████████▍| 94/100 [00:13<00:00,  6.93it/s] 95%|█████████▌| 95/100 [00:13<00:00,  6.84it/s] 96%|█████████▌| 96/100 [00:13<00:00,  6.88it/s] 97%|█████████▋| 97/100 [00:14<00:00,  6.99it/s] 98%|█████████▊| 98/100 [00:14<00:00,  6.80it/s] 99%|█████████▉| 99/100 [00:14<00:00,  6.80it/s]100%|██████████| 100/100 [00:14<00:00,  6.70it/s]100%|██████████| 100/100 [00:14<00:00,  6.89it/s]
FOLD 1
Metric     CE Loss  KL wrt Orig
Model                          
llama_7B  4.786953     2.735833
[4.79133789 2.72236462]
2023-12-04 01:47:19.141817: I tensorflow/core/util/port.cc:110] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2023-12-04 01:47:19.190739: I tensorflow/core/platform/cpu_feature_guard.cc:182] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-12-04 01:47:19.941532: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Could not find TensorRT
Found cached dataset truthful_qa (/home/elicer/.cache/huggingface/datasets/truthful_qa/multiple_choice/1.1.0/63502f6bc6ee493830ce0843991b028d0ab568d221896b2ee3b8a5dfdaa9d7f4)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 370.03it/s]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:00<00:00,  5.18it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  5.93it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  5.80it/s]
head_wise_activation_length:(11012, 32, 4096)
labels_shape:(11012,)
seperated_head_activation shape:11013
Running fold 0
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:28,  1.10it/s]  6%|▋         | 2/32 [00:01<00:27,  1.08it/s]  9%|▉         | 3/32 [00:02<00:26,  1.11it/s] 12%|█▎        | 4/32 [00:03<00:24,  1.13it/s] 16%|█▌        | 5/32 [00:04<00:23,  1.13it/s] 19%|█▉        | 6/32 [00:05<00:23,  1.11it/s] 22%|██▏       | 7/32 [00:06<00:22,  1.10it/s] 25%|██▌       | 8/32 [00:07<00:22,  1.07it/s] 28%|██▊       | 9/32 [00:08<00:22,  1.03it/s] 31%|███▏      | 10/32 [00:09<00:21,  1.00it/s] 34%|███▍      | 11/32 [00:10<00:21,  1.03s/it] 38%|███▊      | 12/32 [00:11<00:20,  1.03s/it] 41%|████      | 13/32 [00:12<00:19,  1.04s/it] 44%|████▍     | 14/32 [00:13<00:19,  1.06s/it] 47%|████▋     | 15/32 [00:14<00:17,  1.06s/it] 50%|█████     | 16/32 [00:15<00:16,  1.06s/it] 53%|█████▎    | 17/32 [00:16<00:15,  1.07s/it] 56%|█████▋    | 18/32 [00:18<00:15,  1.08s/it] 59%|█████▉    | 19/32 [00:19<00:14,  1.11s/it] 62%|██████▎   | 20/32 [00:20<00:13,  1.12s/it] 66%|██████▌   | 21/32 [00:21<00:12,  1.13s/it] 69%|██████▉   | 22/32 [00:22<00:11,  1.12s/it] 72%|███████▏  | 23/32 [00:23<00:10,  1.15s/it] 75%|███████▌  | 24/32 [00:25<00:09,  1.19s/it] 78%|███████▊  | 25/32 [00:26<00:08,  1.18s/it] 81%|████████▏ | 26/32 [00:27<00:06,  1.17s/it] 84%|████████▍ | 27/32 [00:28<00:05,  1.19s/it] 88%|████████▊ | 28/32 [00:29<00:04,  1.14s/it] 91%|█████████ | 29/32 [00:30<00:03,  1.15s/it] 94%|█████████▍| 30/32 [00:31<00:02,  1.13s/it] 97%|█████████▋| 31/32 [00:33<00:01,  1.16s/it]100%|██████████| 32/32 [00:34<00:00,  1.25s/it]100%|██████████| 32/32 [00:34<00:00,  1.08s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
/home/elicer/honest_llama/validation/../TruthfulQA/truthfulqa/metrics.py:284: FutureWarning: load_metric is deprecated and will be removed in the next major version of datasets. Use 'evaluate.load' instead, from the new library 🤗 Evaluate: https://huggingface.co/docs/evaluate
  bleurt = load_metric("bleurt", cache_dir=cache_dir)
[[0.651 0.665 0.645 ... 0.646 0.647 0.652]
 [0.659 0.644 0.645 ... 0.648 0.658 0.656]
 [0.651 0.657 0.685 ... 0.637 0.648 0.667]
 ...
 [0.765 0.762 0.657 ... 0.73  0.704 0.674]
 [0.748 0.678 0.696 ... 0.663 0.769 0.786]
 [0.775 0.815 0.74  ... 0.697 0.809 0.79 ]]
Heads intervened:  [(8, 16), (8, 19), (10, 18), (11, 16), (11, 17), (12, 4), (12, 15), (12, 22), (13, 8), (13, 16), (14, 2), (14, 20), (15, 28), (16, 17), (16, 26), (16, 30), (17, 4), (17, 9), (17, 13), (17, 17), (17, 29), (18, 29), (19, 13), (19, 17), (19, 31), (20, 22), (20, 30), (21, 18), (22, 2), (22, 8), (22, 16), (22, 23), (22, 30), (23, 3), (23, 4), (23, 7), (23, 12), (23, 13), (23, 25), (25, 15), (30, 14), (30, 23), (31, 1), (31, 3), (31, 6), (31, 11), (31, 25), (31, 30)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
2023-12-04 01:48:11.163352: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1635] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 24961 MB memory:  -> device: 0, name: NVIDIA A100 80GB PCIe MIG 3g.40gb, pci bus id: 0000:65:00.0, compute capability: 8.0
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 271.02it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-ec0cf83741fdb3e8.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-d31e6c0c76fafb4d.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:01<01:43,  1.04s/it]  3%|▎         | 3/100 [00:01<00:30,  3.17it/s]  5%|▌         | 5/100 [00:01<00:17,  5.39it/s]  7%|▋         | 7/100 [00:01<00:12,  7.54it/s]  9%|▉         | 9/100 [00:01<00:09,  9.50it/s] 11%|█         | 11/100 [00:01<00:07, 11.17it/s] 13%|█▎        | 13/100 [00:01<00:06, 12.52it/s] 15%|█▌        | 15/100 [00:01<00:06, 13.59it/s] 17%|█▋        | 17/100 [00:02<00:05, 14.41it/s] 19%|█▉        | 19/100 [00:02<00:05, 15.02it/s] 21%|██        | 21/100 [00:02<00:05, 15.48it/s] 23%|██▎       | 23/100 [00:02<00:04, 15.79it/s] 25%|██▌       | 25/100 [00:02<00:04, 16.02it/s] 27%|██▋       | 27/100 [00:02<00:04, 16.20it/s] 29%|██▉       | 29/100 [00:02<00:04, 16.33it/s] 31%|███       | 31/100 [00:02<00:04, 16.41it/s] 33%|███▎      | 33/100 [00:02<00:04, 16.47it/s] 35%|███▌      | 35/100 [00:03<00:03, 16.50it/s] 37%|███▋      | 37/100 [00:03<00:03, 16.53it/s] 39%|███▉      | 39/100 [00:03<00:03, 16.50it/s] 41%|████      | 41/100 [00:03<00:03, 16.52it/s] 43%|████▎     | 43/100 [00:03<00:03, 16.54it/s] 45%|████▌     | 45/100 [00:03<00:03, 16.57it/s] 47%|████▋     | 47/100 [00:03<00:03, 16.58it/s] 49%|████▉     | 49/100 [00:03<00:03, 16.59it/s] 51%|█████     | 51/100 [00:04<00:02, 16.60it/s] 53%|█████▎    | 53/100 [00:04<00:02, 16.60it/s] 55%|█████▌    | 55/100 [00:04<00:02, 16.61it/s] 57%|█████▋    | 57/100 [00:04<00:02, 16.62it/s] 59%|█████▉    | 59/100 [00:04<00:02, 16.62it/s] 61%|██████    | 61/100 [00:04<00:02, 16.62it/s] 63%|██████▎   | 63/100 [00:04<00:02, 16.61it/s] 65%|██████▌   | 65/100 [00:04<00:02, 16.62it/s] 67%|██████▋   | 67/100 [00:05<00:01, 16.64it/s] 69%|██████▉   | 69/100 [00:05<00:01, 16.64it/s] 71%|███████   | 71/100 [00:05<00:01, 16.64it/s] 73%|███████▎  | 73/100 [00:05<00:01, 16.47it/s] 75%|███████▌  | 75/100 [00:05<00:01, 16.20it/s] 77%|███████▋  | 77/100 [00:05<00:01, 16.31it/s] 79%|███████▉  | 79/100 [00:05<00:01, 16.41it/s] 81%|████████  | 81/100 [00:05<00:01, 16.42it/s] 83%|████████▎ | 83/100 [00:06<00:01, 16.45it/s] 85%|████████▌ | 85/100 [00:06<00:00, 16.50it/s] 87%|████████▋ | 87/100 [00:06<00:00, 16.54it/s] 89%|████████▉ | 89/100 [00:06<00:00, 16.58it/s] 91%|█████████ | 91/100 [00:06<00:00, 16.59it/s] 93%|█████████▎| 93/100 [00:06<00:00, 16.61it/s] 95%|█████████▌| 95/100 [00:06<00:00, 16.60it/s] 97%|█████████▋| 97/100 [00:06<00:00, 16.61it/s] 99%|█████████▉| 99/100 [00:06<00:00, 16.62it/s]100%|██████████| 100/100 [00:07<00:00, 14.23it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 347.33it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-1939fcc1eeebdaa7.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-785bb4b6f2089589.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:17,  5.71it/s]  2%|▏         | 2/100 [00:00<00:15,  6.50it/s]  3%|▎         | 3/100 [00:00<00:14,  6.86it/s]  4%|▍         | 4/100 [00:00<00:13,  7.05it/s]  5%|▌         | 5/100 [00:00<00:13,  7.00it/s]  6%|▌         | 6/100 [00:00<00:13,  6.87it/s]  7%|▋         | 7/100 [00:01<00:13,  7.03it/s]  8%|▊         | 8/100 [00:01<00:12,  7.13it/s]  9%|▉         | 9/100 [00:01<00:12,  7.19it/s] 10%|█         | 10/100 [00:01<00:12,  7.22it/s] 11%|█         | 11/100 [00:01<00:12,  7.24it/s] 12%|█▏        | 12/100 [00:01<00:12,  7.23it/s] 13%|█▎        | 13/100 [00:01<00:11,  7.25it/s] 14%|█▍        | 14/100 [00:01<00:11,  7.26it/s] 15%|█▌        | 15/100 [00:02<00:11,  7.29it/s] 16%|█▌        | 16/100 [00:02<00:11,  7.29it/s] 17%|█▋        | 17/100 [00:02<00:11,  7.28it/s] 18%|█▊        | 18/100 [00:02<00:11,  7.20it/s] 19%|█▉        | 19/100 [00:02<00:11,  7.20it/s] 20%|██        | 20/100 [00:02<00:11,  7.21it/s] 21%|██        | 21/100 [00:02<00:10,  7.20it/s] 22%|██▏       | 22/100 [00:03<00:10,  7.24it/s] 23%|██▎       | 23/100 [00:03<00:10,  7.20it/s] 24%|██▍       | 24/100 [00:03<00:10,  7.25it/s] 25%|██▌       | 25/100 [00:03<00:10,  7.26it/s] 26%|██▌       | 26/100 [00:03<00:10,  7.26it/s] 27%|██▋       | 27/100 [00:03<00:10,  7.29it/s] 28%|██▊       | 28/100 [00:03<00:09,  7.30it/s] 29%|██▉       | 29/100 [00:04<00:09,  7.29it/s] 30%|███       | 30/100 [00:04<00:09,  7.24it/s] 31%|███       | 31/100 [00:04<00:09,  7.22it/s] 32%|███▏      | 32/100 [00:04<00:09,  7.25it/s] 33%|███▎      | 33/100 [00:04<00:09,  6.99it/s] 34%|███▍      | 34/100 [00:04<00:09,  7.02it/s] 35%|███▌      | 35/100 [00:04<00:09,  7.04it/s] 36%|███▌      | 36/100 [00:05<00:09,  6.95it/s] 37%|███▋      | 37/100 [00:05<00:08,  7.07it/s] 38%|███▊      | 38/100 [00:05<00:08,  7.11it/s] 39%|███▉      | 39/100 [00:05<00:08,  7.18it/s] 40%|████      | 40/100 [00:05<00:08,  7.22it/s] 41%|████      | 41/100 [00:05<00:08,  7.23it/s] 42%|████▏     | 42/100 [00:05<00:07,  7.26it/s] 43%|████▎     | 43/100 [00:06<00:08,  6.99it/s] 44%|████▍     | 44/100 [00:06<00:07,  7.08it/s] 45%|████▌     | 45/100 [00:06<00:07,  7.16it/s] 46%|████▌     | 46/100 [00:06<00:07,  7.19it/s] 47%|████▋     | 47/100 [00:06<00:07,  7.24it/s] 48%|████▊     | 48/100 [00:06<00:07,  7.27it/s] 49%|████▉     | 49/100 [00:06<00:07,  7.28it/s] 50%|█████     | 50/100 [00:06<00:06,  7.29it/s] 51%|█████     | 51/100 [00:07<00:06,  7.29it/s] 52%|█████▏    | 52/100 [00:07<00:06,  7.32it/s] 53%|█████▎    | 53/100 [00:07<00:06,  7.28it/s] 54%|█████▍    | 54/100 [00:07<00:06,  7.28it/s] 55%|█████▌    | 55/100 [00:07<00:06,  7.29it/s] 56%|█████▌    | 56/100 [00:07<00:06,  7.30it/s] 57%|█████▋    | 57/100 [00:07<00:05,  7.30it/s] 58%|█████▊    | 58/100 [00:08<00:05,  7.30it/s] 59%|█████▉    | 59/100 [00:08<00:05,  7.32it/s] 60%|██████    | 60/100 [00:08<00:05,  7.33it/s] 61%|██████    | 61/100 [00:08<00:05,  7.34it/s] 62%|██████▏   | 62/100 [00:08<00:05,  7.34it/s] 63%|██████▎   | 63/100 [00:08<00:05,  7.35it/s] 64%|██████▍   | 64/100 [00:08<00:04,  7.36it/s] 65%|██████▌   | 65/100 [00:09<00:04,  7.33it/s] 66%|██████▌   | 66/100 [00:09<00:04,  7.33it/s] 67%|██████▋   | 67/100 [00:09<00:04,  7.35it/s] 68%|██████▊   | 68/100 [00:09<00:04,  7.34it/s] 69%|██████▉   | 69/100 [00:09<00:04,  7.35it/s] 70%|███████   | 70/100 [00:09<00:04,  7.34it/s] 71%|███████   | 71/100 [00:09<00:03,  7.34it/s] 72%|███████▏  | 72/100 [00:09<00:03,  7.35it/s] 73%|███████▎  | 73/100 [00:10<00:03,  7.35it/s] 74%|███████▍  | 74/100 [00:10<00:03,  7.35it/s] 75%|███████▌  | 75/100 [00:10<00:03,  7.35it/s] 76%|███████▌  | 76/100 [00:10<00:03,  7.35it/s] 77%|███████▋  | 77/100 [00:10<00:03,  7.36it/s] 78%|███████▊  | 78/100 [00:10<00:02,  7.36it/s] 79%|███████▉  | 79/100 [00:10<00:02,  7.36it/s] 80%|████████  | 80/100 [00:11<00:02,  7.33it/s] 81%|████████  | 81/100 [00:11<00:02,  7.34it/s] 82%|████████▏ | 82/100 [00:11<00:02,  7.22it/s] 83%|████████▎ | 83/100 [00:11<00:02,  7.27it/s] 84%|████████▍ | 84/100 [00:11<00:02,  7.30it/s] 85%|████████▌ | 85/100 [00:11<00:02,  7.31it/s] 86%|████████▌ | 86/100 [00:11<00:01,  7.25it/s] 87%|████████▋ | 87/100 [00:12<00:01,  7.10it/s] 88%|████████▊ | 88/100 [00:12<00:01,  7.18it/s] 89%|████████▉ | 89/100 [00:12<00:01,  7.24it/s] 90%|█████████ | 90/100 [00:12<00:01,  7.26it/s] 91%|█████████ | 91/100 [00:12<00:01,  7.29it/s] 92%|█████████▏| 92/100 [00:12<00:01,  7.32it/s] 93%|█████████▎| 93/100 [00:12<00:00,  7.33it/s] 94%|█████████▍| 94/100 [00:12<00:00,  7.34it/s] 95%|█████████▌| 95/100 [00:13<00:00,  7.32it/s] 96%|█████████▌| 96/100 [00:13<00:00,  7.32it/s] 97%|█████████▋| 97/100 [00:13<00:00,  7.34it/s] 98%|█████████▊| 98/100 [00:13<00:00,  7.35it/s] 99%|█████████▉| 99/100 [00:13<00:00,  7.35it/s]100%|██████████| 100/100 [00:13<00:00,  7.35it/s]100%|██████████| 100/100 [00:13<00:00,  7.24it/s]
FOLD 0
Metric     CE Loss  KL wrt Orig
Model                          
llama_7B  5.703203     3.638399
Running fold 1
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:29,  1.04it/s]  6%|▋         | 2/32 [00:02<00:32,  1.09s/it]  9%|▉         | 3/32 [00:03<00:34,  1.17s/it] 12%|█▎        | 4/32 [00:04<00:33,  1.19s/it] 16%|█▌        | 5/32 [00:05<00:32,  1.22s/it] 19%|█▉        | 6/32 [00:07<00:32,  1.25s/it] 22%|██▏       | 7/32 [00:08<00:31,  1.26s/it] 25%|██▌       | 8/32 [00:09<00:30,  1.25s/it] 28%|██▊       | 9/32 [00:10<00:28,  1.25s/it] 31%|███▏      | 10/32 [00:12<00:27,  1.26s/it] 34%|███▍      | 11/32 [00:13<00:26,  1.24s/it] 38%|███▊      | 12/32 [00:14<00:24,  1.21s/it] 41%|████      | 13/32 [00:15<00:22,  1.21s/it] 44%|████▍     | 14/32 [00:16<00:21,  1.21s/it] 47%|████▋     | 15/32 [00:18<00:20,  1.20s/it] 50%|█████     | 16/32 [00:19<00:19,  1.21s/it] 53%|█████▎    | 17/32 [00:20<00:18,  1.20s/it] 56%|█████▋    | 18/32 [00:21<00:17,  1.22s/it] 59%|█████▉    | 19/32 [00:23<00:16,  1.24s/it] 62%|██████▎   | 20/32 [00:24<00:15,  1.27s/it] 66%|██████▌   | 21/32 [00:25<00:14,  1.27s/it] 69%|██████▉   | 22/32 [00:27<00:12,  1.27s/it] 72%|███████▏  | 23/32 [00:28<00:11,  1.27s/it] 75%|███████▌  | 24/32 [00:29<00:10,  1.30s/it] 78%|███████▊  | 25/32 [00:30<00:09,  1.29s/it] 81%|████████▏ | 26/32 [00:32<00:07,  1.28s/it] 84%|████████▍ | 27/32 [00:33<00:06,  1.29s/it] 88%|████████▊ | 28/32 [00:34<00:05,  1.29s/it] 91%|█████████ | 29/32 [00:36<00:03,  1.30s/it] 94%|█████████▍| 30/32 [00:37<00:02,  1.29s/it] 97%|█████████▋| 31/32 [00:38<00:01,  1.29s/it]100%|██████████| 32/32 [00:40<00:00,  1.34s/it]100%|██████████| 32/32 [00:40<00:00,  1.25s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
[[0.666 0.672 0.662 ... 0.668 0.662 0.67 ]
 [0.662 0.662 0.659 ... 0.677 0.666 0.663]
 [0.668 0.67  0.68  ... 0.661 0.665 0.671]
 ...
 [0.758 0.75  0.674 ... 0.716 0.694 0.677]
 [0.749 0.671 0.686 ... 0.674 0.762 0.76 ]
 [0.765 0.805 0.748 ... 0.743 0.787 0.775]]
Heads intervened:  [(5, 10), (8, 16), (11, 16), (11, 17), (12, 4), (12, 22), (13, 8), (13, 10), (13, 16), (13, 21), (14, 2), (15, 1), (15, 10), (15, 28), (16, 3), (16, 4), (16, 17), (16, 26), (16, 30), (17, 4), (17, 13), (17, 17), (17, 19), (17, 29), (18, 29), (19, 13), (19, 17), (19, 28), (19, 31), (20, 22), (20, 30), (21, 23), (22, 16), (23, 3), (23, 4), (23, 12), (23, 13), (23, 25), (26, 13), (27, 3), (27, 7), (30, 4), (30, 18), (30, 23), (31, 1), (31, 6), (31, 10), (31, 18)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 254.46it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-30ec7b2da7888791.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-4e53eea82b0ecfef.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  2%|▏         | 2/100 [00:00<00:06, 14.71it/s]  4%|▍         | 4/100 [00:00<00:06, 15.68it/s]  6%|▌         | 6/100 [00:00<00:05, 16.02it/s]  8%|▊         | 8/100 [00:00<00:05, 16.19it/s] 10%|█         | 10/100 [00:00<00:05, 16.28it/s] 12%|█▏        | 12/100 [00:00<00:05, 16.34it/s] 14%|█▍        | 14/100 [00:00<00:05, 16.40it/s] 16%|█▌        | 16/100 [00:00<00:05, 16.42it/s] 18%|█▊        | 18/100 [00:01<00:04, 16.43it/s] 20%|██        | 20/100 [00:01<00:04, 16.43it/s] 22%|██▏       | 22/100 [00:01<00:04, 16.45it/s] 24%|██▍       | 24/100 [00:01<00:04, 16.34it/s] 26%|██▌       | 26/100 [00:01<00:04, 16.11it/s] 28%|██▊       | 28/100 [00:01<00:04, 16.21it/s] 30%|███       | 30/100 [00:01<00:04, 16.29it/s] 32%|███▏      | 32/100 [00:01<00:04, 16.34it/s] 34%|███▍      | 34/100 [00:02<00:04, 16.37it/s] 36%|███▌      | 36/100 [00:02<00:03, 16.40it/s] 38%|███▊      | 38/100 [00:02<00:03, 16.41it/s] 40%|████      | 40/100 [00:02<00:03, 16.42it/s] 42%|████▏     | 42/100 [00:02<00:03, 16.42it/s] 44%|████▍     | 44/100 [00:02<00:03, 16.42it/s] 46%|████▌     | 46/100 [00:02<00:03, 16.42it/s] 48%|████▊     | 48/100 [00:02<00:03, 16.43it/s] 50%|█████     | 50/100 [00:03<00:03, 16.43it/s] 52%|█████▏    | 52/100 [00:03<00:02, 16.43it/s] 54%|█████▍    | 54/100 [00:03<00:02, 16.44it/s] 56%|█████▌    | 56/100 [00:03<00:02, 16.44it/s] 58%|█████▊    | 58/100 [00:03<00:02, 16.22it/s] 60%|██████    | 60/100 [00:03<00:02, 16.29it/s] 62%|██████▏   | 62/100 [00:03<00:02, 16.33it/s] 64%|██████▍   | 64/100 [00:03<00:02, 16.37it/s] 66%|██████▌   | 66/100 [00:04<00:02, 16.38it/s] 68%|██████▊   | 68/100 [00:04<00:01, 16.38it/s] 70%|███████   | 70/100 [00:04<00:01, 16.40it/s] 72%|███████▏  | 72/100 [00:04<00:01, 16.41it/s] 74%|███████▍  | 74/100 [00:04<00:01, 16.42it/s] 76%|███████▌  | 76/100 [00:04<00:01, 16.42it/s] 78%|███████▊  | 78/100 [00:04<00:01, 16.42it/s] 80%|████████  | 80/100 [00:04<00:01, 16.41it/s] 82%|████████▏ | 82/100 [00:05<00:01, 16.41it/s] 84%|████████▍ | 84/100 [00:05<00:00, 16.36it/s] 86%|████████▌ | 86/100 [00:05<00:00, 16.37it/s] 88%|████████▊ | 88/100 [00:05<00:00, 16.38it/s] 90%|█████████ | 90/100 [00:05<00:00, 16.39it/s] 92%|█████████▏| 92/100 [00:05<00:00, 16.14it/s] 94%|█████████▍| 94/100 [00:05<00:00, 16.21it/s] 96%|█████████▌| 96/100 [00:05<00:00, 16.24it/s] 98%|█████████▊| 98/100 [00:06<00:00, 16.28it/s]100%|██████████| 100/100 [00:06<00:00, 16.29it/s]100%|██████████| 100/100 [00:06<00:00, 16.33it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 346.01it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-14295f39edd20556.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-10ca04ba0c7bb427.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:17,  5.70it/s]  2%|▏         | 2/100 [00:00<00:14,  6.54it/s]  3%|▎         | 3/100 [00:00<00:14,  6.88it/s]  4%|▍         | 4/100 [00:00<00:13,  7.05it/s]  5%|▌         | 5/100 [00:00<00:13,  7.14it/s]  6%|▌         | 6/100 [00:00<00:13,  7.17it/s]  7%|▋         | 7/100 [00:00<00:12,  7.23it/s]  8%|▊         | 8/100 [00:01<00:12,  7.26it/s]  9%|▉         | 9/100 [00:01<00:12,  7.29it/s] 10%|█         | 10/100 [00:01<00:12,  7.29it/s] 11%|█         | 11/100 [00:01<00:12,  7.30it/s] 12%|█▏        | 12/100 [00:01<00:12,  7.31it/s] 13%|█▎        | 13/100 [00:01<00:11,  7.31it/s] 14%|█▍        | 14/100 [00:01<00:11,  7.31it/s] 15%|█▌        | 15/100 [00:02<00:11,  7.30it/s] 16%|█▌        | 16/100 [00:02<00:11,  7.30it/s] 17%|█▋        | 17/100 [00:02<00:11,  7.31it/s] 18%|█▊        | 18/100 [00:02<00:11,  7.32it/s] 19%|█▉        | 19/100 [00:02<00:11,  7.32it/s] 20%|██        | 20/100 [00:02<00:10,  7.32it/s] 21%|██        | 21/100 [00:02<00:10,  7.31it/s] 22%|██▏       | 22/100 [00:03<00:10,  7.32it/s] 23%|██▎       | 23/100 [00:03<00:10,  7.33it/s] 24%|██▍       | 24/100 [00:03<00:10,  7.33it/s] 25%|██▌       | 25/100 [00:03<00:10,  7.33it/s] 26%|██▌       | 26/100 [00:03<00:10,  7.32it/s] 27%|██▋       | 27/100 [00:03<00:09,  7.33it/s] 28%|██▊       | 28/100 [00:03<00:09,  7.25it/s] 29%|██▉       | 29/100 [00:04<00:09,  7.25it/s] 30%|███       | 30/100 [00:04<00:09,  7.26it/s] 31%|███       | 31/100 [00:04<00:09,  7.28it/s] 32%|███▏      | 32/100 [00:04<00:09,  7.30it/s] 33%|███▎      | 33/100 [00:04<00:09,  7.32it/s] 34%|███▍      | 34/100 [00:04<00:09,  7.32it/s] 35%|███▌      | 35/100 [00:04<00:08,  7.32it/s] 36%|███▌      | 36/100 [00:04<00:08,  7.32it/s] 37%|███▋      | 37/100 [00:05<00:08,  7.32it/s] 38%|███▊      | 38/100 [00:05<00:08,  7.33it/s] 39%|███▉      | 39/100 [00:05<00:08,  7.33it/s] 40%|████      | 40/100 [00:05<00:08,  7.32it/s] 41%|████      | 41/100 [00:05<00:08,  7.32it/s] 42%|████▏     | 42/100 [00:05<00:07,  7.33it/s] 43%|████▎     | 43/100 [00:05<00:07,  7.33it/s] 44%|████▍     | 44/100 [00:06<00:07,  7.32it/s] 45%|████▌     | 45/100 [00:06<00:07,  7.32it/s] 46%|████▌     | 46/100 [00:06<00:07,  7.32it/s] 47%|████▋     | 47/100 [00:06<00:07,  7.32it/s] 48%|████▊     | 48/100 [00:06<00:07,  7.33it/s] 49%|████▉     | 49/100 [00:06<00:06,  7.32it/s] 50%|█████     | 50/100 [00:06<00:06,  7.31it/s] 51%|█████     | 51/100 [00:07<00:06,  7.31it/s] 52%|█████▏    | 52/100 [00:07<00:06,  7.32it/s] 53%|█████▎    | 53/100 [00:07<00:06,  7.31it/s] 54%|█████▍    | 54/100 [00:07<00:06,  7.32it/s] 55%|█████▌    | 55/100 [00:07<00:06,  7.31it/s] 56%|█████▌    | 56/100 [00:07<00:06,  7.31it/s] 57%|█████▋    | 57/100 [00:07<00:05,  7.32it/s] 58%|█████▊    | 58/100 [00:07<00:05,  7.29it/s] 59%|█████▉    | 59/100 [00:08<00:05,  7.28it/s] 60%|██████    | 60/100 [00:08<00:05,  7.29it/s] 61%|██████    | 61/100 [00:08<00:05,  7.29it/s] 62%|██████▏   | 62/100 [00:08<00:05,  7.30it/s] 63%|██████▎   | 63/100 [00:08<00:05,  7.30it/s] 64%|██████▍   | 64/100 [00:08<00:04,  7.31it/s] 65%|██████▌   | 65/100 [00:08<00:04,  7.31it/s] 66%|██████▌   | 66/100 [00:09<00:04,  7.30it/s] 67%|██████▋   | 67/100 [00:09<00:04,  7.32it/s] 68%|██████▊   | 68/100 [00:09<00:04,  7.32it/s] 69%|██████▉   | 69/100 [00:09<00:04,  7.32it/s] 70%|███████   | 70/100 [00:09<00:04,  7.32it/s] 71%|███████   | 71/100 [00:09<00:03,  7.31it/s] 72%|███████▏  | 72/100 [00:09<00:03,  7.32it/s] 73%|███████▎  | 73/100 [00:10<00:03,  7.32it/s] 74%|███████▍  | 74/100 [00:10<00:03,  7.31it/s] 75%|███████▌  | 75/100 [00:10<00:03,  7.31it/s] 76%|███████▌  | 76/100 [00:10<00:03,  7.31it/s] 77%|███████▋  | 77/100 [00:10<00:03,  7.32it/s] 78%|███████▊  | 78/100 [00:10<00:03,  7.31it/s] 79%|███████▉  | 79/100 [00:10<00:02,  7.31it/s] 80%|████████  | 80/100 [00:10<00:02,  7.31it/s] 81%|████████  | 81/100 [00:11<00:02,  7.31it/s] 82%|████████▏ | 82/100 [00:11<00:02,  7.32it/s] 83%|████████▎ | 83/100 [00:11<00:02,  7.32it/s] 84%|████████▍ | 84/100 [00:11<00:02,  7.33it/s] 85%|████████▌ | 85/100 [00:11<00:02,  7.32it/s] 86%|████████▌ | 86/100 [00:11<00:01,  7.32it/s] 87%|████████▋ | 87/100 [00:11<00:01,  7.33it/s] 88%|████████▊ | 88/100 [00:12<00:01,  7.33it/s] 89%|████████▉ | 89/100 [00:12<00:01,  7.22it/s] 90%|█████████ | 90/100 [00:12<00:01,  7.24it/s] 91%|█████████ | 91/100 [00:12<00:01,  7.26it/s] 92%|█████████▏| 92/100 [00:12<00:01,  7.29it/s] 93%|█████████▎| 93/100 [00:12<00:00,  7.30it/s] 94%|█████████▍| 94/100 [00:12<00:00,  7.31it/s] 95%|█████████▌| 95/100 [00:13<00:00,  7.31it/s] 96%|█████████▌| 96/100 [00:13<00:00,  7.31it/s] 97%|█████████▋| 97/100 [00:13<00:00,  7.32it/s] 98%|█████████▊| 98/100 [00:13<00:00,  7.32it/s] 99%|█████████▉| 99/100 [00:13<00:00,  7.32it/s]100%|██████████| 100/100 [00:13<00:00,  7.32it/s]100%|██████████| 100/100 [00:13<00:00,  7.29it/s]
FOLD 1
Metric     CE Loss  KL wrt Orig
Model                          
llama_7B  5.312266     3.257945
[5.50773438 3.44817208]
2023-12-04 01:49:51.124385: I tensorflow/core/util/port.cc:110] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2023-12-04 01:49:51.175695: I tensorflow/core/platform/cpu_feature_guard.cc:182] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-12-04 01:49:51.924052: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Could not find TensorRT
Found cached dataset truthful_qa (/home/elicer/.cache/huggingface/datasets/truthful_qa/multiple_choice/1.1.0/63502f6bc6ee493830ce0843991b028d0ab568d221896b2ee3b8a5dfdaa9d7f4)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 370.59it/s]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:00<00:00,  5.16it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  6.21it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  6.02it/s]
head_wise_activation_length:(11012, 32, 4096)
labels_shape:(11012,)
seperated_head_activation shape:11013
Running fold 0
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:28,  1.09it/s]  6%|▋         | 2/32 [00:01<00:28,  1.06it/s]  9%|▉         | 3/32 [00:02<00:26,  1.09it/s] 12%|█▎        | 4/32 [00:03<00:25,  1.11it/s] 16%|█▌        | 5/32 [00:04<00:24,  1.11it/s] 19%|█▉        | 6/32 [00:05<00:23,  1.09it/s] 22%|██▏       | 7/32 [00:06<00:23,  1.07it/s] 25%|██▌       | 8/32 [00:07<00:22,  1.05it/s] 28%|██▊       | 9/32 [00:08<00:22,  1.03it/s] 31%|███▏      | 10/32 [00:09<00:22,  1.00s/it] 34%|███▍      | 11/32 [00:10<00:21,  1.03s/it] 38%|███▊      | 12/32 [00:11<00:20,  1.03s/it] 41%|████      | 13/32 [00:12<00:19,  1.04s/it] 44%|████▍     | 14/32 [00:13<00:19,  1.06s/it] 47%|████▋     | 15/32 [00:14<00:17,  1.05s/it] 50%|█████     | 16/32 [00:15<00:16,  1.05s/it] 53%|█████▎    | 17/32 [00:16<00:15,  1.06s/it] 56%|█████▋    | 18/32 [00:18<00:15,  1.09s/it] 59%|█████▉    | 19/32 [00:19<00:14,  1.11s/it] 62%|██████▎   | 20/32 [00:20<00:13,  1.12s/it] 66%|██████▌   | 21/32 [00:21<00:12,  1.13s/it] 69%|██████▉   | 22/32 [00:22<00:11,  1.11s/it] 72%|███████▏  | 23/32 [00:23<00:10,  1.13s/it] 75%|███████▌  | 24/32 [00:25<00:09,  1.18s/it] 78%|███████▊  | 25/32 [00:26<00:08,  1.16s/it] 81%|████████▏ | 26/32 [00:27<00:06,  1.15s/it] 84%|████████▍ | 27/32 [00:28<00:05,  1.17s/it] 88%|████████▊ | 28/32 [00:29<00:04,  1.13s/it] 91%|█████████ | 29/32 [00:30<00:03,  1.14s/it] 94%|█████████▍| 30/32 [00:31<00:02,  1.12s/it] 97%|█████████▋| 31/32 [00:33<00:01,  1.13s/it]100%|██████████| 32/32 [00:34<00:00,  1.22s/it]100%|██████████| 32/32 [00:34<00:00,  1.08s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
/home/elicer/honest_llama/validation/../TruthfulQA/truthfulqa/metrics.py:284: FutureWarning: load_metric is deprecated and will be removed in the next major version of datasets. Use 'evaluate.load' instead, from the new library 🤗 Evaluate: https://huggingface.co/docs/evaluate
  bleurt = load_metric("bleurt", cache_dir=cache_dir)
[[0.651 0.665 0.645 ... 0.646 0.647 0.652]
 [0.659 0.644 0.645 ... 0.648 0.658 0.656]
 [0.651 0.657 0.685 ... 0.637 0.648 0.667]
 ...
 [0.765 0.762 0.657 ... 0.73  0.704 0.674]
 [0.748 0.678 0.696 ... 0.663 0.769 0.786]
 [0.775 0.815 0.74  ... 0.697 0.809 0.79 ]]
Heads intervened:  [(8, 16), (8, 19), (10, 18), (11, 16), (11, 17), (12, 4), (12, 15), (12, 22), (13, 8), (13, 16), (14, 2), (14, 20), (15, 28), (16, 17), (16, 26), (16, 30), (17, 4), (17, 9), (17, 13), (17, 17), (17, 29), (18, 29), (19, 13), (19, 17), (19, 31), (20, 22), (20, 30), (21, 18), (22, 2), (22, 8), (22, 16), (22, 23), (22, 30), (23, 3), (23, 4), (23, 7), (23, 12), (23, 13), (23, 25), (25, 15), (30, 14), (30, 23), (31, 1), (31, 3), (31, 6), (31, 11), (31, 25), (31, 30)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
2023-12-04 01:50:42.617266: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1635] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 24961 MB memory:  -> device: 0, name: NVIDIA A100 80GB PCIe MIG 3g.40gb, pci bus id: 0000:65:00.0, compute capability: 8.0
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 265.66it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-ec0cf83741fdb3e8.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-d31e6c0c76fafb4d.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:01<01:43,  1.04s/it]  3%|▎         | 3/100 [00:01<00:30,  3.17it/s]  5%|▌         | 5/100 [00:01<00:17,  5.42it/s]  7%|▋         | 7/100 [00:01<00:12,  7.56it/s]  9%|▉         | 9/100 [00:01<00:09,  9.50it/s] 11%|█         | 11/100 [00:01<00:07, 11.16it/s] 13%|█▎        | 13/100 [00:01<00:06, 12.51it/s] 15%|█▌        | 15/100 [00:01<00:06, 13.58it/s] 17%|█▋        | 17/100 [00:02<00:05, 14.38it/s] 19%|█▉        | 19/100 [00:02<00:05, 14.98it/s] 21%|██        | 21/100 [00:02<00:05, 15.42it/s] 23%|██▎       | 23/100 [00:02<00:04, 15.74it/s] 25%|██▌       | 25/100 [00:02<00:04, 15.97it/s] 27%|██▋       | 27/100 [00:02<00:04, 16.12it/s] 29%|██▉       | 29/100 [00:02<00:04, 16.25it/s] 31%|███       | 31/100 [00:02<00:04, 16.32it/s] 33%|███▎      | 33/100 [00:02<00:04, 16.38it/s] 35%|███▌      | 35/100 [00:03<00:03, 16.42it/s] 37%|███▋      | 37/100 [00:03<00:03, 16.45it/s] 39%|███▉      | 39/100 [00:03<00:03, 16.47it/s] 41%|████      | 41/100 [00:03<00:03, 16.13it/s] 43%|████▎     | 43/100 [00:03<00:03, 16.25it/s] 45%|████▌     | 45/100 [00:03<00:03, 16.35it/s] 47%|████▋     | 47/100 [00:03<00:03, 16.41it/s] 49%|████▉     | 49/100 [00:03<00:03, 16.46it/s] 51%|█████     | 51/100 [00:04<00:02, 16.49it/s] 53%|█████▎    | 53/100 [00:04<00:02, 16.52it/s] 55%|█████▌    | 55/100 [00:04<00:02, 16.53it/s] 57%|█████▋    | 57/100 [00:04<00:02, 16.55it/s] 59%|█████▉    | 59/100 [00:04<00:02, 16.56it/s] 61%|██████    | 61/100 [00:04<00:02, 16.56it/s] 63%|██████▎   | 63/100 [00:04<00:02, 16.55it/s] 65%|██████▌   | 65/100 [00:04<00:02, 16.56it/s] 67%|██████▋   | 67/100 [00:05<00:01, 16.57it/s] 69%|██████▉   | 69/100 [00:05<00:01, 16.58it/s] 71%|███████   | 71/100 [00:05<00:01, 16.58it/s] 73%|███████▎  | 73/100 [00:05<00:01, 16.59it/s] 75%|███████▌  | 75/100 [00:05<00:01, 16.58it/s] 77%|███████▋  | 77/100 [00:05<00:01, 16.58it/s] 79%|███████▉  | 79/100 [00:05<00:01, 16.55it/s] 81%|████████  | 81/100 [00:05<00:01, 16.55it/s] 83%|████████▎ | 83/100 [00:06<00:01, 16.57it/s] 85%|████████▌ | 85/100 [00:06<00:00, 16.57it/s] 87%|████████▋ | 87/100 [00:06<00:00, 16.58it/s] 89%|████████▉ | 89/100 [00:06<00:00, 16.58it/s] 91%|█████████ | 91/100 [00:06<00:00, 16.56it/s] 93%|█████████▎| 93/100 [00:06<00:00, 16.55it/s] 95%|█████████▌| 95/100 [00:06<00:00, 16.56it/s] 97%|█████████▋| 97/100 [00:06<00:00, 16.56it/s] 99%|█████████▉| 99/100 [00:06<00:00, 16.57it/s]100%|██████████| 100/100 [00:07<00:00, 14.21it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 336.46it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-1939fcc1eeebdaa7.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-785bb4b6f2089589.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:18,  5.44it/s]  2%|▏         | 2/100 [00:00<00:16,  6.11it/s]  3%|▎         | 3/100 [00:00<00:15,  6.30it/s]  4%|▍         | 4/100 [00:00<00:14,  6.56it/s]  5%|▌         | 5/100 [00:00<00:14,  6.47it/s]  6%|▌         | 6/100 [00:00<00:14,  6.69it/s]  7%|▋         | 7/100 [00:01<00:14,  6.57it/s]  8%|▊         | 8/100 [00:01<00:13,  6.63it/s]  9%|▉         | 9/100 [00:01<00:13,  6.55it/s] 10%|█         | 10/100 [00:01<00:13,  6.54it/s] 11%|█         | 11/100 [00:01<00:13,  6.73it/s] 12%|█▏        | 12/100 [00:01<00:13,  6.69it/s] 13%|█▎        | 13/100 [00:01<00:13,  6.68it/s] 14%|█▍        | 14/100 [00:02<00:12,  6.79it/s] 15%|█▌        | 15/100 [00:02<00:12,  6.82it/s] 16%|█▌        | 16/100 [00:02<00:12,  6.94it/s] 17%|█▋        | 17/100 [00:02<00:11,  7.02it/s] 18%|█▊        | 18/100 [00:02<00:11,  6.90it/s] 19%|█▉        | 19/100 [00:02<00:11,  6.92it/s] 20%|██        | 20/100 [00:02<00:11,  6.83it/s] 21%|██        | 21/100 [00:03<00:11,  6.81it/s] 22%|██▏       | 22/100 [00:03<00:11,  6.85it/s] 23%|██▎       | 23/100 [00:03<00:10,  7.01it/s] 24%|██▍       | 24/100 [00:03<00:10,  7.09it/s] 25%|██▌       | 25/100 [00:03<00:10,  6.90it/s] 26%|██▌       | 26/100 [00:03<00:10,  6.96it/s] 27%|██▋       | 27/100 [00:03<00:10,  7.05it/s] 28%|██▊       | 28/100 [00:04<00:10,  6.81it/s] 29%|██▉       | 29/100 [00:04<00:10,  6.96it/s] 30%|███       | 30/100 [00:04<00:10,  6.72it/s] 31%|███       | 31/100 [00:04<00:10,  6.65it/s] 32%|███▏      | 32/100 [00:04<00:10,  6.63it/s] 33%|███▎      | 33/100 [00:04<00:10,  6.65it/s] 34%|███▍      | 34/100 [00:05<00:09,  6.68it/s] 35%|███▌      | 35/100 [00:05<00:09,  6.59it/s] 36%|███▌      | 36/100 [00:05<00:09,  6.71it/s] 37%|███▋      | 37/100 [00:05<00:09,  6.81it/s] 38%|███▊      | 38/100 [00:05<00:09,  6.83it/s] 39%|███▉      | 39/100 [00:05<00:08,  6.86it/s] 40%|████      | 40/100 [00:05<00:08,  6.98it/s] 41%|████      | 41/100 [00:06<00:08,  6.98it/s] 42%|████▏     | 42/100 [00:06<00:08,  7.02it/s] 43%|████▎     | 43/100 [00:06<00:08,  6.93it/s] 44%|████▍     | 44/100 [00:06<00:08,  6.94it/s] 45%|████▌     | 45/100 [00:06<00:07,  6.92it/s] 46%|████▌     | 46/100 [00:06<00:07,  6.85it/s] 47%|████▋     | 47/100 [00:06<00:07,  7.00it/s] 48%|████▊     | 48/100 [00:07<00:07,  6.92it/s] 49%|████▉     | 49/100 [00:07<00:07,  6.93it/s] 50%|█████     | 50/100 [00:07<00:07,  6.65it/s] 51%|█████     | 51/100 [00:07<00:07,  6.73it/s] 52%|█████▏    | 52/100 [00:07<00:07,  6.62it/s] 53%|█████▎    | 53/100 [00:07<00:06,  6.83it/s] 54%|█████▍    | 54/100 [00:07<00:06,  6.87it/s] 55%|█████▌    | 55/100 [00:08<00:06,  6.78it/s] 56%|█████▌    | 56/100 [00:08<00:06,  6.86it/s] 57%|█████▋    | 57/100 [00:08<00:06,  7.02it/s] 58%|█████▊    | 58/100 [00:08<00:05,  7.07it/s] 59%|█████▉    | 59/100 [00:08<00:05,  7.14it/s] 60%|██████    | 60/100 [00:08<00:05,  6.90it/s] 61%|██████    | 61/100 [00:08<00:05,  6.79it/s] 62%|██████▏   | 62/100 [00:09<00:05,  6.73it/s] 63%|██████▎   | 63/100 [00:09<00:05,  6.78it/s] 64%|██████▍   | 64/100 [00:09<00:05,  6.73it/s] 65%|██████▌   | 65/100 [00:09<00:05,  6.76it/s] 66%|██████▌   | 66/100 [00:09<00:05,  6.77it/s] 67%|██████▋   | 67/100 [00:09<00:04,  6.96it/s] 68%|██████▊   | 68/100 [00:09<00:04,  6.96it/s] 69%|██████▉   | 69/100 [00:10<00:04,  6.98it/s] 70%|███████   | 70/100 [00:10<00:04,  7.08it/s] 71%|███████   | 71/100 [00:10<00:04,  6.93it/s] 72%|███████▏  | 72/100 [00:10<00:04,  6.95it/s] 73%|███████▎  | 73/100 [00:10<00:03,  6.96it/s] 74%|███████▍  | 74/100 [00:10<00:03,  6.99it/s] 75%|███████▌  | 75/100 [00:11<00:03,  6.88it/s] 76%|███████▌  | 76/100 [00:11<00:03,  6.65it/s] 77%|███████▋  | 77/100 [00:11<00:03,  6.81it/s] 78%|███████▊  | 78/100 [00:11<00:03,  6.76it/s] 79%|███████▉  | 79/100 [00:11<00:03,  6.75it/s] 80%|████████  | 80/100 [00:11<00:02,  6.78it/s] 81%|████████  | 81/100 [00:11<00:02,  6.94it/s] 82%|████████▏ | 82/100 [00:12<00:02,  6.81it/s] 83%|████████▎ | 83/100 [00:12<00:02,  6.92it/s] 84%|████████▍ | 84/100 [00:12<00:02,  6.85it/s] 85%|████████▌ | 85/100 [00:12<00:02,  6.73it/s] 86%|████████▌ | 86/100 [00:12<00:02,  6.90it/s] 87%|████████▋ | 87/100 [00:12<00:01,  6.60it/s] 88%|████████▊ | 88/100 [00:12<00:01,  6.55it/s] 89%|████████▉ | 89/100 [00:13<00:01,  6.61it/s] 90%|█████████ | 90/100 [00:13<00:01,  6.82it/s] 91%|█████████ | 91/100 [00:13<00:01,  6.74it/s] 92%|█████████▏| 92/100 [00:13<00:01,  6.80it/s] 93%|█████████▎| 93/100 [00:13<00:01,  6.95it/s] 94%|█████████▍| 94/100 [00:13<00:00,  7.04it/s] 95%|█████████▌| 95/100 [00:13<00:00,  6.93it/s] 96%|█████████▌| 96/100 [00:14<00:00,  6.96it/s] 97%|█████████▋| 97/100 [00:14<00:00,  6.75it/s] 98%|█████████▊| 98/100 [00:14<00:00,  6.92it/s] 99%|█████████▉| 99/100 [00:14<00:00,  6.86it/s]100%|██████████| 100/100 [00:14<00:00,  6.93it/s]100%|██████████| 100/100 [00:14<00:00,  6.82it/s]
FOLD 0
Metric     CE Loss  KL wrt Orig
Model                          
llama_7B  2.453574     0.259507
Running fold 1
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:29,  1.05it/s]  6%|▋         | 2/32 [00:02<00:33,  1.11s/it]  9%|▉         | 3/32 [00:03<00:34,  1.21s/it] 12%|█▎        | 4/32 [00:04<00:33,  1.21s/it] 16%|█▌        | 5/32 [00:06<00:33,  1.24s/it] 19%|█▉        | 6/32 [00:07<00:32,  1.27s/it] 22%|██▏       | 7/32 [00:08<00:31,  1.27s/it] 25%|██▌       | 8/32 [00:09<00:30,  1.27s/it] 28%|██▊       | 9/32 [00:11<00:29,  1.27s/it] 31%|███▏      | 10/32 [00:12<00:27,  1.27s/it] 34%|███▍      | 11/32 [00:13<00:26,  1.26s/it] 38%|███▊      | 12/32 [00:14<00:24,  1.24s/it] 41%|████      | 13/32 [00:16<00:23,  1.23s/it] 44%|████▍     | 14/32 [00:17<00:22,  1.23s/it] 47%|████▋     | 15/32 [00:18<00:20,  1.23s/it] 50%|█████     | 16/32 [00:19<00:19,  1.24s/it] 53%|█████▎    | 17/32 [00:20<00:18,  1.23s/it] 56%|█████▋    | 18/32 [00:22<00:17,  1.23s/it] 59%|█████▉    | 19/32 [00:23<00:16,  1.26s/it] 62%|██████▎   | 20/32 [00:24<00:15,  1.30s/it] 66%|██████▌   | 21/32 [00:26<00:14,  1.30s/it] 69%|██████▉   | 22/32 [00:27<00:13,  1.30s/it] 72%|███████▏  | 23/32 [00:28<00:11,  1.31s/it] 75%|███████▌  | 24/32 [00:30<00:10,  1.33s/it] 78%|███████▊  | 25/32 [00:31<00:09,  1.33s/it] 81%|████████▏ | 26/32 [00:32<00:07,  1.33s/it] 84%|████████▍ | 27/32 [00:34<00:06,  1.34s/it] 88%|████████▊ | 28/32 [00:35<00:05,  1.33s/it] 91%|█████████ | 29/32 [00:36<00:04,  1.34s/it] 94%|█████████▍| 30/32 [00:38<00:02,  1.32s/it] 97%|█████████▋| 31/32 [00:39<00:01,  1.32s/it]100%|██████████| 32/32 [00:41<00:00,  1.37s/it]100%|██████████| 32/32 [00:41<00:00,  1.28s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
[[0.666 0.672 0.662 ... 0.668 0.662 0.67 ]
 [0.662 0.662 0.659 ... 0.677 0.666 0.663]
 [0.668 0.67  0.68  ... 0.661 0.665 0.671]
 ...
 [0.758 0.75  0.674 ... 0.716 0.694 0.677]
 [0.749 0.671 0.686 ... 0.674 0.762 0.76 ]
 [0.765 0.805 0.748 ... 0.743 0.787 0.775]]
Heads intervened:  [(5, 10), (8, 16), (11, 16), (11, 17), (12, 4), (12, 22), (13, 8), (13, 10), (13, 16), (13, 21), (14, 2), (15, 1), (15, 10), (15, 28), (16, 3), (16, 4), (16, 17), (16, 26), (16, 30), (17, 4), (17, 13), (17, 17), (17, 19), (17, 29), (18, 29), (19, 13), (19, 17), (19, 28), (19, 31), (20, 22), (20, 30), (21, 23), (22, 16), (23, 3), (23, 4), (23, 12), (23, 13), (23, 25), (26, 13), (27, 3), (27, 7), (30, 4), (30, 18), (30, 23), (31, 1), (31, 6), (31, 10), (31, 18)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 260.29it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-30ec7b2da7888791.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-4e53eea82b0ecfef.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  2%|▏         | 2/100 [00:00<00:06, 14.75it/s]  4%|▍         | 4/100 [00:00<00:06, 15.67it/s]  6%|▌         | 6/100 [00:00<00:05, 16.02it/s]  8%|▊         | 8/100 [00:00<00:05, 16.17it/s] 10%|█         | 10/100 [00:00<00:05, 16.24it/s] 12%|█▏        | 12/100 [00:00<00:05, 16.29it/s] 14%|█▍        | 14/100 [00:00<00:05, 16.34it/s] 16%|█▌        | 16/100 [00:00<00:05, 16.37it/s] 18%|█▊        | 18/100 [00:01<00:04, 16.40it/s] 20%|██        | 20/100 [00:01<00:04, 16.43it/s] 22%|██▏       | 22/100 [00:01<00:04, 16.44it/s] 24%|██▍       | 24/100 [00:01<00:04, 16.44it/s] 26%|██▌       | 26/100 [00:01<00:04, 16.45it/s] 28%|██▊       | 28/100 [00:01<00:04, 16.45it/s] 30%|███       | 30/100 [00:01<00:04, 16.44it/s] 32%|███▏      | 32/100 [00:01<00:04, 16.45it/s] 34%|███▍      | 34/100 [00:02<00:04, 16.47it/s] 36%|███▌      | 36/100 [00:02<00:03, 16.47it/s] 38%|███▊      | 38/100 [00:02<00:03, 16.47it/s] 40%|████      | 40/100 [00:02<00:03, 16.36it/s] 42%|████▏     | 42/100 [00:02<00:03, 16.01it/s] 44%|████▍     | 44/100 [00:02<00:03, 16.12it/s] 46%|████▌     | 46/100 [00:02<00:03, 16.21it/s] 48%|████▊     | 48/100 [00:02<00:03, 16.28it/s] 50%|█████     | 50/100 [00:03<00:03, 16.34it/s] 52%|█████▏    | 52/100 [00:03<00:02, 16.37it/s] 54%|█████▍    | 54/100 [00:03<00:02, 16.39it/s] 56%|█████▌    | 56/100 [00:03<00:02, 16.41it/s] 58%|█████▊    | 58/100 [00:03<00:02, 16.44it/s] 60%|██████    | 60/100 [00:03<00:02, 16.44it/s] 62%|██████▏   | 62/100 [00:03<00:02, 16.44it/s] 64%|██████▍   | 64/100 [00:03<00:02, 16.39it/s] 66%|██████▌   | 66/100 [00:04<00:02, 16.40it/s] 68%|██████▊   | 68/100 [00:04<00:01, 16.35it/s] 70%|███████   | 70/100 [00:04<00:01, 16.37it/s] 72%|███████▏  | 72/100 [00:04<00:01, 16.39it/s] 74%|███████▍  | 74/100 [00:04<00:01, 16.42it/s] 76%|███████▌  | 76/100 [00:04<00:01, 16.43it/s] 78%|███████▊  | 78/100 [00:04<00:01, 16.43it/s] 80%|████████  | 80/100 [00:04<00:01, 16.44it/s] 82%|████████▏ | 82/100 [00:05<00:01, 16.46it/s] 84%|████████▍ | 84/100 [00:05<00:00, 16.47it/s] 86%|████████▌ | 86/100 [00:05<00:00, 16.47it/s] 88%|████████▊ | 88/100 [00:05<00:00, 16.39it/s] 90%|█████████ | 90/100 [00:05<00:00, 16.40it/s] 92%|█████████▏| 92/100 [00:05<00:00, 16.41it/s] 94%|█████████▍| 94/100 [00:05<00:00, 16.40it/s] 96%|█████████▌| 96/100 [00:05<00:00, 16.41it/s] 98%|█████████▊| 98/100 [00:05<00:00, 16.41it/s]100%|██████████| 100/100 [00:06<00:00, 16.39it/s]100%|██████████| 100/100 [00:06<00:00, 16.36it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 297.70it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-14295f39edd20556.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-10ca04ba0c7bb427.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:16,  6.14it/s]  2%|▏         | 2/100 [00:00<00:14,  6.62it/s]  3%|▎         | 3/100 [00:00<00:14,  6.60it/s]  4%|▍         | 4/100 [00:00<00:14,  6.65it/s]  5%|▌         | 5/100 [00:00<00:13,  6.90it/s]  6%|▌         | 6/100 [00:00<00:13,  6.84it/s]  7%|▋         | 7/100 [00:01<00:13,  6.70it/s]  8%|▊         | 8/100 [00:01<00:13,  6.73it/s]  9%|▉         | 9/100 [00:01<00:13,  6.75it/s] 10%|█         | 10/100 [00:01<00:13,  6.56it/s] 11%|█         | 11/100 [00:01<00:13,  6.49it/s] 12%|█▏        | 12/100 [00:01<00:13,  6.54it/s] 13%|█▎        | 13/100 [00:01<00:13,  6.66it/s] 14%|█▍        | 14/100 [00:02<00:12,  6.85it/s] 15%|█▌        | 15/100 [00:02<00:12,  6.81it/s] 16%|█▌        | 16/100 [00:02<00:12,  6.73it/s] 17%|█▋        | 17/100 [00:02<00:12,  6.73it/s] 18%|█▊        | 18/100 [00:02<00:12,  6.76it/s] 19%|█▉        | 19/100 [00:02<00:11,  6.76it/s] 20%|██        | 20/100 [00:02<00:11,  6.86it/s] 21%|██        | 21/100 [00:03<00:11,  6.88it/s] 22%|██▏       | 22/100 [00:03<00:11,  6.83it/s] 23%|██▎       | 23/100 [00:03<00:11,  6.58it/s] 24%|██▍       | 24/100 [00:03<00:11,  6.58it/s] 25%|██▌       | 25/100 [00:03<00:11,  6.58it/s] 26%|██▌       | 26/100 [00:03<00:11,  6.49it/s] 27%|██▋       | 27/100 [00:04<00:10,  6.65it/s] 28%|██▊       | 28/100 [00:04<00:10,  6.85it/s] 29%|██▉       | 29/100 [00:04<00:10,  6.81it/s] 30%|███       | 30/100 [00:04<00:10,  6.76it/s] 31%|███       | 31/100 [00:04<00:10,  6.74it/s] 32%|███▏      | 32/100 [00:04<00:09,  6.87it/s] 33%|███▎      | 33/100 [00:04<00:09,  6.82it/s] 34%|███▍      | 34/100 [00:05<00:09,  6.79it/s] 35%|███▌      | 35/100 [00:05<00:09,  6.79it/s] 36%|███▌      | 36/100 [00:05<00:09,  6.96it/s] 37%|███▋      | 37/100 [00:05<00:08,  7.08it/s] 38%|███▊      | 38/100 [00:05<00:08,  7.09it/s] 39%|███▉      | 39/100 [00:05<00:08,  6.93it/s] 40%|████      | 40/100 [00:05<00:08,  6.84it/s] 41%|████      | 41/100 [00:06<00:08,  6.93it/s] 42%|████▏     | 42/100 [00:06<00:08,  6.95it/s] 43%|████▎     | 43/100 [00:06<00:08,  6.72it/s] 44%|████▍     | 44/100 [00:06<00:08,  6.68it/s] 45%|████▌     | 45/100 [00:06<00:08,  6.65it/s] 46%|████▌     | 46/100 [00:06<00:08,  6.57it/s] 47%|████▋     | 47/100 [00:06<00:08,  6.56it/s] 48%|████▊     | 48/100 [00:07<00:07,  6.62it/s] 49%|████▉     | 49/100 [00:07<00:07,  6.76it/s] 50%|█████     | 50/100 [00:07<00:07,  6.88it/s] 51%|█████     | 51/100 [00:07<00:07,  6.90it/s] 52%|█████▏    | 52/100 [00:07<00:06,  7.04it/s] 53%|█████▎    | 53/100 [00:07<00:06,  7.01it/s] 54%|█████▍    | 54/100 [00:07<00:06,  6.88it/s] 55%|█████▌    | 55/100 [00:08<00:06,  6.91it/s] 56%|█████▌    | 56/100 [00:08<00:06,  6.89it/s] 57%|█████▋    | 57/100 [00:08<00:06,  6.72it/s] 58%|█████▊    | 58/100 [00:08<00:06,  6.75it/s] 59%|█████▉    | 59/100 [00:08<00:06,  6.64it/s] 60%|██████    | 60/100 [00:08<00:05,  6.68it/s] 61%|██████    | 61/100 [00:09<00:05,  6.87it/s] 62%|██████▏   | 62/100 [00:09<00:05,  7.01it/s] 63%|██████▎   | 63/100 [00:09<00:05,  6.83it/s] 64%|██████▍   | 64/100 [00:09<00:05,  6.75it/s] 65%|██████▌   | 65/100 [00:09<00:05,  6.86it/s] 66%|██████▌   | 66/100 [00:09<00:05,  6.66it/s] 67%|██████▋   | 67/100 [00:09<00:04,  6.81it/s] 68%|██████▊   | 68/100 [00:10<00:04,  6.97it/s] 69%|██████▉   | 69/100 [00:10<00:04,  6.96it/s] 70%|███████   | 70/100 [00:10<00:04,  6.93it/s] 71%|███████   | 71/100 [00:10<00:04,  6.76it/s] 72%|███████▏  | 72/100 [00:10<00:04,  6.70it/s] 73%|███████▎  | 73/100 [00:10<00:04,  6.67it/s] 74%|███████▍  | 74/100 [00:10<00:03,  6.86it/s] 75%|███████▌  | 75/100 [00:11<00:03,  6.74it/s] 76%|███████▌  | 76/100 [00:11<00:03,  6.87it/s] 77%|███████▋  | 77/100 [00:11<00:03,  6.89it/s] 78%|███████▊  | 78/100 [00:11<00:03,  6.84it/s] 79%|███████▉  | 79/100 [00:11<00:03,  6.83it/s] 80%|████████  | 80/100 [00:11<00:02,  6.75it/s] 81%|████████  | 81/100 [00:11<00:02,  6.62it/s] 82%|████████▏ | 82/100 [00:12<00:02,  6.67it/s] 83%|████████▎ | 83/100 [00:12<00:02,  6.88it/s] 84%|████████▍ | 84/100 [00:12<00:02,  6.82it/s] 85%|████████▌ | 85/100 [00:12<00:02,  6.74it/s] 86%|████████▌ | 86/100 [00:12<00:02,  6.73it/s] 87%|████████▋ | 87/100 [00:12<00:01,  6.69it/s] 88%|████████▊ | 88/100 [00:13<00:01,  6.59it/s] 89%|████████▉ | 89/100 [00:13<00:01,  6.50it/s] 90%|█████████ | 90/100 [00:13<00:01,  6.52it/s] 91%|█████████ | 91/100 [00:13<00:01,  6.55it/s] 92%|█████████▏| 92/100 [00:13<00:01,  6.56it/s] 93%|█████████▎| 93/100 [00:13<00:01,  6.63it/s] 94%|█████████▍| 94/100 [00:13<00:00,  6.55it/s] 95%|█████████▌| 95/100 [00:14<00:00,  6.57it/s] 96%|█████████▌| 96/100 [00:14<00:00,  6.72it/s] 97%|█████████▋| 97/100 [00:14<00:00,  6.85it/s] 98%|█████████▊| 98/100 [00:14<00:00,  6.68it/s] 99%|█████████▉| 99/100 [00:14<00:00,  6.41it/s]100%|██████████| 100/100 [00:14<00:00,  6.46it/s]100%|██████████| 100/100 [00:14<00:00,  6.74it/s]
FOLD 1
Metric     CE Loss  KL wrt Orig
Model                          
llama_7B  2.364189     0.299242
[2.40888184 0.27937438]
2023-12-04 01:52:25.507247: I tensorflow/core/util/port.cc:110] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2023-12-04 01:52:25.557511: I tensorflow/core/platform/cpu_feature_guard.cc:182] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-12-04 01:52:26.302532: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Could not find TensorRT
Found cached dataset truthful_qa (/home/elicer/.cache/huggingface/datasets/truthful_qa/multiple_choice/1.1.0/63502f6bc6ee493830ce0843991b028d0ab568d221896b2ee3b8a5dfdaa9d7f4)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 355.93it/s]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:00<00:00,  5.29it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  6.18it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  6.03it/s]
head_wise_activation_length:(11012, 32, 4096)
labels_shape:(11012,)
seperated_head_activation shape:11013
Running fold 0
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:28,  1.09it/s]  6%|▋         | 2/32 [00:01<00:28,  1.07it/s]  9%|▉         | 3/32 [00:02<00:26,  1.10it/s] 12%|█▎        | 4/32 [00:03<00:25,  1.12it/s] 16%|█▌        | 5/32 [00:04<00:24,  1.11it/s] 19%|█▉        | 6/32 [00:05<00:23,  1.09it/s] 22%|██▏       | 7/32 [00:06<00:23,  1.08it/s] 25%|██▌       | 8/32 [00:07<00:22,  1.06it/s] 28%|██▊       | 9/32 [00:08<00:22,  1.02it/s] 31%|███▏      | 10/32 [00:09<00:22,  1.00s/it] 34%|███▍      | 11/32 [00:10<00:21,  1.02s/it] 38%|███▊      | 12/32 [00:11<00:20,  1.02s/it] 41%|████      | 13/32 [00:12<00:19,  1.03s/it] 44%|████▍     | 14/32 [00:13<00:18,  1.05s/it] 47%|████▋     | 15/32 [00:14<00:17,  1.04s/it] 50%|█████     | 16/32 [00:15<00:16,  1.04s/it] 53%|█████▎    | 17/32 [00:16<00:15,  1.05s/it] 56%|█████▋    | 18/32 [00:17<00:14,  1.07s/it] 59%|█████▉    | 19/32 [00:19<00:14,  1.09s/it] 62%|██████▎   | 20/32 [00:20<00:13,  1.11s/it] 66%|██████▌   | 21/32 [00:21<00:12,  1.13s/it] 69%|██████▉   | 22/32 [00:22<00:11,  1.12s/it] 72%|███████▏  | 23/32 [00:23<00:10,  1.14s/it] 75%|███████▌  | 24/32 [00:25<00:09,  1.20s/it] 78%|███████▊  | 25/32 [00:26<00:08,  1.19s/it] 81%|████████▏ | 26/32 [00:27<00:07,  1.17s/it] 84%|████████▍ | 27/32 [00:28<00:05,  1.19s/it] 88%|████████▊ | 28/32 [00:29<00:04,  1.15s/it] 91%|█████████ | 29/32 [00:30<00:03,  1.15s/it] 94%|█████████▍| 30/32 [00:31<00:02,  1.14s/it] 97%|█████████▋| 31/32 [00:33<00:01,  1.15s/it]100%|██████████| 32/32 [00:34<00:00,  1.25s/it]100%|██████████| 32/32 [00:34<00:00,  1.08s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
/home/elicer/honest_llama/validation/../TruthfulQA/truthfulqa/metrics.py:284: FutureWarning: load_metric is deprecated and will be removed in the next major version of datasets. Use 'evaluate.load' instead, from the new library 🤗 Evaluate: https://huggingface.co/docs/evaluate
  bleurt = load_metric("bleurt", cache_dir=cache_dir)
[[0.651 0.665 0.645 ... 0.646 0.647 0.652]
 [0.659 0.644 0.645 ... 0.648 0.658 0.656]
 [0.651 0.657 0.685 ... 0.637 0.648 0.667]
 ...
 [0.765 0.762 0.657 ... 0.73  0.704 0.674]
 [0.748 0.678 0.696 ... 0.663 0.769 0.786]
 [0.775 0.815 0.74  ... 0.697 0.809 0.79 ]]
Heads intervened:  [(8, 16), (8, 19), (10, 18), (11, 16), (11, 17), (12, 4), (12, 15), (12, 22), (13, 8), (13, 16), (14, 2), (14, 20), (15, 28), (16, 17), (16, 26), (16, 30), (17, 4), (17, 9), (17, 13), (17, 17), (17, 29), (18, 29), (19, 13), (19, 17), (19, 31), (20, 22), (20, 30), (21, 18), (22, 2), (22, 8), (22, 16), (22, 23), (22, 30), (23, 3), (23, 4), (23, 7), (23, 12), (23, 13), (23, 25), (25, 15), (30, 14), (30, 23), (31, 1), (31, 3), (31, 6), (31, 11), (31, 25), (31, 30)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
2023-12-04 01:53:17.580267: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1635] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 24961 MB memory:  -> device: 0, name: NVIDIA A100 80GB PCIe MIG 3g.40gb, pci bus id: 0000:65:00.0, compute capability: 8.0
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 610.44it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-ec0cf83741fdb3e8.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-d31e6c0c76fafb4d.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:01<01:42,  1.04s/it]  3%|▎         | 3/100 [00:01<00:30,  3.18it/s]  5%|▌         | 5/100 [00:01<00:17,  5.44it/s]  7%|▋         | 7/100 [00:01<00:12,  7.60it/s]  9%|▉         | 9/100 [00:01<00:09,  9.52it/s] 11%|█         | 11/100 [00:01<00:07, 11.17it/s] 13%|█▎        | 13/100 [00:01<00:06, 12.48it/s] 15%|█▌        | 15/100 [00:01<00:06, 13.56it/s] 17%|█▋        | 17/100 [00:02<00:05, 14.38it/s] 19%|█▉        | 19/100 [00:02<00:05, 14.68it/s] 21%|██        | 21/100 [00:02<00:05, 14.97it/s] 23%|██▎       | 23/100 [00:02<00:05, 15.35it/s] 25%|██▌       | 25/100 [00:02<00:04, 15.63it/s] 27%|██▋       | 27/100 [00:02<00:04, 15.79it/s] 29%|██▉       | 29/100 [00:02<00:04, 15.92it/s] 31%|███       | 31/100 [00:02<00:04, 15.95it/s] 33%|███▎      | 33/100 [00:03<00:04, 16.09it/s] 35%|███▌      | 35/100 [00:03<00:04, 16.10it/s] 37%|███▋      | 37/100 [00:03<00:03, 16.02it/s] 39%|███▉      | 39/100 [00:03<00:03, 16.13it/s] 41%|████      | 41/100 [00:03<00:03, 16.09it/s] 43%|████▎     | 43/100 [00:03<00:03, 16.15it/s] 45%|████▌     | 45/100 [00:03<00:03, 16.11it/s] 47%|████▋     | 47/100 [00:03<00:03, 15.57it/s] 49%|████▉     | 49/100 [00:04<00:03, 15.81it/s] 51%|█████     | 51/100 [00:04<00:03, 16.02it/s] 53%|█████▎    | 53/100 [00:04<00:02, 16.11it/s] 55%|█████▌    | 55/100 [00:04<00:02, 16.20it/s] 57%|█████▋    | 57/100 [00:04<00:02, 16.30it/s] 59%|█████▉    | 59/100 [00:04<00:02, 16.39it/s] 61%|██████    | 61/100 [00:04<00:02, 16.45it/s] 63%|██████▎   | 63/100 [00:04<00:02, 16.30it/s] 65%|██████▌   | 65/100 [00:05<00:02, 15.68it/s] 67%|██████▋   | 67/100 [00:05<00:02, 15.91it/s] 69%|██████▉   | 69/100 [00:05<00:01, 16.03it/s] 71%|███████   | 71/100 [00:05<00:01, 16.16it/s] 73%|███████▎  | 73/100 [00:05<00:01, 16.22it/s] 75%|███████▌  | 75/100 [00:05<00:01, 16.24it/s] 77%|███████▋  | 77/100 [00:05<00:01, 16.31it/s] 79%|███████▉  | 79/100 [00:05<00:01, 16.24it/s] 81%|████████  | 81/100 [00:05<00:01, 16.11it/s] 83%|████████▎ | 83/100 [00:06<00:01, 16.20it/s] 85%|████████▌ | 85/100 [00:06<00:00, 16.19it/s] 87%|████████▋ | 87/100 [00:06<00:00, 16.27it/s] 89%|████████▉ | 89/100 [00:06<00:00, 16.25it/s] 91%|█████████ | 91/100 [00:06<00:00, 16.10it/s] 93%|█████████▎| 93/100 [00:06<00:00, 16.17it/s] 95%|█████████▌| 95/100 [00:06<00:00, 16.23it/s] 97%|█████████▋| 97/100 [00:06<00:00, 16.17it/s] 99%|█████████▉| 99/100 [00:07<00:00, 15.73it/s]100%|██████████| 100/100 [00:07<00:00, 13.94it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 345.75it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-1939fcc1eeebdaa7.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-785bb4b6f2089589.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:18,  5.39it/s]  2%|▏         | 2/100 [00:00<00:15,  6.17it/s]  3%|▎         | 3/100 [00:00<00:14,  6.57it/s]  4%|▍         | 4/100 [00:00<00:15,  6.39it/s]  5%|▌         | 5/100 [00:00<00:14,  6.48it/s]  6%|▌         | 6/100 [00:00<00:14,  6.55it/s]  7%|▋         | 7/100 [00:01<00:13,  6.80it/s]  8%|▊         | 8/100 [00:01<00:13,  6.71it/s]  9%|▉         | 9/100 [00:01<00:13,  6.53it/s] 10%|█         | 10/100 [00:01<00:13,  6.59it/s] 11%|█         | 11/100 [00:01<00:13,  6.68it/s] 12%|█▏        | 12/100 [00:01<00:12,  6.88it/s] 13%|█▎        | 13/100 [00:01<00:13,  6.43it/s] 14%|█▍        | 14/100 [00:02<00:13,  6.52it/s] 15%|█▌        | 15/100 [00:02<00:12,  6.59it/s] 16%|█▌        | 16/100 [00:02<00:12,  6.74it/s] 17%|█▋        | 17/100 [00:02<00:12,  6.86it/s] 18%|█▊        | 18/100 [00:02<00:12,  6.78it/s] 19%|█▉        | 19/100 [00:02<00:12,  6.69it/s] 20%|██        | 20/100 [00:03<00:11,  6.85it/s] 21%|██        | 21/100 [00:03<00:11,  6.98it/s] 22%|██▏       | 22/100 [00:03<00:11,  6.89it/s] 23%|██▎       | 23/100 [00:03<00:11,  6.87it/s] 24%|██▍       | 24/100 [00:03<00:11,  6.74it/s] 25%|██▌       | 25/100 [00:03<00:11,  6.69it/s] 26%|██▌       | 26/100 [00:03<00:11,  6.68it/s] 27%|██▋       | 27/100 [00:04<00:10,  6.72it/s] 28%|██▊       | 28/100 [00:04<00:10,  6.92it/s] 29%|██▉       | 29/100 [00:04<00:10,  6.94it/s] 30%|███       | 30/100 [00:04<00:10,  6.61it/s] 31%|███       | 31/100 [00:04<00:10,  6.74it/s] 32%|███▏      | 32/100 [00:04<00:09,  6.87it/s] 33%|███▎      | 33/100 [00:04<00:09,  7.01it/s] 34%|███▍      | 34/100 [00:05<00:09,  6.97it/s] 35%|███▌      | 35/100 [00:05<00:09,  7.11it/s] 36%|███▌      | 36/100 [00:05<00:09,  7.03it/s] 37%|███▋      | 37/100 [00:05<00:08,  7.06it/s] 38%|███▊      | 38/100 [00:05<00:08,  7.02it/s] 39%|███▉      | 39/100 [00:05<00:08,  7.10it/s] 40%|████      | 40/100 [00:05<00:08,  7.19it/s] 41%|████      | 41/100 [00:06<00:08,  7.27it/s] 42%|████▏     | 42/100 [00:06<00:08,  7.11it/s] 43%|████▎     | 43/100 [00:06<00:08,  6.85it/s] 44%|████▍     | 44/100 [00:06<00:08,  6.77it/s] 45%|████▌     | 45/100 [00:06<00:08,  6.80it/s] 46%|████▌     | 46/100 [00:06<00:07,  6.83it/s] 47%|████▋     | 47/100 [00:06<00:07,  6.69it/s] 48%|████▊     | 48/100 [00:07<00:07,  6.83it/s] 49%|████▉     | 49/100 [00:07<00:07,  6.82it/s] 50%|█████     | 50/100 [00:07<00:07,  6.93it/s] 51%|█████     | 51/100 [00:07<00:06,  7.02it/s] 52%|█████▏    | 52/100 [00:07<00:06,  6.94it/s] 53%|█████▎    | 53/100 [00:07<00:06,  6.90it/s] 54%|█████▍    | 54/100 [00:07<00:06,  7.00it/s] 55%|█████▌    | 55/100 [00:08<00:06,  6.83it/s] 56%|█████▌    | 56/100 [00:08<00:06,  6.77it/s] 57%|█████▋    | 57/100 [00:08<00:06,  6.81it/s] 58%|█████▊    | 58/100 [00:08<00:06,  7.00it/s] 59%|█████▉    | 59/100 [00:08<00:05,  6.93it/s] 60%|██████    | 60/100 [00:08<00:05,  6.92it/s] 61%|██████    | 61/100 [00:08<00:05,  6.98it/s] 62%|██████▏   | 62/100 [00:09<00:05,  6.88it/s] 63%|██████▎   | 63/100 [00:09<00:05,  6.96it/s] 64%|██████▍   | 64/100 [00:09<00:05,  6.94it/s] 65%|██████▌   | 65/100 [00:09<00:05,  6.83it/s] 66%|██████▌   | 66/100 [00:09<00:05,  6.77it/s] 67%|██████▋   | 67/100 [00:09<00:04,  6.97it/s] 68%|██████▊   | 68/100 [00:09<00:04,  6.96it/s] 69%|██████▉   | 69/100 [00:10<00:04,  7.08it/s] 70%|███████   | 70/100 [00:10<00:04,  7.17it/s] 71%|███████   | 71/100 [00:10<00:04,  6.90it/s] 72%|███████▏  | 72/100 [00:10<00:03,  7.02it/s] 73%|███████▎  | 73/100 [00:10<00:03,  6.82it/s] 74%|███████▍  | 74/100 [00:10<00:03,  6.88it/s] 75%|███████▌  | 75/100 [00:10<00:03,  7.01it/s] 76%|███████▌  | 76/100 [00:11<00:03,  7.03it/s] 77%|███████▋  | 77/100 [00:11<00:03,  6.86it/s] 78%|███████▊  | 78/100 [00:11<00:03,  6.73it/s] 79%|███████▉  | 79/100 [00:11<00:03,  6.72it/s] 80%|████████  | 80/100 [00:11<00:03,  6.52it/s] 81%|████████  | 81/100 [00:11<00:02,  6.50it/s] 82%|████████▏ | 82/100 [00:12<00:02,  6.71it/s] 83%|████████▎ | 83/100 [00:12<00:02,  6.86it/s] 84%|████████▍ | 84/100 [00:12<00:02,  6.93it/s] 85%|████████▌ | 85/100 [00:12<00:02,  7.08it/s] 86%|████████▌ | 86/100 [00:12<00:02,  6.91it/s] 87%|████████▋ | 87/100 [00:12<00:01,  6.95it/s] 88%|████████▊ | 88/100 [00:12<00:01,  7.00it/s] 89%|████████▉ | 89/100 [00:13<00:01,  6.96it/s] 90%|█████████ | 90/100 [00:13<00:01,  7.06it/s] 91%|█████████ | 91/100 [00:13<00:01,  7.03it/s] 92%|█████████▏| 92/100 [00:13<00:01,  6.88it/s] 93%|█████████▎| 93/100 [00:13<00:01,  6.96it/s] 94%|█████████▍| 94/100 [00:13<00:00,  6.92it/s] 95%|█████████▌| 95/100 [00:13<00:00,  6.78it/s] 96%|█████████▌| 96/100 [00:14<00:00,  6.85it/s] 97%|█████████▋| 97/100 [00:14<00:00,  6.83it/s] 98%|█████████▊| 98/100 [00:14<00:00,  6.87it/s] 99%|█████████▉| 99/100 [00:14<00:00,  6.68it/s]100%|██████████| 100/100 [00:14<00:00,  6.76it/s]100%|██████████| 100/100 [00:14<00:00,  6.84it/s]
FOLD 0
Metric     CE Loss  KL wrt Orig
Model                          
llama_7B  3.350273     1.158718
Running fold 1
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:28,  1.08it/s]  6%|▋         | 2/32 [00:02<00:32,  1.07s/it]  9%|▉         | 3/32 [00:03<00:33,  1.15s/it] 12%|█▎        | 4/32 [00:04<00:32,  1.16s/it] 16%|█▌        | 5/32 [00:05<00:32,  1.19s/it] 19%|█▉        | 6/32 [00:07<00:31,  1.22s/it] 22%|██▏       | 7/32 [00:08<00:30,  1.23s/it] 25%|██▌       | 8/32 [00:09<00:29,  1.22s/it] 28%|██▊       | 9/32 [00:10<00:28,  1.23s/it] 31%|███▏      | 10/32 [00:11<00:26,  1.23s/it] 34%|███▍      | 11/32 [00:13<00:25,  1.21s/it] 38%|███▊      | 12/32 [00:14<00:23,  1.19s/it] 41%|████      | 13/32 [00:15<00:22,  1.20s/it] 44%|████▍     | 14/32 [00:16<00:21,  1.19s/it] 47%|████▋     | 15/32 [00:17<00:20,  1.18s/it] 50%|█████     | 16/32 [00:19<00:19,  1.19s/it] 53%|█████▎    | 17/32 [00:20<00:17,  1.20s/it] 56%|█████▋    | 18/32 [00:21<00:16,  1.19s/it] 59%|█████▉    | 19/32 [00:22<00:15,  1.21s/it] 62%|██████▎   | 20/32 [00:24<00:14,  1.25s/it] 66%|██████▌   | 21/32 [00:25<00:13,  1.26s/it] 69%|██████▉   | 22/32 [00:26<00:12,  1.26s/it] 72%|███████▏  | 23/32 [00:27<00:11,  1.26s/it] 75%|███████▌  | 24/32 [00:29<00:10,  1.29s/it] 78%|███████▊  | 25/32 [00:30<00:08,  1.28s/it] 81%|████████▏ | 26/32 [00:31<00:07,  1.28s/it] 84%|████████▍ | 27/32 [00:33<00:06,  1.29s/it] 88%|████████▊ | 28/32 [00:34<00:05,  1.28s/it] 91%|█████████ | 29/32 [00:35<00:03,  1.29s/it] 94%|█████████▍| 30/32 [00:36<00:02,  1.27s/it] 97%|█████████▋| 31/32 [00:38<00:01,  1.26s/it]100%|██████████| 32/32 [00:39<00:00,  1.31s/it]100%|██████████| 32/32 [00:39<00:00,  1.23s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
[[0.666 0.672 0.662 ... 0.668 0.662 0.67 ]
 [0.662 0.662 0.659 ... 0.677 0.666 0.663]
 [0.668 0.67  0.68  ... 0.661 0.665 0.671]
 ...
 [0.758 0.75  0.674 ... 0.716 0.694 0.677]
 [0.749 0.671 0.686 ... 0.674 0.762 0.76 ]
 [0.765 0.805 0.748 ... 0.743 0.787 0.775]]
Heads intervened:  [(5, 10), (8, 16), (11, 16), (11, 17), (12, 4), (12, 22), (13, 8), (13, 10), (13, 16), (13, 21), (14, 2), (15, 1), (15, 10), (15, 28), (16, 3), (16, 4), (16, 17), (16, 26), (16, 30), (17, 4), (17, 13), (17, 17), (17, 19), (17, 29), (18, 29), (19, 13), (19, 17), (19, 28), (19, 31), (20, 22), (20, 30), (21, 23), (22, 16), (23, 3), (23, 4), (23, 12), (23, 13), (23, 25), (26, 13), (27, 3), (27, 7), (30, 4), (30, 18), (30, 23), (31, 1), (31, 6), (31, 10), (31, 18)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 253.28it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-30ec7b2da7888791.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-4e53eea82b0ecfef.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  2%|▏         | 2/100 [00:00<00:06, 14.71it/s]  4%|▍         | 4/100 [00:00<00:06, 15.60it/s]  6%|▌         | 6/100 [00:00<00:06, 15.60it/s]  8%|▊         | 8/100 [00:00<00:05, 15.69it/s] 10%|█         | 10/100 [00:00<00:05, 15.82it/s] 12%|█▏        | 12/100 [00:00<00:05, 15.91it/s] 14%|█▍        | 14/100 [00:00<00:05, 15.84it/s] 16%|█▌        | 16/100 [00:01<00:05, 15.86it/s] 18%|█▊        | 18/100 [00:01<00:05, 15.23it/s] 20%|██        | 20/100 [00:01<00:05, 15.48it/s] 22%|██▏       | 22/100 [00:01<00:04, 15.69it/s] 24%|██▍       | 24/100 [00:01<00:04, 15.78it/s] 26%|██▌       | 26/100 [00:01<00:04, 15.89it/s] 28%|██▊       | 28/100 [00:01<00:04, 15.78it/s] 30%|███       | 30/100 [00:01<00:04, 15.78it/s] 32%|███▏      | 32/100 [00:02<00:04, 15.64it/s] 34%|███▍      | 34/100 [00:02<00:04, 15.75it/s] 36%|███▌      | 36/100 [00:02<00:04, 15.83it/s] 38%|███▊      | 38/100 [00:02<00:03, 15.84it/s] 40%|████      | 40/100 [00:02<00:03, 15.92it/s] 42%|████▏     | 42/100 [00:02<00:03, 15.96it/s] 44%|████▍     | 44/100 [00:02<00:03, 15.99it/s] 46%|████▌     | 46/100 [00:02<00:03, 16.00it/s] 48%|████▊     | 48/100 [00:03<00:03, 16.01it/s] 50%|█████     | 50/100 [00:03<00:03, 15.91it/s] 52%|█████▏    | 52/100 [00:03<00:03, 15.92it/s] 54%|█████▍    | 54/100 [00:03<00:02, 15.90it/s] 56%|█████▌    | 56/100 [00:03<00:02, 15.67it/s] 58%|█████▊    | 58/100 [00:03<00:02, 15.85it/s] 60%|██████    | 60/100 [00:03<00:02, 15.98it/s] 62%|██████▏   | 62/100 [00:03<00:02, 15.83it/s] 64%|██████▍   | 64/100 [00:04<00:02, 15.84it/s] 66%|██████▌   | 66/100 [00:04<00:02, 15.95it/s] 68%|██████▊   | 68/100 [00:04<00:02, 15.96it/s] 70%|███████   | 70/100 [00:04<00:01, 16.05it/s] 72%|███████▏  | 72/100 [00:04<00:01, 15.92it/s] 74%|███████▍  | 74/100 [00:04<00:01, 15.86it/s] 76%|███████▌  | 76/100 [00:04<00:01, 15.98it/s] 78%|███████▊  | 78/100 [00:04<00:01, 16.07it/s] 80%|████████  | 80/100 [00:05<00:01, 15.96it/s] 82%|████████▏ | 82/100 [00:05<00:01, 15.46it/s] 84%|████████▍ | 84/100 [00:05<00:01, 15.61it/s] 86%|████████▌ | 86/100 [00:05<00:00, 15.75it/s] 88%|████████▊ | 88/100 [00:05<00:00, 15.80it/s] 90%|█████████ | 90/100 [00:05<00:00, 15.84it/s] 92%|█████████▏| 92/100 [00:05<00:00, 15.64it/s] 94%|█████████▍| 94/100 [00:05<00:00, 15.27it/s] 96%|█████████▌| 96/100 [00:06<00:00, 15.46it/s] 98%|█████████▊| 98/100 [00:06<00:00, 15.61it/s]100%|██████████| 100/100 [00:06<00:00, 15.76it/s]100%|██████████| 100/100 [00:06<00:00, 15.78it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 343.85it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-14295f39edd20556.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-10ca04ba0c7bb427.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:16,  5.96it/s]  2%|▏         | 2/100 [00:00<00:16,  5.85it/s]  3%|▎         | 3/100 [00:00<00:15,  6.32it/s]  4%|▍         | 4/100 [00:00<00:14,  6.47it/s]  5%|▌         | 5/100 [00:00<00:14,  6.63it/s]  6%|▌         | 6/100 [00:00<00:14,  6.50it/s]  7%|▋         | 7/100 [00:01<00:14,  6.39it/s]  8%|▊         | 8/100 [00:01<00:14,  6.56it/s]  9%|▉         | 9/100 [00:01<00:13,  6.79it/s] 10%|█         | 10/100 [00:01<00:13,  6.47it/s] 11%|█         | 11/100 [00:01<00:13,  6.48it/s] 12%|█▏        | 12/100 [00:01<00:13,  6.69it/s] 13%|█▎        | 13/100 [00:01<00:13,  6.64it/s] 14%|█▍        | 14/100 [00:02<00:12,  6.72it/s] 15%|█▌        | 15/100 [00:02<00:12,  6.84it/s] 16%|█▌        | 16/100 [00:02<00:12,  6.94it/s] 17%|█▋        | 17/100 [00:02<00:12,  6.79it/s] 18%|█▊        | 18/100 [00:02<00:12,  6.71it/s] 19%|█▉        | 19/100 [00:02<00:11,  6.80it/s] 20%|██        | 20/100 [00:03<00:11,  6.68it/s] 21%|██        | 21/100 [00:03<00:11,  6.60it/s] 22%|██▏       | 22/100 [00:03<00:11,  6.51it/s] 23%|██▎       | 23/100 [00:03<00:11,  6.55it/s] 24%|██▍       | 24/100 [00:03<00:11,  6.58it/s] 25%|██▌       | 25/100 [00:03<00:11,  6.46it/s] 26%|██▌       | 26/100 [00:03<00:11,  6.55it/s] 27%|██▋       | 27/100 [00:04<00:10,  6.71it/s] 28%|██▊       | 28/100 [00:04<00:10,  6.65it/s] 29%|██▉       | 29/100 [00:04<00:10,  6.67it/s] 30%|███       | 30/100 [00:04<00:10,  6.53it/s] 31%|███       | 31/100 [00:04<00:10,  6.50it/s] 32%|███▏      | 32/100 [00:04<00:10,  6.48it/s] 33%|███▎      | 33/100 [00:05<00:10,  6.53it/s] 34%|███▍      | 34/100 [00:05<00:09,  6.71it/s] 35%|███▌      | 35/100 [00:05<00:09,  6.81it/s] 36%|███▌      | 36/100 [00:05<00:09,  6.95it/s] 37%|███▋      | 37/100 [00:05<00:09,  6.81it/s] 38%|███▊      | 38/100 [00:05<00:09,  6.87it/s] 39%|███▉      | 39/100 [00:05<00:08,  6.86it/s] 40%|████      | 40/100 [00:06<00:08,  6.99it/s] 41%|████      | 41/100 [00:06<00:08,  6.94it/s] 42%|████▏     | 42/100 [00:06<00:08,  6.79it/s] 43%|████▎     | 43/100 [00:06<00:08,  6.85it/s] 44%|████▍     | 44/100 [00:06<00:08,  6.77it/s] 45%|████▌     | 45/100 [00:06<00:08,  6.68it/s] 46%|████▌     | 46/100 [00:06<00:08,  6.52it/s] 47%|████▋     | 47/100 [00:07<00:07,  6.63it/s] 48%|████▊     | 48/100 [00:07<00:07,  6.53it/s] 49%|████▉     | 49/100 [00:07<00:07,  6.58it/s] 50%|█████     | 50/100 [00:07<00:07,  6.76it/s] 51%|█████     | 51/100 [00:07<00:07,  6.77it/s] 52%|█████▏    | 52/100 [00:07<00:07,  6.71it/s] 53%|█████▎    | 53/100 [00:07<00:07,  6.65it/s] 54%|█████▍    | 54/100 [00:08<00:06,  6.85it/s] 55%|█████▌    | 55/100 [00:08<00:06,  6.82it/s] 56%|█████▌    | 56/100 [00:08<00:06,  6.91it/s] 57%|█████▋    | 57/100 [00:08<00:06,  6.80it/s] 58%|█████▊    | 58/100 [00:08<00:06,  6.77it/s] 59%|█████▉    | 59/100 [00:08<00:05,  6.90it/s] 60%|██████    | 60/100 [00:08<00:05,  6.81it/s] 61%|██████    | 61/100 [00:09<00:05,  6.87it/s] 62%|██████▏   | 62/100 [00:09<00:05,  6.99it/s] 63%|██████▎   | 63/100 [00:09<00:05,  7.00it/s] 64%|██████▍   | 64/100 [00:09<00:05,  6.85it/s] 65%|██████▌   | 65/100 [00:09<00:05,  6.60it/s] 66%|██████▌   | 66/100 [00:09<00:05,  6.56it/s] 67%|██████▋   | 67/100 [00:10<00:04,  6.73it/s] 68%|██████▊   | 68/100 [00:10<00:04,  6.60it/s] 69%|██████▉   | 69/100 [00:10<00:04,  6.44it/s] 70%|███████   | 70/100 [00:10<00:04,  6.51it/s] 71%|███████   | 71/100 [00:10<00:04,  6.61it/s] 72%|███████▏  | 72/100 [00:10<00:04,  6.77it/s] 73%|███████▎  | 73/100 [00:10<00:04,  6.58it/s] 74%|███████▍  | 74/100 [00:11<00:03,  6.62it/s] 75%|███████▌  | 75/100 [00:11<00:03,  6.64it/s] 76%|███████▌  | 76/100 [00:11<00:03,  6.64it/s] 77%|███████▋  | 77/100 [00:11<00:03,  6.79it/s] 78%|███████▊  | 78/100 [00:11<00:03,  6.70it/s] 79%|███████▉  | 79/100 [00:11<00:03,  6.72it/s] 80%|████████  | 80/100 [00:11<00:03,  6.61it/s] 81%|████████  | 81/100 [00:12<00:02,  6.76it/s] 82%|████████▏ | 82/100 [00:12<00:02,  6.82it/s] 83%|████████▎ | 83/100 [00:12<00:02,  6.72it/s] 84%|████████▍ | 84/100 [00:12<00:02,  6.84it/s] 85%|████████▌ | 85/100 [00:12<00:02,  6.95it/s] 86%|████████▌ | 86/100 [00:12<00:02,  6.79it/s] 87%|████████▋ | 87/100 [00:13<00:01,  6.80it/s] 88%|████████▊ | 88/100 [00:13<00:01,  6.76it/s] 89%|████████▉ | 89/100 [00:13<00:01,  6.86it/s] 90%|█████████ | 90/100 [00:13<00:01,  6.92it/s] 91%|█████████ | 91/100 [00:13<00:01,  7.02it/s] 92%|█████████▏| 92/100 [00:13<00:01,  7.10it/s] 93%|█████████▎| 93/100 [00:13<00:01,  6.92it/s] 94%|█████████▍| 94/100 [00:14<00:00,  6.89it/s] 95%|█████████▌| 95/100 [00:14<00:00,  6.69it/s] 96%|█████████▌| 96/100 [00:14<00:00,  6.73it/s] 97%|█████████▋| 97/100 [00:14<00:00,  6.67it/s] 98%|█████████▊| 98/100 [00:14<00:00,  6.63it/s] 99%|█████████▉| 99/100 [00:14<00:00,  6.60it/s]100%|██████████| 100/100 [00:14<00:00,  6.63it/s]100%|██████████| 100/100 [00:14<00:00,  6.70it/s]
FOLD 1
Metric    CE Loss  KL wrt Orig
Model                         
llama_7B  4.83457      2.59068
[4.09242188 1.87469906]
2023-12-04 01:54:59.589639: I tensorflow/core/util/port.cc:110] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2023-12-04 01:54:59.639475: I tensorflow/core/platform/cpu_feature_guard.cc:182] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-12-04 01:55:00.390987: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Could not find TensorRT
Found cached dataset truthful_qa (/home/elicer/.cache/huggingface/datasets/truthful_qa/multiple_choice/1.1.0/63502f6bc6ee493830ce0843991b028d0ab568d221896b2ee3b8a5dfdaa9d7f4)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 353.23it/s]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:00<00:00,  5.44it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  5.96it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  5.87it/s]
head_wise_activation_length:(11012, 32, 4096)
labels_shape:(11012,)
seperated_head_activation shape:11013
Running fold 0
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:28,  1.09it/s]  6%|▋         | 2/32 [00:01<00:28,  1.06it/s]  9%|▉         | 3/32 [00:02<00:26,  1.10it/s] 12%|█▎        | 4/32 [00:03<00:24,  1.12it/s] 16%|█▌        | 5/32 [00:04<00:24,  1.12it/s] 19%|█▉        | 6/32 [00:05<00:23,  1.10it/s] 22%|██▏       | 7/32 [00:06<00:22,  1.09it/s] 25%|██▌       | 8/32 [00:07<00:22,  1.05it/s] 28%|██▊       | 9/32 [00:08<00:22,  1.02it/s] 31%|███▏      | 10/32 [00:09<00:22,  1.01s/it] 34%|███▍      | 11/32 [00:10<00:21,  1.03s/it] 38%|███▊      | 12/32 [00:11<00:20,  1.03s/it] 41%|████      | 13/32 [00:12<00:19,  1.05s/it] 44%|████▍     | 14/32 [00:13<00:19,  1.07s/it] 47%|████▋     | 15/32 [00:14<00:18,  1.06s/it] 50%|█████     | 16/32 [00:15<00:17,  1.06s/it] 53%|█████▎    | 17/32 [00:17<00:16,  1.07s/it] 56%|█████▋    | 18/32 [00:18<00:15,  1.08s/it] 59%|█████▉    | 19/32 [00:19<00:14,  1.11s/it] 62%|██████▎   | 20/32 [00:20<00:13,  1.12s/it] 66%|██████▌   | 21/32 [00:21<00:12,  1.13s/it] 69%|██████▉   | 22/32 [00:22<00:11,  1.12s/it] 72%|███████▏  | 23/32 [00:23<00:10,  1.15s/it] 75%|███████▌  | 24/32 [00:25<00:09,  1.19s/it] 78%|███████▊  | 25/32 [00:26<00:08,  1.18s/it] 81%|████████▏ | 26/32 [00:27<00:06,  1.16s/it] 84%|████████▍ | 27/32 [00:28<00:05,  1.19s/it] 88%|████████▊ | 28/32 [00:29<00:04,  1.15s/it] 91%|█████████ | 29/32 [00:30<00:03,  1.16s/it] 94%|█████████▍| 30/32 [00:32<00:02,  1.14s/it] 97%|█████████▋| 31/32 [00:33<00:01,  1.16s/it]100%|██████████| 32/32 [00:34<00:00,  1.26s/it]100%|██████████| 32/32 [00:34<00:00,  1.09s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
/home/elicer/honest_llama/validation/../TruthfulQA/truthfulqa/metrics.py:284: FutureWarning: load_metric is deprecated and will be removed in the next major version of datasets. Use 'evaluate.load' instead, from the new library 🤗 Evaluate: https://huggingface.co/docs/evaluate
  bleurt = load_metric("bleurt", cache_dir=cache_dir)
[[0.651 0.665 0.645 ... 0.646 0.647 0.652]
 [0.659 0.644 0.645 ... 0.648 0.658 0.656]
 [0.651 0.657 0.685 ... 0.637 0.648 0.667]
 ...
 [0.765 0.762 0.657 ... 0.73  0.704 0.674]
 [0.748 0.678 0.696 ... 0.663 0.769 0.786]
 [0.775 0.815 0.74  ... 0.697 0.809 0.79 ]]
Heads intervened:  [(8, 16), (8, 19), (10, 18), (11, 16), (11, 17), (12, 4), (12, 15), (12, 22), (13, 8), (13, 16), (14, 2), (14, 20), (15, 28), (16, 17), (16, 26), (16, 30), (17, 4), (17, 9), (17, 13), (17, 17), (17, 29), (18, 29), (19, 13), (19, 17), (19, 31), (20, 22), (20, 30), (21, 18), (22, 2), (22, 8), (22, 16), (22, 23), (22, 30), (23, 3), (23, 4), (23, 7), (23, 12), (23, 13), (23, 25), (25, 15), (30, 14), (30, 23), (31, 1), (31, 3), (31, 6), (31, 11), (31, 25), (31, 30)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
2023-12-04 01:55:52.014074: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1635] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 24961 MB memory:  -> device: 0, name: NVIDIA A100 80GB PCIe MIG 3g.40gb, pci bus id: 0000:65:00.0, compute capability: 8.0
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 278.75it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-ec0cf83741fdb3e8.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-d31e6c0c76fafb4d.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:01<01:44,  1.05s/it]  3%|▎         | 3/100 [00:01<00:30,  3.14it/s]  5%|▌         | 5/100 [00:01<00:17,  5.39it/s]  7%|▋         | 7/100 [00:01<00:12,  7.54it/s]  9%|▉         | 9/100 [00:01<00:09,  9.50it/s] 11%|█         | 11/100 [00:01<00:07, 11.17it/s] 13%|█▎        | 13/100 [00:01<00:06, 12.46it/s] 15%|█▌        | 15/100 [00:01<00:06, 13.55it/s] 17%|█▋        | 17/100 [00:02<00:05, 14.37it/s] 19%|█▉        | 19/100 [00:02<00:05, 14.86it/s] 21%|██        | 21/100 [00:02<00:05, 15.35it/s] 23%|██▎       | 23/100 [00:02<00:04, 15.69it/s] 25%|██▌       | 25/100 [00:02<00:04, 15.86it/s] 27%|██▋       | 27/100 [00:02<00:04, 16.07it/s] 29%|██▉       | 29/100 [00:02<00:04, 16.25it/s] 31%|███       | 31/100 [00:02<00:04, 16.27it/s] 33%|███▎      | 33/100 [00:02<00:04, 16.25it/s] 35%|███▌      | 35/100 [00:03<00:03, 16.34it/s] 37%|███▋      | 37/100 [00:03<00:03, 16.42it/s] 39%|███▉      | 39/100 [00:03<00:03, 16.45it/s] 41%|████      | 41/100 [00:03<00:03, 16.51it/s] 43%|████▎     | 43/100 [00:03<00:03, 16.54it/s] 45%|████▌     | 45/100 [00:03<00:03, 16.56it/s] 47%|████▋     | 47/100 [00:03<00:03, 16.55it/s] 49%|████▉     | 49/100 [00:03<00:03, 16.50it/s] 51%|█████     | 51/100 [00:04<00:02, 16.54it/s] 53%|█████▎    | 53/100 [00:04<00:02, 16.58it/s] 55%|█████▌    | 55/100 [00:04<00:02, 16.45it/s] 57%|█████▋    | 57/100 [00:04<00:02, 16.41it/s] 59%|█████▉    | 59/100 [00:04<00:02, 16.48it/s] 61%|██████    | 61/100 [00:04<00:02, 16.44it/s] 63%|██████▎   | 63/100 [00:04<00:02, 16.49it/s] 65%|██████▌   | 65/100 [00:04<00:02, 16.32it/s] 67%|██████▋   | 67/100 [00:05<00:02, 15.80it/s] 69%|██████▉   | 69/100 [00:05<00:01, 15.90it/s] 71%|███████   | 71/100 [00:05<00:01, 16.05it/s] 73%|███████▎  | 73/100 [00:05<00:01, 16.18it/s] 75%|███████▌  | 75/100 [00:05<00:01, 16.30it/s] 77%|███████▋  | 77/100 [00:05<00:01, 16.38it/s] 79%|███████▉  | 79/100 [00:05<00:01, 16.41it/s] 81%|████████  | 81/100 [00:05<00:01, 16.44it/s] 83%|████████▎ | 83/100 [00:06<00:01, 16.45it/s] 85%|████████▌ | 85/100 [00:06<00:00, 16.28it/s] 87%|████████▋ | 87/100 [00:06<00:00, 16.34it/s] 89%|████████▉ | 89/100 [00:06<00:00, 16.41it/s] 91%|█████████ | 91/100 [00:06<00:00, 16.42it/s] 93%|█████████▎| 93/100 [00:06<00:00, 16.42it/s] 95%|█████████▌| 95/100 [00:06<00:00, 15.91it/s] 97%|█████████▋| 97/100 [00:06<00:00, 16.13it/s] 99%|█████████▉| 99/100 [00:07<00:00, 16.29it/s]100%|██████████| 100/100 [00:07<00:00, 14.10it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 341.89it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-1939fcc1eeebdaa7.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-785bb4b6f2089589.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:18,  5.40it/s]  2%|▏         | 2/100 [00:00<00:16,  5.98it/s]  3%|▎         | 3/100 [00:00<00:14,  6.48it/s]  4%|▍         | 4/100 [00:00<00:14,  6.77it/s]  5%|▌         | 5/100 [00:00<00:13,  6.96it/s]  6%|▌         | 6/100 [00:00<00:13,  6.74it/s]  7%|▋         | 7/100 [00:01<00:13,  6.69it/s]  8%|▊         | 8/100 [00:01<00:13,  6.71it/s]  9%|▉         | 9/100 [00:01<00:13,  6.75it/s] 10%|█         | 10/100 [00:01<00:13,  6.88it/s] 11%|█         | 11/100 [00:01<00:13,  6.77it/s] 12%|█▏        | 12/100 [00:01<00:13,  6.56it/s] 13%|█▎        | 13/100 [00:01<00:12,  6.76it/s] 14%|█▍        | 14/100 [00:02<00:12,  6.85it/s] 15%|█▌        | 15/100 [00:02<00:12,  7.01it/s] 16%|█▌        | 16/100 [00:02<00:12,  6.79it/s] 17%|█▋        | 17/100 [00:02<00:12,  6.78it/s] 18%|█▊        | 18/100 [00:02<00:12,  6.81it/s] 19%|█▉        | 19/100 [00:02<00:11,  6.79it/s] 20%|██        | 20/100 [00:02<00:11,  6.98it/s] 21%|██        | 21/100 [00:03<00:11,  7.00it/s] 22%|██▏       | 22/100 [00:03<00:11,  6.99it/s] 23%|██▎       | 23/100 [00:03<00:11,  6.97it/s] 24%|██▍       | 24/100 [00:03<00:10,  7.04it/s] 25%|██▌       | 25/100 [00:03<00:10,  7.04it/s] 26%|██▌       | 26/100 [00:03<00:10,  6.99it/s] 27%|██▋       | 27/100 [00:03<00:10,  6.70it/s] 28%|██▊       | 28/100 [00:04<00:11,  6.42it/s] 29%|██▉       | 29/100 [00:04<00:11,  6.35it/s] 30%|███       | 30/100 [00:04<00:10,  6.64it/s] 31%|███       | 31/100 [00:04<00:10,  6.78it/s] 32%|███▏      | 32/100 [00:04<00:09,  6.83it/s] 33%|███▎      | 33/100 [00:04<00:09,  6.72it/s] 34%|███▍      | 34/100 [00:05<00:09,  6.83it/s] 35%|███▌      | 35/100 [00:05<00:09,  6.87it/s] 36%|███▌      | 36/100 [00:05<00:09,  6.98it/s] 37%|███▋      | 37/100 [00:05<00:09,  6.88it/s] 38%|███▊      | 38/100 [00:05<00:08,  6.96it/s] 39%|███▉      | 39/100 [00:05<00:08,  6.80it/s] 40%|████      | 40/100 [00:05<00:08,  6.79it/s] 41%|████      | 41/100 [00:06<00:08,  6.91it/s] 42%|████▏     | 42/100 [00:06<00:08,  6.74it/s] 43%|████▎     | 43/100 [00:06<00:08,  6.91it/s] 44%|████▍     | 44/100 [00:06<00:08,  6.80it/s] 45%|████▌     | 45/100 [00:06<00:07,  6.91it/s] 46%|████▌     | 46/100 [00:06<00:07,  6.88it/s] 47%|████▋     | 47/100 [00:06<00:07,  6.68it/s] 48%|████▊     | 48/100 [00:07<00:07,  6.87it/s] 49%|████▉     | 49/100 [00:07<00:07,  6.97it/s] 50%|█████     | 50/100 [00:07<00:07,  7.03it/s] 51%|█████     | 51/100 [00:07<00:07,  6.92it/s] 52%|█████▏    | 52/100 [00:07<00:06,  7.04it/s] 53%|█████▎    | 53/100 [00:07<00:06,  6.91it/s] 54%|█████▍    | 54/100 [00:07<00:06,  6.81it/s] 55%|█████▌    | 55/100 [00:08<00:06,  6.64it/s] 56%|█████▌    | 56/100 [00:08<00:06,  6.84it/s] 57%|█████▋    | 57/100 [00:08<00:06,  6.94it/s] 58%|█████▊    | 58/100 [00:08<00:05,  7.00it/s] 59%|█████▉    | 59/100 [00:08<00:05,  7.12it/s] 60%|██████    | 60/100 [00:08<00:05,  6.98it/s] 61%|██████    | 61/100 [00:08<00:05,  6.92it/s] 62%|██████▏   | 62/100 [00:09<00:05,  6.92it/s] 63%|██████▎   | 63/100 [00:09<00:05,  7.02it/s] 64%|██████▍   | 64/100 [00:09<00:05,  7.08it/s] 65%|██████▌   | 65/100 [00:09<00:05,  6.94it/s] 66%|██████▌   | 66/100 [00:09<00:04,  6.92it/s] 67%|██████▋   | 67/100 [00:09<00:04,  6.95it/s] 68%|██████▊   | 68/100 [00:09<00:04,  7.02it/s] 69%|██████▉   | 69/100 [00:10<00:04,  6.96it/s] 70%|███████   | 70/100 [00:10<00:04,  6.97it/s] 71%|███████   | 71/100 [00:10<00:04,  7.00it/s] 72%|███████▏  | 72/100 [00:10<00:04,  6.86it/s] 73%|███████▎  | 73/100 [00:10<00:04,  6.73it/s] 74%|███████▍  | 74/100 [00:10<00:03,  6.58it/s] 75%|███████▌  | 75/100 [00:10<00:03,  6.75it/s] 76%|███████▌  | 76/100 [00:11<00:03,  6.71it/s] 77%|███████▋  | 77/100 [00:11<00:03,  6.57it/s] 78%|███████▊  | 78/100 [00:11<00:03,  6.50it/s] 79%|███████▉  | 79/100 [00:11<00:03,  6.63it/s] 80%|████████  | 80/100 [00:11<00:02,  6.82it/s] 81%|████████  | 81/100 [00:11<00:02,  6.87it/s] 82%|████████▏ | 82/100 [00:12<00:02,  7.01it/s] 83%|████████▎ | 83/100 [00:12<00:02,  6.86it/s] 84%|████████▍ | 84/100 [00:12<00:02,  6.99it/s] 85%|████████▌ | 85/100 [00:12<00:02,  7.02it/s] 86%|████████▌ | 86/100 [00:12<00:02,  6.84it/s] 87%|████████▋ | 87/100 [00:12<00:01,  6.71it/s] 88%|████████▊ | 88/100 [00:12<00:01,  6.90it/s] 89%|████████▉ | 89/100 [00:13<00:01,  6.90it/s] 90%|█████████ | 90/100 [00:13<00:01,  6.77it/s] 91%|█████████ | 91/100 [00:13<00:01,  6.91it/s] 92%|█████████▏| 92/100 [00:13<00:01,  6.88it/s] 93%|█████████▎| 93/100 [00:13<00:01,  6.97it/s] 94%|█████████▍| 94/100 [00:13<00:00,  6.96it/s] 95%|█████████▌| 95/100 [00:13<00:00,  6.87it/s] 96%|█████████▌| 96/100 [00:14<00:00,  6.91it/s] 97%|█████████▋| 97/100 [00:14<00:00,  6.97it/s] 98%|█████████▊| 98/100 [00:14<00:00,  6.96it/s] 99%|█████████▉| 99/100 [00:14<00:00,  6.89it/s]100%|██████████| 100/100 [00:14<00:00,  7.01it/s]100%|██████████| 100/100 [00:14<00:00,  6.85it/s]
FOLD 0
Metric    CE Loss  KL wrt Orig
Model                         
llama_7B  6.09168     4.010005
Running fold 1
y_val (1000,) (4000, 32, 32, 128) (1000, 32, 32, 128) (4000,)
  0%|          | 0/32 [00:00<?, ?it/s]  3%|▎         | 1/32 [00:00<00:30,  1.02it/s]  6%|▋         | 2/32 [00:02<00:33,  1.11s/it]  9%|▉         | 3/32 [00:03<00:34,  1.18s/it] 12%|█▎        | 4/32 [00:04<00:33,  1.19s/it] 16%|█▌        | 5/32 [00:05<00:33,  1.23s/it] 19%|█▉        | 6/32 [00:07<00:32,  1.26s/it] 22%|██▏       | 7/32 [00:08<00:31,  1.26s/it] 25%|██▌       | 8/32 [00:09<00:30,  1.26s/it] 28%|██▊       | 9/32 [00:11<00:28,  1.26s/it] 31%|███▏      | 10/32 [00:12<00:27,  1.27s/it] 34%|███▍      | 11/32 [00:13<00:26,  1.25s/it] 38%|███▊      | 12/32 [00:14<00:24,  1.22s/it] 41%|████      | 13/32 [00:15<00:22,  1.21s/it] 44%|████▍     | 14/32 [00:17<00:21,  1.20s/it] 47%|████▋     | 15/32 [00:18<00:20,  1.19s/it] 50%|█████     | 16/32 [00:19<00:19,  1.19s/it] 53%|█████▎    | 17/32 [00:20<00:17,  1.19s/it] 56%|█████▋    | 18/32 [00:21<00:16,  1.19s/it] 59%|█████▉    | 19/32 [00:23<00:15,  1.22s/it] 62%|██████▎   | 20/32 [00:24<00:15,  1.27s/it] 66%|██████▌   | 21/32 [00:25<00:14,  1.27s/it] 69%|██████▉   | 22/32 [00:27<00:12,  1.27s/it] 72%|███████▏  | 23/32 [00:28<00:11,  1.28s/it] 75%|███████▌  | 24/32 [00:29<00:10,  1.30s/it] 78%|███████▊  | 25/32 [00:30<00:09,  1.31s/it] 81%|████████▏ | 26/32 [00:32<00:07,  1.30s/it] 84%|████████▍ | 27/32 [00:33<00:06,  1.31s/it] 88%|████████▊ | 28/32 [00:34<00:05,  1.30s/it] 91%|█████████ | 29/32 [00:36<00:03,  1.30s/it] 94%|█████████▍| 30/32 [00:37<00:02,  1.29s/it] 97%|█████████▋| 31/32 [00:38<00:01,  1.29s/it]100%|██████████| 32/32 [00:40<00:00,  1.34s/it]100%|██████████| 32/32 [00:40<00:00,  1.26s/it]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
[[0.666 0.672 0.662 ... 0.668 0.662 0.67 ]
 [0.662 0.662 0.659 ... 0.677 0.666 0.663]
 [0.668 0.67  0.68  ... 0.661 0.665 0.671]
 ...
 [0.758 0.75  0.674 ... 0.716 0.694 0.677]
 [0.749 0.671 0.686 ... 0.674 0.762 0.76 ]
 [0.765 0.805 0.748 ... 0.743 0.787 0.775]]
Heads intervened:  [(5, 10), (8, 16), (11, 16), (11, 17), (12, 4), (12, 22), (13, 8), (13, 10), (13, 16), (13, 21), (14, 2), (15, 1), (15, 10), (15, 28), (16, 3), (16, 4), (16, 17), (16, 26), (16, 30), (17, 4), (17, 13), (17, 17), (17, 19), (17, 29), (18, 29), (19, 13), (19, 17), (19, 28), (19, 31), (20, 22), (20, 30), (21, 23), (22, 16), (23, 3), (23, 4), (23, 12), (23, 13), (23, 25), (26, 13), (27, 3), (27, 7), (30, 4), (30, 18), (30, 23), (31, 1), (31, 6), (31, 10), (31, 18)]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
llama_7B ['bleurt', 'bleu', 'rouge']
tqa_done
['bleurt', 'bleu', 'rouge']
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
Running BLEU / ROUGE!
'llama_7B'
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 259.08it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-30ec7b2da7888791.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-4e53eea82b0ecfef.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  2%|▏         | 2/100 [00:00<00:06, 14.61it/s]  4%|▍         | 4/100 [00:00<00:06, 15.50it/s]  6%|▌         | 6/100 [00:00<00:05, 15.75it/s]  8%|▊         | 8/100 [00:00<00:05, 15.70it/s] 10%|█         | 10/100 [00:00<00:05, 15.67it/s] 12%|█▏        | 12/100 [00:00<00:05, 15.64it/s] 14%|█▍        | 14/100 [00:00<00:05, 15.78it/s] 16%|█▌        | 16/100 [00:01<00:05, 15.87it/s] 18%|█▊        | 18/100 [00:01<00:05, 16.00it/s] 20%|██        | 20/100 [00:01<00:04, 16.07it/s] 22%|██▏       | 22/100 [00:01<00:04, 15.87it/s] 24%|██▍       | 24/100 [00:01<00:04, 16.00it/s] 26%|██▌       | 26/100 [00:01<00:04, 16.07it/s] 28%|██▊       | 28/100 [00:01<00:04, 16.14it/s] 30%|███       | 30/100 [00:01<00:04, 15.98it/s] 32%|███▏      | 32/100 [00:02<00:04, 16.04it/s] 34%|███▍      | 34/100 [00:02<00:04, 16.04it/s] 36%|███▌      | 36/100 [00:02<00:04, 15.99it/s] 38%|███▊      | 38/100 [00:02<00:03, 16.00it/s] 40%|████      | 40/100 [00:02<00:03, 16.10it/s] 42%|████▏     | 42/100 [00:02<00:03, 16.00it/s] 44%|████▍     | 44/100 [00:02<00:03, 15.90it/s] 46%|████▌     | 46/100 [00:02<00:03, 16.04it/s] 48%|████▊     | 48/100 [00:03<00:03, 16.14it/s] 50%|█████     | 50/100 [00:03<00:03, 16.22it/s] 52%|█████▏    | 52/100 [00:03<00:02, 16.27it/s] 54%|█████▍    | 54/100 [00:03<00:02, 16.31it/s] 56%|█████▌    | 56/100 [00:03<00:02, 16.28it/s] 58%|█████▊    | 58/100 [00:03<00:02, 16.02it/s] 60%|██████    | 60/100 [00:03<00:02, 16.10it/s] 62%|██████▏   | 62/100 [00:03<00:02, 16.17it/s] 64%|██████▍   | 64/100 [00:03<00:02, 16.22it/s] 66%|██████▌   | 66/100 [00:04<00:02, 16.26it/s] 68%|██████▊   | 68/100 [00:04<00:02, 15.96it/s] 70%|███████   | 70/100 [00:04<00:01, 15.99it/s] 72%|███████▏  | 72/100 [00:04<00:01, 16.11it/s] 74%|███████▍  | 74/100 [00:04<00:01, 16.10it/s] 76%|███████▌  | 76/100 [00:04<00:01, 15.96it/s] 78%|███████▊  | 78/100 [00:04<00:01, 15.90it/s] 80%|████████  | 80/100 [00:04<00:01, 15.99it/s] 82%|████████▏ | 82/100 [00:05<00:01, 16.05it/s] 84%|████████▍ | 84/100 [00:05<00:00, 16.06it/s] 86%|████████▌ | 86/100 [00:05<00:00, 16.14it/s] 88%|████████▊ | 88/100 [00:05<00:00, 16.19it/s] 90%|█████████ | 90/100 [00:05<00:00, 16.20it/s] 92%|█████████▏| 92/100 [00:05<00:00, 15.97it/s] 94%|█████████▍| 94/100 [00:05<00:00, 15.98it/s] 96%|█████████▌| 96/100 [00:05<00:00, 16.03it/s] 98%|█████████▊| 98/100 [00:06<00:00, 16.09it/s]100%|██████████| 100/100 [00:06<00:00, 16.15it/s]100%|██████████| 100/100 [00:06<00:00, 16.03it/s]
Found cached dataset openwebtext-10k (/home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 352.76it/s]
Loading cached shuffled indices for dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-14295f39edd20556.arrow
Loading cached processed dataset at /home/elicer/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b/cache-10ca04ba0c7bb427.arrow
  0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:16,  5.84it/s]  2%|▏         | 2/100 [00:00<00:15,  6.37it/s]  3%|▎         | 3/100 [00:00<00:14,  6.71it/s]  4%|▍         | 4/100 [00:00<00:14,  6.72it/s]  5%|▌         | 5/100 [00:00<00:13,  6.85it/s]  6%|▌         | 6/100 [00:00<00:13,  6.94it/s]  7%|▋         | 7/100 [00:01<00:13,  6.74it/s]  8%|▊         | 8/100 [00:01<00:13,  6.75it/s]  9%|▉         | 9/100 [00:01<00:13,  6.92it/s] 10%|█         | 10/100 [00:01<00:12,  6.99it/s] 11%|█         | 11/100 [00:01<00:13,  6.77it/s] 12%|█▏        | 12/100 [00:01<00:12,  6.87it/s] 13%|█▎        | 13/100 [00:01<00:12,  6.89it/s] 14%|█▍        | 14/100 [00:02<00:12,  6.91it/s] 15%|█▌        | 15/100 [00:02<00:12,  7.05it/s] 16%|█▌        | 16/100 [00:02<00:12,  6.79it/s] 17%|█▋        | 17/100 [00:02<00:12,  6.71it/s] 18%|█▊        | 18/100 [00:02<00:12,  6.71it/s] 19%|█▉        | 19/100 [00:02<00:12,  6.69it/s] 20%|██        | 20/100 [00:02<00:11,  6.88it/s] 21%|██        | 21/100 [00:03<00:11,  6.84it/s] 22%|██▏       | 22/100 [00:03<00:11,  6.94it/s] 23%|██▎       | 23/100 [00:03<00:11,  6.89it/s] 24%|██▍       | 24/100 [00:03<00:10,  7.00it/s] 25%|██▌       | 25/100 [00:03<00:10,  7.03it/s] 26%|██▌       | 26/100 [00:03<00:10,  7.10it/s] 27%|██▋       | 27/100 [00:03<00:10,  6.91it/s] 28%|██▊       | 28/100 [00:04<00:10,  6.90it/s] 29%|██▉       | 29/100 [00:04<00:10,  7.02it/s] 30%|███       | 30/100 [00:04<00:10,  6.89it/s] 31%|███       | 31/100 [00:04<00:10,  6.88it/s] 32%|███▏      | 32/100 [00:04<00:09,  6.95it/s] 33%|███▎      | 33/100 [00:04<00:09,  6.80it/s] 34%|███▍      | 34/100 [00:04<00:09,  6.93it/s] 35%|███▌      | 35/100 [00:05<00:09,  6.70it/s] 36%|███▌      | 36/100 [00:05<00:09,  6.82it/s] 37%|███▋      | 37/100 [00:05<00:09,  6.86it/s] 38%|███▊      | 38/100 [00:05<00:09,  6.67it/s] 39%|███▉      | 39/100 [00:05<00:08,  6.82it/s] 40%|████      | 40/100 [00:05<00:08,  6.98it/s] 41%|████      | 41/100 [00:05<00:08,  6.89it/s] 42%|████▏     | 42/100 [00:06<00:08,  6.82it/s] 43%|████▎     | 43/100 [00:06<00:08,  6.95it/s] 44%|████▍     | 44/100 [00:06<00:08,  6.92it/s] 45%|████▌     | 45/100 [00:06<00:07,  6.90it/s] 46%|████▌     | 46/100 [00:06<00:07,  6.84it/s] 47%|████▋     | 47/100 [00:06<00:07,  6.97it/s] 48%|████▊     | 48/100 [00:07<00:07,  6.54it/s] 49%|████▉     | 49/100 [00:07<00:07,  6.56it/s] 50%|█████     | 50/100 [00:07<00:07,  6.49it/s] 51%|█████     | 51/100 [00:07<00:07,  6.70it/s] 52%|█████▏    | 52/100 [00:07<00:07,  6.71it/s] 53%|█████▎    | 53/100 [00:07<00:06,  6.77it/s] 54%|█████▍    | 54/100 [00:07<00:06,  6.59it/s] 55%|█████▌    | 55/100 [00:08<00:06,  6.51it/s] 56%|█████▌    | 56/100 [00:08<00:06,  6.64it/s] 57%|█████▋    | 57/100 [00:08<00:06,  6.77it/s] 58%|█████▊    | 58/100 [00:08<00:06,  6.91it/s] 59%|█████▉    | 59/100 [00:08<00:06,  6.82it/s] 60%|██████    | 60/100 [00:08<00:05,  6.92it/s] 61%|██████    | 61/100 [00:08<00:05,  6.91it/s] 62%|██████▏   | 62/100 [00:09<00:05,  6.86it/s] 63%|██████▎   | 63/100 [00:09<00:05,  6.96it/s] 64%|██████▍   | 64/100 [00:09<00:05,  6.94it/s] 65%|██████▌   | 65/100 [00:09<00:05,  6.77it/s] 66%|██████▌   | 66/100 [00:09<00:05,  6.74it/s] 67%|██████▋   | 67/100 [00:09<00:04,  6.90it/s] 68%|██████▊   | 68/100 [00:09<00:04,  6.67it/s] 69%|██████▉   | 69/100 [00:10<00:04,  6.86it/s] 70%|███████   | 70/100 [00:10<00:04,  7.00it/s] 71%|███████   | 71/100 [00:10<00:04,  6.84it/s] 72%|███████▏  | 72/100 [00:10<00:04,  6.98it/s] 73%|███████▎  | 73/100 [00:10<00:03,  6.85it/s] 74%|███████▍  | 74/100 [00:10<00:03,  6.95it/s] 75%|███████▌  | 75/100 [00:10<00:03,  6.99it/s] 76%|███████▌  | 76/100 [00:11<00:03,  7.10it/s] 77%|███████▋  | 77/100 [00:11<00:03,  6.92it/s] 78%|███████▊  | 78/100 [00:11<00:03,  6.96it/s] 79%|███████▉  | 79/100 [00:11<00:02,  7.09it/s] 80%|████████  | 80/100 [00:11<00:02,  7.15it/s] 81%|████████  | 81/100 [00:11<00:02,  7.12it/s] 82%|████████▏ | 82/100 [00:11<00:02,  7.14it/s] 83%|████████▎ | 83/100 [00:12<00:02,  7.05it/s] 84%|████████▍ | 84/100 [00:12<00:02,  7.10it/s] 85%|████████▌ | 85/100 [00:12<00:02,  7.09it/s] 86%|████████▌ | 86/100 [00:12<00:01,  7.03it/s] 87%|████████▋ | 87/100 [00:12<00:01,  7.12it/s] 88%|████████▊ | 88/100 [00:12<00:01,  7.06it/s] 89%|████████▉ | 89/100 [00:12<00:01,  6.94it/s] 90%|█████████ | 90/100 [00:13<00:01,  6.75it/s] 91%|█████████ | 91/100 [00:13<00:01,  6.62it/s] 92%|█████████▏| 92/100 [00:13<00:01,  6.69it/s] 93%|█████████▎| 93/100 [00:13<00:01,  6.84it/s] 94%|█████████▍| 94/100 [00:13<00:00,  6.92it/s] 95%|█████████▌| 95/100 [00:13<00:00,  6.94it/s] 96%|█████████▌| 96/100 [00:13<00:00,  6.97it/s] 97%|█████████▋| 97/100 [00:14<00:00,  7.07it/s] 98%|█████████▊| 98/100 [00:14<00:00,  6.96it/s] 99%|█████████▉| 99/100 [00:14<00:00,  6.84it/s]100%|██████████| 100/100 [00:14<00:00,  7.00it/s]100%|██████████| 100/100 [00:14<00:00,  6.87it/s]
FOLD 1
Metric      CE Loss  KL wrt Orig
Model                           
llama_7B  14.934219     12.66209
[10.51294922  8.33604775]
